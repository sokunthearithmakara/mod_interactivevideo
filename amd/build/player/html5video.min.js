define("mod_interactivevideo/player/html5video",["exports","core/event_dispatcher"],(function(_exports,_event_dispatcher){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;var _default=
/**
   * HTML5 Video Player class
   *
   * @module     mod_interactivevideo/player/html5video
   * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
class{constructor(url,start,end){let opts=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const showControls=opts.showControls||!1,node=opts.node||"player",autoplay=opts.autoplay||!1;this.type="html5video",this.start=start,this.end=end,this.frequency=.28,this.support={playbackrate:!0,quality:!1};var player=document.getElementById(node);this.posterImage=player.poster;const ext=url.split(".").pop();if(-1===["fmp4","m4v","mov","mp4","ogv","webm"].indexOf(ext)){this.audio=!0;const canvas='<canvas id="visualizer"></canvas>';player.insertAdjacentHTML("afterend",canvas)}player.src=url,player.controls=showControls,player.currentTime=start,(document.body.classList.contains("mobiletheme")||autoplay)&&(player.muted=!0,player.autoplay=!0),player.tabIndex=-1;let self=this;showControls||document.body.classList.add("no-original-controls"),player.setAttribute("playsinline",""),player.setAttribute("disablePictureInPicture",""),player.setAttribute("disablePictureInPicture",""),player.addEventListener("loadedmetadata",(function(){self.aspectratio=self.ratio();let totaltime=Number(player.duration.toFixed(2));end=end?Math.min(end,totaltime):totaltime,end=Number(end.toFixed(2)),self.end=end,self.totaltime=totaltime,self.duration=self.end-self.start,player.pause(),(0,_event_dispatcher.dispatchEvent)("iv:playerLoaded",{tracks:null}),(0,_event_dispatcher.dispatchEvent)("iv:playerReady")})),player.addEventListener("seeked",(function(){(0,_event_dispatcher.dispatchEvent)("iv:playerSeek",{time:player.currentTime})})),player.addEventListener("timeupdate",(function(){player.ended||end&&player.currentTime>=end?((0,_event_dispatcher.dispatchEvent)("iv:playerEnded"),player.pause()):player.paused?(0,_event_dispatcher.dispatchEvent)("iv:playerPaused"):player.paused||(0,_event_dispatcher.dispatchEvent)("iv:playerPlaying")})),player.addEventListener("error",(function(e){(0,_event_dispatcher.dispatchEvent)("iv:playerError",{error:e})})),player.addEventListener("ratechange",(function(){(0,_event_dispatcher.dispatchEvent)("iv:playerRateChange",{rate:player.playbackRate})})),this.player=player}visualizer(){var context=new AudioContext,src=context.createMediaElementSource(this.player),analyser=context.createAnalyser(),canvas=document.getElementById("visualizer");canvas.width=window.innerWidth,canvas.height=window.innerHeight;var ctx=canvas.getContext("2d");src.connect(analyser),analyser.connect(context.destination),analyser.fftSize=256;var barHeight,bufferLength=analyser.frequencyBinCount,dataArray=new Uint8Array(bufferLength),WIDTH=canvas.width,HEIGHT=canvas.height,barWidth=WIDTH/bufferLength*2.5,x=0;const renderFrame=()=>{requestAnimationFrame(renderFrame),x=0,analyser.getByteFrequencyData(dataArray),ctx.fillStyle="#000",ctx.fillRect(0,0,WIDTH,HEIGHT);for(var i=0;i<bufferLength;i++){var r=(barHeight=dataArray[i])+i/bufferLength*25,g=i/bufferLength*250;ctx.fillStyle="rgb("+r+","+g+",50)",ctx.fillRect(x,HEIGHT-barHeight,barWidth,barHeight),x+=barWidth+1}};renderFrame()}play(){this.player.play()}async pause(){await this.player.pause()}stop(starttime){this.player.pause(),this.player.currentTime=starttime}seek(time){return this.player.currentTime=time,!0}getCurrentTime(){return this.player.currentTime}getDuration(){return this.player.duration}isPaused(){return this.player.paused}isPlaying(){return!this.player.paused}isEnded(){return this.player.ended}ratio(){return this.audio?16/9:this.player.videoWidth/this.player.videoHeight}destroy(){document.getElementById("video-wrapper").innerHTML='<div id="player" style="width:100%; max-width: 100%"></div>',this.player.pause(),this.player.removeAttribute("src"),this.player.load()}getState(){return this.player.paused?"paused":"playing"}setRate(rate){this.player.playbackRate=rate}mute(){this.player.muted=!0}unMute(){this.player.muted=!1}originalPlayer(){return this.player}setQuality(quality){return quality}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=html5video.min.js.map