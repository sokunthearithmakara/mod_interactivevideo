define("mod_interactivevideo/player/yt",["exports","core/event_dispatcher"],(function(_exports,_event_dispatcher){
/**
   * Youtube Player class
   *
   * @module     mod_interactivevideo/player/yt
   * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
let player;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;var _default=class{constructor(url,start,end){let opts=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const showControls=opts.showControls||!1,customStart=opts.customStart||!1,preload=opts.preload||!1,node=opts.node||"player";var YT;this.type="yt",this.start=start,this.end=end,this.frequency=.25,this.support={playbackrate:!0,quality:!1};var videoId=new RegExp("(?:https?:\\/\\/)?(?:www\\.)?(?:youtube\\.com|youtu\\.be|youtube-nocookie\\.com)(?:\\/embed\\/|\\/watch\\?v=|\\/)([^\\/]+)","g").exec(url)[1];videoId=videoId.split("&")[0],this.videoId=videoId,this.posterImage="https://img.youtube.com/vi/".concat(videoId,"/hqdefault.jpg");let loadedcaption=!1;var ready=!1,self=this,options={videoId:videoId,width:1080,height:720,playerVars:{autoplay:opts.autoplay||0,hl:M.cfg.language,start:start,end:end,controls:showControls?1:0,showinfo:0,fs:0,iv_load_policy:3,cc_load_policy:0,autohide:1,rel:0,playsinline:1,disablekb:1,mute:0},events:{onError:function(e){(0,_event_dispatcher.dispatchEvent)("iv:playerError",{error:e.data})},onReady:function(e){if(self.title=e.target.videoTitle,self.end=self.end?Math.min(self.end,e.target.getDuration()):e.target.getDuration(),self.aspectratio=self.ratio(),1==preload&&0==customStart)ready=!0,(0,_event_dispatcher.dispatchEvent)("iv:playerReady");else{e.target.mute(),e.target.playVideo();let interval=setInterval((()=>{e.target.getCurrentTime()>0&&(clearInterval(interval),e.target.seekTo(self.start),e.target.pauseVideo(),e.target.unMute(),ready=!0,(0,_event_dispatcher.dispatchEvent)("iv:playerReady"))}),1e3)}},onStateChange:function(e){if(!1!==ready)switch(e.data){case YT.PlayerState.BUFFERING:(0,_event_dispatcher.dispatchEvent)("iv:playerBuffering");break;case YT.PlayerState.ENDED:(0,_event_dispatcher.dispatchEvent)("iv:playerEnded");break;case YT.PlayerState.PLAYING:player.getCurrentTime()>=self.end||player.getCurrentTime()<self.start?(player.seekTo(self.start),(0,_event_dispatcher.dispatchEvent)("iv:playerEnded")):(0,_event_dispatcher.dispatchEvent)("iv:playerPlaying");break;case YT.PlayerState.PAUSED:(0,_event_dispatcher.dispatchEvent)("iv:playerPaused");break;case YT.PlayerState.CUED:player.getCurrentTime()>=self.end&&player.seekTo(self.start)}},onPlaybackRateChange:function(e){(0,_event_dispatcher.dispatchEvent)("iv:playerRateChange",{rate:e.data})},onApiChange:function(){let tracks;loadedcaption||(player.loadModule("captions"),loadedcaption=!0),player.setOption("captions","track",{});try{tracks=player.getOption("captions","tracklist")}catch(e){tracks=[]}tracks&&tracks.length>0&&(tracks=tracks.map((track=>({label:track.displayName,code:track.languageCode}))),self.captions=tracks),loadedcaption=!0,(0,_event_dispatcher.dispatchEvent)("iv:playerLoaded",{tracks:tracks})}}};if(url.includes("youtube-nocookie")&&(options.host="https://www.youtube-nocookie.com"),window.YT)YT=window.YT||{},player=new YT.Player(node,options);else{var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api",tag.async=!0,tag.as="script",tag.rel="preload";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag),window.onYouTubeIframeAPIReady=function(){YT=window.YT||{},player=new YT.Player(node,options)}}}play(){player.playVideo()}async pause(){await player.pauseVideo()}stop(starttime){player.seekTo(starttime),player.pauseVideo()}async seek(time){return player.seekTo(time,!0),(0,_event_dispatcher.dispatchEvent)("iv:playerSeek",{time:time}),!0}getCurrentTime(){return player.getCurrentTime()}getDuration(){return player.getDuration()}isPaused(){return 2===player.getPlayerState()}isPlaying(){return 1===player.getPlayerState()}isEnded(){return 0===player.getPlayerState()||player.getCurrentTime()>=this.end}ratio(){return 16/9}destroy(){player.destroy(),(0,_event_dispatcher.dispatchEvent)("iv:playerDestroyed")}getState(){return player.getPlayerState()}setRate(rate){return player.setPlaybackRate(rate),rate}mute(){player.mute()}unMute(){player.unMute()}originalPlayer(){return player}setCaption(track){player.setOption("captions","track",track?{languageCode:track}:{})}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=yt.min.js.map