{"version":3,"file":"viewannotation.min.js","sources":["../src/viewannotation.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * View page module\n *\n * @module     mod_interactivevideo/viewannotation\n * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'jquery', 'core/event_dispatcher', 'core/toast', 'mod_interactivevideo/libraries/jquery-ui'\n], function($, {dispatchEvent}, Toast) {\n    let ctRenderer = {};\n    let annotations, // Array of annotations.\n        totaltime, // Video total time.\n        activityType, // Current activityType.\n        lastanno, // Last run annotation.\n        contentTypes, // Array of available content types.\n        displayoptions, // Display options.\n        releventAnnotations, // Array of annotations that are not skipped.\n        player;\n\n    const $videoNav = $('#video-nav');\n    const $interactionNav = $('#interactions-nav');\n\n    const convertSecondsToMinutes = (seconds) => {\n        const hours = Math.floor(seconds / 3600);\n        const minutes = Math.floor((seconds % 3600) / 60);\n        const remainingSeconds = seconds % 60;\n        let string = '';\n        if (hours > 0) {\n            string += hours + 'h ';\n        }\n        if (minutes > 0) {\n            string += minutes + 'm ';\n        }\n        if (remainingSeconds > 0) {\n            string += remainingSeconds + 's';\n        }\n        return string;\n    };\n\n    const renderAnnotationItems = async (annos, start, totaltime) => {\n        releventAnnotations = annos;\n\n        let actualduration = totaltime;\n\n        const skipsegments = annos.filter(x => x.type == 'skipsegment');\n\n        if (skipsegments.length > 0) {\n            skipsegments.forEach(x => {\n                const length = (Number(x.title) - Number(x.timestamp));\n                actualduration -= length;\n            });\n        }\n\n        const completableAnno = releventAnnotations.filter(x => x.hascompletion == 1);\n        const actualAnnotationCounts = completableAnno.length;\n\n        const xp = completableAnno.map(x => Number(x.xp)).reduce((a, b) => a + b, 0);\n\n        const completedAnnos = completableAnno\n            .filter(x => x.completed);\n\n        const xpEarned = completedAnnos.map(x => Number(x.xp)).reduce((a, b) => a + b, 0);\n\n        $(\".metadata\").empty();\n        $(\".metadata\").append(`<span class=\"d-inline-block mr-3\">\n            <i class=\"bi bi-stopwatch mr-2\"></i>${convertSecondsToMinutes(Math.ceil(actualduration))}</span>\n            <span class=\"d-inline-block mr-3\">\n        <i class=\"bi bi-bullseye mr-2\"></i>${completedAnnos.length} / ${actualAnnotationCounts}</span>\n        <span class=\"d-inline-block\"><i class=\"bi bi-star mr-2\"></i>${xpEarned} / ${xp}</span>`);\n\n        $(\"#interactions-nav ul\").empty();\n\n        if (annos.length == 0) {\n            return;\n        }\n\n        if (displayoptions.preventseeking == 1) {\n            $videoNav.addClass('no-pointer-events');\n        }\n\n        if (displayoptions.hidemainvideocontrols == 1 || displayoptions.hideinteractions == 1) {\n            if (displayoptions.hidemainvideocontrols == 1) {\n                $('#wrapper').addClass('no-videonav');\n            }\n            return;\n        }\n        const render = new Promise((resolve) => {\n            annos.forEach(async (x) => {\n                const renderer = ctRenderer[x.type];\n                renderer.renderItemOnVideoNavigation(x);\n            });\n            resolve();\n        });\n\n        await render;\n        dispatchEvent('annotationitemsrendered', {'annotations': annos});\n        $('.annolistinchapter').empty();\n        const chapteritems = releventAnnotations.filter(x => x.type != 'skipsegment' && x.hascompletion == 1);\n        chapteritems.sort((a, b) => a.timestamp - b.timestamp);\n        chapteritems.forEach((x) => {\n            $('[data-region=\"chapterlists\"] li').each(function() {\n                const cstart = $(this).data('start');\n                const cend = $(this).data('end');\n                if (x.timestamp >= cstart && x.timestamp < cend) {\n                    $(this).find('.annolistinchapter')\n                        .append(`<li class=\"border-bottom anno d-flex align-items-center justify-content-between\n                         px-3 py-2 ${x.completed ? \"completed\" : \"\"}\" data-id=\"${x.id}\" data-timestamp=\"${x.timestamp}\">\n                         <span class=\"text-nowrap\">\n                         <i class=\"small bi ${x.completed ? \"bi-check-circle-fill text-success\" : 'bi-circle'} mr-2\"></i>\n                         <i class=\"${JSON.parse(x.prop).icon} mr-2\"></i></span>\n                         <span class=\"flex-grow-1 text-truncate\">${x.formattedtitle}</span>\n                         <span class=\"text-nowrap\">${x.xp}<i class=\"bi bi-star ml-1\"></i></span></li>`);\n                }\n            });\n        });\n        dispatchEvent('chapterrendered', {'annotations': releventAnnotations});\n    };\n\n    return {\n        renderAnnotationItems: renderAnnotationItems,\n        init: function(\n            url, cmid, interaction, course, userid, start = 0, end,\n            completionpercentage, gradeiteminstance, grademax, vtype,\n            preventskip = true, moment = null, doptions = {}, token = null) {\n            // Convert start to number if string\n            start = Number(start);\n            if (isNaN(start)) {\n                start = 0;\n            }\n\n            // Convert end to number if string\n            end = Number(end);\n            if (isNaN(end)) {\n                end = null;\n            }\n\n            displayoptions = doptions;\n\n            let playerReady = false;\n\n            const convertSecondsToHMS = (seconds) => {\n                const h = Math.floor(seconds / 3600);\n                const m = Math.floor(seconds % 3600 / 60);\n                const s = Math.floor(seconds % 3600 % 60);\n                return (h > 0 ? h + ':' : '') + (m < 10 ? '0' : '') + m + ':' + (s < 10 ? '0' : '') + s;\n            };\n\n            const replaceProgressBars = (percentage) => {\n                percentage = percentage > 100 ? 100 : percentage;\n                $videoNav.find('#progress').replaceWith(`<div id=\"progress\" style=\"width: ${percentage}%;\"></div>`);\n                $videoNav.find('#seekhead').css('left', percentage + '%');\n            };\n\n            const getAnnotations = (callback) => {\n                // Get all interaction items.\n                const annnoitems = $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'get_items',\n                        sesskey: M.cfg.sesskey,\n                        id: interaction,\n                        contextid: M.cfg.courseContextId,\n                        token: token,\n                        cmid: cmid\n                    }\n                });\n\n                // Get current user progress.\n                const userprogress = $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'get_progress',\n                        sesskey: M.cfg.sesskey,\n                        id: interaction,\n                        uid: userid,\n                        token: token,\n                        cmid: cmid\n                    }\n                });\n\n                // Get all content types.\n                const getContentTypes = $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'getallcontenttypes',\n                        sesskey: M.cfg.sesskey,\n                        token: token,\n                        cmid: cmid\n                    }\n                });\n\n                $.when(annnoitems, userprogress, getContentTypes).done(async function(annos, progress, ct) {\n                    annotations = JSON.parse(annos[0]);\n                    progress = JSON.parse(progress[0]);\n                    contentTypes = JSON.parse(ct[0]);\n                    // Get only annotations within the start and end times.\n                    // Remove the skip segments that are completely outside the start and end times.\n                    // Remove the annotations whose content type is not in the contentTypes.\n                    annotations = annotations.filter(x => {\n                        const inContentType = contentTypes.some(y => y.name === x.type);\n                        if (!inContentType) {\n                            return false;\n                        }\n\n                        if (x.type === 'skipsegment') {\n                            return !(x.timestamp > end || x.title < start);\n                        }\n\n                        return (x.timestamp >= start && x.timestamp <= end) || x.timestamp < 0;\n                    });\n\n                    const completedItems = progress.completeditems == '' ? [] : JSON.parse(progress.completeditems);\n                    annotations = annotations.map(x => {\n                        // First, let's make sure numbers are treated as numbers.\n                        x.timestamp = Number(x.timestamp);\n                        x.xp = Number(x.xp);\n                        if (x.type == 'skipsegment') {\n                            x.title = Number(x.title);\n                        }\n                        // Properties must be stringified so it can be passed through Fragment.\n                        x.prop = JSON.stringify(contentTypes.find(y => y.name == x.type));\n\n                        x.completed = completedItems.indexOf(x.id) > -1;\n\n                        // Handle the skip segments that are half inside the start and end times.\n                        if (x.type == 'skipsegment') {\n                            if (x.timestamp < start && x.title > start) {\n                                x.timestamp = start;\n                            }\n                            if (x.title > end && x.timestamp < end) {\n                                x.title = end;\n                            }\n                        }\n\n                        const advanced = JSON.parse(x.advanced);\n                        x.rerunnable = advanced && advanced.replaybehavior === '1';\n\n                        return x;\n                    });\n\n                    // Sort by timestamp.\n                    annotations.sort((a, b) => a.timestamp - b.timestamp);\n\n                    const skipsegments = annotations.filter(x => x.type == 'skipsegment');\n\n                    releventAnnotations = [];\n                    annotations.forEach(x => {\n                        let shouldAdd = true;\n                        skipsegments.forEach(y => {\n                            if (Number(x.timestamp) > Number(y.timestamp) && Number(x.timestamp) < Number(y.title)) {\n                                shouldAdd = false;\n                            }\n                        });\n                        if (shouldAdd) {\n                            releventAnnotations.push(x);\n                        }\n                    });\n\n                    if (releventAnnotations.length > 0 && !releventAnnotations.find(x => x.type == 'chapter')) {\n                        // Add a dummy chapter at the start of the video.\n                        releventAnnotations.unshift({\n                            id: 0,\n                            title: M.util.get_string('startchapter', 'mod_interactivevideo'),\n                            formattedtitle: M.util.get_string('startchapter', 'mod_interactivevideo'),\n                            timestamp: start,\n                            type: 'chapter',\n                            prop: JSON.stringify(contentTypes.find(x => x.name == 'chapter')),\n                            xp: 0,\n                            completed: true,\n                            hide: true\n                        });\n                    }\n\n                    const getRenderers = new Promise((resolve) => {\n                        const chapterContentType = contentTypes.find(x => x.name == 'chapter');\n                        // We want to use only the content types that are being used in the annotations\n                        contentTypes = contentTypes.filter(x => releventAnnotations.map(y => y.type).includes(x.name));\n                        if (contentTypes.length == 0) {\n                            // Remove the chapter toggle\n                            $('#chaptertoggle, #chapter-container-left, #chapter-container-right').remove();\n                            resolve(ctRenderer);\n                        } else {\n                            $('#chaptertoggle, #chapter-container-left, #chapter-container-right').removeClass('d-none');\n                        }\n                        if (!contentTypes.find(x => x.name == 'chapter')) {\n                            // Include the chapterContentType\n                            contentTypes.push(chapterContentType);\n                        }\n                        var count = 0;\n                        contentTypes.forEach(x => {\n                            require([x.amdmodule], function(Type) {\n                                ctRenderer[x.name] = new Type(player, releventAnnotations, interaction, course, userid,\n                                    completionpercentage, gradeiteminstance, grademax, vtype, preventskip, totaltime, start,\n                                    end, x, cmid, token);\n                                try {\n                                    ctRenderer[x.name].init();\n                                } catch (error) {\n                                    // Do nothing.\n                                }\n                                count++;\n                                if (count == contentTypes.length) {\n                                    resolve(ctRenderer);\n                                }\n                            });\n                        });\n                    });\n\n                    await getRenderers;\n\n                    await renderAnnotationItems(releventAnnotations, start, totaltime);\n                    $(\"#play\").removeClass('d-none');\n                    $(\"#spinner\").remove();\n                    $(\"#video-info\").toggleClass('d-none d-flex');\n                    callback();\n                });\n            };\n\n            const runInteraction = async (annotation) => {\n                lastanno = annotation;\n                // Remove the previous message but keep the one below the video.\n                $('#annotation-modal').modal('hide');\n                $('#message').not('[data-placement=bottom]').not('.sticky').remove();\n                $('#end-screen, #start-screen').fadeOut(300);\n\n                if (preventskip) {\n                    const theAnnotations = releventAnnotations\n                        .filter(x => Number(x.timestamp) < Number(annotation.timestamp)\n                            && x.completed == false && x.hascompletion == 1);\n                    if (theAnnotations.length > 0) {\n                        const theAnnotation = theAnnotations[0];\n                        player.pause();\n                        await player.seek((theAnnotation.timestamp - 0.7 > start) ? (theAnnotation.timestamp - 0.7) : start);\n                        Toast.add(M.util.get_string('youmustcompletethepreviousactivity', 'mod_interactivevideo'), {\n                            type: 'danger'\n                        });\n                        return;\n                    }\n                }\n                activityType = ctRenderer[annotation.type];\n                activityType.runInteraction(annotation);\n            };\n\n            const shareMoment = async () => {\n                if (!moment) {\n                    return;\n                }\n                // Check if the url has a timestamp using url params.\n                const urlParams = new URLSearchParams(window.location.search);\n                const time = Number(moment);\n                if (time && !isNaN(time) && time >= start && time <= end) {\n                    // Hide the start screen.\n                    $('#video-wrapper #start-screen').hide(0);\n                    await player.seek(time);\n                    player.play();\n                    const theAnnotation = releventAnnotations.find(x => x.timestamp == time);\n                    if (theAnnotation) {\n                        runInteraction(theAnnotation);\n                    }\n\n                    replaceProgressBars(((time - start) / totaltime) * 100);\n\n                }\n                urlParams.delete('t');\n                const newurl = window.location.protocol\n                    + '//' + window.location.host + window.location.pathname + '?' + urlParams.toString();\n                window.history.replaceState(null, null, newurl);\n            };\n\n            const onReady = async () => {\n                if (player.support.playbackrate == false) {\n                    $('#changerate').remove();\n                } else {\n                    $('#changerate').removeClass('d-none');\n                }\n\n                if (player.support.quality == false) {\n                    $('#changequality').remove();\n                } else {\n                    $('#changequality').removeClass('d-none');\n                }\n\n                if (player.posterImage) {\n                    $('#video-wrapper #start-screen').css({\n                        'background': `url(${player.posterImage}) no-repeat center center / cover`,\n                    });\n                }\n                $(\".video-block\").css('background', 'transparent');\n                const duration = await player.getDuration();\n                end = !end ? duration : Math.min(end, duration);\n                start = start > end ? 0 : start;\n                totaltime = end - start;\n                getAnnotations(shareMoment);\n                $('#duration').text(convertSecondsToHMS(totaltime));\n\n                // Recalculate the ratio of the video\n                const ratio = await player.ratio();\n                $(\"#video-wrapper\").css('padding-bottom', (1 / ratio) * 100 + '%');\n\n                playerReady = true;\n                $('#start-screen #start').focus();\n\n                $('#seekhead').draggable({\n                    'containment': '#video-nav',\n                    'axis': 'x',\n                    'cursor': 'col-resize',\n                    'start': function() {\n                        $(this).addClass('active');\n                        $('#taskinfo').addClass('no-pointer-events');\n                        $(\"#message, #end-screen\").remove();\n                    },\n                    'drag': async function(event, ui) {\n                        let timestamp = ((ui.position.left) / $('#video-nav').width()) * totaltime + start;\n                        await player.seek(timestamp);\n                        player.pause();\n                    },\n                    'stop': async function(event, ui) {\n                        setTimeout(function() {\n                            $('#taskinfo').removeClass('no-pointer-events');\n                        }, 200);\n                        setTimeout(function() {\n                            $('#seekhead').removeClass('active');\n                        }, 1000);\n                        let percentage = ui.position.left / $('#video-nav').width();\n                        replaceProgressBars(percentage * 100);\n                        player.play();\n                    }\n                });\n            };\n\n            const onPaused = () => {\n                if (!playerReady) {\n                    return;\n                }\n                clearInterval(interval);\n                $('#playpause').find('i').removeClass('bi-pause-fill').addClass('bi-play-fill');\n                $('#playpause').attr('data-original-title', M.util.get_string('play', 'mod_interactivevideo'));\n            };\n\n            const onEnded = (t) => {\n                if (!playerReady) {\n                    return;\n                }\n                const time = t || end;\n                // Check if theAnnotation exists at the end of the video.\n                const theAnnotation = releventAnnotations.find(x => x.timestamp == time);\n                if (theAnnotation && !lastanno) {\n                    if (!theAnnotation.completed || theAnnotation.rerunnable) {\n                        player.pause();\n                        runInteraction(theAnnotation);\n                    }\n                    // Toggle the tooltip to show the title.\n                    $interactionNav.find('.annotation[data-id=\"' + theAnnotation.id + '\"] .item').trigger('mouseover')\n                        .addClass('active');\n                    // Hide the tooltip after 2 seconds.\n                    setTimeout(function() {\n                        $interactionNav.find('.annotation[data-id=\"' + theAnnotation.id + '\"] .item').trigger('mouseout')\n                            .removeClass('active');\n                    }, 2000);\n                }\n\n                $('#restart').removeClass('d-none').fadeIn(300);\n                $('#end-screen').removeClass('d-none').fadeIn(300);\n                $('#progress').css('width', '100%');\n                $('#seekhead').css('left', '100%');\n                clearInterval(interval);\n                player.pause();\n                $('#playpause').find('i').removeClass('bi-pause-fill').addClass('bi-play-fill');\n                $('#playpause').attr('data-original-title', M.util.get_string('play', 'mod_interactivevideo'));\n            };\n\n            const onSeek = async (t) => {\n                if (!playerReady) {\n                    return;\n                }\n                if (t) {\n                    t = Number(t);\n                } else {\n                    t = await player.getCurrentTime();\n                }\n                if (t > start && t < end) {\n                    $('#end-screen, #start-screen').addClass('d-none');\n                }\n                var percentage = (t - start) / (totaltime) * 100;\n                $('#currenttime').text(convertSecondsToHMS(t - start));\n                replaceProgressBars(percentage);\n                dispatchEvent('timeupdate', {'time': t});\n            };\n\n            let interval;\n            const onPlaying = async () => { // Use with player timeupdate event.\n                // Reset the annotation content.\n                if (!playerReady) {\n                    return;\n                }\n                if ($('body').hasClass('mobiletheme') && !$('#wrapper').hasClass('fullscreen')) {\n                    $(\"#fullscreen\").trigger('click');\n                }\n                $('#annotation-modal').modal('hide');\n                $('#message').not('[data-placement=bottom]').not('.sticky').remove();\n                $('#end-screen, #start-screen').fadeOut(300);\n                $('#restart').addClass('d-none');\n                $('#playpause').find('i').removeClass('bi-play-fill').addClass('bi-pause-fill');\n                $('#playpause').attr('data-original-title', M.util.get_string('pause', 'mod_interactivevideo'));\n                const intervalFunction = async function() {\n                    const isPlaying = await player.isPlaying();\n                    const isEnded = await player.isEnded();\n                    if (!isPlaying || isEnded) {\n                        clearInterval(interval);\n                        return;\n                    }\n\n                    const t = await player.getCurrentTime();\n                    if (t > end || isEnded) {\n                        clearInterval(interval);\n                        onEnded(end);\n                        return;\n                    }\n\n                    dispatchEvent('timeupdate', {'time': t});\n\n                    const time = Math.round(t);\n\n                    // If it is the same annotation we just run, then we don't need to run it again.\n                    if (lastanno && time == lastanno.timestamp) {\n                        return;\n                    } else {\n                        if (lastanno && time > lastanno.timestamp) {\n                            lastanno = null;\n                        }\n                        let percentagePlayed = (t - start) / totaltime;\n                        $('#currenttime').text(convertSecondsToHMS(t - start));\n                        percentagePlayed = percentagePlayed > 1 ? 1 : percentagePlayed;\n                        $('#video-nav #progress').css('width', percentagePlayed * 100 + '%');\n                        $('#video-nav #seekhead').css('left', percentagePlayed * 100 + '%');\n                        const theAnnotation = releventAnnotations.find(x => (((t - player.frequency) <= x.timestamp\n                            && (t + player.frequency) >= x.timestamp) || time == x.timestamp) && x.id != 0);\n                        if (theAnnotation) {\n                            $('#interactions-nav .annotation[data-id=\"' + theAnnotation.id + '\"] .item').trigger('mouseover')\n                                .addClass('active');\n\n                            setTimeout(function() {\n                                $('#interactions-nav .annotation[data-id=\"' + theAnnotation.id + '\"] .item')\n                                    .trigger('mouseout').removeClass('active');\n                            }, 2000);\n                            if (!theAnnotation.completed || theAnnotation.rerunnable) {\n                                player.pause();\n                                $('#video-nav #progress')\n                                    .css('width', (theAnnotation.timestamp - start) / totaltime * 100 + '%');\n                                $('#video-nav #seekhead').css('left', (theAnnotation.timestamp - start) / totaltime * 100 + '%');\n                                runInteraction(theAnnotation);\n                            }\n                        }\n                    }\n\n                    // Pause video on spacebar pressed\n                    $(document).on('keydown', function(e) {\n                        if (e.keyCode == 32) {\n                            e.preventDefault();\n                            player.pause();\n                        }\n                    });\n                };\n\n                if (player.type == 'yt' || player.type == 'wistia') {\n                    interval = setInterval(intervalFunction, player.frequency * 100);\n                } else {\n                    intervalFunction();\n                }\n\n            };\n\n            // Implement the player\n            require(['mod_interactivevideo/player/' + vtype], function(VideoPlayer) {\n                player = new VideoPlayer(\n                    url,\n                    start,\n                    end,\n                    displayoptions.useoriginalvideocontrols == 1,\n                    true,\n                    false\n                );\n            });\n\n            // Move toast-wrapper to the #wrapper element so it can be displayed on top of the video in fullscreen mode.\n            let $toast = $('.toast-wrapper').detach();\n            $('#wrapper').append($toast);\n\n            $(document).on('timeupdate', async function(e) {\n                const t = e.originalEvent.detail.time;\n                if (preventskip) {\n                    const theAnnotations = releventAnnotations.filter(x => Number(x.timestamp) <= (t + player.frequency)\n                        && x.completed == false && x.hascompletion == 1);\n                    if (theAnnotations.length > 0) {\n                        const theAnnotation = theAnnotations[0];\n                        player.pause();\n                        await player.seek((theAnnotation.timestamp - 0.7 > start) ? (theAnnotation.timestamp - 0.7) : start);\n                        clearInterval(interval);\n                        Toast.add(M.util.get_string('youmustcompletethepreviousactivity', 'mod_interactivevideo'), {\n                            type: 'danger'\n                        });\n                        $videoNav.find('#progress').css('width', ((theAnnotation.timestamp - start) / totaltime) * 100 + '%');\n                        $videoNav.find('#seekhead').css('left', ((theAnnotation.timestamp - start) / totaltime) * 100 + '%');\n                    }\n                }\n            });\n\n            // Handle the refresh button:: allowing user to refresh the content\n            $(document).on('click', '#refresh', function(e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                const id = $(this).data('id');\n                const annotation = releventAnnotations.find(x => x.id == id);\n                $(this).closest('#message').find(\"#content\").empty();\n                runInteraction(annotation, true);\n            });\n\n            // Handle video control events:: fullscreen toggle\n            $(document).on('click', '#fullscreen', function(e) {\n                e.preventDefault();\n                if (!playerReady) {\n                    return;\n                }\n\n                // Put the wrapper in fullscreen mode\n                let elem = document.getElementById('wrapper');\n                $('#fullscreen').toggleClass('active');\n                if (!$('#wrapper').hasClass('fullscreen')) {\n                    if (elem.requestFullscreen) {\n                        elem.requestFullscreen();\n                    } else if (elem.mozRequestFullScreen) { /* Firefox */\n                        elem.mozRequestFullScreen();\n                    } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari and Opera */\n                        elem.webkitRequestFullscreen();\n                    } else if (elem.msRequestFullscreen) { /* IE/Edge */\n                        elem.msRequestFullscreen();\n                    }\n                } else {\n                    if (document.exitFullscreen) {\n                        document.exitFullscreen();\n                    } else if (document.mozCancelFullScreen) { /* Firefox */\n                        document.mozCancelFullScreen();\n                    } else if (document.webkitExitFullscreen) { /* Chrome, Safari and Opera */\n                        document.webkitExitFullscreen();\n                    } else if (document.msExitFullscreen) { /* IE/Edge */\n                        document.msExitFullscreen();\n                    }\n                }\n            });\n\n            $(document).on('fullscreenchange', async function() {\n                if (document.fullscreenElement) {\n                    $('#wrapper, #interactivevideo-container').addClass('fullscreen');\n                    $(\"#video-wrapper\").css('padding-bottom', '0');\n                    $('#wrapper [data-toggle=\"tooltip\"]').tooltip({\n                        container: '#wrapper',\n                        boundary: 'window',\n                    });\n                } else {\n                    $('#wrapper, #interactivevideo-container').removeClass('fullscreen');\n                    const ratio = await player.ratio();\n                    $(\"#video-wrapper\").css('padding-bottom', (1 / ratio) * 100 + '%');\n                }\n                $('#wrapper #fullscreen i').toggleClass('bi-fullscreen bi-fullscreen-exit');\n            });\n\n            // Pause video when the tab is not visible.\n            $(document).on('visibilitychange', function() {\n                if (document.visibilityState == 'hidden') {\n                    player.pause();\n                }\n            });\n\n            // Handle share this moment event.\n            $(document).on('click', '#controller #share', async function(e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                const $this = $(this);\n                $this.find('i').toggleClass('bi-share-fill bi-share');\n                let time = await player.getCurrentTime();\n                const url = window.location.href;\n                const shareurl = url + (url.indexOf('?') > 0 ? '&' : '?') + 't=' + Math.round(time);\n                // Add shareurl to clipboard.\n                await navigator.clipboard.writeText(shareurl);\n                $this.attr('data-original-title', M.util.get_string(\"copied\", \"mod_interactivevideo\")).tooltip('show');\n                setTimeout(function() {\n                    // Change tooltip back to share.\n                    $this\n                        .attr('data-original-title', M.util.get_string(\"sharethismoment\", \"mod_interactivevideo\"))\n                        .tooltip('hide');\n                    $this.find('i').toggleClass('bi-share-fill bi-share');\n                }, 2000);\n            });\n\n            // Display time when user hover on the progress bar.\n            $(document).on('mouseenter', '#video-nav #seek', function(e) {\n                if (!playerReady) {\n                    return;\n                }\n                $(this).append('<div id=\"position\"><div id=\"timelabel\"></div></div>');\n                let $position = $('#position');\n                const parentOffset = $(this).offset();\n                const relX = e.pageX - parentOffset.left;\n\n                $position.css('left', (relX) + 'px');\n                var percentage = relX / $(this).width();\n                var time = Math.round(percentage * end);\n                var formattedTime = convertSecondsToHMS(time);\n                $position.find('#timelabel').text(formattedTime);\n            });\n\n            $(document).on('mousemove', '#video-nav #seek', function(e) {\n                if (!playerReady) {\n                    return;\n                }\n                const parentOffset = $(this).offset();\n                const relX = e.pageX - parentOffset.left;\n                var percentage = relX / $(this).width();\n                var time = Math.round(percentage * end);\n                var formattedTime = convertSecondsToHMS(time);\n                $('#position').css('left', (relX) + 'px');\n                $('#position #timelabel').text(formattedTime);\n            });\n\n            $(document).on('mouseleave', '#video-nav #seek', function() {\n                $('#position').remove();\n            });\n\n            // Handle annotation click event:: when user click on the annotation on the progress bar\n            $(document).on('click', '#interactions-nav .annotation, #video-nav .annotation', async function(e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                if ($(this).hasClass('no-click')) {\n                    // Add a tooltip that seeking is disabled.\n                    Toast.add(M.util.get_string('youcannotviewthisannotationyet', 'mod_interactivevideo'), {\n                        type: 'danger'\n                    });\n                    return;\n                }\n                const timestamp = $(this).data('timestamp');\n                player.play();\n                if (player.type == 'yt') {\n                    clearInterval(interval);\n                }\n                await player.seek(Number(timestamp));\n                replaceProgressBars(((timestamp - start) / totaltime) * 100);\n                const id = $(this).data('id');\n                const theAnnotation = releventAnnotations.find(x => x.id == id);\n                runInteraction(theAnnotation);\n                lastanno = theAnnotation;\n            });\n\n            // Handle seeking event:: when user click on the progress bar\n            $(document).on('click', '#seek', async function(e) {\n                if (!playerReady) {\n                    return;\n                }\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                if ($('#video-nav').hasClass('no-click')) {\n                    // Add a tooltip that seeking is disabled.\n                    Toast.add(M.util.get_string('seekingdisabled', 'mod_interactivevideo'), {\n                        type: 'danger'\n                    });\n                    return;\n                }\n                lastanno = null;\n                $('#start-screen').fadeOut(300);\n                $('#end-screen').fadeOut(300);\n                const parentOffset = $(this).offset();\n                const relX = e.pageX - parentOffset.left;\n                var percentage = relX / $(this).width();\n                // Gotta check if this affects anything.\n                if (player.type == 'yt') {\n                    clearInterval(interval);\n                }\n                player.pause(); // Especially for vimeo.\n                await player.seek((percentage * totaltime) + start);\n                replaceProgressBars(percentage * 100);\n                player.play();\n            });\n\n            // Handle video control events:: play\n            $(document).on('click', '#start-screen #play', async function(e) {\n                e.preventDefault();\n                $('#start-screen').fadeOut(300);\n                $(this).addClass('d-none');\n                $videoNav.removeClass('d-none');\n                player.play();\n            });\n\n            // Handle video control events:: restart\n            $(document).on('click', '#end-screen #restart', async function(e) {\n                e.preventDefault();\n                $('#message').remove();\n                lastanno = null;\n                await player.seek(start);\n                $videoNav.find(\"#progress\").css('width', '0%');\n                $videoNav.find(\"#seekhead\").css('left', '0%');\n                $('#end-screen').fadeOut(300);\n                $(this).addClass('d-none');\n                $videoNav.removeClass('d-none');\n                replaceProgressBars(0);\n                player.play();\n            });\n\n            // Handle video control events:: pause/resume when user click on the video\n            $(document).on('click', '#video-wrapper .video-block', async function(e) {\n                if (!playerReady) {\n                    return;\n                }\n                clearInterval(interval);\n                e.preventDefault();\n                // Pause or resume the video.\n                const playing = await player.isPlaying();\n                if (playing) {\n                    player.pause();\n                } else {\n                    player.play();\n                }\n            });\n\n            $(document).on('click', '#playpause', async function(e) {\n                if (!playerReady) {\n                    return;\n                }\n                e.preventDefault();\n                $(this).tooltip('hide');\n                // Pause or resume the video.\n                const playing = await player.isPlaying();\n                if (playing) {\n                    player.pause();\n                } else {\n                    let t = await player.getCurrentTime();\n                    if (t >= end) {\n                        $('#end-screen #restart').trigger('click');\n                    } else {\n                        player.play();\n                    }\n                }\n            });\n\n            $(document).on('click', 'li.anno', async function(e) {\n                e.preventDefault();\n                const id = $(this).data('id');\n                $(`li.annotation[data-id=${id}]`).trigger('click');\n                if ($(this).closest('#chapter-container-left').length > 0) {\n                    $('#chaptertoggle .btn').trigger('click');\n                }\n            });\n\n            // Handle video control events:: mute/unmute\n            $(document).on('click', '#mute', function(e) {\n                e.preventDefault();\n                $(this).tooltip('hide');\n                $(this).toggleClass('active');\n                if ($(this).hasClass('active')) {\n                    player.mute();\n                    $(this).attr('data-original-title', M.util.get_string('unmute', 'mod_interactivevideo'));\n                } else {\n                    player.unMute();\n                    $(this).attr('data-original-title', M.util.get_string('mute', 'mod_interactivevideo'));\n                }\n                $(this).find('i').toggleClass('bi-volume-mute bi-volume-up');\n                $(this).tooltip('show');\n            });\n\n            // Handle video control events:: playrate change\n            $(document).on('click', '.changerate', function(e) {\n                e.preventDefault();\n                const rate = $(this).data('rate');\n                player.setRate(rate);\n                $('.changerate').find('i').removeClass('bi-check');\n                $(this).find('i').addClass('bi-check');\n            });\n\n            // Handle video control:: Quality change\n            $(\"#changequality\").on('shown.bs.dropdown', async function() {\n                let quality = await player.getQualities();\n                $('#qualitieslist').empty();\n                let currentQuality = quality.currentQuality;\n                if (currentQuality === null) {\n                    currentQuality = $(this).data('current');\n                }\n                let qualities = quality.qualities;\n                let qualitiesLabel = quality.qualitiesLabel;\n                qualities.forEach((q, i) => {\n                    $('#qualitieslist').append(`<a class=\"dropdown-item text-white changequality\" data-quality=\"${q}\"\n                         href=\"#\"><i class=\"bi ${q == currentQuality ? 'bi-check' : ''} fa-fw ml-n3\"></i>${qualitiesLabel[i]}</a>`);\n                });\n                $(this).find('[data-toggle=dropdown]').dropdown('update');\n            });\n\n            $(document).on('click', '.changequality', function(e) {\n                e.preventDefault();\n                const quality = $(this).data('quality');\n                player.setQuality(quality);\n                $('.changequality').find('i').removeClass('bi-check');\n                $(this).find('i').addClass('bi-check');\n            });\n\n            $(document).on('interactionrun', function(e) {\n                window.console.log(e);\n            });\n\n            $(document).on('interactionclose', function(e) {\n                window.console.log(e);\n            });\n\n            $(document).on('interactionCompletionUpdated', function(e) {\n                window.console.log(e);\n            });\n\n            $(document).on('iv:playerReady', function() {\n                onReady();\n            });\n\n            $(document).on('iv:playerPaused', function() {\n                onPaused();\n            });\n\n            $(document).on('iv:playerPlaying', function() {\n                onPlaying();\n            });\n\n            $(document).on('iv:playerEnded', function() {\n                onEnded();\n            });\n\n            $(document).on('iv:playerSeek', function(e) {\n                onSeek(e.detail.time);\n            });\n\n            $(document).on('iv:playerError', function() {\n                Toast.add(M.util.get_string('thereisanissueloadingvideo', 'mod_interactivevideo'), {\n                    type: 'danger'\n                });\n                $('#spinner').remove();\n            });\n\n            $(document).on('iv:playerRateChange', function(e) {\n                $('.changerate').find('i').removeClass('bi-check');\n                $(`.changerate[data-rate=\"${e.originalEvent.detail.rate}\"]`).find('i').addClass('bi-check');\n            });\n\n            $(document).on('iv:playerQualityChange', function(e) {\n                $('#changequality').attr('data-current', e.originalEvent.detail.quality);\n                $('.changequality').find('i').removeClass('bi-check');\n                $(`.changequality[data-quality=\"${e.originalEvent.detail.quality}\"]`).find('i').addClass('bi-check');\n            });\n\n            $(document).on('annotationitemsrendered', function() {\n                $('#wrapper [data-toggle=\"tooltip\"]').tooltip({\n                    container: '#wrapper',\n                    boundary: 'window',\n                });\n                if (displayoptions.disableinteractionclickuntilcompleted == 1) {\n                    $interactionNav.find('li:not(.completed)').addClass('no-click');\n                }\n                if (displayoptions.disableinteractionclick == 1) {\n                    $interactionNav.find('li').addClass('no-click');\n                }\n                if (displayoptions.preventseeking == 1) {\n                    $interactionNav.find('li').addClass('no-click');\n                    $videoNav.addClass('no-click');\n                }\n            });\n        }\n    };\n});"],"names":["define","$","Toast","annotations","totaltime","activityType","lastanno","contentTypes","displayoptions","releventAnnotations","player","dispatchEvent","ctRenderer","$videoNav","$interactionNav","renderAnnotationItems","async","annos","start","actualduration","skipsegments","filter","x","type","length","forEach","Number","title","timestamp","completableAnno","hascompletion","actualAnnotationCounts","xp","map","reduce","a","b","completedAnnos","completed","xpEarned","empty","append","seconds","hours","Math","floor","minutes","remainingSeconds","string","convertSecondsToMinutes","ceil","preventseeking","addClass","hidemainvideocontrols","hideinteractions","render","Promise","resolve","renderItemOnVideoNavigation","chapteritems","sort","each","cstart","this","data","cend","find","id","JSON","parse","prop","icon","formattedtitle","init","url","cmid","interaction","course","userid","end","completionpercentage","gradeiteminstance","grademax","vtype","preventskip","moment","doptions","token","isNaN","playerReady","convertSecondsToHMS","h","m","s","replaceProgressBars","percentage","replaceWith","css","getAnnotations","callback","annnoitems","ajax","M","cfg","wwwroot","method","dataType","action","sesskey","contextid","courseContextId","userprogress","uid","getContentTypes","when","done","progress","ct","some","y","name","completedItems","completeditems","stringify","indexOf","advanced","rerunnable","replaybehavior","shouldAdd","push","unshift","util","get_string","hide","getRenderers","chapterContentType","includes","remove","removeClass","count","require","amdmodule","Type","error","toggleClass","runInteraction","annotation","modal","not","fadeOut","theAnnotations","theAnnotation","pause","seek","add","shareMoment","urlParams","URLSearchParams","window","location","search","time","play","delete","newurl","protocol","host","pathname","toString","history","replaceState","onReady","support","playbackrate","quality","posterImage","duration","getDuration","min","text","ratio","focus","draggable","event","ui","position","left","width","setTimeout","onPaused","clearInterval","interval","attr","onEnded","t","trigger","fadeIn","onSeek","getCurrentTime","onPlaying","hasClass","intervalFunction","isPlaying","isEnded","round","percentagePlayed","frequency","document","on","e","keyCode","preventDefault","setInterval","VideoPlayer","useoriginalvideocontrols","$toast","detach","originalEvent","detail","stopImmediatePropagation","closest","elem","getElementById","exitFullscreen","mozCancelFullScreen","webkitExitFullscreen","msExitFullscreen","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen","fullscreenElement","tooltip","container","boundary","visibilityState","$this","href","shareurl","navigator","clipboard","writeText","$position","parentOffset","offset","relX","pageX","formattedTime","mute","unMute","rate","setRate","getQualities","currentQuality","qualities","qualitiesLabel","q","i","dropdown","setQuality","console","log","disableinteractionclickuntilcompleted","disableinteractionclick"],"mappings":"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"}