{"version":3,"file":"viewannotation.min.js","sources":["../src/viewannotation.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\n/**\n * View page module\n *\n * @module     mod_interactivevideo/viewannotation\n * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'jquery', 'core/event_dispatcher', 'core/toast', 'mod_interactivevideo/libraries/jquery-ui'\n], function($, eventDispatcher, Toast) {\n    const {dispatchEvent} = eventDispatcher;\n    const ctRenderer = {};\n    let annotations, // Array of annotations.\n        totaltime, // Video total time.\n        activityType, // Current activityType.\n        viewedAnno = [], // Array of viewed annotations.\n        contentTypes, // Array of available content types.\n        displayoptions, // Display options.\n        releventAnnotations, // Array of annotations that are not skipped.\n        completionid, // Id of the completion record.\n        player; // Video player instance.\n\n    const $videoNav = $('#video-nav');\n    const $interactionNav = $('#interactions-nav');\n\n    const formatTime = (seconds) => {\n        const hours = Math.floor(seconds / 3600);\n        const minutes = Math.floor((seconds % 3600) / 60);\n        const remainingSeconds = seconds % 60;\n        let string = '';\n        if (hours > 0) {\n            string += hours + 'h ';\n        }\n        if (minutes > 0) {\n            string += minutes + 'm ';\n        }\n        if (remainingSeconds > 0) {\n            string += remainingSeconds + 's';\n        }\n        return string;\n    };\n\n    const renderAnnotationItems = async (annos, start, totaltime) => {\n        releventAnnotations = annos;\n        let actualduration = totaltime;\n\n        const skipsegments = annos.filter(x => x.type == 'skipsegment');\n\n        if (skipsegments.length > 0) {\n            skipsegments.forEach(x => {\n                const length = (Number(x.title) - Number(x.timestamp));\n                actualduration -= length;\n            });\n        }\n\n        const completableAnno = releventAnnotations.filter(x => x.hascompletion == 1);\n        const actualAnnotationCounts = completableAnno.length;\n\n        const xp = completableAnno.map(x => Number(x.xp)).reduce((a, b) => a + b, 0);\n\n        const completedAnnos = completableAnno\n            .filter(x => x.completed);\n\n        const xpEarned = completedAnnos.map(x => Number(x.xp)).reduce((a, b) => a + b, 0);\n\n        $(\".metadata\").empty();\n        $(\".metadata\").append(`<span class=\"d-inline-block mr-3\">\n            <i class=\"bi bi-stopwatch mr-2\"></i>${formatTime(Math.ceil(actualduration))}</span>\n            <span class=\"d-inline-block mr-3\">\n        <i class=\"bi bi-bullseye mr-2\"></i>${completedAnnos.length} / ${actualAnnotationCounts}</span>\n        <span class=\"d-inline-block\"><i class=\"bi bi-star mr-2\"></i>${xpEarned} / ${xp}</span>`);\n\n        $(\"#interactions-nav ul\").empty();\n\n        if (annos.length == 0) {\n            return;\n        }\n\n        if (displayoptions.preventseeking == 1) {\n            $videoNav.addClass('no-pointer-events');\n        }\n\n        if (displayoptions.hidemainvideocontrols == 1 || displayoptions.hideinteractions == 1) {\n            if (displayoptions.hidemainvideocontrols == 1) {\n                $('#wrapper').addClass('no-videonav');\n            }\n            return;\n        }\n        for (const x of annos) {\n            const renderer = ctRenderer[x.type];\n            await renderer.renderItemOnVideoNavigation(x);\n        }\n        dispatchEvent('annotationitemsrendered', {'annotations': annos});\n        $('.annolistinchapter').empty();\n        const chapteritems = releventAnnotations.filter(x => x.type != 'skipsegment' && x.hascompletion == 1);\n        chapteritems.sort((a, b) => a.timestamp - b.timestamp);\n        chapteritems.forEach((x) => {\n            $('[data-region=\"chapterlists\"] li').each(function() {\n                const cstart = $(this).data('start');\n                const cend = $(this).data('end');\n                if (x.timestamp >= cstart && x.timestamp < cend) {\n                    $(this).find('.annolistinchapter')\n                        .append(`<li class=\"border-bottom anno d-flex align-items-center justify-content-between\n                         px-3 py-2 ${x.completed ? \"completed\" : \"\"}\" data-id=\"${x.id}\" data-timestamp=\"${x.timestamp}\">\n                         <span class=\"text-nowrap\">\n                         <i class=\"small bi ${x.completed ? \"bi-check-circle-fill text-success\" : 'bi-circle'} mr-2\"></i>\n                         <i class=\"${JSON.parse(x.prop).icon} mr-2\"></i></span>\n                         <span class=\"flex-grow-1 text-truncate\">${x.formattedtitle}</span>\n                         <span class=\"text-nowrap\">${x.xp}<i class=\"bi bi-star ml-1\"></i></span></li>`);\n                }\n            });\n        });\n        dispatchEvent('chapterrendered', {'annotations': releventAnnotations});\n    };\n\n    return {\n        /**\n         * Render annotation items on the video navigation and chapter list.\n         */\n        renderAnnotationItems: renderAnnotationItems,\n        /**\n         * Initialize the view annotation on page loads.\n         * @param {string} url - The video url.\n         * @param {number} cmid - The course module id.\n         * @param {number} interaction - The interaction id.\n         * @param {number} course - The course id.\n         * @param {number} userid - The user id.\n         * @param {number} start - The start time of the video.\n         * @param {number} end - The end time of the video.\n         * @param {number} completionpercentage - The completion percentage.\n         * @param {number} gradeiteminstance - The grade item instance.\n         * @param {number} grademax - The grade max.\n         * @param {string} vtype - The video type.\n         * @param {boolean} preventskip - Prevent user from skipping the video.\n         * @param {number} moment - The moment to share.\n         * @param {object} doptions - The display options.\n         * @param {string} token - The token.\n         * @return {void}\n         */\n        init: function(\n            url, cmid, interaction, course, userid, start = 0, end,\n            completionpercentage, gradeiteminstance, grademax, vtype,\n            preventskip = true, moment = null, doptions = {}, token = null) {\n            // Convert start to number if string\n            start = Number(start);\n            if (isNaN(start)) {\n                start = 0;\n            }\n\n            // Convert end to number if string\n            end = Number(end);\n            if (isNaN(end)) {\n                end = null;\n            }\n\n            displayoptions = doptions;\n\n            let playerReady = false;\n\n            if (localStorage.getItem('limitedwidth') == 'true' && displayoptions.hidemainvideocontrols == 0) {\n                $('body').addClass('limited-width');\n                $('#controller #expand i').removeClass('bi-file').addClass('bi-square');\n            }\n\n            /**\n             * Function to convert seconds to HH:MM:SS format.\n             * @param {number} seconds\n             * @returns {string}\n             */\n            const convertSecondsToHMS = (seconds) => {\n                const h = Math.floor(seconds / 3600);\n                const m = Math.floor(seconds % 3600 / 60);\n                const s = Math.floor(seconds % 3600 % 60);\n                return (h > 0 ? h + ':' : '') + (m < 10 ? '0' : '') + m + ':' + (s < 10 ? '0' : '') + s;\n            };\n\n            /**\n             * Function to replace the progress bars on the video navigation.\n             * @param {number} percentage\n             * @returns {void}\n             */\n            const replaceProgressBars = (percentage) => {\n                percentage = percentage > 100 ? 100 : percentage;\n                $videoNav.find('#progress').css('width', percentage + '%');\n                $videoNav.find('#seekhead').css('left', percentage + '%');\n            };\n\n            /**\n             * Function to get all annotations from the database and render them.\n             * @param {function} callback\n             * @returns {Promise}\n             */\n            const getAnnotations = (callback) => {\n                // Get all interaction items.\n                const annnoitems = $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'get_items',\n                        sesskey: M.cfg.sesskey,\n                        id: interaction,\n                        contextid: M.cfg.courseContextId,\n                        token: token,\n                        cmid: cmid\n                    }\n                });\n\n                // Get current user progress.\n                const userprogress = $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'get_progress',\n                        sesskey: M.cfg.sesskey,\n                        id: interaction,\n                        uid: userid,\n                        token: token,\n                        cmid: cmid\n                    }\n                });\n\n                // Get all content types.\n                const getContentTypes = $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'getallcontenttypes',\n                        sesskey: M.cfg.sesskey,\n                        token: token,\n                        cmid: cmid\n                    }\n                });\n\n                $.when(annnoitems, userprogress, getContentTypes).done(async function(annos, progress, ct) {\n                    annotations = JSON.parse(annos[0]);\n                    progress = JSON.parse(progress[0]);\n                    contentTypes = JSON.parse(ct[0]);\n                    completionid = progress.id;\n\n                    annotations = filterAnnotations(annotations, contentTypes, start, end);\n                    annotations = processAnnotations(annotations, contentTypes, progress, start, end);\n                    annotations.sort((a, b) => a.timestamp - b.timestamp);\n\n                    releventAnnotations = getRelevantAnnotations(annotations, start, end, contentTypes);\n\n                    if (releventAnnotations.length > 0 && !releventAnnotations.find(x => x.type == 'chapter')) {\n                        prependDummyChapter(releventAnnotations, start, contentTypes);\n                    }\n\n                    await initializeContentTypeRenderers(\n                        contentTypes, releventAnnotations, player, interaction, course, userid,\n                        completionpercentage, gradeiteminstance, grademax, vtype, preventskip,\n                        totaltime, start, end, cmid, token, completionid);\n\n                    await renderAnnotationItems(releventAnnotations, start, totaltime);\n                    $(\"#play\").removeClass('d-none');\n                    $(\"#spinner\").remove();\n                    $(\"#video-info\").toggleClass('d-none d-flex');\n                    playerReady = true;\n                    callback();\n                    return new Promise((resolve) => {\n                        resolve();\n                    });\n                });\n\n                /**\n                 * Filters annotations based on content types and a time range.\n                 *\n                 * @param {Array} annotations - The list of annotations to filter.\n                 * @param {Array} contentTypes - The list of content types to include.\n                 * @param {number} start - The start time of the range.\n                 * @param {number} end - The end time of the range.\n                 * @returns {Array} - The filtered list of annotations.\n                 */\n                function filterAnnotations(annotations, contentTypes, start, end) {\n                    return annotations.filter(annotation => {\n                        const inContentType = contentTypes.some(y => y.name === annotation.type);\n                        if (!inContentType) {\n                            return false;\n                        }\n\n                        if (annotation.type === 'skipsegment') {\n                            return !(annotation.timestamp > end || annotation.title < start);\n                        }\n\n                        return (annotation.timestamp >= start && annotation.timestamp <= end) || annotation.timestamp < 0;\n                    });\n                }\n\n                /**\n                 * Maps and processes annotations based on provided content types, progress, and time range.\n                 *\n                 * @param {Array} annotations - The list of annotations to be processed.\n                 * @param {Array} contentTypes - The list of content types to match with annotations.\n                 * @param {Object} progress - The progress object containing completed items.\n                 * @param {number} start - The start time of the segment.\n                 * @param {number} end - The end time of the segment.\n                 * @returns {Array} - The processed list of annotations.\n                 */\n                function processAnnotations(annotations, contentTypes, progress, start, end) {\n                    const completedItems = progress.completeditems == '' ? [] : JSON.parse(progress.completeditems);\n                    const contentTypeMap = new Map(contentTypes.map(ct => [ct.name, ct]));\n                    return annotations.map(annotation => {\n                        annotation.timestamp = Number(annotation.timestamp);\n                        annotation.xp = Number(annotation.xp);\n                        if (annotation.type == 'skipsegment') {\n                            annotation.title = Number(annotation.title);\n                            if (annotation.timestamp < start && annotation.title > start) {\n                                annotation.timestamp = start;\n                            }\n                            if (annotation.title > end && annotation.timestamp < end) {\n                                annotation.title = end;\n                            }\n                        }\n                        annotation.prop = JSON.stringify(contentTypeMap.get(annotation.type));\n                        annotation.completed = completedItems.indexOf(annotation.id) > -1;\n\n                        let advanced;\n                        try {\n                            advanced = JSON.parse(annotation.advanced);\n                        } catch (e) {\n                            advanced = null;\n                        }\n                        annotation.rerunnable = advanced && advanced.replaybehavior === '1';\n\n                        return annotation;\n                    });\n                }\n\n                /**\n                 * Filters and returns relevant annotations within a specified time range,\n                 * excluding those that fall within skip segments.\n                 *\n                 * @param {Array} annotations - The list of annotations to filter.\n                 * @returns {Array} - The filtered list of relevant annotations.\n                 */\n                function getRelevantAnnotations(annotations) {\n                    const skipsegments = annotations.filter(annotation => annotation.type == 'skipsegment');\n                    let releventAnnotations = [];\n                    annotations.forEach(annotation => {\n                        let shouldAdd = true;\n                        skipsegments.forEach(skipsegment => {\n                            if (Number(annotation.timestamp) > Number(skipsegment.timestamp)\n                                && Number(annotation.timestamp) < Number(skipsegment.title)) {\n                                shouldAdd = false;\n                            }\n                        });\n                        if (shouldAdd) {\n                            releventAnnotations.push(annotation);\n                        }\n                    });\n                    return releventAnnotations;\n                }\n\n                /**\n                 * Adds a dummy chapter annotation to the beginning of the relevant annotations array.\n                 *\n                 * @param {Array} releventAnnotations - The array of relevant annotations to which the dummy chapter will be added.\n                 * @param {number} start - The timestamp at which the dummy chapter starts.\n                 * @param {Array} contentTypes - The array of content types to find the chapter type from.\n                 */\n                function prependDummyChapter(releventAnnotations, start, contentTypes) {\n                    releventAnnotations.unshift({\n                        id: 0,\n                        title: M.util.get_string('startchapter', 'mod_interactivevideo'),\n                        formattedtitle: M.util.get_string('startchapter', 'mod_interactivevideo'),\n                        timestamp: start,\n                        type: 'chapter',\n                        prop: JSON.stringify(contentTypes.find(x => x.name == 'chapter')),\n                        xp: 0,\n                        completed: true,\n                        hide: true\n                    });\n                }\n\n\n                /**\n                 * Asynchronously loads and initializes content type renderers for interactive video annotations.\n                 *\n                 * @param {Array} contentTypes - Array of content type objects.\n                 * @param {Array} releventAnnotations - Array of relevant annotation objects.\n                 * @param {Object} player - The video player instance.\n                 * @param {Object} interaction - The interaction object.\n                 * @param {Object} course - The course object.\n                 * @param {number} userid - The user ID.\n                 * @param {number} completionpercentage - The completion percentage.\n                 * @param {number} gradeiteminstance - The grade item instance.\n                 * @param {number} grademax - The maximum grade.\n                 * @param {string} vtype - The video type.\n                 * @param {boolean} preventskip - Flag to prevent skipping.\n                 * @param {number} totaltime - The total time of the video.\n                 * @param {number} start - The start time of the video.\n                 * @param {number} end - The end time of the video.\n                 * @param {number} cmid - The course module ID.\n                 * @param {string} token - The authentication token.\n                 * @param {number} completionid - Completion record id.\n                 * @returns {Promise<Object>} A promise that resolves to an object containing the initialized contenttype renderers.\n                 */\n                async function initializeContentTypeRenderers(contentTypes, releventAnnotations,\n                    player, interaction, course, userid, completionpercentage, gradeiteminstance,\n                    grademax, vtype, preventskip, totaltime, start, end, cmid, token, completionid) {\n                    const chapterContentType = contentTypes.find(x => x.name == 'chapter');\n                    contentTypes = contentTypes.filter(x => releventAnnotations.map(y => y.type).includes(x.name));\n                    if (contentTypes.length == 0) {\n                        $('#chaptertoggle, #chapter-container-left, #chapter-container-right').remove();\n                        return;\n                    } else {\n                        $('#chaptertoggle, #chapter-container-left, #chapter-container-right').removeClass('d-none');\n                    }\n                    if (!contentTypes.find(x => x.name == 'chapter')) {\n                        contentTypes.push(chapterContentType);\n                    }\n                    return Promise.all(contentTypes.map(contentType => {\n                        return new Promise((resolve) => {\n                            require([contentType.amdmodule], function(Type) {\n                                ctRenderer[contentType.name] = new Type(player, releventAnnotations, interaction, course, userid,\n                                    completionpercentage, gradeiteminstance, grademax, vtype, preventskip, totaltime, start,\n                                    end, contentType, cmid, token, displayoptions, completionid);\n                                try {\n                                    ctRenderer[contentType.name].init();\n                                } catch (error) {\n                                    // Do nothing.\n                                }\n                                resolve(ctRenderer[contentType.name]);\n                            });\n                        });\n                    })).then(() => ctRenderer);\n                }\n            };\n\n            /**\n             * Run the interaction.\n             * @param {object} annotation annotation object\n             * @returns {void}\n             */\n            const runInteraction = async (annotation) => {\n                $('#video-wrapper').data('timestamp', new Date().getTime());\n                viewedAnno.push(Number(annotation.id));\n                viewedAnno = [...new Set(viewedAnno)];\n                // Remove the previous message but keep the one below the video.\n                $('#annotation-modal').modal('hide');\n                $('#message').not('[data-placement=bottom]').not('.sticky').not(`[data-id=${annotation.id}]`).remove();\n                $('#end-screen, #start-screen').fadeOut(300);\n\n                if (preventskip) {\n                    const theAnnotations = releventAnnotations\n                        .filter(x => Number(x.timestamp) < Number(annotation.timestamp)\n                            && x.completed == false && x.hascompletion == 1);\n                    if (theAnnotations.length > 0) {\n                        const theAnnotation = theAnnotations[0];\n                        player.pause();\n                        await player.seek((theAnnotation.timestamp - 0.7 > start) ? (theAnnotation.timestamp - 0.7) : start);\n                        Toast.add(M.util.get_string('youmustcompletethepreviousactivity', 'mod_interactivevideo'), {\n                            type: 'danger'\n                        });\n                        return;\n                    }\n                }\n                activityType = ctRenderer[annotation.type];\n                activityType.runInteraction(annotation);\n            };\n\n            /**\n             * Shares a specific moment in the video by seeking to the given timestamp and playing the video.\n             * If the timestamp is within the valid range, it hides the start screen, seeks to the timestamp,\n             * plays the video, runs the relevant annotation interaction, and updates the progress bars.\n             * Finally, it removes the timestamp parameter from the URL.\n             *\n             * @async\n             * @function shareMoment\n             * @returns {Promise<void>} A promise that resolves when the video has been successfully sought and played.\n             */\n            const shareMoment = async () => {\n                if (!moment) {\n                    return;\n                }\n                // Check if the url has a timestamp using url params.\n                const urlParams = new URLSearchParams(window.location.search);\n                const time = Number(moment);\n                if (time && !isNaN(time) && time >= start && time <= end) {\n                    // Hide the start screen.\n                    $('#video-wrapper #start-screen').hide(0);\n                    replaceProgressBars(((time - start) / totaltime) * 100);\n                    await player.seek(time);\n                    player.play();\n                    const theAnnotation = releventAnnotations.find(x => x.timestamp == time);\n                    if (theAnnotation) {\n                        runInteraction(theAnnotation);\n                    }\n                }\n                urlParams.delete('t');\n                const newurl = window.location.protocol\n                    + '//' + window.location.host + window.location.pathname + '?' + urlParams.toString();\n                window.history.replaceState(null, null, newurl);\n            };\n\n            /**\n             * Initializes the video player and its controls when the player is ready.\n             *\n             * This function performs the following tasks:\n             * - Checks if the player supports playback rate and quality adjustments, and updates the UI accordingly.\n             * - Sets the background image of the start screen if a poster image is available.\n             * - Adjusts the background of the video block to be transparent.\n             * - Retrieves the video duration and updates the end time if necessary.\n             * - Calculates the total playback time and updates the duration display.\n             * - Recalculates the aspect ratio of the video and updates the video wrapper's padding.\n             * - Sets the player as ready and focuses on the start button.\n             * - Initializes the seek head draggable functionality, allowing users to seek through the video.\n             *\n             * @async\n             * @function onReady\n             * @returns {Promise<void>} A promise that resolves when the player is fully initialized and ready.\n             */\n            const onReady = async () => {\n                if (player.support.playbackrate == false) {\n                    $('#changerate').remove();\n                } else {\n                    $('#changerate').removeClass('d-none');\n                }\n\n                if (player.support.quality == false) {\n                    $('#changequality').remove();\n                } else {\n                    $('#changequality').removeClass('d-none');\n                }\n\n                if (player.posterImage) {\n                    $('#video-wrapper #start-screen').css({\n                        'background': `url(${player.posterImage}) no-repeat center center / cover`,\n                    });\n                }\n                $(\".video-block\").css('background', 'transparent');\n                const duration = await player.getDuration();\n                end = !end ? duration : Math.min(end, duration);\n                start = start > end ? 0 : start;\n                totaltime = end - start;\n                await getAnnotations(shareMoment);\n                $('#duration').text(convertSecondsToHMS(totaltime));\n\n                // Recalculate the ratio of the video\n                let ratio = 16 / 9;\n                if (!displayoptions.usefixedratio || displayoptions.usefixedratio == 0) {\n                    ratio = player.aspectratio;\n                }\n                $(\"#video-wrapper\").css('padding-bottom', (1 / ratio) * 100 + '%');\n                let gap = '125px';\n                if (displayoptions.hidemainvideocontrols == 1) {\n                    gap = '70px';\n                }\n                $(\"#wrapper\").css({\n                    'width': 'calc((100dvh - ' + gap + ' - 2.5rem) * ' + ratio + ')'\n                });\n                $('#start-screen #start').focus();\n\n                $('#seekhead').draggable({\n                    'containment': '#video-nav',\n                    'axis': 'x',\n                    'cursor': 'col-resize',\n                    'start': function(event, ui) {\n                        $(this).addClass('active');\n                        $('#taskinfo').addClass('no-pointer-events');\n                        $(\"#message, #end-screen\").remove();\n                        $(\"#seek\").append('<div id=\"position\"><div id=\"timelabel\"></div></div>');\n                        let $position = $('#position');\n                        const relX = ui.position.left;\n                        $position.css('left', (relX) + 'px');\n                        var percentage = relX / $(this).width();\n                        var time = percentage * totaltime;\n                        var formattedTime = convertSecondsToHMS(time);\n                        $position.find('#timelabel').text(formattedTime);\n                    },\n                    'drag': async function(event, ui) {\n                        let timestamp = ((ui.position.left) / $('#video-nav').width()) * totaltime + start;\n                        let percentage = ui.position.left / $('#video-nav').width();\n                        replaceProgressBars(percentage * 100);\n                        $('#seek #position').css('left', ui.position.left + 'px');\n                        $('#seek #position #timelabel').text(convertSecondsToHMS(timestamp - start));\n                        await player.seek(timestamp);\n                        player.pause();\n                    },\n                    'stop': async function() {\n                        setTimeout(function() {\n                            $('#taskinfo').removeClass('no-pointer-events');\n                        }, 200);\n                        setTimeout(function() {\n                            $('#seekhead').removeClass('active');\n                            $('#seek #position').remove();\n                        }, 1000);\n                        player.play();\n                    }\n                });\n            };\n\n\n            /**\n             * Handles the event when the video player is paused.\n             *\n             * This function performs the following actions:\n             * - Checks if the player is ready. If not, it exits early.\n             * - Clears the interval timer.\n             * - Updates the play/pause button icon to indicate 'play'.\n             * - Sets the tooltip of the play/pause button to 'play'.\n             */\n            const onPaused = () => {\n                if (!playerReady) {\n                    return;\n                }\n                clearInterval(interval);\n                $('#playpause').find('i').removeClass('bi-pause-fill').addClass('bi-play-fill');\n                $('#playpause').attr('data-original-title', M.util.get_string('play', 'mod_interactivevideo'));\n            };\n\n\n            /**\n             * Handles the end of the video playback.\n             *\n             * @param {number} t - The current time of the video playback. If not provided, defaults to the end time.\n             *\n             * @returns {void}\n             *\n             * This function performs the following actions:\n             * - Checks if the player is ready.\n             * - Finds the relevant annotation at the end of the video.\n             * - If the annotation exists and is not the last one, pauses the player and runs the interaction.\n             * - Toggles the tooltip to show the annotation title and hides it after 2 seconds.\n             * - Updates the UI to show the end screen and restart button.\n             * - Clears the interval and pauses the player.\n             * - Updates the play/pause button to show the play icon.\n             */\n            const onEnded = (t) => {\n                if (!playerReady) {\n                    return;\n                }\n                const time = t || end;\n                // Check if theAnnotation exists at the end of the video.\n                const theAnnotation = releventAnnotations.find(x => x.timestamp == time && x.id != 0 &&\n                    !viewedAnno.includes(Number(x.id)));\n                if (theAnnotation) {\n                    if (!theAnnotation.completed || theAnnotation.rerunnable) {\n                        player.pause();\n                        runInteraction(theAnnotation);\n                    }\n                    // Toggle the tooltip to show the title.\n                    $interactionNav.find('.annotation[data-id=\"' + theAnnotation.id + '\"] .item').trigger('mouseover')\n                        .addClass('active');\n                    // Hide the tooltip after 2 seconds.\n                    setTimeout(function() {\n                        $interactionNav.find('.annotation[data-id=\"' + theAnnotation.id + '\"] .item').trigger('mouseout')\n                            .removeClass('active');\n                    }, 2000);\n                }\n                $('#currenttime').text(convertSecondsToHMS(totaltime));\n                $('#restart').removeClass('d-none').fadeIn(300);\n                $('#end-screen').removeClass('d-none').fadeIn(300);\n                $('#progress').css('width', '100%');\n                $('#seekhead').css('left', '100%');\n                clearInterval(interval);\n                player.pause();\n                $('#playpause').find('i').removeClass('bi-pause-fill').addClass('bi-play-fill');\n                $('#playpause').attr('data-original-title', M.util.get_string('play', 'mod_interactivevideo'));\n            };\n\n            /**\n             * Handles the seek event for the video player.\n             *\n             * @param {number} t - The time to seek to. If not provided, the current time of the player will be used.\n             * @returns {Promise<void>} - A promise that resolves when the seek operation is complete.\n             */\n            const onSeek = async (t) => {\n                if (!playerReady) {\n                    return;\n                }\n                if (t) {\n                    t = Number(t);\n                } else {\n                    t = await player.getCurrentTime();\n                }\n                if (t > start && t < end) {\n                    $('#end-screen, #start-screen').addClass('d-none');\n                }\n                var percentage = (t - start) / (totaltime) * 100;\n                $('#currenttime').text(convertSecondsToHMS(t - start));\n                replaceProgressBars(percentage);\n                dispatchEvent('timeupdate', {'time': t});\n            };\n\n            let interval;\n            /**\n             * Handles the 'playing' event of the video player.\n             * This function is triggered when the video is playing and performs various actions such as:\n             * - Resetting the annotation content.\n             * - Handling fullscreen mode for mobile themes.\n             * - Hiding modals and messages.\n             * - Updating the play/pause button state.\n             * - Managing the video progress and annotations.\n             *\n             * @async\n             * @function onPlaying\n             * @returns {Promise<void>} A promise that resolves when the function completes.\n             */\n            const onPlaying = () => { // Use with player timeupdate event.\n                // Reset the annotation content.\n                if (!playerReady) {\n                    return;\n                }\n                if ($('body').hasClass('mobiletheme') && !$('#wrapper').hasClass('fullscreen')) {\n                    $(\"#fullscreen\").trigger('click');\n                }\n                $('#annotation-modal').modal('hide');\n                $('#message').not('[data-placement=bottom]').not('.sticky').remove();\n                $('#end-screen, #start-screen').fadeOut(300);\n                $('#restart').addClass('d-none');\n                $('#playpause').find('i').removeClass('bi-play-fill').addClass('bi-pause-fill');\n                $('#playpause').attr('data-original-title', M.util.get_string('pause', 'mod_interactivevideo'));\n                const intervalFunction = async function() {\n                    const t = await player.getCurrentTime();\n                    // Remove the viewedAnno after the current time.\n                    viewedAnno = viewedAnno.filter(x => {\n                        const anno = releventAnnotations.find(y => y.id == x);\n                        return anno.timestamp <= t;\n                    });\n                    const isPlaying = await player.isPlaying();\n                    const isEnded = await player.isEnded();\n                    if (!isPlaying || isEnded) {\n                        clearInterval(interval);\n                        return;\n                    }\n\n                    if (t > end || isEnded) {\n                        clearInterval(interval);\n                        onEnded(end);\n                        return;\n                    }\n\n                    if ($('#mute i').hasClass('bi-volume-up') && player.type == 'wistia') {\n                        player.unMute();\n                    }\n\n                    dispatchEvent('timeupdate', {'time': t});\n\n                    const time = Number(t.toFixed(2));\n                    // If it is the same annotation we just run, then we don't need to run it again.\n                    let percentagePlayed = (t - start) / totaltime;\n                    $('#currenttime').text(convertSecondsToHMS(t - start));\n                    percentagePlayed = percentagePlayed > 1 ? 1 : percentagePlayed;\n                    $('#video-nav #progress').css('width', percentagePlayed * 100 + '%');\n                    $('#video-nav #seekhead').css('left', percentagePlayed * 100 + '%');\n                    const theAnnotation = releventAnnotations.find(x => (((t - 0.5).toFixed(2) <= x.timestamp\n                        && (t + player.frequency).toFixed(2) >= x.timestamp) || time == x.timestamp) &&\n                        x.id != 0 && !viewedAnno.includes(Number(x.id)));\n                    if (theAnnotation) {\n                        $('#interactions-nav .annotation[data-id=\"' + theAnnotation.id + '\"] .item').trigger('mouseover')\n                            .addClass('active');\n\n                        setTimeout(function() {\n                            $('#interactions-nav .annotation[data-id=\"' + theAnnotation.id + '\"] .item')\n                                .trigger('mouseout').removeClass('active');\n                        }, 2000);\n                        if (!theAnnotation.completed || theAnnotation.rerunnable) {\n                            player.pause();\n                            await player.seek(theAnnotation.timestamp); // Pause after the timestamp.\n                            player.pause();\n                            $('#video-nav #progress')\n                                .css('width', (theAnnotation.timestamp - start) / totaltime * 100 + '%');\n                            $('#video-nav #seekhead').css('left', (theAnnotation.timestamp - start) / totaltime * 100 + '%');\n                            if (player.type == 'yt') {\n                                const isPlayingInterval = setInterval(async function() {\n                                    if (player.isPaused()) {\n                                        clearInterval(isPlayingInterval);\n                                        runInteraction(theAnnotation);\n                                    }\n                                }, 10);\n                            } else {\n                                runInteraction(theAnnotation);\n                            }\n                        }\n                    }\n                };\n\n                if (player.type == 'yt' || player.type == 'wistia') {\n                    interval = setInterval(intervalFunction, player.frequency * 100);\n                } else {\n                    intervalFunction();\n                }\n            };\n\n            // Implement the player\n            require(['mod_interactivevideo/player/' + vtype], function(VideoPlayer) {\n                player = new VideoPlayer(\n                    url,\n                    start,\n                    end,\n                    displayoptions.useoriginalvideocontrols == 1,\n                    true,\n                    false\n                );\n            });\n\n            // Move toast-wrapper to the #wrapper element so it can be displayed on top of the video in fullscreen mode.\n            let $toast = $('.toast-wrapper').detach();\n            $('#wrapper').append($toast);\n\n            $(document).on('timeupdate', async function(e) {\n                const t = e.originalEvent.detail.time;\n                if (preventskip) {\n                    const theAnnotations = releventAnnotations.filter(x => Number(x.timestamp) <= (t + player.frequency)\n                        && x.completed == false && x.hascompletion == 1);\n                    if (theAnnotations.length > 0) {\n                        const theAnnotation = theAnnotations[0];\n                        player.pause();\n                        await player.seek((theAnnotation.timestamp - 0.7 > start) ? (theAnnotation.timestamp - 0.7) : start);\n                        clearInterval(interval);\n                        Toast.add(M.util.get_string('youmustcompletethepreviousactivity', 'mod_interactivevideo'), {\n                            type: 'danger'\n                        });\n                        $videoNav.find('#progress').css('width', ((theAnnotation.timestamp - start) / totaltime) * 100 + '%');\n                        $videoNav.find('#seekhead').css('left', ((theAnnotation.timestamp - start) / totaltime) * 100 + '%');\n                    }\n                }\n            });\n\n            // Handle the refresh button:: allowing user to refresh the content\n            $(document).on('click', '#refresh', function(e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                const id = $(this).data('id');\n                const annotation = releventAnnotations.find(x => x.id == id);\n                $(this).closest('#message').find(\"#content\").empty();\n                runInteraction(annotation, true);\n            });\n\n            // Handle video control events:: fullscreen toggle\n            $(document).on('click', '#fullscreen', function(e) {\n                e.preventDefault();\n                if (!playerReady) {\n                    return;\n                }\n\n                // Put the wrapper in fullscreen mode\n                let elem = document.getElementById('wrapper');\n                $('#fullscreen').toggleClass('active');\n                if (!$('#wrapper').hasClass('fullscreen')) {\n                    if (elem.requestFullscreen) {\n                        elem.requestFullscreen();\n                    } else if (elem.mozRequestFullScreen) { /* Firefox */\n                        elem.mozRequestFullScreen();\n                    } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari and Opera */\n                        elem.webkitRequestFullscreen();\n                    } else if (elem.msRequestFullscreen) { /* IE/Edge */\n                        elem.msRequestFullscreen();\n                    }\n                } else {\n                    if (document.exitFullscreen) {\n                        document.exitFullscreen();\n                    } else if (document.mozCancelFullScreen) { /* Firefox */\n                        document.mozCancelFullScreen();\n                    } else if (document.webkitExitFullscreen) { /* Chrome, Safari and Opera */\n                        document.webkitExitFullscreen();\n                    } else if (document.msExitFullscreen) { /* IE/Edge */\n                        document.msExitFullscreen();\n                    }\n                }\n            });\n\n            $(document).on('fullscreenchange', async function() {\n                if (document.fullscreenElement) {\n                    $('#wrapper, #interactivevideo-container').addClass('fullscreen');\n                    $(\"#video-wrapper\").css('padding-bottom', '0');\n                    $('#wrapper [data-toggle=\"tooltip\"]').tooltip({\n                        container: '#wrapper',\n                        boundary: 'window',\n                    });\n                } else {\n                    $('#wrapper, #interactivevideo-container').removeClass('fullscreen');\n                    let ratio = 16 / 9;\n                    if (!displayoptions.usefixedratio || displayoptions.usefixedratio == 0) {\n                        ratio = player.aspectratio;\n                    }\n                    $(\"#video-wrapper\").css('padding-bottom', (1 / ratio) * 100 + '%');\n                }\n                $('#wrapper #fullscreen i').toggleClass('bi-fullscreen bi-fullscreen-exit');\n            });\n\n            // Pause video when the tab is not visible.\n            $(document).on('visibilitychange', function() {\n                if (document.visibilityState == 'hidden') {\n                    player.pause();\n                }\n            });\n\n            // Handle player size change event.\n            $(document).on('click', '#controller #expand', function(e) {\n                e.preventDefault();\n                $('body').toggleClass('limited-width');\n                localStorage.setItem('limitedwidth', $('body').hasClass('limited-width'));\n                $(this).find('i').toggleClass('bi-square bi-file');\n            });\n\n            // Handle share this moment event.\n            $(document).on('click', '#controller #share', async function(e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                const $this = $(this);\n                $this.find('i').toggleClass('bi-share-fill bi-share');\n                let time = await player.getCurrentTime();\n                const url = window.location.href;\n                const shareurl = url + (url.indexOf('?') > 0 ? '&' : '?') + 't=' + Math.round(time);\n                // Add shareurl to clipboard.\n                await navigator.clipboard.writeText(shareurl);\n                $this.attr('data-original-title', M.util.get_string(\"copied\", \"mod_interactivevideo\")).tooltip('show');\n                setTimeout(function() {\n                    // Change tooltip back to share.\n                    $this\n                        .attr('data-original-title', M.util.get_string(\"sharethismoment\", \"mod_interactivevideo\"))\n                        .tooltip('hide');\n                    $this.find('i').toggleClass('bi-share-fill bi-share');\n                }, 2000);\n            });\n\n            // Display time when user hover on the progress bar.\n            $(document).on('mouseenter', '#video-nav #seek', function(e) {\n                if (!playerReady) {\n                    return;\n                }\n                $(this).append('<div id=\"position\"><div id=\"timelabel\"></div></div>');\n                let $position = $('#position');\n                const parentOffset = $(this).offset();\n                const relX = e.pageX - parentOffset.left;\n\n                $position.css('left', (relX) + 'px');\n                var percentage = relX / $(this).width();\n                var time = percentage * totaltime;\n                var formattedTime = convertSecondsToHMS(time);\n                $position.find('#timelabel').text(formattedTime);\n            });\n\n            $(document).on('mousemove', '#video-nav #seek', function(e) {\n                if (!playerReady) {\n                    return;\n                }\n                const parentOffset = $(this).offset();\n                const relX = e.pageX - parentOffset.left;\n                var percentage = relX / $(this).width();\n                var time = percentage * totaltime;\n                var formattedTime = convertSecondsToHMS(time);\n                $('#position').css('left', (relX) + 'px');\n                $('#position #timelabel').text(formattedTime);\n            });\n\n            $(document).on('mouseleave', '#video-nav #seek', function() {\n                $('#position').remove();\n            });\n\n            // Handle annotation click event:: when user click on the annotation on the progress bar\n            $(document).on('click', '#interactions-nav .annotation, #video-nav .annotation', async function(e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                if ($(this).hasClass('no-click')) {\n                    // Add a tooltip that seeking is disabled.\n                    Toast.add(M.util.get_string('youcannotviewthisannotationyet', 'mod_interactivevideo'), {\n                        type: 'danger'\n                    });\n                    return;\n                }\n                const timestamp = $(this).data('timestamp');\n                replaceProgressBars(((timestamp - start) / totaltime) * 100);\n                player.play();\n                if (player.type == 'yt') {\n                    clearInterval(interval);\n                }\n                await player.seek(Number(timestamp));\n                player.pause();\n                const id = $(this).data('id');\n                const theAnnotation = releventAnnotations.find(x => x.id == id);\n                setTimeout(() => {\n                    runInteraction(theAnnotation);\n                }, 500);\n                // Clear the viewed annotations that are after this timestamp.\n                const preceedingAnno = releventAnnotations.filter(x => x.timestamp < timestamp).map(x => Number(x.id));\n                viewedAnno = preceedingAnno;\n                viewedAnno.push(id);\n                // Concatenate the preceeding annotations.\n                viewedAnno = [...new Set(viewedAnno)];\n            });\n\n            // Handle seeking event:: when user click on the progress bar\n            $(document).on('click', '#seek', async function(e) {\n                if (!playerReady) {\n                    return;\n                }\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                if ($('#video-nav').hasClass('no-click')) {\n                    // Add a tooltip that seeking is disabled.\n                    Toast.add(M.util.get_string('seekingdisabled', 'mod_interactivevideo'), {\n                        type: 'danger'\n                    });\n                    return;\n                }\n                $('#start-screen').fadeOut(300);\n                $('#end-screen').fadeOut(300);\n                const parentOffset = $(this).offset();\n                const relX = e.pageX - parentOffset.left;\n                var percentage = relX / $(this).width();\n                replaceProgressBars(percentage * 100);\n                // Gotta check if this affects anything.\n                if (player.type == 'yt') {\n                    clearInterval(interval);\n                }\n                player.pause(); // Especially for vimeo.\n                await player.seek((percentage * totaltime) + start);\n                player.play();\n                setTimeout(() => {\n                    // Remove the position.\n                    $('#position').remove();\n                }, 300);\n            });\n\n            // Handle video control events:: play\n            $(document).on('click', '#start-screen #play', async function(e) {\n                e.preventDefault();\n                $('#start-screen').fadeOut(300);\n                $(this).addClass('d-none');\n                $videoNav.removeClass('d-none');\n                player.play();\n            });\n\n            // Handle video control events:: restart\n            $(document).on('click', '#end-screen #restart', async function(e) {\n                e.preventDefault();\n                $('#message').remove();\n                viewedAnno = [];\n                await player.seek(start);\n                $videoNav.find(\"#progress\").css('width', '0%');\n                $videoNav.find(\"#seekhead\").css('left', '0%');\n                $('#end-screen').fadeOut(300);\n                $(this).addClass('d-none');\n                $videoNav.removeClass('d-none');\n                player.play();\n            });\n\n            // Handle video control events:: pause/resume when user click on the video\n            $(document).on('click', '#video-wrapper .video-block', async function(e) {\n                if (!playerReady) {\n                    return;\n                }\n                clearInterval(interval);\n                e.preventDefault();\n                // Pause or resume the video.\n                const playing = await player.isPlaying();\n                if (playing) {\n                    player.pause();\n                } else {\n                    player.play();\n                }\n            });\n\n            $(document).on('click', '#playpause', async function(e) {\n                if (!playerReady) {\n                    return;\n                }\n                e.preventDefault();\n                $(this).tooltip('hide');\n                // Pause or resume the video.\n                const playing = await player.isPlaying();\n                if (playing) {\n                    player.pause();\n                } else {\n                    let t = await player.getCurrentTime();\n                    if (t >= end) {\n                        $('#end-screen #restart').trigger('click');\n                    } else {\n                        player.play();\n                    }\n                }\n            });\n\n            $(document).on('click', 'li.anno', async function(e) {\n                e.preventDefault();\n                const id = $(this).data('id');\n                $(`li.annotation[data-id=${id}]`).trigger('click');\n                if ($(this).closest('#chapter-container-left').length > 0) {\n                    $('#chaptertoggle .btn').trigger('click');\n                }\n            });\n\n            // Handle video control events:: mute/unmute\n            $(document).on('click', '#mute', function(e) {\n                e.preventDefault();\n                $(this).tooltip('hide');\n                $(this).toggleClass('active');\n                if ($(this).hasClass('active')) {\n                    player.mute();\n                    $(this).attr('data-original-title', M.util.get_string('unmute', 'mod_interactivevideo'));\n                } else {\n                    player.unMute();\n                    $(this).attr('data-original-title', M.util.get_string('mute', 'mod_interactivevideo'));\n                }\n                $(this).find('i').toggleClass('bi-volume-mute bi-volume-up');\n                $(this).tooltip('show');\n            });\n\n            // Handle video control events:: playrate change\n            $(document).on('click', '.changerate', function(e) {\n                e.preventDefault();\n                const rate = $(this).data('rate');\n                player.setRate(rate);\n                $('.changerate').find('i').removeClass('bi-check');\n                $(this).find('i').addClass('bi-check');\n            });\n\n            // Handle video control:: Quality change\n            $(\"#changequality\").on('shown.bs.dropdown', async function() {\n                let quality = await player.getQualities();\n                $('#qualitieslist').empty();\n                let currentQuality = quality.currentQuality;\n                if (currentQuality === null) {\n                    currentQuality = $(this).data('current');\n                }\n                let qualities = quality.qualities;\n                let qualitiesLabel = quality.qualitiesLabel;\n                qualities.forEach((q, i) => {\n                    $('#qualitieslist').append(`<a class=\"dropdown-item text-white changequality\" data-quality=\"${q}\"\n                         href=\"#\"><i class=\"bi ${q == currentQuality ? 'bi-check' : ''} fa-fw ml-n3\"></i>${qualitiesLabel[i]}</a>`);\n                });\n                $(this).find('[data-toggle=dropdown]').dropdown('update');\n            });\n\n            $(document).on('click', '.changequality', function(e) {\n                e.preventDefault();\n                const quality = $(this).data('quality');\n                player.setQuality(quality);\n                $('.changequality').find('i').removeClass('bi-check');\n                $(this).find('i').addClass('bi-check');\n            });\n\n            $(document).on('iv:playerReady', function() {\n                onReady();\n            });\n\n            $(document).on('iv:playerPaused', function() {\n                onPaused();\n            });\n\n            $(document).on('iv:playerPlaying', function() {\n                onPlaying();\n            });\n\n            $(document).on('iv:playerEnded', function() {\n                onEnded();\n            });\n\n            $(document).on('iv:playerSeek', function(e) {\n                onSeek(e.detail.time);\n            });\n\n            $(document).on('iv:playerError', function() {\n                Toast.add(M.util.get_string('thereisanissueloadingvideo', 'mod_interactivevideo'), {\n                    type: 'danger'\n                });\n                $('#spinner').remove();\n            });\n\n            $(document).on('iv:playerRateChange', function(e) {\n                $('.changerate').find('i').removeClass('bi-check');\n                $(`.changerate[data-rate=\"${e.originalEvent.detail.rate}\"]`).find('i').addClass('bi-check');\n            });\n\n            $(document).on('iv:playerQualityChange', function(e) {\n                $('#changequality').attr('data-current', e.originalEvent.detail.quality);\n                $('.changequality').find('i').removeClass('bi-check');\n                $(`.changequality[data-quality=\"${e.originalEvent.detail.quality}\"]`).find('i').addClass('bi-check');\n            });\n\n            $(document).on('annotationitemsrendered', function() {\n                $('#wrapper [data-toggle=\"tooltip\"]').tooltip({\n                    container: '#wrapper',\n                    boundary: 'window',\n                });\n                if (displayoptions.disableinteractionclickuntilcompleted == 1) {\n                    $interactionNav.find('li:not(.completed)').addClass('no-click');\n                }\n                if (displayoptions.disableinteractionclick == 1) {\n                    $interactionNav.find('li').addClass('no-click');\n                }\n                if (displayoptions.preventseeking == 1) {\n                    $interactionNav.find('li').addClass('no-click');\n                    $videoNav.addClass('no-click');\n                }\n            });\n\n            if ($(\"body\").hasClass('mobiletheme')) {\n                $('[data-toggle=\"tooltip\"]').on('click', function() {\n                    var $this = $(this);\n                    setTimeout(function() {\n                        $this.tooltip('hide');\n                    }, 2000); // Hide after 3 seconds\n                });\n            }\n        }\n    };\n});"],"names":["define","$","eventDispatcher","Toast","dispatchEvent","ctRenderer","annotations","totaltime","activityType","contentTypes","displayoptions","releventAnnotations","completionid","player","viewedAnno","$videoNav","$interactionNav","renderAnnotationItems","async","annos","start","actualduration","skipsegments","filter","x","type","length","forEach","Number","title","timestamp","completableAnno","hascompletion","actualAnnotationCounts","xp","map","reduce","a","b","completedAnnos","completed","xpEarned","empty","append","seconds","hours","Math","floor","minutes","remainingSeconds","string","formatTime","ceil","preventseeking","addClass","hidemainvideocontrols","hideinteractions","renderer","renderItemOnVideoNavigation","chapteritems","sort","each","cstart","this","data","cend","find","id","JSON","parse","prop","icon","formattedtitle","init","url","cmid","interaction","course","userid","end","completionpercentage","gradeiteminstance","grademax","vtype","preventskip","moment","doptions","token","isNaN","playerReady","localStorage","getItem","removeClass","convertSecondsToHMS","h","m","s","replaceProgressBars","percentage","css","getAnnotations","callback","annnoitems","ajax","M","cfg","wwwroot","method","dataType","action","sesskey","contextid","courseContextId","userprogress","uid","getContentTypes","when","done","progress","ct","annotation","some","y","name","filterAnnotations","completedItems","completeditems","contentTypeMap","Map","advanced","stringify","get","indexOf","e","rerunnable","replaybehavior","processAnnotations","shouldAdd","skipsegment","push","getRelevantAnnotations","unshift","util","get_string","hide","prependDummyChapter","chapterContentType","includes","remove","Promise","all","contentType","resolve","require","amdmodule","Type","error","then","initializeContentTypeRenderers","toggleClass","runInteraction","Date","getTime","Set","modal","not","fadeOut","theAnnotations","theAnnotation","pause","seek","add","shareMoment","urlParams","URLSearchParams","window","location","search","time","play","delete","newurl","protocol","host","pathname","toString","history","replaceState","onReady","support","playbackrate","quality","posterImage","duration","getDuration","min","text","ratio","usefixedratio","aspectratio","gap","focus","draggable","event","ui","$position","relX","position","left","width","formattedTime","setTimeout","onPaused","clearInterval","interval","attr","onEnded","t","trigger","fadeIn","onSeek","getCurrentTime","onPlaying","hasClass","intervalFunction","isPlaying","isEnded","unMute","toFixed","percentagePlayed","frequency","isPlayingInterval","setInterval","isPaused","VideoPlayer","useoriginalvideocontrols","$toast","detach","document","on","originalEvent","detail","preventDefault","stopImmediatePropagation","closest","elem","getElementById","exitFullscreen","mozCancelFullScreen","webkitExitFullscreen","msExitFullscreen","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen","fullscreenElement","tooltip","container","boundary","visibilityState","setItem","$this","href","shareurl","round","navigator","clipboard","writeText","parentOffset","offset","pageX","preceedingAnno","mute","rate","setRate","getQualities","currentQuality","qualities","qualitiesLabel","q","i","dropdown","setQuality","disableinteractionclickuntilcompleted","disableinteractionclick"],"mappings":"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"}