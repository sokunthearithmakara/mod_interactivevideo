{"version":3,"file":"viewannotation.min.js","sources":["../src/viewannotation.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * View page module\n *\n * @module     mod_interactivevideo/viewannotation\n * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'jquery', 'core/event_dispatcher', 'core/toast', 'mod_interactivevideo/libraries/jquery-ui'\n], function($, {dispatchEvent}, Toast) {\n    let ctRenderer = {};\n    let annotations, // Array of annotations.\n        totaltime, // Video total time.\n        activityType, // Current activityType.\n        lastanno, // Last run annotation.\n        contentTypes, // Array of available content types.\n        displayoptions, // Display options.\n        releventAnnotations, // Array of annotations that are not skipped.\n        player;\n\n    const $videoNav = $('#video-nav');\n\n    const convertSecondsToMinutes = (seconds) => {\n        if (seconds < 60) {\n            return seconds + 's';\n        } else {\n            const minutes = Math.floor(seconds / 60);\n            const remainingSeconds = seconds % 60;\n            return minutes + 'm ' + remainingSeconds + 's';\n        }\n    };\n\n    const renderAnnotationItems = async (annos, start, totaltime) => {\n        releventAnnotations = annos;\n\n        let actualduration = totaltime;\n\n        const skipsegments = annos.filter(x => x.type == 'skipsegment');\n\n        if (skipsegments.length > 0) {\n            skipsegments.forEach(x => {\n                const length = (Number(x.title) - Number(x.timestamp));\n                actualduration -= length;\n            });\n        }\n\n        const completableAnno = releventAnnotations.filter(x => x.hascompletion == 1);\n        const actualAnnotationCounts = completableAnno.length;\n\n        const xp = completableAnno.map(x => Number(x.xp)).reduce((a, b) => a + b, 0);\n\n        const completedAnnos = completableAnno\n            .filter(x => x.completed);\n\n        const xpEarned = completedAnnos.map(x => Number(x.xp)).reduce((a, b) => a + b, 0);\n\n        $(\".metadata\").empty();\n        $(\".metadata\").append(`<span class=\"d-inline-block mr-3\">\n            <i class=\"bi bi-stopwatch mr-2\"></i>${convertSecondsToMinutes(Math.ceil(actualduration))}</span>\n            <span class=\"d-inline-block mr-3\">\n        <i class=\"bi bi-bullseye mr-2\"></i>${completedAnnos.length} / ${actualAnnotationCounts}</span>\n        <span class=\"d-inline-block\"><i class=\"bi bi-star mr-2\"></i>${xpEarned} / ${xp}</span>`);\n\n        $(\"#video-nav ul\").empty();\n\n        if (annos.length == 0) {\n            return;\n        }\n\n        if (displayoptions.preventseeking == 1) {\n            $videoNav.addClass('no-pointer-events');\n        }\n\n        if (displayoptions.hidemainvideocontrols == 1 || displayoptions.hideinteractions == 1) {\n            if (displayoptions.hidemainvideocontrols == 1) {\n                $('#wrapper').addClass('no-videonav');\n            }\n            return;\n        }\n        const render = new Promise((resolve) => {\n            annos.forEach(async (x) => {\n                const renderer = ctRenderer[x.type];\n                renderer.renderItemOnVideoNavigation(x);\n            });\n            resolve();\n        });\n\n        await render;\n        dispatchEvent('annotationitemsrendered', {'annotations': annos});\n        $('.annolistinchapter').empty();\n        const chapteritems = releventAnnotations.filter(x => x.type != 'skipsegment' && x.hascompletion == 1);\n        chapteritems.sort((a, b) => a.timestamp - b.timestamp);\n        chapteritems.forEach((x) => {\n            $('[data-region=\"chapterlists\"] li').each(function() {\n                const cstart = $(this).data('start');\n                const cend = $(this).data('end');\n                if (x.timestamp >= cstart && x.timestamp < cend) {\n                    $(this).find('.annolistinchapter')\n                        .append(`<li class=\"border-bottom anno d-flex align-items-center justify-content-between\n                         px-3 py-2 ${x.completed ? \"completed\" : \"\"}\" data-id=\"${x.id}\" data-timestamp=\"${x.timestamp}\">\n                         <span class=\"text-nowrap\">\n                         <i class=\"small bi ${x.completed ? \"bi-check-circle-fill text-success\" : 'bi-circle'} mr-2\"></i>\n                         <i class=\"${JSON.parse(x.prop).icon} mr-2\"></i></span>\n                         <span class=\"flex-grow-1 text-truncate\">${x.formattedtitle}</span>\n                         <span class=\"text-nowrap\">${x.xp}<i class=\"bi bi-star ml-1\"></i></span></li>`);\n                }\n            });\n        });\n        dispatchEvent('chapterrendered', {'annotations': releventAnnotations});\n\n        $(document).on('annotationitemsrendered', function() {\n            $('#wrapper [data-toggle=\"tooltip\"]').tooltip({\n                container: '#wrapper',\n                boundary: 'window',\n            });\n            if (displayoptions.disableinteractionclickuntilcompleted == 1) {\n                $videoNav.find('ul li:not(.completed):not(.chapter)').addClass('no-click');\n            }\n            if (displayoptions.disableinteractionclick == 1) {\n                $videoNav.find('ul li:not(.chapter)').addClass('no-click');\n            }\n            if (displayoptions.preventseeking == 1) {\n                $videoNav.find('ul li').addClass('no-click');\n                $videoNav.addClass('no-click');\n            }\n        });\n    };\n\n    return {\n        renderAnnotationItems: renderAnnotationItems,\n        init: function(\n            url, cmid, interaction, course, userid, start = 0, end,\n            completionpercentage, gradeiteminstance, grademax, vtype,\n            preventskip = true, moment = null, doptions = {}, token = null) {\n            // Convert start to number if string\n            start = Number(start);\n            if (isNaN(start)) {\n                start = 0;\n            }\n\n            // Convert end to number if string\n            end = Number(end);\n            if (isNaN(end)) {\n                end = null;\n            }\n\n            displayoptions = doptions;\n\n            let playerReady = false;\n\n            const convertSecondsToHMS = (seconds) => {\n                const h = Math.floor(seconds / 3600);\n                const m = Math.floor(seconds % 3600 / 60);\n                const s = Math.floor(seconds % 3600 % 60);\n                return (h > 0 ? h + ':' : '') + (m < 10 ? '0' : '') + m + ':' + (s < 10 ? '0' : '') + s;\n            };\n\n            const replaceProgressBars = (percentage) => {\n                percentage = percentage > 100 ? 100 : percentage;\n                $videoNav.find('#progress').replaceWith(`<div id=\"progress\" style=\"width: ${percentage}%;\"></div>`);\n                $videoNav.find('#seekhead').css('left', percentage + '%');\n            };\n\n            const getAnnotations = (callback) => {\n                // Get all interaction items.\n                const annnoitems = $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'get_items',\n                        sesskey: M.cfg.sesskey,\n                        id: interaction,\n                        contextid: M.cfg.courseContextId,\n                        token: token,\n                        cmid: cmid\n                    }\n                });\n\n                // Get current user progress.\n                const userprogress = $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'get_progress',\n                        sesskey: M.cfg.sesskey,\n                        id: interaction,\n                        uid: userid,\n                        token: token,\n                        cmid: cmid\n                    }\n                });\n\n                // Get all content types.\n                const getContentTypes = $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'getallcontenttypes',\n                        sesskey: M.cfg.sesskey,\n                        token: token,\n                        cmid: cmid\n                    }\n                });\n\n                $.when(annnoitems, userprogress, getContentTypes).done(async function(annos, progress, ct) {\n                    annotations = JSON.parse(annos[0]);\n                    progress = JSON.parse(progress[0]);\n                    contentTypes = JSON.parse(ct[0]);\n                    // Get only annotations within the start and end times.\n                    // Remove the skip segments that are completely outside the start and end times.\n                    // Remove the annotations whose content type is not in the contentTypes.\n                    annotations = annotations.filter(x => {\n                        const inContentType = contentTypes.some(y => y.name === x.type);\n                        if (!inContentType) {\n                            return false;\n                        }\n\n                        if (x.type === 'skipsegment') {\n                            return !(x.timestamp > end || x.title < start);\n                        }\n\n                        return (x.timestamp >= start && x.timestamp <= end) || x.timestamp < 0;\n                    });\n\n                    const completedItems = progress.completeditems == '' ? [] : JSON.parse(progress.completeditems);\n                    annotations = annotations.map(x => {\n                        // First, let's make sure numbers are treated as numbers.\n                        x.timestamp = Number(x.timestamp);\n                        x.xp = Number(x.xp);\n                        if (x.type == 'skipsegment') {\n                            x.title = Number(x.title);\n                        }\n                        // Properties must be stringified so it can be passed through Fragment.\n                        x.prop = JSON.stringify(contentTypes.find(y => y.name == x.type));\n\n                        x.completed = completedItems.indexOf(x.id) > -1;\n\n                        // Handle the skip segments that are half inside the start and end times.\n                        if (x.type == 'skipsegment') {\n                            if (x.timestamp < start && x.title > start) {\n                                x.timestamp = start;\n                            }\n                            if (x.title > end && x.timestamp < end) {\n                                x.title = end;\n                            }\n                        }\n\n                        const advanced = JSON.parse(x.advanced);\n                        x.rerunnable = advanced && advanced.replaybehavior === '1';\n\n                        return x;\n                    });\n\n                    // Sort by timestamp.\n                    annotations.sort((a, b) => a.timestamp - b.timestamp);\n\n                    const skipsegments = annotations.filter(x => x.type == 'skipsegment');\n\n                    releventAnnotations = [];\n                    annotations.forEach(x => {\n                        let shouldAdd = true;\n                        skipsegments.forEach(y => {\n                            if (Number(x.timestamp) > Number(y.timestamp) && Number(x.timestamp) < Number(y.title)) {\n                                shouldAdd = false;\n                            }\n                        });\n                        if (shouldAdd) {\n                            releventAnnotations.push(x);\n                        }\n                    });\n\n                    if (releventAnnotations.length > 0 && !releventAnnotations.find(x => x.type == 'chapter')) {\n                        // Add a dummy chapter at the start of the video.\n                        releventAnnotations.unshift({\n                            id: 0,\n                            title: M.util.get_string('startchapter', 'mod_interactivevideo'),\n                            formattedtitle: M.util.get_string('startchapter', 'mod_interactivevideo'),\n                            timestamp: start,\n                            type: 'chapter',\n                            prop: JSON.stringify(contentTypes.find(x => x.name == 'chapter')),\n                            xp: 0,\n                            completed: true,\n                            hide: true\n                        });\n                    }\n\n                    const getRenderers = new Promise((resolve) => {\n                        const chapterContentType = contentTypes.find(x => x.name == 'chapter');\n                        // We want to use only the content types that are being used in the annotations\n                        contentTypes = contentTypes.filter(x => releventAnnotations.map(y => y.type).includes(x.name));\n                        if (contentTypes.length == 0) {\n                            // Remove the chapter toggle\n                            $('#chaptertoggle, #chapter-container-left, #chapter-container-right').remove();\n                            resolve(ctRenderer);\n                        } else {\n                            $('#chaptertoggle, #chapter-container-left, #chapter-container-right').removeClass('d-none');\n                        }\n                        if (!contentTypes.find(x => x.name == 'chapter')) {\n                            // Include the chapterContentType\n                            contentTypes.push(chapterContentType);\n                        }\n                        var count = 0;\n                        contentTypes.forEach(x => {\n                            require([x.amdmodule], function(Type) {\n                                ctRenderer[x.name] = new Type(player, releventAnnotations, interaction, course, userid,\n                                    completionpercentage, gradeiteminstance, grademax, vtype, preventskip, totaltime, start,\n                                    end, x, cmid, token);\n                                try {\n                                    ctRenderer[x.name].init();\n                                } catch (error) {\n                                    // Do nothing.\n                                }\n                                count++;\n                                if (count == contentTypes.length) {\n                                    resolve(ctRenderer);\n                                }\n                            });\n                        });\n                    });\n\n                    await getRenderers;\n\n                    await renderAnnotationItems(releventAnnotations, start, totaltime);\n                    $(\"#play\").removeClass('d-none');\n                    $(\"#spinner\").remove();\n                    $(\"#video-info\").toggleClass('d-none d-flex');\n                    callback();\n                });\n            };\n\n            const runInteraction = async (annotation) => {\n                lastanno = annotation;\n                // Remove the previous message but keep the one below the video.\n                $('#annotation-modal').modal('hide');\n                $('#message').not('[data-placement=bottom]').not('.sticky').remove();\n                $('#end-screen, #start-screen').fadeOut(300);\n\n                if (preventskip) {\n                    const theAnnotations = releventAnnotations\n                        .filter(x => Number(x.timestamp) < Number(annotation.timestamp)\n                            && x.completed == false && x.hascompletion == 1);\n                    if (theAnnotations.length > 0) {\n                        const theAnnotation = theAnnotations[0];\n                        player.pause();\n                        await player.seek((theAnnotation.timestamp - 0.7 > start) ? (theAnnotation.timestamp - 0.7) : start);\n                        Toast.add(M.util.get_string('youmustcompletethepreviousactivity', 'mod_interactivevideo'), {\n                            type: 'danger'\n                        });\n                        return;\n                    }\n                }\n                activityType = ctRenderer[annotation.type];\n                activityType.runInteraction(annotation);\n            };\n\n            const shareMoment = async () => {\n                if (!moment) {\n                    return;\n                }\n                // Check if the url has a timestamp using url params.\n                const urlParams = new URLSearchParams(window.location.search);\n                const time = Number(moment);\n                if (time && !isNaN(time) && time >= start && time <= end) {\n                    // Hide the start screen.\n                    $('#video-wrapper #start-screen').hide(0);\n                    await player.seek(time);\n                    player.play();\n                    const theAnnotation = releventAnnotations.find(x => x.timestamp == time);\n                    if (theAnnotation) {\n                        runInteraction(theAnnotation);\n                    }\n\n                    replaceProgressBars(((time - start) / totaltime) * 100);\n\n                }\n                urlParams.delete('t');\n                const newurl = window.location.protocol\n                    + '//' + window.location.host + window.location.pathname + '?' + urlParams.toString();\n                window.history.replaceState(null, null, newurl);\n            };\n\n            const onReady = async () => {\n                if (player.support.playbackrate == false) {\n                    $('#changerate').remove();\n                } else {\n                    $('#changerate').removeClass('d-none');\n                }\n\n                if (player.support.quality == false) {\n                    $('#changequality').remove();\n                } else {\n                    $('#changequality').removeClass('d-none');\n                }\n\n                if (player.posterImage) {\n                    $('#video-wrapper #start-screen').css({\n                        'background': `url(${player.posterImage}) no-repeat center center / cover`,\n                    });\n                }\n                $(\".video-block\").css('background', 'transparent');\n                const duration = await player.getDuration();\n                end = !end ? duration : Math.min(end, duration);\n                start = start > end ? 0 : start;\n                totaltime = end - start;\n                getAnnotations(shareMoment);\n                $('#duration').text(convertSecondsToHMS(totaltime));\n\n                // Recalculate the ratio of the video\n                const ratio = await player.ratio();\n                $(\"#video-wrapper\").css('padding-bottom', (1 / ratio) * 100 + '%');\n\n                playerReady = true;\n                $('#start-screen #start').focus();\n\n                $('#seekhead').draggable({\n                    'containment': '#video-nav',\n                    'axis': 'x',\n                    'cursor': 'col-resize',\n                    'start': function() {\n                        $(this).addClass('active');\n                        $('#taskinfo').addClass('no-pointer-events');\n                        $(\"#message, #end-screen\").remove();\n                    },\n                    'drag': async function(event, ui) {\n                        let timestamp = ((ui.position.left) / $('#video-nav').width()) * totaltime + start;\n                        await player.seek(timestamp);\n                        player.pause();\n                    },\n                    'stop': async function(event, ui) {\n                        setTimeout(function() {\n                            $('#taskinfo').removeClass('no-pointer-events');\n                        }, 200);\n                        setTimeout(function() {\n                            $('#seekhead').removeClass('active');\n                        }, 1000);\n                        let percentage = ui.position.left / $('#video-nav').width();\n                        replaceProgressBars(percentage * 100);\n                        player.play();\n                    }\n                });\n            };\n\n            const onPaused = () => {\n                if (!playerReady) {\n                    return;\n                }\n                clearInterval(interval);\n                $('#playpause').find('i').removeClass('bi-pause-fill').addClass('bi-play-fill');\n                $('#playpause').attr('data-original-title', M.util.get_string('play', 'mod_interactivevideo'));\n            };\n\n            const onEnded = (t) => {\n                if (!playerReady) {\n                    return;\n                }\n                const time = t || end;\n                // Check if theAnnotation exists at the end of the video.\n                const theAnnotation = releventAnnotations.find(x => x.timestamp == time);\n                if (theAnnotation && !lastanno) {\n                    if (!theAnnotation.completed || theAnnotation.rerunnable) {\n                        player.pause();\n                        runInteraction(theAnnotation);\n                    }\n                    // Toggle the tooltip to show the title.\n                    $videoNav.find('.annotation[data-id=\"' + theAnnotation.id + '\"] .item').tooltip('show');\n                    // Hide the tooltip after 2 seconds.\n                    setTimeout(function() {\n                        $videoNav.find('.annotation[data-id=\"' + theAnnotation.id + '\"] .item').tooltip('hide');\n                    }, 2000);\n                }\n\n                $('#restart').removeClass('d-none').fadeIn(300);\n                $('#end-screen').removeClass('d-none').fadeIn(300);\n                $('#progress').css('width', '100%');\n                $('#seekhead').css('left', '100%');\n                clearInterval(interval);\n                player.pause();\n                $('#playpause').find('i').removeClass('bi-pause-fill').addClass('bi-play-fill');\n                $('#playpause').attr('data-original-title', M.util.get_string('play', 'mod_interactivevideo'));\n            };\n\n            const onSeek = async (t) => {\n                if (!playerReady) {\n                    return;\n                }\n                if (t) {\n                    t = Number(t);\n                } else {\n                    t = await player.getCurrentTime();\n                }\n                if (t > start && t < end) {\n                    $('#end-screen, #start-screen').addClass('d-none');\n                }\n                var percentage = (t - start) / (totaltime) * 100;\n                $('#currenttime').text(convertSecondsToHMS(t - start));\n                replaceProgressBars(percentage);\n                dispatchEvent('timeupdate', {'time': t});\n            };\n\n            let interval;\n            const onPlaying = async () => { // Use with player timeupdate event.\n                // Reset the annotation content.\n                if (!playerReady) {\n                    return;\n                }\n                if ($('body').hasClass('mobiletheme') && !$('#wrapper').hasClass('fullscreen')) {\n                    $(\"#fullscreen\").trigger('click');\n                }\n                $('#annotation-modal').modal('hide');\n                $('#message').not('[data-placement=bottom]').not('.sticky').remove();\n                $('#end-screen, #start-screen').fadeOut(300);\n                $('#restart').addClass('d-none');\n                $('#playpause').find('i').removeClass('bi-play-fill').addClass('bi-pause-fill');\n                $('#playpause').attr('data-original-title', M.util.get_string('pause', 'mod_interactivevideo'));\n                const intervalFunction = async function() {\n                    const isPlaying = await player.isPlaying();\n                    const isEnded = await player.isEnded();\n                    if (!isPlaying || isEnded) {\n                        clearInterval(interval);\n                        return;\n                    }\n\n                    const t = await player.getCurrentTime();\n                    if (t > end || isEnded) {\n                        clearInterval(interval);\n                        onEnded(end);\n                        return;\n                    }\n\n                    dispatchEvent('timeupdate', {'time': t});\n\n                    const time = Math.round(t);\n\n                    // If it is the same annotation we just run, then we don't need to run it again.\n                    if (lastanno && time == lastanno.timestamp) {\n                        return;\n                    } else {\n                        if (lastanno && time > lastanno.timestamp) {\n                            lastanno = null;\n                        }\n                        let percentagePlayed = (t - start) / totaltime;\n                        $('#currenttime').text(convertSecondsToHMS(t - start));\n                        percentagePlayed = percentagePlayed > 1 ? 1 : percentagePlayed;\n                        $('#video-nav #progress').css('width', percentagePlayed * 100 + '%');\n                        $('#video-nav #seekhead').css('left', percentagePlayed * 100 + '%');\n                        const theAnnotation = releventAnnotations.find(x => (((t - player.frequency) <= x.timestamp\n                            && (t + player.frequency) >= x.timestamp) || time == x.timestamp) && x.id != 0);\n                        if (theAnnotation) {\n                            if (theAnnotation.completed && !theAnnotation.rerunnable) {\n                                $('#video-nav .annotation[data-id=\"' + theAnnotation.id + '\"] .item').tooltip('show');\n                                setTimeout(function() {\n                                    $('#video-nav .annotation[data-id=\"' + theAnnotation.id + '\"] .item').tooltip('hide');\n                                }, 2000);\n                            } else {\n                                player.pause();\n                                $('#video-nav #progress')\n                                    .css('width', (theAnnotation.timestamp - start) / totaltime * 100 + '%');\n                                $('#video-nav #seekhead').css('left', (theAnnotation.timestamp - start) / totaltime * 100 + '%');\n                                runInteraction(theAnnotation);\n                            }\n                        }\n                    }\n\n                    // Pause video on spacebar pressed\n                    $(document).on('keydown', function(e) {\n                        if (e.keyCode == 32) {\n                            e.preventDefault();\n                            player.pause();\n                        }\n                    });\n                };\n\n                if (player.type == 'yt' || player.type == 'wistia') {\n                    interval = setInterval(intervalFunction, player.frequency * 100);\n                } else {\n                    intervalFunction();\n                }\n\n            };\n\n            // Implement the player\n            require(['mod_interactivevideo/player/' + vtype], function(VideoPlayer) {\n                player = new VideoPlayer(\n                    url,\n                    start,\n                    end,\n                    displayoptions.useoriginalvideocontrols == 1,\n                    true,\n                    false\n                );\n            });\n\n            // Move toast-wrapper to the #wrapper element so it can be displayed on top of the video in fullscreen mode.\n            let $toast = $('.toast-wrapper').detach();\n            $('#wrapper').append($toast);\n\n            $(document).on('timeupdate', async function(e) {\n                const t = e.originalEvent.detail.time;\n                if (preventskip) {\n                    const theAnnotations = releventAnnotations.filter(x => Number(x.timestamp) <= (t + player.frequency)\n                        && x.completed == false && x.hascompletion == 1);\n                    if (theAnnotations.length > 0) {\n                        const theAnnotation = theAnnotations[0];\n                        player.pause();\n                        await player.seek((theAnnotation.timestamp - 0.7 > start) ? (theAnnotation.timestamp - 0.7) : start);\n                        clearInterval(interval);\n                        Toast.add(M.util.get_string('youmustcompletethepreviousactivity', 'mod_interactivevideo'), {\n                            type: 'danger'\n                        });\n                        $videoNav.find('#progress').css('width', ((theAnnotation.timestamp - start) / totaltime) * 100 + '%');\n                        $videoNav.find('#seekhead').css('left', ((theAnnotation.timestamp - start) / totaltime) * 100 + '%');\n                    }\n                }\n            });\n\n            // Handle the refresh button:: allowing user to refresh the content\n            $(document).on('click', '#refresh', function(e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                const id = $(this).data('id');\n                const annotation = releventAnnotations.find(x => x.id == id);\n                $(this).closest('#message').find(\"#content\").empty();\n                runInteraction(annotation, true);\n            });\n\n            // Handle video control events:: fullscreen toggle\n            $(document).on('click', '#fullscreen', function(e) {\n                e.preventDefault();\n                if (!playerReady) {\n                    return;\n                }\n\n                // Put the wrapper in fullscreen mode\n                let elem = document.getElementById('wrapper');\n                $('#fullscreen').toggleClass('active');\n                if (!$('#wrapper').hasClass('fullscreen')) {\n                    if (elem.requestFullscreen) {\n                        elem.requestFullscreen();\n                    } else if (elem.mozRequestFullScreen) { /* Firefox */\n                        elem.mozRequestFullScreen();\n                    } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari and Opera */\n                        elem.webkitRequestFullscreen();\n                    } else if (elem.msRequestFullscreen) { /* IE/Edge */\n                        elem.msRequestFullscreen();\n                    }\n                } else {\n                    if (document.exitFullscreen) {\n                        document.exitFullscreen();\n                    } else if (document.mozCancelFullScreen) { /* Firefox */\n                        document.mozCancelFullScreen();\n                    } else if (document.webkitExitFullscreen) { /* Chrome, Safari and Opera */\n                        document.webkitExitFullscreen();\n                    } else if (document.msExitFullscreen) { /* IE/Edge */\n                        document.msExitFullscreen();\n                    }\n                }\n            });\n\n            $(document).on('fullscreenchange', async function() {\n                if (document.fullscreenElement) {\n                    $('#wrapper, #interactivevideo-container').addClass('fullscreen');\n                    $(\"#video-wrapper\").css('padding-bottom', '0');\n                    $('#wrapper [data-toggle=\"tooltip\"]').tooltip({\n                        container: '#wrapper',\n                        boundary: 'window',\n                    });\n                } else {\n                    $('#wrapper, #interactivevideo-container').removeClass('fullscreen');\n                    const ratio = await player.ratio();\n                    $(\"#video-wrapper\").css('padding-bottom', (1 / ratio) * 100 + '%');\n                }\n                $('#wrapper #fullscreen i').toggleClass('bi-fullscreen bi-fullscreen-exit');\n            });\n\n            // Pause video when the tab is not visible.\n            $(document).on('visibilitychange', function() {\n                if (document.visibilityState == 'hidden') {\n                    player.pause();\n                }\n            });\n\n            // Handle share this moment event.\n            $(document).on('click', '#controller #share', async function(e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                const $this = $(this);\n                $this.find('i').toggleClass('bi-share-fill bi-share');\n                let time = await player.getCurrentTime();\n                const url = window.location.href;\n                const shareurl = url + (url.indexOf('?') > 0 ? '&' : '?') + 't=' + Math.round(time);\n                // Add shareurl to clipboard.\n                await navigator.clipboard.writeText(shareurl);\n                $this.attr('data-original-title', M.util.get_string(\"copied\", \"mod_interactivevideo\")).tooltip('show');\n                setTimeout(function() {\n                    // Change tooltip back to share.\n                    $this\n                        .attr('data-original-title', M.util.get_string(\"sharethismoment\", \"mod_interactivevideo\"))\n                        .tooltip('hide');\n                    $this.find('i').toggleClass('bi-share-fill bi-share');\n                }, 2000);\n            });\n\n            // Display time when user hover on the progress bar.\n            $(document).on('mouseenter', '#video-nav #seek', function(e) {\n                if (!playerReady) {\n                    return;\n                }\n                $(this).append('<div id=\"position\"><div id=\"timelabel\"></div></div>');\n                let $position = $('#position');\n                const parentOffset = $(this).offset();\n                const relX = e.pageX - parentOffset.left;\n\n                $position.css('left', (relX + 3) + 'px');\n                var percentage = relX / $(this).width();\n                var time = Math.round(percentage * end);\n                var formattedTime = convertSecondsToHMS(time);\n                $position.find('#timelabel').text(formattedTime);\n            });\n\n            $(document).on('mousemove', '#video-nav #seek', function(e) {\n                if (!playerReady) {\n                    return;\n                }\n                const parentOffset = $(this).offset();\n                const relX = e.pageX - parentOffset.left;\n                var percentage = relX / $(this).width();\n                var time = Math.round(percentage * end);\n                var formattedTime = convertSecondsToHMS(time);\n                $('#position').css('left', (relX + 3) + 'px');\n                $('#position #timelabel').text(formattedTime);\n            });\n\n            $(document).on('mouseleave', '#video-nav #seek', function() {\n                $('#position').remove();\n            });\n\n            // Handle annotation click event:: when user click on the annotation on the progress bar\n            $(document).on('click', '#video-nav .annotation', async function(e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                if ($(this).hasClass('no-click')) {\n                    // Add a tooltip that seeking is disabled.\n                    Toast.add(M.util.get_string('youcannotviewthisannotationyet', 'mod_interactivevideo'), {\n                        type: 'danger'\n                    });\n                    return;\n                }\n                const timestamp = $(this).data('timestamp');\n                player.play();\n                if (player.type == 'yt') {\n                    clearInterval(interval);\n                }\n                await player.seek(Number(timestamp));\n                replaceProgressBars(((timestamp - start) / totaltime) * 100);\n                const id = $(this).data('id');\n                const theAnnotation = releventAnnotations.find(x => x.id == id);\n                runInteraction(theAnnotation);\n                lastanno = theAnnotation;\n            });\n\n            // Handle seeking event:: when user click on the progress bar\n            $(document).on('click', '#video-nav', async function(e) {\n                if (!playerReady) {\n                    return;\n                }\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                if ($(this).hasClass('no-click')) {\n                    // Add a tooltip that seeking is disabled.\n                    Toast.add(M.util.get_string('seekingdisabled', 'mod_interactivevideo'), {\n                        type: 'danger'\n                    });\n                    return;\n                }\n                lastanno = null;\n                $('#start-screen').fadeOut(300);\n                $('#end-screen').fadeOut(300);\n                const parentOffset = $(this).offset();\n                const relX = e.pageX - parentOffset.left;\n                var percentage = relX / $(this).width();\n                // Gotta check if this affects anything.\n                if (player.type == 'yt') {\n                    clearInterval(interval);\n                }\n                player.pause(); // Especially for vimeo.\n                await player.seek((percentage * totaltime) + start);\n                replaceProgressBars(percentage * 100);\n                player.play();\n\n            });\n\n            // Handle video control events:: play\n            $(document).on('click', '#start-screen #play', async function(e) {\n                e.preventDefault();\n                $('#start-screen').fadeOut(300);\n                $(this).addClass('d-none');\n                $videoNav.removeClass('d-none');\n                await player.seek(start);\n                player.play();\n            });\n\n            // Handle video control events:: restart\n            $(document).on('click', '#end-screen #restart', async function(e) {\n                e.preventDefault();\n                $('#message').remove();\n                lastanno = null;\n                await player.seek(start);\n                $videoNav.find(\"#progress\").css('width', '0%');\n                $videoNav.find(\"#seekhead\").css('left', '0%');\n                $('#end-screen').fadeOut(300);\n                $(this).addClass('d-none');\n                $videoNav.removeClass('d-none');\n                replaceProgressBars(0);\n                player.play();\n            });\n\n            // Handle video control events:: pause/resume when user click on the video\n            $(document).on('click', '#video-wrapper .video-block', async function(e) {\n                if (!playerReady) {\n                    return;\n                }\n                clearInterval(interval);\n                e.preventDefault();\n                // Pause or resume the video.\n                const playing = await player.isPlaying();\n                if (playing) {\n                    player.pause();\n                } else {\n                    player.play();\n                }\n            });\n\n            $(document).on('click', '#playpause', async function(e) {\n                if (!playerReady) {\n                    return;\n                }\n                e.preventDefault();\n                $(this).tooltip('hide');\n                // Pause or resume the video.\n                const playing = await player.isPlaying();\n                if (playing) {\n                    player.pause();\n                } else {\n                    let t = await player.getCurrentTime();\n                    if (t >= end) {\n                        $('#end-screen #restart').trigger('click');\n                    } else {\n                        player.play();\n                    }\n                }\n            });\n\n            $(document).on('click', 'li.anno', async function(e) {\n                e.preventDefault();\n                const id = $(this).data('id');\n                $(`li.annotation[data-id=${id}]`).trigger('click');\n                if ($(this).closest('#chapter-container-left').length > 0) {\n                    $('#chaptertoggle .btn').trigger('click');\n                }\n            });\n\n            // Handle video control events:: mute/unmute\n            $(document).on('click', '#mute', function(e) {\n                e.preventDefault();\n                $(this).tooltip('hide');\n                $(this).toggleClass('active');\n                if ($(this).hasClass('active')) {\n                    player.mute();\n                    $(this).attr('data-original-title', M.util.get_string('unmute', 'mod_interactivevideo'));\n                } else {\n                    player.unMute();\n                    $(this).attr('data-original-title', M.util.get_string('mute', 'mod_interactivevideo'));\n                }\n                $(this).find('i').toggleClass('bi-volume-mute bi-volume-up');\n                $(this).tooltip('show');\n            });\n\n            // Handle video control events:: playrate change\n            $(document).on('click', '.changerate', function(e) {\n                e.preventDefault();\n                const rate = $(this).data('rate');\n                player.setRate(rate);\n                $('.changerate').find('i').removeClass('bi-check');\n                $(this).find('i').addClass('bi-check');\n            });\n\n            // Handle video control:: Quality change\n            $(\"#changequality\").on('shown.bs.dropdown', async function() {\n                let quality = await player.getQualities();\n                $('#qualitieslist').empty();\n                let currentQuality = quality.currentQuality;\n                if (currentQuality === null) {\n                    currentQuality = $(this).data('current');\n                }\n                let qualities = quality.qualities;\n                let qualitiesLabel = quality.qualitiesLabel;\n                qualities.forEach((q, i) => {\n                    $('#qualitieslist').append(`<a class=\"dropdown-item text-white changequality\" data-quality=\"${q}\"\n                         href=\"#\"><i class=\"bi ${q == currentQuality ? 'bi-check' : ''} fa-fw ml-n3\"></i>${qualitiesLabel[i]}</a>`);\n                });\n                $(this).find('[data-toggle=dropdown]').dropdown('update');\n            });\n\n            $(document).on('click', '.changequality', function(e) {\n                e.preventDefault();\n                const quality = $(this).data('quality');\n                player.setQuality(quality);\n                $('.changequality').find('i').removeClass('bi-check');\n                $(this).find('i').addClass('bi-check');\n            });\n\n            $(document).on('interactionrun', function(e) {\n                window.console.log(e);\n            });\n\n            $(document).on('interactionclose', function(e) {\n                window.console.log(e);\n            });\n\n            $(document).on('interactionCompletionUpdated', function(e) {\n                window.console.log(e);\n            });\n\n            $(document).on('iv:playerReady', function() {\n                onReady();\n            });\n\n            $(document).on('iv:playerPaused', function() {\n                onPaused();\n            });\n\n            $(document).on('iv:playerPlaying', function() {\n                onPlaying();\n            });\n\n            $(document).on('iv:playerEnded', function() {\n                onEnded();\n            });\n\n            $(document).on('iv:playerSeek', function(e) {\n                onSeek(e.detail.time);\n            });\n\n            $(document).on('iv:playerError', function() {\n                Toast.add(M.util.get_string('thereisanissueloadingvideo', 'mod_interactivevideo'), {\n                    type: 'danger'\n                });\n                $('#spinner').remove();\n            });\n\n            $(document).on('iv:playerRateChange', function(e) {\n                $('.changerate').find('i').removeClass('bi-check');\n                $(`.changerate[data-rate=\"${e.originalEvent.detail.rate}\"]`).find('i').addClass('bi-check');\n            });\n\n            $(document).on('iv:playerQualityChange', function(e) {\n                window.console.log(e);\n                $('#changequality').attr('data-current', e.originalEvent.detail.quality);\n                $('.changequality').find('i').removeClass('bi-check');\n                $(`.changequality[data-quality=\"${e.originalEvent.detail.quality}\"]`).find('i').addClass('bi-check');\n            });\n        }\n    };\n});"],"names":["define","$","Toast","annotations","totaltime","activityType","lastanno","contentTypes","displayoptions","releventAnnotations","player","dispatchEvent","ctRenderer","$videoNav","renderAnnotationItems","async","annos","start","actualduration","skipsegments","filter","x","type","length","forEach","Number","title","timestamp","completableAnno","hascompletion","actualAnnotationCounts","xp","map","reduce","a","b","completedAnnos","completed","xpEarned","seconds","empty","append","Math","ceil","floor","preventseeking","addClass","hidemainvideocontrols","hideinteractions","render","Promise","resolve","renderItemOnVideoNavigation","chapteritems","sort","each","cstart","this","data","cend","find","id","JSON","parse","prop","icon","formattedtitle","document","on","tooltip","container","boundary","disableinteractionclickuntilcompleted","disableinteractionclick","init","url","cmid","interaction","course","userid","end","completionpercentage","gradeiteminstance","grademax","vtype","preventskip","moment","doptions","token","isNaN","playerReady","convertSecondsToHMS","h","m","s","replaceProgressBars","percentage","replaceWith","css","getAnnotations","callback","annnoitems","ajax","M","cfg","wwwroot","method","dataType","action","sesskey","contextid","courseContextId","userprogress","uid","getContentTypes","when","done","progress","ct","some","y","name","completedItems","completeditems","stringify","indexOf","advanced","rerunnable","replaybehavior","shouldAdd","push","unshift","util","get_string","hide","getRenderers","chapterContentType","includes","remove","removeClass","count","require","amdmodule","Type","error","toggleClass","runInteraction","annotation","modal","not","fadeOut","theAnnotations","theAnnotation","pause","seek","add","shareMoment","urlParams","URLSearchParams","window","location","search","time","play","delete","newurl","protocol","host","pathname","toString","history","replaceState","onReady","support","playbackrate","quality","posterImage","duration","getDuration","min","text","ratio","focus","draggable","event","ui","position","left","width","setTimeout","onPaused","clearInterval","interval","attr","onEnded","t","fadeIn","onSeek","getCurrentTime","onPlaying","hasClass","trigger","intervalFunction","isPlaying","isEnded","round","percentagePlayed","frequency","e","keyCode","preventDefault","setInterval","VideoPlayer","useoriginalvideocontrols","$toast","detach","originalEvent","detail","stopImmediatePropagation","closest","elem","getElementById","exitFullscreen","mozCancelFullScreen","webkitExitFullscreen","msExitFullscreen","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen","fullscreenElement","visibilityState","$this","href","shareurl","navigator","clipboard","writeText","$position","parentOffset","offset","relX","pageX","formattedTime","mute","unMute","rate","setRate","getQualities","currentQuality","qualities","qualitiesLabel","q","i","dropdown","setQuality","console","log"],"mappings":"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"}