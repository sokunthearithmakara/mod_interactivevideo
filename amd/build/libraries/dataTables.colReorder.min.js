!function(factory){if("function"==typeof define&&define.amd)define("mod_interactivevideo/libraries/dataTables.colReorder",["jquery","mod_interactivevideo/libraries/datatables"],(function($){return factory($,window,document)}));else if("object"==typeof exports){var jq=require("jquery"),cjsRequires=function(root,$){$.fn.dataTable||require("mod_interactivevideo/libraries/datatables")(root,$)};"undefined"==typeof window?module.exports=function(root,$){return root||(root=window),$||($=jq(root)),cjsRequires(root,$),factory($,root,root.document)}:(cjsRequires(window,jq),module.exports=factory(jq,window,window.document))}else factory(jQuery,window,document)}((function($,window,document){var DataTable=$.fn.dataTable;function arrayMove(arr,from,count,to){var movers=arr.splice(from,count);movers.unshift(0),movers.unshift(to<from?to:to-count+1),arr.splice.apply(arr,movers)}function finalise(dt){dt.rows().invalidate("data"),dt.column(0).visible(dt.column(0).visible()),dt.columns.adjust();var order=dt.colReorder.order();dt.trigger("columns-reordered",[{order:order,mapping:invertKeyValues(order)}])}function getOrder(dt){return dt.settings()[0].aoColumns.map((function(col){return col._crOriginalIdx}))}function headerUpdate(structure,map,from,to){for(var done=[],i=0;i<structure.length;i++){var headerRow=structure[i];arrayMove(headerRow,from[0],from.length,to);for(var j=0;j<headerRow.length;j++){var cell=headerRow[j].cell;if(!done.includes(cell)){var mapped=cell.getAttribute("data-dt-column").split(",").map((function(idx){return map[idx]})).join(",");cell.setAttribute("data-dt-column",mapped),done.push(cell)}}}}function init(api){api.columns().iterator("column",(function(s,idx){var columns=s.aoColumns;void 0===columns[idx]._crOriginalIdx&&(columns[idx]._crOriginalIdx=idx)}))}function invertKeyValues(arr){for(var result=[],i=0;i<arr.length;i++)result[arr[i]]=i;return result}function move(dt,from,to){var i,j,settings=dt.settings()[0],columns=settings.aoColumns,newOrder=columns.map((function(col,idx){return idx}));if(!from.includes(to)){arrayMove(newOrder,from[0],from.length,to);var reverseIndexes=invertKeyValues(newOrder);for(arrayMove(columns,from[0],from.length,to),i=0;i<settings.aoData.length;i++){var data=settings.aoData[i];if(data){var cells=data.anCells;if(cells)for(arrayMove(cells,from[0],from.length,to),j=0;j<cells.length;j++)data.nTr&&cells[j]&&columns[j].bVisible&&data.nTr.appendChild(cells[j]),cells[j]&&cells[j]._DT_CellIndex&&(cells[j]._DT_CellIndex.column=j)}}for(i=0;i<columns.length;i++){var column=columns[i];for(j=0;j<column.aDataSort.length;j++)column.aDataSort[j]=reverseIndexes[column.aDataSort[j]];column.idx=reverseIndexes[column.idx],column.bVisible&&settings.colgroup.append(column.colEl)}headerUpdate(settings.aoHeader,reverseIndexes,from,to),headerUpdate(settings.aoFooter,reverseIndexes,from,to),arrayMove(settings.aoPreSearchCols,from[0],from.length,to),orderingIndexes(reverseIndexes,settings.aaSorting),Array.isArray(settings.aaSortingFixed)?orderingIndexes(reverseIndexes,settings.aaSortingFixed):(settings.aaSortingFixed.pre||settings.aaSortingFixed.post)&&orderingIndexes(reverseIndexes,settings.aaSortingFixed.pre),settings.aLastSort.forEach((function(el){el.src=reverseIndexes[el.src]})),dt.trigger("column-reorder",[dt.settings()[0],{from:from,to:to,mapping:reverseIndexes}])}}function orderingIndexes(map,order){if(order)for(var i=0;i<order.length;i++){var el=order[i];"number"==typeof el?order[i]=map[el]:$.isPlainObject(el)&&void 0!==el.idx?el.idx=map[el.idx]:Array.isArray(el)&&"number"==typeof el[0]&&(el[0]=map[el[0]])}}function setOrder(dt,order,original){var i,changed=!1;if(order.length===dt.columns().count()){original&&(order=transpose(dt,order,"toCurrent"));var setOrder=invertKeyValues(order);for(i=0;i<setOrder.length;i++){var currentIndex=setOrder.indexOf(i);i!==currentIndex&&(arrayMove(setOrder,currentIndex,1,i),move(dt,[currentIndex],i),changed=!0)}changed&&finalise(dt)}else dt.error("ColReorder - column count mismatch")}function transpose(dt,idx,dir){var order=dt.colReorder.order(),columns=dt.settings()[0].aoColumns;return"toCurrent"===dir||"fromOriginal"===dir?Array.isArray(idx)?idx.map((function(index){return order.indexOf(index)})):order.indexOf(idx):Array.isArray(idx)?idx.map((function(index){return columns[index]._crOriginalIdx})):columns[idx]._crOriginalIdx}function validateMove(table,from,to){var columns=table.columns().count();return!(from[0]<to&&to<from[from.length])&&(!(from[0]<0&&from[from.length-1]>columns)&&(!(to<0&&to>columns)&&(!!from.includes(to)||!!validateStructureMove(table.table().header.structure(),from,to)&&!!validateStructureMove(table.table().footer.structure(),from,to))))}function validateStructureMove(structure,from,to){var i,header=function(structure){for(var filledIn=[],row=0;row<structure.length;row++){filledIn.push([]);for(var col=0;col<structure[row].length;col++){var cell=structure[row][col];if(cell)for(var rowInner=0;rowInner<cell.rowspan;rowInner++){filledIn[row+rowInner]||(filledIn[row+rowInner]=[]);for(var colInner=0;colInner<cell.colspan;colInner++)filledIn[row+rowInner][col+colInner]=cell.cell}}}return filledIn}(structure);for(i=0;i<header.length;i++)arrayMove(header[i],from[0],from.length,to);for(i=0;i<header.length;i++)for(var seen=[],j=0;j<header[i].length;j++){var cell=header[i][j];if(seen.includes(cell)){if(seen[seen.length-1]!==cell)return!1}else seen.push(cell)}return!0}var ColReorder=function(){function ColReorder(dt,opts){this.dom={drag:null},this.c={columns:null,enable:null,order:null},this.s={dropZones:[],mouse:{absLeft:-1,offset:{x:-1,y:-1},start:{x:-1,y:-1},target:null,targets:[]},scrollInterval:null};var that=this;if(!dt.settings()[0]._colReorder){dt.settings()[0]._colReorder=this,this.dt=dt,$.extend(this.c,ColReorder.defaults,opts),init(dt),dt.on("stateSaveParams",(function(e,s,d){d.colReorder=getOrder(dt)})),dt.on("destroy",(function(){dt.off(".colReorder"),dt.colReorder.reset()}));var loaded=dt.state.loaded(),order=this.c.order;loaded&&loaded.colReorder&&(order=loaded.colReorder),order&&dt.ready((function(){setOrder(dt,order,!0)})),dt.table().header.structure().forEach((function(row){for(var i=0;i<row.length;i++)row[i]&&row[i].cell&&that._addListener(row[i].cell)}))}}return ColReorder.prototype.disable=function(){return this.c.enable=!1,this},ColReorder.prototype.enable=function(flag){return void 0===flag&&(flag=!0),!1===flag?this.disable():(this.c.enable=!0,this)},ColReorder.prototype._addListener=function(el){var that=this;$(el).on("selectstart.colReorder",(function(){return!1})).on("mousedown.colReorder touchstart.colReorder",(function(e){"mousedown"===e.type&&1!==e.which||that.c.enable&&that._mouseDown(e,this)}))},ColReorder.prototype._createDragNode=function(){var origCell=this.s.mouse.target,origTr=origCell.parent(),origThead=origTr.parent(),origTable=origThead.parent(),cloneCell=origCell.clone();this.dom.drag=$(origTable[0].cloneNode(!1)).addClass("dtcr-cloned").append($(origThead[0].cloneNode(!1)).append($(origTr[0].cloneNode(!1)).append(cloneCell[0]))).css({position:"absolute",top:0,left:0,width:$(origCell).outerWidth(),height:$(origCell).outerHeight()}).appendTo("body")},ColReorder.prototype._cursorPosition=function(e,prop){return-1!==e.type.indexOf("touch")?e.originalEvent.touches[0][prop]:e[prop]},ColReorder.prototype._mouseDown=function(e,cell){for(var _this=this,target=$(e.target).closest("th, td"),offset=target.offset(),moveableColumns=this.dt.columns(this.c.columns).indexes().toArray(),moveColumnIndexes=$(cell).attr("data-dt-column").split(",").map((function(val){return parseInt(val,10)})),j=0;j<moveColumnIndexes.length;j++)if(!moveableColumns.includes(moveColumnIndexes[j]))return!1;this.s.mouse.start.x=this._cursorPosition(e,"pageX"),this.s.mouse.start.y=this._cursorPosition(e,"pageY"),this.s.mouse.offset.x=this._cursorPosition(e,"pageX")-offset.left,this.s.mouse.offset.y=this._cursorPosition(e,"pageY")-offset.top,this.s.mouse.target=target,this.s.mouse.targets=moveColumnIndexes;for(var i=0;i<moveColumnIndexes.length;i++){var cells=this.dt.cells(null,moveColumnIndexes[i],{page:"current"}).nodes().to$(),klass="dtcr-moving";0===i&&(klass+=" dtcr-moving-first"),i===moveColumnIndexes.length-1&&(klass+=" dtcr-moving-last"),cells.addClass(klass)}this._regions(moveColumnIndexes),this._scrollRegions(),$(document).on("mousemove.colReorder touchmove.colReorder",(function(e){_this._mouseMove(e)})).on("mouseup.colReorder touchend.colReorder",(function(e){_this._mouseUp(e)}))},ColReorder.prototype._mouseMove=function(e){if(null===this.dom.drag){if(Math.pow(Math.pow(this._cursorPosition(e,"pageX")-this.s.mouse.start.x,2)+Math.pow(this._cursorPosition(e,"pageY")-this.s.mouse.start.y,2),.5)<5)return;$(document.body).addClass("dtcr-dragging"),this._createDragNode()}this.dom.drag.css({left:this._cursorPosition(e,"pageX")-this.s.mouse.offset.x,top:this._cursorPosition(e,"pageY")-this.s.mouse.offset.y});var tableOffset=$(this.dt.table().node()).offset().left,cursorMouseLeft=this._cursorPosition(e,"pageX")-tableOffset,dropZone=this.s.dropZones.find((function(zone){return zone.left<=cursorMouseLeft&&cursorMouseLeft<=zone.left+zone.width}));this.s.mouse.absLeft=this._cursorPosition(e,"pageX"),dropZone&&(dropZone.self||this._move(dropZone,cursorMouseLeft))},ColReorder.prototype._mouseUp=function(e){$(document).off(".colReorder"),$(document.body).removeClass("dtcr-dragging"),this.dom.drag&&(this.dom.drag.remove(),this.dom.drag=null),this.s.scrollInterval&&clearInterval(this.s.scrollInterval),this.dt.cells(".dtcr-moving").nodes().to$().removeClass("dtcr-moving dtcr-moving-first dtcr-moving-last")},ColReorder.prototype._move=function(dropZone,cursorMouseLeft){var that=this;this.dt.colReorder.move(this.s.mouse.targets,dropZone.colIdx),this.s.mouse.targets=$(this.s.mouse.target).attr("data-dt-column").split(",").map((function(val){return parseInt(val,10)})),this._regions(this.s.mouse.targets);var visibleTargets=this.s.mouse.targets.filter((function(val){return that.dt.column(val).visible()})),dz=this.s.dropZones.find((function(zone){return zone.colIdx===visibleTargets[0]})),dzIdx=this.s.dropZones.indexOf(dz);if(dz.left>cursorMouseLeft){var previousDiff=dz.left-cursorMouseLeft,previousDz=this.s.dropZones[dzIdx-1];dz.left-=previousDiff,dz.width+=previousDiff,previousDz&&(previousDz.width-=previousDiff)}if((dz=this.s.dropZones.find((function(zone){return zone.colIdx===visibleTargets[visibleTargets.length-1]}))).left+dz.width<cursorMouseLeft){var nextDiff=cursorMouseLeft-(dz.left+dz.width),nextDz=this.s.dropZones[dzIdx+1];dz.width+=nextDiff,nextDz&&(nextDz.left+=nextDiff,nextDz.width-=nextDiff)}},ColReorder.prototype._regions=function(moveColumns){var that=this,dropZones=[],totalWidth=0,negativeCorrect=0,allowedColumns=this.dt.columns(this.c.columns).indexes().toArray(),widths=this.dt.columns().widths();this.dt.columns().every((function(colIdx,tabIdx,i){if(this.visible()){var columnWidth=widths[colIdx];if(allowedColumns.includes(colIdx))validateMove(that.dt,moveColumns,colIdx)?dropZones.push({colIdx:colIdx,left:totalWidth-negativeCorrect,self:moveColumns[0]<=colIdx&&colIdx<=moveColumns[moveColumns.length-1],width:columnWidth+negativeCorrect}):colIdx<moveColumns[0]?dropZones.length&&(dropZones[dropZones.length-1].width+=columnWidth):colIdx>moveColumns[moveColumns.length-1]&&(negativeCorrect+=columnWidth),totalWidth+=columnWidth;else totalWidth+=columnWidth}})),this.s.dropZones=dropZones},ColReorder.prototype._isScrolling=function(){return this.dt.table().body().parentNode!==this.dt.table().header().parentNode},ColReorder.prototype._scrollRegions=function(){if(this._isScrolling()){var that=this,tableLeft=$(this.dt.table().container()).position().left,tableWidth=$(this.dt.table().container()).outerWidth(),scrollContainer=this.dt.table().body().parentElement.parentElement;this.s.scrollInterval=setInterval((function(){var mouseLeft=that.s.mouse.absLeft;mouseLeft<tableLeft+75&&scrollContainer.scrollLeft?scrollContainer.scrollLeft-=5:mouseLeft>tableLeft+tableWidth-75&&scrollContainer.scrollLeft<scrollContainer.scrollWidth&&(scrollContainer.scrollLeft+=5)}),25)}},ColReorder.defaults={columns:"",enable:!0,order:null},ColReorder.version="2.0.4",ColReorder}();return DataTable.Api.register("colReorder.enable()",(function(flag){return this.iterator("table",(function(ctx){ctx._colReorder&&ctx._colReorder.enable(flag)}))})),DataTable.Api.register("colReorder.disable()",(function(){return this.iterator("table",(function(ctx){ctx._colReorder&&ctx._colReorder.disable()}))})),DataTable.Api.register("colReorder.move()",(function(from,to){return init(this),Array.isArray(from)||(from=[from]),validateMove(this,from,to)?this.tables().every((function(){move(this,from,to),finalise(this)})):(this.error("ColReorder - invalid move"),this)})),DataTable.Api.register("colReorder.order()",(function(set,original){return init(this),set?this.tables().every((function(){setOrder(this,set,original)})):this.context.length?getOrder(this):null})),DataTable.Api.register("colReorder.reset()",(function(){return init(this),this.tables().every((function(){setOrder(this,this.columns().every((function(i){return i})).flatten().toArray(),!0)}))})),DataTable.Api.register("colReorder.transpose()",(function(idx,dir){return init(this),dir||(dir="toCurrent"),transpose(this,idx,dir)})),DataTable.ColReorder=ColReorder,$(document).on("stateLoadInit.dt",(function(e,settings,state){if("dt"===e.namespace){var dt=new DataTable.Api(settings);if(state.colReorder)if(dt.ready())setOrder(dt,state.colReorder,!0);else if(orderingIndexes(state.colReorder,state.order),state.columns){for(var i=0;i<state.columns.length;i++)state.columns[i]._cr_sort=state.colReorder[i];state.columns.sort((function(a,b){return a._cr_sort-b._cr_sort}))}}})),$(document).on("preInit.dt",(function(e,settings){if("dt"===e.namespace){var init=settings.oInit.colReorder,defaults=DataTable.defaults.colReorder;if(init||defaults){var opts=$.extend({},defaults,init);if(!1!==init){var dt=new DataTable.Api(settings);new ColReorder(dt,opts)}}}})),DataTable}));

//# sourceMappingURL=dataTables.colReorder.min.js.map