!function(factory){if("function"==typeof define&&define.amd)define("mod_interactivevideo/libraries/dataTables.rowReorder",["jquery","mod_interactivevideo/libraries/datatables"],(function($){return factory($,window,document)}));else if("object"==typeof exports){var jq=require("jquery"),cjsRequires=function(root,$){$.fn.dataTable||require("mod_interactivevideo/libraries/datatables")(root,$)};"undefined"==typeof window?module.exports=function(root,$){return root||(root=window),$||($=jq(root)),cjsRequires(root,$),factory($,root,root.document)}:(cjsRequires(window,jq),module.exports=factory(jq,window,window.document))}else factory(jQuery,window,document)}((function($,window,document){var DataTable=$.fn.dataTable,RowReorder=function(dt,opts){if(!DataTable.versionCheck||!DataTable.versionCheck("1.11"))throw"DataTables RowReorder requires DataTables 1.11 or newer";this.c=$.extend(!0,{},DataTable.defaults.rowReorder,RowReorder.defaults,opts),this.s={bodyTop:null,dt:new DataTable.Api(dt),getDataFn:DataTable.util.get(this.c.dataSrc),middles:null,scroll:{},scrollInterval:null,setDataFn:DataTable.util.set(this.c.dataSrc),start:{top:0,left:0,offsetTop:0,offsetLeft:0,nodes:[],rowIndex:0},windowHeight:0,documentOuterHeight:0,domCloneOuterHeight:0,dropAllowed:!0},this.dom={clone:null,cloneParent:null,dtScroll:$("div.dataTables_scrollBody, div.dt-scroll-body",this.s.dt.table().container())};var settings=this.s.dt.settings()[0],existing=settings.rowreorder;if(existing)return existing;this.dom.dtScroll.length||(this.dom.dtScroll=$(this.s.dt.table().container(),"tbody")),settings.rowreorder=this,this._constructor()};$.extend(RowReorder.prototype,{_constructor:function(){var that=this,dt=this.s.dt,table=$(dt.table().node());"static"===table.css("position")&&table.css("position","relative"),$(dt.table().container()).on("mousedown.rowReorder touchstart.rowReorder",this.c.selector,(function(e){if(that.c.enable){if($(e.target).is(that.c.excludedChildren))return!0;var tr=$(this).closest("tr"),row=dt.row(tr);return row.any()?(that._emitEvent("pre-row-reorder",{node:row.node(),index:row.index()}),that._mouseDown(e,tr),!1):void 0}})),dt.on("destroy.rowReorder",(function(){$(dt.table().container()).off(".rowReorder"),dt.off(".rowReorder")})),this._keyup=this._keyup.bind(this)},_cachePositions:function(){var dt=this.s.dt,headerHeight=$(dt.table().node()).find("thead").outerHeight(),nodes=$.unique(dt.rows({page:"current"}).nodes().toArray()),middles=$.map(nodes,(function(node,i){var top=$(node).position().top-headerHeight;return(top+top+$(node).outerHeight())/2}));this.s.middles=middles,this.s.bodyTop=$(dt.table().body()).offset().top,this.s.windowHeight=$(window).height(),this.s.documentOuterHeight=$(document).outerHeight(),this.s.bodyArea=this._calcBodyArea()},_clone:function(target){var dt=this.s.dt,clone=$(dt.table().node().cloneNode(!1)).addClass("dt-rowReorder-float").append("<tbody/>").append(target.clone(!1)),tableWidth=target.outerWidth(),tableHeight=target.outerHeight(),scrollBody=$($(this.s.dt.table().node()).parent()),scrollWidth=scrollBody.width(),scrollLeft=scrollBody.scrollLeft(),sizes=target.children().map((function(){return $(this).width()}));clone.width(tableWidth).height(tableHeight).find("tr").children().each((function(i){this.style.width=sizes[i]+"px"}));var cloneParent=$("<div>").addClass("dt-rowReorder-float-parent").width(scrollWidth).append(clone).appendTo("body").scrollLeft(scrollLeft);this.dom.clone=clone,this.dom.cloneParent=cloneParent,this.s.domCloneOuterHeight=clone.outerHeight()},_clonePosition:function(e){var left,start=this.s.start,topDiff=this._eventToPage(e,"Y")-start.top,leftDiff=this._eventToPage(e,"X")-start.left,snap=this.c.snapX,top=topDiff+start.offsetTop;left=!0===snap?start.offsetLeft:"number"==typeof snap?start.offsetLeft+snap:leftDiff+start.offsetLeft+this.dom.cloneParent.scrollLeft(),top<0?top=0:top+this.s.domCloneOuterHeight>this.s.documentOuterHeight&&(top=this.s.documentOuterHeight-this.s.domCloneOuterHeight),this.dom.cloneParent.css({top:top,left:left})},_emitEvent:function(name,args){var ret;return this.s.dt.iterator("table",(function(ctx,i){var innerRet=$(ctx.nTable).triggerHandler(name+".dt",args);void 0!==innerRet&&(ret=innerRet)})),ret},_eventToPage:function(e,pos){return-1!==e.type.indexOf("touch")?e.originalEvent.touches[0]["page"+pos]:e["page"+pos]},_mouseDown:function(e,target){var that=this,dt=this.s.dt,start=this.s.start,cancelable=this.c.cancelable,offset=target.offset();start.top=this._eventToPage(e,"Y"),start.left=this._eventToPage(e,"X"),start.offsetTop=offset.top,start.offsetLeft=offset.left,start.nodes=$.unique(dt.rows({page:"current"}).nodes().toArray()),this._cachePositions(),this._clone(target),this._clonePosition(e);var bodyY=this._eventToPage(e,"Y")-this.s.bodyTop;start.rowIndex=this._calcRowIndexByPos(bodyY),this.dom.target=target,target.addClass("dt-rowReorder-moving"),$(document).on("mouseup.rowReorder touchend.rowReorder",(function(e){that._mouseUp(e)})).on("mousemove.rowReorder touchmove.rowReorder",(function(e){that._mouseMove(e)})),$(window).width()===$(document).width()&&$(document.body).addClass("dt-rowReorder-noOverflow");var scrollWrapper=this.dom.dtScroll;this.s.scroll={windowHeight:$(window).height(),windowWidth:$(window).width(),dtTop:scrollWrapper.length?scrollWrapper.offset().top:null,dtLeft:scrollWrapper.length?scrollWrapper.offset().left:null,dtHeight:scrollWrapper.length?scrollWrapper.outerHeight():null,dtWidth:scrollWrapper.length?scrollWrapper.outerWidth():null},cancelable&&$(document).on("keyup",this._keyup)},_mouseMove:function(e){this._clonePosition(e);var start=this.s.start,cancelable=this.c.cancelable;if(cancelable){var bodyArea=this.s.bodyArea,cloneArea=this._calcCloneParentArea();this.s.dropAllowed=this._rectanglesIntersect(bodyArea,cloneArea),this.s.dropAllowed?$(this.dom.cloneParent).removeClass("drop-not-allowed"):$(this.dom.cloneParent).addClass("drop-not-allowed")}for(var bodyY=this._eventToPage(e,"Y")-this.s.bodyTop,middles=this.s.middles,insertPoint=null,i=0,ien=middles.length;i<ien;i++)if(bodyY<middles[i]){insertPoint=i;break}null===insertPoint&&(insertPoint=middles.length),cancelable&&(this.s.dropAllowed||(insertPoint=start.rowIndex>this.s.lastInsert?start.rowIndex+1:start.rowIndex),this.dom.target.toggleClass("dt-rowReorder-moving",this.s.dropAllowed)),this._moveTargetIntoPosition(insertPoint),this._shiftScroll(e)},_mouseUp:function(e){var i,ien,that=this,dt=this.s.dt,dataSrc=this.c.dataSrc;if(this.s.dropAllowed){var startNodes=this.s.start.nodes,endNodes=$.unique(dt.rows({page:"current"}).nodes().toArray()),idDiff={},fullDiff=[],diffNodes=[],getDataFn=this.s.getDataFn,setDataFn=this.s.setDataFn;for(i=0,ien=startNodes.length;i<ien;i++)if(startNodes[i]!==endNodes[i]){var id=dt.row(endNodes[i]).id(),endRowData=dt.row(endNodes[i]).data(),startRowData=dt.row(startNodes[i]).data();id&&(idDiff[id]=getDataFn(startRowData)),fullDiff.push({node:endNodes[i],oldData:getDataFn(endRowData),newData:getDataFn(startRowData),newPosition:i,oldPosition:$.inArray(endNodes[i],startNodes)}),diffNodes.push(endNodes[i])}var eventArgs=[fullDiff,{dataSrc:dataSrc,nodes:diffNodes,values:idDiff,triggerRow:dt.row(this.dom.target),originalEvent:e}];if(!1!==this._emitEvent("row-reorder",eventArgs)){this._cleanupDragging();var update=function(){if(that.c.update){for(i=0,ien=fullDiff.length;i<ien;i++){var rowData=dt.row(fullDiff[i].node).data();setDataFn(rowData,fullDiff[i].newData),dt.columns().every((function(){this.dataSrc()===dataSrc&&dt.cell(fullDiff[i].node,this.index()).invalidate("data")}))}that._emitEvent("row-reordered",eventArgs),dt.draw(!1)}};this.c.editor?(this.c.enable=!1,this.c.editor.edit(diffNodes,!1,$.extend({submit:"changed"},this.c.formOptions)).multiSet(dataSrc,idDiff).one("preSubmitCancelled.rowReorder",(function(){that.c.enable=!0,that.c.editor.off(".rowReorder"),dt.draw(!1)})).one("submitUnsuccessful.rowReorder",(function(){dt.draw(!1)})).one("submitSuccess.rowReorder",(function(){update()})).one("submitComplete",(function(){that.c.enable=!0,that.c.editor.off(".rowReorder")})).submit()):update()}else that._cancel()}else that._cancel()},_moveTargetIntoPosition:function(insertPoint){var dt=this.s.dt;if(null===this.s.lastInsert||this.s.lastInsert!==insertPoint){var nodes=$.unique(dt.rows({page:"current"}).nodes().toArray()),insertPlacement="";insertPoint>this.s.lastInsert?(this.dom.target.insertAfter(nodes[insertPoint-1]),insertPlacement="after"):(this.dom.target.insertBefore(nodes[insertPoint]),insertPlacement="before"),this._cachePositions(),this.s.lastInsert=insertPoint,this._emitEvent("row-reorder-changed",{insertPlacement:insertPlacement,insertPoint:insertPoint,row:dt.row(this.dom.target)})}},_cleanupDragging:function(){var cancelable=this.c.cancelable;this.dom.clone.remove(),this.dom.cloneParent.remove(),this.dom.clone=null,this.dom.cloneParent=null,this.dom.target.removeClass("dt-rowReorder-moving"),$(document).off(".rowReorder"),$(document.body).removeClass("dt-rowReorder-noOverflow"),clearInterval(this.s.scrollInterval),this.s.scrollInterval=null,cancelable&&$(document).off("keyup",this._keyup)},_shiftScroll:function(e){var windowVert,dtVert,that=this,scroll=this.s.scroll,runInterval=!1,windowY=e.pageY-document.body.scrollTop;windowY<$(window).scrollTop()+65?windowVert=-5:windowY>scroll.windowHeight+$(window).scrollTop()-65&&(windowVert=5),null!==scroll.dtTop&&e.pageY<scroll.dtTop+65?dtVert=-5:null!==scroll.dtTop&&e.pageY>scroll.dtTop+scroll.dtHeight-65&&(dtVert=5),windowVert||dtVert?(scroll.windowVert=windowVert,scroll.dtVert=dtVert,runInterval=!0):this.s.scrollInterval&&(clearInterval(this.s.scrollInterval),this.s.scrollInterval=null),!this.s.scrollInterval&&runInterval&&(this.s.scrollInterval=setInterval((function(){if(scroll.windowVert){var top=$(document).scrollTop();if($(document).scrollTop(top+scroll.windowVert),top!==$(document).scrollTop()){var move=parseFloat(that.dom.cloneParent.css("top"));that.dom.cloneParent.css("top",move+scroll.windowVert)}}if(scroll.dtVert){var scroller=that.dom.dtScroll[0];scroll.dtVert&&(scroller.scrollTop+=scroll.dtVert)}}),20))},_calcBodyArea:function(e){var dt=this.s.dt,offset=$(dt.table().body()).offset();return{left:offset.left,top:offset.top,right:offset.left+$(dt.table().body()).width(),bottom:offset.top+$(dt.table().body()).height()}},_calcCloneParentArea:function(e){var offset=$(this.dom.cloneParent).offset();return{left:offset.left,top:offset.top,right:offset.left+$(this.dom.cloneParent).width(),bottom:offset.top+$(this.dom.cloneParent).height()}},_rectanglesIntersect:function(a,b){return!(a.left>=b.right||b.left>=a.right||a.top>=b.bottom||b.top>=a.bottom)},_calcRowIndexByPos:function(bodyY){var dt=this.s.dt,nodes=$.unique(dt.rows({page:"current"}).nodes().toArray()),rowIndex=-1,headerHeight=$(dt.table().node()).find("thead").outerHeight();return $.each(nodes,(function(i,node){var top=$(node).position().top-headerHeight,bottom=top+$(node).outerHeight();bodyY>=top&&bodyY<=bottom&&(rowIndex=i)})),rowIndex},_keyup:function(e){this.c.cancelable&&27===e.which&&(e.preventDefault(),this._cancel())},_cancel:function(){var start=this.s.start,insertPoint=start.rowIndex>this.s.lastInsert?start.rowIndex+1:start.rowIndex;this._moveTargetIntoPosition(insertPoint),this._cleanupDragging(),this._emitEvent("row-reorder-canceled",[this.s.start.rowIndex])}}),RowReorder.defaults={dataSrc:0,editor:null,enable:!0,formOptions:{},selector:"td:first-child",snapX:!1,update:!0,excludedChildren:"a",cancelable:!1};var Api=$.fn.dataTable.Api;return Api.register("rowReorder()",(function(){return this})),Api.register("rowReorder.enable()",(function(toggle){return void 0===toggle&&(toggle=!0),this.iterator("table",(function(ctx){ctx.rowreorder&&(ctx.rowreorder.c.enable=toggle)}))})),Api.register("rowReorder.disable()",(function(){return this.iterator("table",(function(ctx){ctx.rowreorder&&(ctx.rowreorder.c.enable=!1)}))})),RowReorder.version="1.5.0",$.fn.dataTable.RowReorder=RowReorder,$.fn.DataTable.RowReorder=RowReorder,$(document).on("init.dt.dtr",(function(e,settings,json){if("dt"===e.namespace){var init=settings.oInit.rowReorder,defaults=DataTable.defaults.rowReorder;if(init||defaults){var opts=$.extend({},init,defaults);!1!==init&&new RowReorder(settings,opts)}}})),DataTable}));

//# sourceMappingURL=dataTables.rowReorder.min.js.map