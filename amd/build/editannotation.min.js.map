{"version":3,"file":"editannotation.min.js","sources":["../src/editannotation.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Edit interactions module\n *\n * @module     mod_interactivevideo/editannotation\n * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery',\n    'core/toast',\n    'core/notification',\n    'core/event_dispatcher',\n    'mod_interactivevideo/libraries/jquery-ui',\n], function ($, addToast, Notification, { dispatchEvent }) {\n    var ctRenderer = new Object();\n    var player;\n    var totaltime;\n    var currentTime;\n    var playerReady = false;\n    /**\n     * Replace the progress bar on the video navigation.\n     * @param {Number} percentage - Percentage to replace the progress bar.\n     * @returns {void}\n     * */\n    const replaceProgressBars = (percentage) => {\n        percentage = percentage > 100 ? 100 : percentage;\n        $('#video-nav #progress').replaceWith(`<div id=\"progress\"  style=\"width: ${percentage}%;\"></div>`);\n        $('#scrollbar').css('left', percentage + '%');\n    };\n    /**\n     * Render the annotations on the video navigation.\n     * @param {Array} annos - Annotations to render.\n     * @param {Number} start - Start time of the video.\n     * @param {Number} totaltime - Total time of the video.\n     * @returns {void}\n     * */\n    const renderVideoNav = async (annos, start, totaltime) => {\n        if (annos.length == 0) {\n            $(\"#video-nav ul\").empty();\n            return;\n        }\n\n        $(\"#video-nav ul\").empty();\n        $(\"#video-timeline-wrapper .skipsegment\").remove();\n        annos.forEach(async (x) => {\n            var render = ctRenderer[x.type];\n            await render.renderItemOnVideoNavigation(x);\n        });\n\n        player.getCurrentTime().then((time) => {\n            // Replace progress bar.\n            var percentage = (time - start) / totaltime * 100;\n            replaceProgressBars(percentage);\n            return;\n        }).catch(() => {\n            // Do nothing.\n        });\n\n        dispatchEvent('annotationitemsrendered', { 'annotations': annos });\n\n    };\n\n\n    return {\n        init: function (url, coursemodule, interaction, course, start, end, coursecontextid, type = 'yt') {\n            const addNotification = (msg, type = \"info\") => {\n                addToast.add(msg, {\n                    type: type\n                });\n            };\n\n            start = Number(start);\n            if (isNaN(start)) {\n                start = 0;\n            }\n\n            end = Number(end);\n            if (isNaN(end)) {\n                end = null;\n            }\n\n            var annotations = [];\n            var contentTypes;\n\n            const convertSecondsToHMS = (s, dynamic = false) => {\n                var hours = Math.floor(s / 3600);\n                var minutes = Math.floor(s % 3600 / 60);\n                var seconds = Math.floor(s % 3600 % 60);\n                if (dynamic && hours == 0) {\n                    return (minutes < 10 ? '0' + minutes : minutes) + ':' +\n                        (seconds < 10 ? '0' + seconds : seconds);\n                }\n                return (hours < 10 ? '0' + hours : hours) + ':' +\n                    (minutes < 10 ? '0' + minutes : minutes) + ':' +\n                    (seconds < 10 ? '0' + seconds : seconds);\n            };\n\n            var activeid = null; // Current active annotation id. Mainly used when editing to relaunch the interaction afte editing.\n            const renderAnnotationItems = (annotations) => {\n                renderVideoNav(annotations, start, totaltime);\n                $('#annotationwrapper .loader').remove();\n                $('#annotation-list').empty().removeClass(\"d-flex align-items-center justify-content-center\");\n                if (annotations.length == 0) {\n                    $('#annotation-list').html(`${M.util.get_string('clickaddtoaddinteraction', 'mod_interactivevideo')}`)\n                        .addClass(\"d-flex align-items-center justify-content-center\");\n                    return;\n                }\n                annotations.sort(function (a, b) {\n                    return Number(a.timestamp) - Number(b.timestamp);\n                });\n\n                annotations.forEach(function (item) {\n                    var listItem = $('#annotation-template').clone();\n                    ctRenderer[item.type].renderEditItem(annotations, listItem, item);\n                });\n\n                var xp = annotations.filter(x => x.xp).map(x => Number(x.xp)).reduce((a, b) => a + b, 0);\n                $(\"#xp span\").text(xp);\n\n                if (activeid) {\n                    var activeAnno = annotations.find(x => x.id == activeid);\n                    if (activeAnno) {\n                        ctRenderer[activeAnno.type].postEditCallback(activeAnno);\n                    }\n                }\n            };\n\n            const getAnnotations = () => {\n                const getItems = $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'get_items',\n                        sesskey: M.cfg.sesskey,\n                        id: interaction,\n                        contextid: M.cfg.courseContextId,\n                    }\n                });\n\n                const getContentTypes = $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'getallcontenttypes',\n                        sesskey: M.cfg.sesskey,\n                    }\n                });\n\n                $.when(getItems, getContentTypes).done(function (items, contenttypes) {\n                    annotations = JSON.parse(items[0]);\n                    contentTypes = JSON.parse(contenttypes[0]);\n                    // Remove all annotations that are not in the content types.\n                    annotations = annotations.filter(x => contentTypes.find(y => y.name === x.type));\n                    const getRenderers = new Promise((resolve) => {\n                        var count = 0;\n                        contentTypes.forEach(x => {\n                            require(['' + x.amdmodule], function (Type) {\n                                ctRenderer[x.name] = new Type(player, annotations, interaction,\n                                    course, 0, 0, 0, 0, type, 0, totaltime, start, end, x, coursemodule);\n                                count++;\n                                if (count == contentTypes.length) {\n                                    resolve(ctRenderer);\n                                }\n                            });\n                        });\n                    });\n                    annotations.map(x => {\n                        x.prop = JSON.stringify(contentTypes.find(y => y.name === x.type));\n                        return x;\n                    });\n                    getRenderers.then(() => {\n                        renderAnnotationItems(annotations);\n                        return;\n                    }).catch(() => {\n                        // Do nothing.\n                    });\n                });\n            };\n\n            const validateTimestampFormat = (timestamp, fld, existing) => {\n                var regex = /^([0-9]{2}):([0-5][0-9]):([0-5][0-9])$/;\n                if (!regex.test(timestamp)) {\n                    addNotification(M.util.get_string('invalidtimestampformat', 'mod_interactivevideo'), 'danger');\n                    if (existing) {\n                        $(fld).val(existing);\n                    } else {\n                        $(fld).val(convertSecondsToHMS(start));\n                    }\n                    return false;\n                }\n                return true;\n            };\n\n            const validateTimeStartEnd = (timestamp, fld, existing, seconds, checkduration,\n                checkexisting, checkskipsegment) => {\n                // Convert the timestamp to seconds.\n                var parts = timestamp.split(':');\n                timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                // Make sure the timestamp is between start and end.\n                if (checkduration) {\n                    if (timestamp > end || timestamp < start) {\n                        var message = M.util.get_string('timemustbebetweenstartandendtime', 'mod_interactivevideo', {\n                            \"start\": convertSecondsToHMS(start, true),\n                            \"end\": convertSecondsToHMS(end, true)\n                        });\n                        addNotification(message, 'danger');\n                        if (existing) {\n                            $(fld).val(existing);\n                        } else {\n                            $(fld).val(convertSecondsToHMS(start));\n                        }\n                        return -1;\n                    }\n                }\n\n                // Make sure the timestamp is not already in the list.\n                if (checkexisting) {\n                    if (annotations.find(x => x.timestamp == timestamp) && timestamp != seconds) {\n                        addNotification(M.util.get_string('interactionalreadyexists', 'mod_interactivevideo'), 'danger');\n                        if (existing) {\n                            $(fld).val(existing);\n                        } else {\n                            $(fld).val(convertSecondsToHMS(start));\n                        }\n                        return -1;\n                    }\n                }\n\n                // Make sure timestamp is not in a skip segment.\n                if (checkskipsegment) {\n                    var skipsegments = annotations.filter((annotation) => annotation.type == 'skipsegment');\n                    var skip = skipsegments.find(x => Number(x.timestamp) < Number(timestamp)\n                        && Number(x.title) > Number(timestamp));\n                    if (skip) {\n                        addNotification(M.util.get_string('interactionisbetweentheskipsegment', 'mod_interactivevideo', {\n                            \"start\": convertSecondsToHMS(skip.timestamp, true),\n                            \"end\": convertSecondsToHMS(skip.title, true)\n                        }), 'danger');\n                        if (existing) {\n                            $(fld).val(existing);\n                        } else {\n                            $(fld).val(convertSecondsToHMS(start));\n                        }\n                        return -1;\n                    }\n                }\n\n                return timestamp;\n\n            };\n\n            const runInteraction = (annotation) => {\n                // Remove the previous message but keep the one below the video.\n                $('#annotation-modal').modal('hide');\n                $('#message').not('[data-placement=bottom]').remove();\n                $('#end-screen').remove();\n                player.pause();\n                var activityType = ctRenderer[annotation.type];\n                activityType.runInteraction(annotation);\n            };\n\n            const onReady = () => {\n                let duration = player.getDuration();\n                duration.then(t => {\n                    if (!end) {\n                        end = t;\n                    } else {\n                        end = Math.min(end, t);\n                    }\n\n                    if (start > end) {\n                        start = 0;\n                    }\n\n                    totaltime = end - start;\n                    // Recalculate the ratio of the video\n                    player.ratio().then((ratio) => {\n                        $(\"#video-wrapper\").css('padding-bottom', (1 / ratio) * 100 + '%');\n                    });\n                    playerReady = true;\n\n                    // Handle timeline block\n                    $(\"#timeline #video-timeline\").css({\n                        'background-image': 'url(' + player.posterImage + ')',\n                        'background-size': 'contain',\n                        'background-repeat': 'no-repeat',\n                    });\n                    $(\"#timeline #duration\").text(convertSecondsToHMS(end, true));\n                    $(\"#timeline #currenttime\").text(convertSecondsToHMS(start, true));\n                    // Render minute markers\n                    const minutes = Math.floor(totaltime / 60);\n                    $('#timeline-items-wrapper').css('width', (minutes * 300) + 'px');\n                    $('#timeline-items .minute').remove();\n                    for (let i = start; i <= end; i += 60) {\n                        let percentage = (i - start) / totaltime * 100;\n                        let marker = '';\n                        // Format h:m (e.g 3h1m);\n                        if (i >= 3600) {\n                            marker = Math.floor(i / 3600) + 'h' + Math.floor((i % 3600) / 60) + 'm';\n                        } else {\n                            marker = Math.floor(i / 60) + 'm';\n                        }\n                        $('#timeline-items').append(`<div class=\"minute position-absolute\" style=\"left: ${percentage}%\">\n                            <div class=\"minute-label\">${marker}</div></div>`);\n                    }\n                    return getAnnotations();\n                }).catch(() => {\n                    // Do nothing.\n                });\n\n            };\n\n            const onEnded = () => {\n                player.pause();\n                $('#playpause').find('i').removeClass('bi-pause-fill').addClass('bi-play-fill');\n                // Cover the video with a message on a white background div.\n                $('#video-wrapper').append(`<div id=\"end-screen\" class=\"position-absolute w-100 h-100 bg-white d-flex\n                     justify-content-center align-items-center style=\"top: 0; left: 0;\">\n                     <button class=\"btn btn-danger rounded-circle\" style=\"font-size: 1.5rem;\" id=\"restart\">\n                    <i class=\"bi bi-arrow-repeat\" style=\"font-size: x-large;\"></i></button></div>`);\n                $('#video-nav #progress').css('width', '100%');\n                $('#scrollbar').css('left', '100%');\n                // Focus on the restart button;\n                $('#message #restart').focus();\n\n                // If the current time matches the timestamp of an annotation, highlight the annotation\n                var currentAnnotation = annotations.find((annotation) => annotation.timestamp == end);\n                if (currentAnnotation) {\n                    $('#annotation-list tr').removeClass('active');\n                    $(`tr[data-id=\"${currentAnnotation.id}\"]`).addClass('active');\n\n                    // Show tooltip for two seconds\n                    // toggle the tooltip to show the title\n                    $('#video-nav .annotation[data-id=\"' + currentAnnotation.id + '\"] .item').tooltip('show');\n                    // Hide the tooltip after 2 seconds\n                    setTimeout(function () {\n                        $('#video-nav .annotation[data-id=\"' + currentAnnotation.id + '\"] .item').tooltip('hide');\n                    }, 2000);\n                }\n            };\n\n            const onSeek = async (t) => {\n                if (!playerReady) {\n                    return;\n                }\n                if (t) {\n                    t = Number(t);\n                } else {\n                    t = await player.getCurrentTime();\n                }\n                if (t > start && t < end) {\n                    $('#end-screen').remove();\n                }\n                var percentage = (t - start) / (totaltime) * 100;\n                $('#scrollbar').css('left', percentage + '%');\n                return $('#timeline #currenttime').text(convertSecondsToHMS(t, true));\n            };\n\n            var onPlayingInterval;\n            const onPlaying = () => {\n                $('#message, #end-screen').remove();\n                $('#playpause').find('i').removeClass('bi-play-fill').addClass('bi-pause-fill');\n                var intervalFunction = async function () {\n                    var thisTime = await player.getCurrentTime();\n                    var isPlaying = await player.isPlaying();\n                    var isEnded = await player.isEnded();\n                    if (!isPlaying || isEnded) {\n                        clearInterval(onPlayingInterval);\n                        return;\n                    }\n\n                    if (thisTime < start) {\n                        await player.seek(start);\n                        thisTime = start;\n                    }\n\n                    if (thisTime >= end) {\n                        player.stop(end);\n                        clearInterval(onPlayingInterval);\n                        onEnded();\n                        return;\n                    }\n                    $('#timeline #currenttime').text(convertSecondsToHMS(thisTime, true));\n                    var percentage = (thisTime - start) / (totaltime) * 100;\n                    $('#video-nav #progress').css('width', percentage + '%');\n\n                    $(\"#scrollbar\").css('left', percentage + '%');\n\n                    // Scroll the timeline so that the current time is in the middle of the timeline.\n                    const scrollBar = document.getElementById('scrollbar');\n                    // Check if the scrollbar is in view.\n                    const rect = scrollBar.getBoundingClientRect();\n                    if (rect.left < 0 || rect.right > window.innerWidth) {\n                        scrollBar.scrollIntoView({ behavior: \"instant\", block: \"center\", inline: \"center\" });\n                    }\n\n                    // If the current time matches the timestamp of an annotation, highlight the annotation\n                    var currentAnnotation = annotations.find(x => (thisTime - player.frequency) <= x.timestamp\n                        && (thisTime + player.frequency) >= x.timestamp);\n                    if (currentAnnotation) {\n                        $('#annotation-list tr').removeClass('active');\n                        $(`tr[data-id=\"${currentAnnotation.id}\"]`).addClass('active');\n\n                        // Show tooltip for two seconds\n                        // toggle the tooltip to show the title\n                        $('#video-nav .annotation[data-id=\"' + currentAnnotation.id + '\"] .item').tooltip('show');\n                        // Hide the tooltip after 2 seconds\n                        setTimeout(function () {\n                            $('#video-nav .annotation[data-id=\"' + currentAnnotation.id + '\"] .item').tooltip('hide');\n                        }, 2000);\n                    }\n\n                    // If current time is within the skipsegment, seek to the end of the segment\n                    var skipsegments = annotations.filter((annotation) => annotation.type == 'skipsegment');\n                    var skip = skipsegments.find(x => Number(x.timestamp) < Number(thisTime)\n                        && Number(x.title) > Number(thisTime));\n                    if (skip) {\n                        await player.seek(Number(skip.title));\n                        // Replace the progress bar\n                        percentage = (skip.title - start) / totaltime * 100;\n                        replaceProgressBars(percentage);\n                    }\n                };\n                if (player.type == 'yt' || player.type == 'wistia') {\n                    onPlayingInterval = setInterval(intervalFunction, 100);\n                } else {\n                    intervalFunction();\n                }\n            };\n\n            const onPause = () => {\n                clearInterval(onPlayingInterval);\n                $('#playpause').find('i').removeClass('bi-pause-fill').addClass('bi-play-fill');\n            };\n\n            // Implement the player\n            require(['mod_interactivevideo/player/' + type], function (VideoPlayer) {\n                player = new VideoPlayer(\n                    url,\n                    start,\n                    end,\n                    true,\n                    true,\n                );\n            });\n\n            $(document).on('iv:playerReady', function () {\n                onReady();\n            });\n\n            $(document).on('iv:playerPaused', function () {\n                onPause();\n            });\n\n            $(document).on('iv:playerPlaying', function () {\n                onPlaying();\n            });\n\n            $(document).on('iv:playerEnded', function () {\n                onEnded();\n            });\n\n            $(document).on('iv:playerSeek', function (e) {\n                onSeek(e.detail.time);\n            });\n\n            $(document).on('annotationupdated', function (e) {\n                var updated = e.originalEvent.detail.annotation;\n                var action = e.originalEvent.detail.action;\n                if (action == 'edit' || action == 'draft' || action == 'savedraft') {\n                    annotations = annotations.filter(function (item) {\n                        return item.id != updated.id;\n                    });\n                }\n                updated.prop = JSON.stringify(contentTypes.find(x => x.name === updated.type));\n                annotations.push(updated);\n                if (action == 'add') {\n                    activeid = updated.id;\n                } else {\n                    activeid = null;\n                }\n\n                renderAnnotationItems(annotations);\n                if (action == 'add' || action == 'clone') {\n                    addNotification(M.util.get_string('interactionadded', 'mod_interactivevideo'), 'success');\n                    $(`tr[data-id=\"${updated.id}\"]`).addClass('active');\n                    if (action == 'clone') {\n                        setTimeout(function () {\n                            $(`tr[data-id=\"${updated.id}\"]`).find(`[data-editable=\"timestamp\"]`).trigger('contextmenu');\n                        }, 100);\n                    }\n                } else if (action == 'edit') {\n                    addNotification(M.util.get_string('interactionupdated', 'mod_interactivevideo'), 'success');\n                    $(`tr[data-id=\"${updated.id}\"]`).addClass('active');\n                    setTimeout(function () {\n                        $(`tr[data-id=\"${updated.id}\"]`).removeClass('active');\n                    }, 1500);\n                }\n\n                // If draft exists, activate the save button.\n                if (annotations.find(x => x.status == 'draft')) {\n                    $('#timeline #savedraft').removeAttr('disabled');\n                } else {\n                    $('#timeline #savedraft').attr('disabled', 'disabled');\n                }\n            });\n\n            // Implement create annotation\n            $(document).on('click', '#addcontentdropdown a', async function (e) {\n                if (!playerReady) {\n                    return;\n                }\n                e.preventDefault();\n                $('#addcontentdropdown a').removeClass('active');\n                $(this).addClass('active');\n                var contenttype = $(this).data('type');\n                player.pause();\n                var timestamp = currentTime || await player.getCurrentTime();\n                timestamp = Math.floor(timestamp);\n                currentTime = null;\n                ctRenderer[contenttype].addAnnotation(annotations, timestamp, coursemodule);\n            });\n\n            // Implement edit annotation\n            $(document).on('click', 'tr .edit', async function (e) {\n                e.preventDefault();\n                var timestamp = $(this).closest('.annotation').data('timestamp');\n                if (timestamp) {\n                    await player.seek(timestamp, true);\n                }\n                player.pause();\n                var id = $(this).closest('.annotation').data('id');\n                var contenttype = $(this).closest('.annotation').data('type');\n                ctRenderer[contenttype].editAnnotation(annotations, id, coursemodule);\n            });\n\n            // Implement copy annotation\n            $(document).on('click', 'tr .copy', function (e) {\n                e.preventDefault();\n                var id = $(this).closest('.annotation').data('id');\n                var contenttype = $(this).closest('.annotation').data('type');\n                ctRenderer[contenttype].cloneAnnotation(id);\n            });\n\n            $(document).on('annotationdeleted', function (e) {\n                var annotation = e.originalEvent.detail.annotation;\n                activeid = null;\n                $(`tr[data-id=\"${annotation.id}\"]`).addClass('deleted');\n                setTimeout(function () {\n                    annotations = annotations.filter(function (item) {\n                        return item.id != annotation.id;\n                    });\n                    renderAnnotationItems(annotations);\n                    addNotification(M.util.get_string('interactiondeleted', 'mod_interactivevideo'), 'success');\n                }, 1000);\n            });\n\n            // Implement delete annotation.\n            $(document).on('click', '.delete', function (e) {\n                e.preventDefault();\n                player.pause();\n                var id = $(this).closest('.annotation').data('id');\n                var annotation = annotations.find(x => x.id == id);\n                Notification.saveCancel(\n                    M.util.get_string('deleteinteraction', 'mod_interactivevideo'),\n                    M.util.get_string('deleteinteractionconfirm', 'mod_interactivevideo'),\n                    M.util.get_string('delete', 'mod_interactivevideo'),\n                    function () {\n                        ctRenderer[annotation.type].deleteAnnotation(annotations, id);\n                    },\n                    null\n                );\n\n            });\n\n            // Implement view annotation\n            $(document).on('click', '.annotation .title', async function (e) {\n                e.preventDefault();\n                var timestamp = $(this).closest('.annotation').data('timestamp');\n                await player.seek(timestamp, true);\n                // Update the progress bar\n                var percentage = (timestamp - start) / totaltime * 100;\n                replaceProgressBars(percentage);\n\n                var id = $(this).closest('.annotation').data('id');\n\n                var theAnnotation = annotations.find(x => x.id == id);\n\n                runInteraction(theAnnotation);\n            });\n\n            // Implement go to timestamp\n            $(document).on('click', '.timestamp', async function (e) {\n                e.preventDefault();\n                var timestamp = $(this).data('timestamp');\n                await player.seek(timestamp);\n                player.play();\n            });\n\n            $(document).on('contextmenu', '#vseek, #video-timeline', async function (e) {\n                if (!playerReady) {\n                    return;\n                }\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                var percentage = e.offsetX / $(this).width();\n                replaceProgressBars(percentage * 100);\n                currentTime = Math.floor(percentage * totaltime) + start;\n                await player.seek(currentTime);\n                player.pause();\n                $(\"#addcontent\").trigger('click');\n            });\n\n            $(document).on('click', '#playpause', async function (e) {\n                if (!playerReady) {\n                    return;\n                }\n                e.preventDefault();\n                // Pause or resume the video.\n                let isPlaying = await player.isPlaying();\n                if (isPlaying) {\n                    player.pause();\n                } else {\n                    let t = await player.getCurrentTime();\n                    if (t >= end) {\n                        $('#end-screen #restart').trigger('click');\n                    } else {\n                        player.play();\n                    }\n                }\n            });\n\n            $(document).on('contextmenu', '#video-nav .annotation', function (e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                var id = $(this).data('id');\n                // Trigger click on the edit button\n                $(`tr.annotation[data-id=\"${id}\"] .edit`).trigger('click');\n            });\n\n            // Quick edit\n            $(document).on('contextmenu', '[data-editable]', function (e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                if ($('[data-field].editing').length > 0) {\n                    return;\n                }\n                var fld = $(this).data('editable');\n                $(this).hide();\n                $(this).siblings('[data-field=\"' + fld + '\"]').removeClass('d-none').focus().addClass('editing');\n            });\n\n            $(document).on('keyup', '[data-field].editing', function (e) {\n                $(this).removeClass('is-invalid');\n                var initialValue = $(this).data('initial-value');\n                var val = $(this).val();\n                var fld = $(this).data('field');\n                if (val == '') {\n                    $(this).addClass('is-invalid');\n                }\n\n                // If escape key is pressed, revert the value\n                if (e.key == 'Escape') {\n                    $(this).val(initialValue);\n                    $(this).removeClass('editing');\n                    $(this).addClass('d-none');\n                    $(this).siblings('[data-editable]').show();\n                    return;\n                }\n                // If enter key is pressed, save the value\n                if (e.key == 'Enter') {\n                    var seconds;\n                    if (fld == 'timestamp') {\n                        var parts = initialValue.split(':');\n                        seconds = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                        if (!validateTimestampFormat(val, '[data-field].editing', initialValue)) {\n                            $(this).addClass('is-invalid');\n                            return;\n                        }\n                        var timestamp = validateTimeStartEnd(val, '[data-field].editing', initialValue, seconds,\n                            true, true, true);\n                        if (timestamp == -1) {\n                            window.console.log('wtf');\n                            $(this).addClass('is-invalid');\n                            return;\n                        }\n                        seconds = timestamp;\n                    }\n\n                    if ($(this).hasClass('is-invalid')) {\n                        return;\n                    }\n                    if (val == initialValue) {\n                        $(this).removeClass('editing');\n                        $(this).addClass('d-none');\n                        $(this).siblings('[data-editable]').show();\n                        return;\n                    }\n                    var id = $(this).data('id');\n                    $.ajax({\n                        url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                        method: \"POST\",\n                        dataType: \"text\",\n                        data: {\n                            action: 'quickeditfield',\n                            sesskey: M.cfg.sesskey,\n                            id: id,\n                            field: fld,\n                            contextid: M.cfg.contextid,\n                            value: fld == 'timestamp' ? seconds : val,\n                        },\n                        success: function (data) {\n                            var updated = JSON.parse(data);\n                            dispatchEvent('annotationupdated', {\n                                annotation: updated,\n                                action: 'edit'\n                            });\n                        }\n                    });\n                    return;\n                }\n            });\n\n            $(document).on('blur', '[data-field].editing', function () {\n                var initialValue = $(this).data('initial-value');\n                $(this).val(initialValue);\n                $(this).removeClass('editing');\n                $(this).addClass('d-none');\n                $(this).siblings('[data-editable]').show();\n            });\n            // End quick edit\n\n            $(document).on('click', '#end-screen #restart', async function (e) {\n                e.preventDefault();\n                $('#end-screen').remove();\n                await player.seek(start);\n                player.play();\n            });\n\n            $(document).on('mouseover', 'tr.annotation', function () {\n                var id = $(this).data('id');\n                $(`#video-nav ul li[data-id=\"${id}\"] .item`).trigger('mouseover');\n            });\n\n            $(document).on('mouseout', 'tr.annotation', function () {\n                var id = $(this).data('id');\n                $(`#video-nav ul li[data-id=\"${id}\"] .item`).trigger('mouseout');\n                $('.tooltip').remove();\n            });\n\n            $(document).on('mouseover', '#video-nav ul li', function () {\n                var id = $(this).data('id');\n                $(`tr.annotation[data-id=\"${id}\"]`).addClass('active');\n            });\n\n            $(document).on('mouseout', '#video-nav ul li', function () {\n                var id = $(this).data('id');\n                $(`tr.annotation[data-id=\"${id}\"]`).removeClass('active');\n            });\n\n            $(document).on('change', '.timestamp-input', function () {\n                $(this).removeClass('is-invalid');\n                var parts = $(this).val().split(':');\n                var seconds = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                if (!validateTimestampFormat($(this).val(), this)) {\n                    $(this).addClass('is-invalid');\n                    return;\n                }\n\n                var timestamp = validateTimeStartEnd($(this).val(), this, \"00:00:00\", seconds, true, false, true);\n\n                if (timestamp == -1) {\n                    $(this).addClass('is-invalid');\n                    return;\n                }\n            });\n\n            $('#contentmodal').on('show.bs.modal', function () {\n                player.pause();\n                $('#addcontentdropdown').addClass('modal-body');\n            });\n\n            $('#contentmodal').on('hide.bs.modal', function () {\n                $('#addcontentdropdown a').removeClass('active');\n                $('#addcontentdropdown').removeClass('modal-body');\n            });\n\n            $(document).on('click', '#fullscreen', function (e) {\n                e.preventDefault();\n                if ($(this).hasClass('fullscreen')) {\n                    $('#distractfreemodal').modal('hide');\n\n                } else {\n                    let modal = `<div class=\"modal fade p-0\" id=\"distractfreemodal\"\n                     role=\"dialog\" aria-hidden=\"true\" data-backdrop=\"static\"\n                    data-keyboard=\"false\">\n                    <div class=\"modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable\" role=\"document\">\n                        <div class=\"modal-content rounded-0 p-3\">\n                            <div class=\"modal-body px-1 px-sm-3\" id=\"distractionfreebody\">\n                <div class=\"d-flex w-100 align-items-center justify-content-center mt-5\"><div class=\"spinner-grow text-secondary\"\n                    style=\"width: 3rem; height: 3rem;\" role=\"status\">\n                <span class=\"sr-only\">Loading...</span>\n                </div></div>\n                            </div>\n                        </div>\n                    </div>\n                </div>`;\n                    $('body').append(modal);\n                    $('#distractfreemodal').modal('show');\n                }\n\n                $(this).toggleClass('fullscreen');\n\n                $('#distractfreemodal').on('shown.bs.modal', function () {\n                    $('body').addClass('distractionfreemode');\n                    let $wrapper = $('#wrapper').clone();\n                    $('#distractfreemodal').find('#distractionfreebody').html($wrapper);\n                    // Remove original wrapper\n                    $('#wrapper').remove();\n                });\n                $('#distractfreemodal').on('hidden.bs.modal', function () {\n                    $('body').removeClass('distractionfreemode');\n                    let $wrapper = $('#distractfreemodal #wrapper').clone();\n                    $('[role=\"main\"]').append($wrapper);\n                    $('#distractfreemodal').remove();\n                });\n            });\n\n            const appendTimestamp = (seconds) => {\n                var formattedTime = convertSecondsToHMS(seconds, true);\n                $('#scrollbar').append(`<div id=\"position\" class=\"position-absolute bg-black text-white small rounded-sm p-1\"\n                     style=\"top: -30px;\">${formattedTime}</div>`);\n            };\n\n            $(document).on('annotationitemsrendered', function () {\n                let secondLength = $('#timeline-items').width() / totaltime;\n                $('#timeline [data-toggle=\"tooltip\"]').tooltip({\n                    'boundary': 'window',\n                    'container': '#timeline',\n                });\n                // Put the minute markers on the timeline;\n                let targetAnnotation = null;\n                // Tested\n                $('#timeline-items .annotation.li-draggable').draggable({\n                    // 'containment': '#timeline',\n                    'axis': 'x',\n                    'grid': [secondLength, 0],\n                    'start': function () {\n                        appendTimestamp($(this).data('timestamp'));\n                        $('.tooltip, #message').remove();\n                        $('#timeline-items').addClass('no-pointer-events');\n                    },\n                    'drag': async function (event, ui) {\n                        $('.tooltip').remove();\n                        let timestamp = ((ui.position.left + 5) / $('#timeline-items').width()) * totaltime + start;\n                        if (timestamp < start) {\n                            timestamp = start;\n                            $(this).css('left', 0);\n                        }\n                        if (timestamp > end) {\n                            timestamp = end;\n                            $(this).css('left', '100%');\n                        }\n                        $('#scrollbar').css('left', timestamp / end * 100 + '%');\n                        await player.seek(Math.round(timestamp));\n                        player.pause();\n                        $('#scrollbar #position').text(convertSecondsToHMS(Math.round(timestamp), true));\n                    },\n                    'stop': async function (event, ui) {\n                        $('.tooltip').remove();\n                        $('#scrollbar #position').remove();\n                        setTimeout(function () {\n                            $('#timeline-items').removeClass('no-pointer-events');\n                        }, 200);\n                        let timestamp = ((ui.position.left + 5) / $('#timeline-items').width()) * totaltime + start;\n                        if (timestamp < start) {\n                            timestamp = start;\n                            $(this).css('left', '-5px');\n                        }\n                        if (timestamp > end) {\n                            timestamp = end;\n                            $(this).css('left', 'calc(100% - 5px)');\n                        }\n                        $('#scrollbar').css('left', timestamp / end * 100 + '%');\n                        const id = $(this).data('id');\n                        targetAnnotation = annotations.find(x => x.id == id);\n                        const existingAnnotation = annotations.find(x => x.timestamp == Math.round(timestamp) && x.id != id);\n                        if (existingAnnotation) {\n                            addNotification(M.util.get_string('interactionalreadyexists', 'mod_interactivevideo'), 'danger');\n                            renderAnnotationItems(annotations);\n                            return;\n                        }\n                        if (targetAnnotation.timestamp == Math.round(timestamp)) {\n                            return;\n                        }\n                        targetAnnotation.timestamp = Math.round(timestamp);\n                        targetAnnotation.status = \"draft\";\n                        dispatchEvent('annotationupdated', {\n                            annotation: targetAnnotation,\n                            action: 'draft'\n                        });\n                        await player.seek(Math.round(timestamp)); // Seek to the new position\n                        player.pause();\n                        $('#scrollbar').css('left', timestamp / end * 100 + '%');\n                    }\n                });\n\n                $('#video-timeline-wrapper .skipsegment').draggable({\n                    'axis': 'x',\n                    'grid': [secondLength, 0],\n                    'start': function () {\n                        $('#message').remove();\n                        appendTimestamp($(this).data('timestamp'));\n                        $('#timeline-items').addClass('no-pointer-events');\n                    },\n                    'drag': async function (event, ui) {\n                        const id = $(this).data('id');\n                        targetAnnotation = annotations.find(x => x.id == id);\n                        let timestamp = ((ui.position.left) / $('#video-timeline').width()) * totaltime + start;\n                        if (timestamp < start) {\n                            timestamp = start;\n                        }\n\n                        if (timestamp > end) {\n                            timestamp = end;\n                        }\n\n                        $('#scrollbar').css('left', timestamp / end * 100 + '%');\n                        await player.seek(Math.round(timestamp));\n                        player.pause();\n                        $('#scrollbar #position').text(convertSecondsToHMS(Math.round(timestamp), true));\n                    },\n                    'stop': async function (event, ui) {\n                        $('#scrollbar #position').remove();\n                        setTimeout(function () {\n                            $('#video-timeline').removeClass('no-pointer-events');\n                        }, 200);\n                        let timestamp = ((ui.position.left) / $('#video-timeline').width()) * totaltime + start;\n                        const id = $(this).data('id');\n                        targetAnnotation = annotations.find(x => x.id == id);\n                        let skipduration = Number(targetAnnotation.title) - Number(targetAnnotation.timestamp);\n                        if (timestamp < 0 && timestamp + skipduration < start) {\n                            renderAnnotationItems(annotations);\n                            return;\n                        }\n                        if (timestamp > end) {\n                            renderAnnotationItems(annotations);\n                            return;\n                        }\n                        if (timestamp < start) {\n                            skipduration = skipduration - Math.abs(start - timestamp);\n                            timestamp = start;\n                        }\n                        if (timestamp + skipduration > end) {\n                            skipduration = Math.abs(end - timestamp);\n                            timestamp = end - skipduration;\n                        }\n                        if (skipduration <= 0) {\n                            renderAnnotationItems(annotations);\n                            return;\n                        }\n                        const existingAnnotation = annotations.find(x => x.timestamp == Math.round(timestamp) && x.id != id);\n                        if (existingAnnotation) {\n                            addNotification(M.util.get_string('interactionalreadyexists', 'mod_interactivevideo'), 'danger');\n                            renderAnnotationItems(annotations);\n                            return;\n                        }\n                        if (targetAnnotation.timestamp == Math.round(timestamp)) {\n                            renderAnnotationItems(annotations);\n                            return;\n                        }\n                        targetAnnotation.timestamp = Math.round(timestamp);\n                        targetAnnotation.title = Math.round(timestamp) + skipduration;\n                        targetAnnotation.status = \"draft\";\n                        dispatchEvent('annotationupdated', {\n                            annotation: targetAnnotation,\n                            action: 'draft'\n                        });\n                        await player.seek(Math.round(timestamp)); // Seek to the new position\n                        player.pause();\n                        $('#scrollbar').css('left', timestamp / end * 100 + '%');\n                    }\n                });\n\n                $('#video-timeline-wrapper .skipsegment').resizable({\n                    'containment': '#video-timeline-wrapper',\n                    'handles': 'e, w',\n                    'grid': [secondLength, 0],\n                    'start': function () {\n                        $('#message').remove();\n                        appendTimestamp($(this).data('timestamp'));\n                        $('#timeline-items').addClass('no-pointer-events');\n                    },\n                    'resize': async function (event, ui) {\n                        let timestamp;\n                        if (ui.originalPosition.left != ui.position.left || ui.originalSize.width == ui.size.width) {\n                            if (ui.position.left < 0) {\n                                ui.position.left = 0;\n                            }\n                            timestamp = ((ui.position.left) / $('#video-timeline').width()) * totaltime + start;\n                        } else {\n                            timestamp = ((ui.position.left + ui.size.width) / $('#video-timeline').width()) * totaltime + start;\n                        }\n                        $('#scrollbar').css('left', timestamp / end * 100 + '%');\n                        await player.seek(Math.round(timestamp));\n                        player.pause();\n                        $('#scrollbar #position').text(convertSecondsToHMS(Math.round(timestamp), true));\n                    },\n                    'stop': async function (event, ui) {\n                        $('#scrollbar #position').remove();\n                        setTimeout(function () {\n                            $('#timeline-items').removeClass('no-pointer-events');\n                        }, 200);\n                        const id = $(this).data('id');\n                        targetAnnotation = annotations.find(x => x.id == id);\n                        let timestamp, direction;\n                        if (ui.originalPosition.left != ui.position.left) {\n                            if (ui.position.left < 0) {\n                                ui.position.left = 0;\n                            }\n                            timestamp = ((ui.position.left) / $('#video-timeline').width()) * totaltime + start;\n                            direction = \"left\";\n                        } else {\n                            timestamp = ((ui.position.left + ui.size.width) / $('#video-timeline').width()) * totaltime + start;\n                            direction = \"right\";\n                        }\n                        const existingAnnotation = annotations.find(x => x.timestamp == Math.round(timestamp) && x.id != id);\n                        if (existingAnnotation) {\n                            addNotification(M.util.get_string('interactionalreadyexists', 'mod_interactivevideo'), 'danger');\n                            renderAnnotationItems(annotations);\n                            return;\n                        }\n                        if (targetAnnotation.timestamp == Math.round(timestamp)) {\n                            return;\n                        }\n                        if (direction == \"left\") {\n                            targetAnnotation.timestamp = Math.round(timestamp);\n                        } else {\n                            targetAnnotation.title = Math.round(timestamp);\n                        }\n                        targetAnnotation.status = 'draft';\n                        dispatchEvent('annotationupdated', {\n                            annotation: targetAnnotation,\n                            action: 'draft'\n                        });\n                        await player.seek(Math.round(timestamp));\n                        player.pause();\n                        $('#scrollbar').css('left', timestamp / end * 100 + '%');\n                    }\n                });\n\n                $('#video-timeline-wrapper .skipsegment').on('click', async function (e) {\n                    e.preventDefault();\n                    const timestamp = $(this).data('timestamp');\n                    await player.seek(timestamp);\n                    player.pause();\n                });\n\n                $('#video-timeline-wrapper .skipsegment .delete-skipsegment').on('click', function (e) {\n                    e.preventDefault();\n                    const id = $(this).closest('.skipsegment').data('id');\n                    $(`tr.annotation[data-id=\"${id}\"] .delete`).trigger('click');\n                });\n            });\n\n            // Tested\n            $('#scrollbar').draggable({\n                'containment': '#timeline-items',\n                'axis': 'x',\n                'handle': '#scrollhead, #scrollline',\n                'cursor': 'col-resize',\n                'start': function (event, ui) {\n                    $('#timeline-items').addClass('no-pointer-events');\n                    $(\"#message\").remove();\n                    appendTimestamp(Math.round(((ui.position.left) / $('#timeline-items').width()) * totaltime + start));\n                },\n                'drag': async function (event, ui) {\n                    let timestamp = ((ui.position.left) / $('#timeline-items').width()) * totaltime + start;\n                    await player.seek(Math.round(timestamp));\n                    player.pause();\n                    $('#scrollbar #position').text(convertSecondsToHMS(Math.round(timestamp), true));\n                },\n                'stop': function (event, ui) {\n                    $('#scrollbar #position').remove();\n                    setTimeout(function () {\n                        $('#timeline-items').removeClass('no-pointer-events');\n                    }, 200);\n                    // Convert the position to percentage\n                    let timestamp = ((ui.position.left) / $('#timeline-items').width()) * totaltime + start;\n                    $('#scrollbar').css('left', timestamp / end * 100 + '%');\n                }\n            });\n\n            // Seek bar functionalities\n            $('#vseek, #video-timeline, #video-nav .annotation').on('mouseenter', function (e) {\n                $('#cursorbar').remove();\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                // First clone the #scrollbar and place it where the cursor is.\n                var $scrollbar = $('#scrollbar').clone();\n                $scrollbar.attr('id', 'cursorbar');\n\n                const parentOffset = $(this).offset();\n                const relX = e.pageX - parentOffset.left;\n\n                $scrollbar.css('left', (relX + 3) + 'px');\n                $scrollbar.find('#scrollhead').remove();\n                var percentage = relX / $(this).width();\n                var time = Math.round(percentage * (totaltime) + start);\n                var formattedTime = convertSecondsToHMS(time, true);\n                $scrollbar.append(`<div id=\"position\" class=\"position-absolute bg-dark text-white small rounded-sm p-1\"\n                     style=\"top: -30px;\">${formattedTime}</div>`);\n                $('#timeline-items').append($scrollbar);\n            });\n\n            $('#vseek, #video-timeline, #video-nav .annotation').on('mouseleave', function (e) {\n                e.stopImmediatePropagation();\n                $('#cursorbar').remove();\n            });\n\n            $('#vseek, #video-timeline').on('mousemove', function (e) {\n                e.stopImmediatePropagation();\n                const parentOffset = $(this).offset();\n                const relX = e.pageX - parentOffset.left;\n                var percentage = relX / $(this).width();\n                var time = Math.round(percentage * (totaltime) + start);\n                var formattedTime = convertSecondsToHMS(time, true);\n                // Move the cursorbar\n                $('#cursorbar').css('left', (relX + 3) + 'px');\n                $('#cursorbar #position').text(formattedTime);\n            });\n\n            $(document).on('click', '#video-nav .annotation', async function (e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                var id = $(this).data('id');\n                var annotation = annotations.find(x => x.id == id);\n                await player.seek(annotation.timestamp);\n                runInteraction(annotation);\n            });\n\n            $(document).on('click', '#vseek, #video-timeline', async function (e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                var percentage = e.offsetX / $(this).width();\n                replaceProgressBars(percentage * 100);\n                await player.seek(Math.round((percentage * totaltime) + start));\n                player.pause();\n                $(\"#message, #end-screen\").remove();\n            });\n\n            $('#zoomout').on('click', function () {\n                let currentLevel = $('#timeline-items-wrapper').css('width'); // In px.\n                let newLevel = parseInt(currentLevel) - 300;\n                $('#timeline-items-wrapper').css('width', newLevel + 'px');\n                let timelineElement = document.getElementById('timeline');\n                if (timelineElement.scrollWidth <= timelineElement.clientWidth) {\n                    $(this).attr('disabled', 'disabled');\n                }\n                dispatchEvent('annotationitemsrendered', { 'annotations': annotations });\n            });\n\n            $(\"#timeline\").on('wheel', function (e) {\n                e.preventDefault();\n                if (e.originalEvent.deltaY < 0) {\n                    $('#zoomin').trigger('click');\n                } else {\n                    $('#zoomout').trigger('click');\n                }\n            });\n\n            $('#zoomin').on('click', function () {\n                let currentLevel = $('#timeline-items-wrapper').css('width'); // In px.\n                let newLevel = parseInt(currentLevel) + 300;\n                $('#timeline-items-wrapper').css('width', newLevel + 'px');\n                $('#zoomout').removeAttr('disabled');\n                dispatchEvent('annotationitemsrendered', { 'annotations': annotations });\n            });\n\n            $('#savedraft').on('click', function (e) {\n                e.stopImmediatePropagation();\n                let draftAnnotations = annotations.filter(x => x.status == 'draft');\n                let count = 0;\n                draftAnnotations.forEach(function (a) {\n                    $.ajax({\n                        url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                        method: \"POST\",\n                        dataType: \"text\",\n                        data: {\n                            action: 'quickeditfield',\n                            sesskey: M.cfg.sesskey,\n                            id: a.id,\n                            field: 'timestamp',\n                            contextid: M.cfg.contextid,\n                            value: a.timestamp,\n                        },\n                        success: function (data) {\n                            var updated = JSON.parse(data);\n                            dispatchEvent('annotationupdated', {\n                                annotation: updated,\n                                action: 'savedraft'\n                            });\n                        }\n                    });\n                    if (a.type == 'skipsegment') {\n                        $.ajax({\n                            url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                            method: \"POST\",\n                            dataType: \"text\",\n                            data: {\n                                action: 'quickeditfield',\n                                sesskey: M.cfg.sesskey,\n                                id: a.id,\n                                field: 'title',\n                                contextid: M.cfg.contextid,\n                                value: a.title,\n                            },\n                            success: function (data) {\n                                var updated = JSON.parse(data);\n                                dispatchEvent('annotationupdated', {\n                                    annotation: updated,\n                                    action: 'savedraft'\n                                });\n                            }\n                        });\n                    }\n                    count++;\n                    if (count == draftAnnotations.length) {\n                        addNotification(M.util.get_string('draftsaved', 'mod_interactivevideo'), 'success');\n                    }\n                });\n\n            });\n\n            $('#addcontent').on('click', async function (e) {\n                e.preventDefault();\n                if (!playerReady) {\n                    return;\n                }\n                const currentTime = await player.getCurrentTime();\n                if (annotations.find(x => x.timestamp == currentTime)) {\n                    addNotification(M.util.get_string('interactionalreadyexists', 'mod_interactivevideo'), 'danger');\n                    return;\n                }\n                // Check skip segments\n                const skipsegments = annotations.filter(x => x.type == 'skipsegment');\n                const skip = skipsegments.find(x => Number(x.timestamp) < Number(currentTime)\n                    && Number(x.title) > Number(currentTime));\n                if (skip) {\n                    addNotification(M.util.get_string('interactionisbetweentheskipsegment', 'mod_interactivevideo'), 'danger');\n                    return;\n                }\n                $('#contentmodal').modal('show');\n            });\n\n            $('#player-region').resizable({\n                'containment': 'parent',\n                'handles': 'e',\n                'grid': [10, 10],\n            });\n\n            $('#interaction-region').resizable({\n                'containment': 'parent',\n                'handles': 'e',\n                'grid': [10, 10],\n            });\n\n            window.addEventListener('beforeunload', (e) => {\n                if (annotations.find(x => x.status == 'draft')) {\n                    const confirmationMessage = M.util.get_string('unsavedchanges', 'mod_interactivevideo');\n                    e.returnValue = confirmationMessage;\n                    return confirmationMessage;\n                }\n            });\n\n        }\n    };\n});"],"names":["define","$","addToast","Notification","dispatchEvent","player","totaltime","currentTime","ctRenderer","Object","playerReady","replaceProgressBars","percentage","replaceWith","css","renderVideoNav","async","annos","start","length","empty","remove","forEach","render","x","type","renderItemOnVideoNavigation","getCurrentTime","then","time","catch","init","url","coursemodule","interaction","course","end","coursecontextid","addNotification","msg","add","Number","isNaN","contentTypes","annotations","convertSecondsToHMS","s","dynamic","hours","Math","floor","minutes","seconds","activeid","renderAnnotationItems","removeClass","sort","a","b","timestamp","item","listItem","clone","renderEditItem","xp","filter","map","reduce","text","activeAnno","find","id","postEditCallback","html","M","util","get_string","addClass","getAnnotations","getItems","ajax","cfg","wwwroot","method","dataType","data","action","sesskey","contextid","courseContextId","getContentTypes","when","done","items","contenttypes","JSON","parse","y","name","getRenderers","Promise","resolve","count","require","amdmodule","Type","prop","stringify","validateTimestampFormat","fld","existing","test","val","validateTimeStartEnd","checkduration","checkexisting","checkskipsegment","parts","split","message","skip","annotation","title","runInteraction","modal","not","pause","onReady","getDuration","t","min","ratio","posterImage","i","marker","append","onEnded","focus","currentAnnotation","tooltip","setTimeout","onSeek","onPlayingInterval","onPlaying","intervalFunction","thisTime","isPlaying","isEnded","clearInterval","seek","stop","scrollBar","document","getElementById","rect","getBoundingClientRect","left","right","window","innerWidth","scrollIntoView","behavior","block","inline","frequency","setInterval","onPause","VideoPlayer","on","e","detail","updated","originalEvent","push","trigger","status","removeAttr","attr","preventDefault","this","contenttype","addAnnotation","closest","editAnnotation","cloneAnnotation","saveCancel","deleteAnnotation","theAnnotation","play","stopImmediatePropagation","offsetX","width","hide","siblings","initialValue","key","show","console","log","hasClass","field","value","success","toggleClass","$wrapper","appendTimestamp","formattedTime","secondLength","targetAnnotation","draggable","event","ui","position","round","skipduration","abs","resizable","originalPosition","originalSize","size","direction","$scrollbar","parentOffset","offset","relX","pageX","currentLevel","newLevel","parseInt","timelineElement","scrollWidth","clientWidth","deltaY","draftAnnotations","addEventListener","confirmationMessage","returnValue"],"mappings":"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"}