{"version":3,"file":"editannotation.min.js","sources":["../src/editannotation.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Edit interactions module\n *\n * @module     mod_interactivevideo/editannotation\n * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery',\n    'core/toast',\n    'core/notification',\n    'core/event_dispatcher',\n], function ($, addToast, Notification, { dispatchEvent }) {\n    var ctRenderer = new Object();\n    var player;\n    var totaltime;\n    var currentTime;\n    var playerReady = false;\n    /**\n     * Replace the progress bar on the video navigation.\n     * @param {Number} percentage - Percentage to replace the progress bar.\n     * @returns {void}\n     * */\n    const replaceProgressBars = (percentage) => {\n        percentage = percentage > 100 ? 100 : percentage;\n        $('#video-nav #progress').replaceWith(`<div id=\"progress\"  style=\"width: ${percentage}%;\"></div>`);\n    };\n    /**\n     * Render the annotations on the video navigation.\n     * @param {Array} annos - Annotations to render.\n     * @param {Number} start - Start time of the video.\n     * @param {Number} totaltime - Total time of the video.\n     * @returns {void}\n     * */\n    const renderVideoNav = async (annos, start, totaltime) => {\n        if (annos.length == 0) {\n            $(\"#taskinfo #completion-info\").text('0/0');\n            $(\"#video-nav ul\").empty();\n            return;\n        }\n\n        $(\"#video-nav ul\").empty();\n        annos.forEach(async (x) => {\n            var render = ctRenderer[x.type];\n            await render.renderItemOnVideoNavigation(x);\n        });\n\n        player.getCurrentTime().then((time) => {\n            // Replace progress bar.\n            var percentage = (time - start) / totaltime * 100;\n            replaceProgressBars(percentage);\n            return;\n        }).catch(() => {\n            // Do nothing.\n        });\n\n        dispatchEvent('annotationitemsrendered', { 'annotations': annos });\n\n    };\n\n    $(document).on('annotationitemsrendered', function () {\n        $('#wrapper [data-toggle=\"tooltip\"]').tooltip();\n    });\n\n    return {\n        init: function (url, coursemodule, interaction, course, start, end, coursecontextid, type = 'yt') {\n            const addNotification = (msg, type = \"info\") => {\n                addToast.add(msg, {\n                    type: type\n                });\n            };\n\n            start = Number(start);\n            if (isNaN(start)) {\n                start = 0;\n            }\n\n            end = Number(end);\n            if (isNaN(end)) {\n                end = null;\n            }\n\n            var annotations = [];\n            var contentTypes;\n\n            const convertSecondsToHMS = (s) => {\n                var hours = Math.floor(s / 3600);\n                var minutes = Math.floor(s % 3600 / 60);\n                var seconds = Math.floor(s % 3600 % 60);\n                return (hours < 10 ? '0' + hours : hours) + ':' +\n                    (minutes < 10 ? '0' + minutes : minutes) + ':' +\n                    (seconds < 10 ? '0' + seconds : seconds);\n            };\n\n            var activeid = null; // Current active annotation id. Mainly used when editing to relaunch the interaction afte editing.\n            const renderAnnotationItems = (annotations) => {\n                renderVideoNav(annotations, start, totaltime);\n                $('#annotationwrapper .loader').remove();\n                $('#annotation-list').empty().removeClass(\"d-flex align-items-center justify-content-center\");\n                if (annotations.length == 0) {\n                    $('#annotation-list').html(`${M.util.get_string('clickaddtoaddinteraction', 'mod_interactivevideo')}`)\n                        .addClass(\"d-flex align-items-center justify-content-center\");\n                    return;\n                }\n                annotations.sort(function (a, b) {\n                    return Number(a.timestamp) - Number(b.timestamp);\n                });\n\n                annotations.forEach(function (item) {\n                    var listItem = $('#annotation-template').clone();\n                    ctRenderer[item.type].renderEditItem(annotations, listItem, item);\n                });\n\n                var xp = annotations.filter(x => x.xp).map(x => Number(x.xp)).reduce((a, b) => a + b, 0);\n                $(\"#xp span\").text(xp);\n\n                if (activeid) {\n                    var activeAnno = annotations.find(x => x.id == activeid);\n                    if (activeAnno) {\n                        ctRenderer[activeAnno.type].postEditCallback(activeAnno);\n                    }\n                }\n            };\n\n            const getAnnotations = () => {\n                const getItems = $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'get_items',\n                        sesskey: M.cfg.sesskey,\n                        id: interaction,\n                        contextid: M.cfg.courseContextId,\n                    }\n                });\n\n                const getContentTypes = $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'getallcontenttypes',\n                        sesskey: M.cfg.sesskey,\n                    }\n                });\n\n                $.when(getItems, getContentTypes).done(function (items, contenttypes) {\n                    annotations = JSON.parse(items[0]);\n                    contentTypes = JSON.parse(contenttypes[0]);\n                    // Remove all annotations that are not in the content types.\n                    annotations = annotations.filter(x => contentTypes.find(y => y.name === x.type));\n                    const getRenderers = new Promise((resolve) => {\n                        var count = 0;\n                        contentTypes.forEach(x => {\n                            require(['' + x.amdmodule], function (Type) {\n                                ctRenderer[x.name] = new Type(player, annotations, interaction,\n                                    course, 0, 0, 0, 0, type, 0, totaltime, start, end, x);\n                                count++;\n                                if (count == contentTypes.length) {\n                                    resolve(ctRenderer);\n                                }\n                            });\n                        });\n                    });\n                    annotations.map(x => {\n                        x.prop = JSON.stringify(contentTypes.find(y => y.name === x.type));\n                        return x;\n                    });\n                    getRenderers.then(() => {\n                        renderAnnotationItems(annotations);\n                        return;\n                    }).catch(() => {\n                        // Do nothing.\n                    });\n                });\n            };\n\n            const validateTimestampFormat = (timestamp, fld, existing) => {\n                var regex = /^([0-9]{2}):([0-5][0-9]):([0-5][0-9])$/;\n                if (!regex.test(timestamp)) {\n                    addNotification(M.util.get_string('invalidtimestampformat', 'mod_interactivevideo'), 'danger');\n                    if (existing) {\n                        $(fld).val(existing);\n                    } else {\n                        $(fld).val(convertSecondsToHMS(start));\n                    }\n                    return false;\n                }\n                return true;\n            };\n\n            const validateTimeStartEnd = (timestamp, fld, existing, seconds, checkduration,\n                checkexisting, checkskipsegment) => {\n                // Convert the timestamp to seconds.\n                var parts = timestamp.split(':');\n                timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                // Make sure the timestamp is between start and end.\n                if (checkduration) {\n                    if (timestamp > end || timestamp < start) {\n                        var message = M.util.get_string('timemustbebetweenstartandendtime', 'mod_interactivevideo', {\n                            \"start\": convertSecondsToHMS(start),\n                            \"end\": convertSecondsToHMS(end)\n                        });\n                        addNotification(message, 'danger');\n                        if (existing) {\n                            $(fld).val(existing);\n                        } else {\n                            $(fld).val(convertSecondsToHMS(start));\n                        }\n                        return -1;\n                    }\n                }\n\n                // Make sure the timestamp is not already in the list.\n                if (checkexisting) {\n                    if (annotations.find(x => x.timestamp == timestamp) && timestamp != seconds) {\n                        addNotification(M.util.get_string('interactionalreadyexists', 'mod_interactivevideo'), 'danger');\n                        if (existing) {\n                            $(fld).val(existing);\n                        } else {\n                            $(fld).val(convertSecondsToHMS(start));\n                        }\n                        return -1;\n                    }\n                }\n\n                // Make sure timestamp is not in a skip segment.\n                if (checkskipsegment) {\n                    var skipsegments = annotations.filter((annotation) => annotation.type == 'skipsegment');\n                    var skip = skipsegments.find(x => Number(x.timestamp) < Number(timestamp)\n                        && Number(x.title) > Number(timestamp));\n                    if (skip) {\n                        addNotification(M.util.get_string('interactionisbetweentheskipsegment', 'mod_interactivevideo', {\n                            \"start\": convertSecondsToHMS(skip.timestamp),\n                            \"end\": convertSecondsToHMS(skip.title)\n                        }), 'danger');\n                        if (existing) {\n                            $(fld).val(existing);\n                        } else {\n                            $(fld).val(convertSecondsToHMS(start));\n                        }\n                        return -1;\n                    }\n                }\n\n                return timestamp;\n\n            };\n\n            const runInteraction = (annotation) => {\n                player.pause();\n                // Remove the previous message but keep the one below the video.\n                $('#annotation-modal').modal('hide');\n                $('#message').not('[data-placement=bottom]').remove();\n                $('#end-screen').remove();\n                var activityType = ctRenderer[annotation.type];\n                activityType.runInteraction(annotation);\n            };\n\n            const onReady = () => {\n                let duration = player.getDuration();\n                duration.then(t => {\n                    if (!end) {\n                        end = t;\n                    } else {\n                        end = Math.min(end, t);\n                    }\n\n                    if (start > end) {\n                        start = 0;\n                    }\n\n                    totaltime = end - start;\n                    // Recalculate the ratio of the video\n                    player.ratio().then((ratio) => {\n                        $(\"#video-wrapper\").css('padding-bottom', (1 / ratio) * 100 + '%');\n                    });\n                    playerReady = true;\n                    $(\"#timeframe\").text(\"[\" + convertSecondsToHMS(start) + ' - ' + convertSecondsToHMS(end) + \"]\");\n                    return getAnnotations();\n                }).catch(() => {\n                    // Do nothing.\n                });\n            };\n\n            const onEnded = () => {\n                player.pause();\n                // Cover the video with a message on a white background div.\n                $('#video-wrapper').append(`<div id=\"end-screen\" class=\"position-absolute w-100 h-100 bg-white d-flex\n                     justify-content-center align-items-center style=\"top: 0; left: 0;\">\n                     <button class=\"btn btn-danger rounded-circle\" style=\"font-size: 1.5rem;\" id=\"restart\">\n                    <i class=\"bi bi-arrow-repeat\" style=\"font-size: x-large;\"></i></button></div>`);\n                $('#video-nav #progress').css('width', '100%');\n                // Focus on the restart button;\n                $('#message #restart').focus();\n\n                // If the current time matches the timestamp of an annotation, highlight the annotation\n                var currentAnnotation = annotations.find((annotation) => annotation.timestamp == end);\n                if (currentAnnotation) {\n                    $('#annotation-list tr').removeClass('active');\n                    $(`tr[data-id=\"${currentAnnotation.id}\"]`).addClass('active');\n\n                    // Show tooltip for two seconds\n                    // toggle the tooltip to show the title\n                    $('#video-nav .annotation[data-id=\"' + currentAnnotation.id + '\"] .item').tooltip('show');\n                    // Hide the tooltip after 2 seconds\n                    setTimeout(function () {\n                        $('#video-nav .annotation[data-id=\"' + currentAnnotation.id + '\"] .item').tooltip('hide');\n                    }, 2000);\n                }\n            };\n\n            const onSeek = async (t) => {\n                if (t) {\n                    t = Number(t);\n                } else {\n                    t = await player.getCurrentTime();\n                }\n                var percentage = (t - start) / (totaltime) * 100;\n                return $('#video-nav #progress').css('width', percentage + '%');\n            };\n\n            var onPlayingInterval;\n            const onPlaying = () => {\n                $('#message, #end-screen').remove();\n                var intervalFunction = async function () {\n                    var thisTime = await player.getCurrentTime();\n                    var isPlaying = await player.isPlaying();\n                    var isEnded = await player.isEnded();\n                    if (!isPlaying || isEnded) {\n                        clearInterval(onPlayingInterval);\n                        return;\n                    }\n\n                    if (thisTime < start) {\n                        player.seek(start);\n                        thisTime = start;\n                    }\n\n                    if (thisTime >= end) {\n                        player.stop(end);\n                        clearInterval(onPlayingInterval);\n                        onEnded();\n                        return;\n                    }\n\n                    var percentage = (thisTime - start) / (totaltime) * 100;\n                    $('#video-nav #progress').css('width', percentage + '%');\n\n                    // If the current time matches the timestamp of an annotation, highlight the annotation\n                    var currentAnnotation = annotations.find(x => (thisTime - player.frequency) <= x.timestamp\n                        && (thisTime + player.frequency) >= x.timestamp);\n                    if (currentAnnotation) {\n                        $('#annotation-list tr').removeClass('active');\n                        $(`tr[data-id=\"${currentAnnotation.id}\"]`).addClass('active');\n\n                        // Show tooltip for two seconds\n                        // toggle the tooltip to show the title\n                        $('#video-nav .annotation[data-id=\"' + currentAnnotation.id + '\"] .item').tooltip('show');\n                        // Hide the tooltip after 2 seconds\n                        setTimeout(function () {\n                            $('#video-nav .annotation[data-id=\"' + currentAnnotation.id + '\"] .item').tooltip('hide');\n                        }, 2000);\n                    }\n\n                    // If current time is within the skipsegment, seek to the end of the segment\n                    var skipsegments = annotations.filter((annotation) => annotation.type == 'skipsegment');\n                    var skip = skipsegments.find(x => Number(x.timestamp) < Number(thisTime)\n                        && Number(x.title) > Number(thisTime));\n                    if (skip) {\n                        player.seek(Number(skip.title));\n                        // Replace the progress bar\n                        percentage = (skip.title - start) / totaltime * 100;\n                        replaceProgressBars(percentage);\n                    }\n                };\n                if (player.type == 'yt' || player.type == 'wistia') {\n                    onPlayingInterval = setInterval(intervalFunction, 100);\n                } else {\n                    intervalFunction();\n                }\n            };\n\n            const onPause = () => {\n                clearInterval(onPlayingInterval);\n            };\n\n            // Implement the player\n            require(['mod_interactivevideo/player/' + type], function (VideoPlayer) {\n                player = new VideoPlayer(\n                    url,\n                    start,\n                    end,\n                    true,\n                    true,\n                );\n            });\n\n            $(document).on('iv:playerReady', function () {\n                onReady();\n            });\n\n            $(document).on('iv:playerPaused', function () {\n                onPause();\n            });\n\n            $(document).on('iv:playerPlaying', function () {\n                onPlaying();\n            });\n\n            $(document).on('iv:playerEnded', function () {\n                onEnded();\n            });\n\n            $(document).on('iv:playerSeek', function (e) {\n                onSeek(e.detail.time);\n            });\n\n            $(document).on('annotationupdated', function (e) {\n                var updated = e.originalEvent.detail.annotation;\n                var action = e.originalEvent.detail.action;\n                if (action == 'edit') {\n                    annotations = annotations.filter(function (item) {\n                        return item.id != updated.id;\n                    });\n                }\n                updated.prop = JSON.stringify(contentTypes.find(x => x.name === updated.type));\n                annotations.push(updated);\n                if (action == 'add') {\n                    activeid = updated.id;\n                } else {\n                    activeid = null;\n                }\n\n                renderAnnotationItems(annotations);\n                if (action == 'add' || action == 'clone') {\n                    addNotification(M.util.get_string('interactionadded', 'mod_interactivevideo'), 'success');\n                    $(`tr[data-id=\"${updated.id}\"]`).addClass('active');\n                    if (action == 'clone') {\n                        setTimeout(function () {\n                            $(`tr[data-id=\"${updated.id}\"]`).find(`[data-editable=\"timestamp\"]`).trigger('contextmenu');\n                        }, 100);\n                    }\n                } else if (action == 'edit') {\n                    addNotification(M.util.get_string('interactionupdated', 'mod_interactivevideo'), 'success');\n                    $(`tr[data-id=\"${updated.id}\"]`).addClass('active');\n                    setTimeout(function () {\n                        $(`tr[data-id=\"${updated.id}\"]`).removeClass('active');\n                    }, 1500);\n                }\n            });\n\n            // Implement create annotation\n            $(document).on('click', '#addcontentdropdown a', async function (e) {\n                if (!playerReady) {\n                    return;\n                }\n                e.preventDefault();\n                $('#addcontentdropdown a').removeClass('active');\n                $(this).addClass('active');\n                var contenttype = $(this).data('type');\n                player.pause();\n                var timestamp = currentTime || await player.getCurrentTime();\n                timestamp = Math.floor(timestamp);\n                currentTime = null;\n                ctRenderer[contenttype].addAnnotation(annotations, timestamp, coursemodule);\n            });\n\n            // Implement edit annotation\n            $(document).on('click', 'tr .edit', function (e) {\n                e.preventDefault();\n                var timestamp = $(this).closest('.annotation').data('timestamp');\n                if (timestamp) {\n                    player.seek(timestamp, true);\n                }\n\n                player.pause();\n                var id = $(this).closest('.annotation').data('id');\n                var contenttype = $(this).closest('.annotation').data('type');\n                ctRenderer[contenttype].editAnnotation(annotations, id, coursemodule);\n            });\n\n            // Implement copy annotation\n            $(document).on('click', 'tr .copy', function (e) {\n                e.preventDefault();\n                var id = $(this).closest('.annotation').data('id');\n                var contenttype = $(this).closest('.annotation').data('type');\n                ctRenderer[contenttype].cloneAnnotation(id);\n            });\n\n            $(document).on('annotationdeleted', function (e) {\n                var annotation = e.originalEvent.detail.annotation;\n                activeid = null;\n                $(`tr[data-id=\"${annotation.id}\"]`).addClass('deleted');\n                setTimeout(function () {\n                    annotations = annotations.filter(function (item) {\n                        return item.id != annotation.id;\n                    });\n                    renderAnnotationItems(annotations);\n                    addNotification(M.util.get_string('interactiondeleted', 'mod_interactivevideo'), 'success');\n                }, 1000);\n            });\n\n            // Implement delete annotation.\n            $(document).on('click', '.delete', function (e) {\n                e.preventDefault();\n                player.pause();\n                var id = $(this).closest('.annotation').data('id');\n                var annotation = annotations.find(x => x.id == id);\n                Notification.saveCancel(\n                    M.util.get_string('deleteinteraction', 'mod_interactivevideo'),\n                    M.util.get_string('deleteinteractionconfirm', 'mod_interactivevideo'),\n                    M.util.get_string('delete', 'mod_interactivevideo'),\n                    function () {\n                        ctRenderer[annotation.type].deleteAnnotation(annotations, id);\n                    },\n                    null\n                );\n\n            });\n\n            // Implement view annotation\n            $(document).on('click', '.annotation .title', function (e) {\n                e.preventDefault();\n                var timestamp = $(this).closest('.annotation').data('timestamp');\n                player.seek(timestamp, true);\n                player.pause();\n\n                // Update the progress bar\n                var percentage = (timestamp - start) / totaltime * 100;\n                replaceProgressBars(percentage);\n\n                var id = $(this).closest('.annotation').data('id');\n\n                var theAnnotation = annotations.find(x => x.id == id);\n\n                runInteraction(theAnnotation);\n            });\n\n            // Implement go to timestamp\n            $(document).on('click', '.timestamp', function (e) {\n                e.preventDefault();\n                var timestamp = $(this).data('timestamp');\n                player.seek(timestamp);\n                player.play();\n            });\n\n            // Display time when user hover on the progress bar\n            $(document).on('mousemove', '#video-nav #seek', function (e) {\n                if (!playerReady) {\n                    return;\n                }\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                var percentage = e.offsetX / $(this).width();\n                var time = Math.floor(percentage * (totaltime) + start);\n                var formattedTime = convertSecondsToHMS(time);\n                $('.tooltip').remove();\n                $('#video-nav #seek #tooltip').remove();\n                // Create a dummy element on the ul and show the time as tooltip\n                $('#video-nav #seek').append(`<div id=\"tooltip\" class=\"position-absolute bg-transparent text-white\"\n                    data-toggle=\"tooltip\" data-container=\"#wrapper\" data-original-title=\"${formattedTime}\"\n                    style=\"left: calc(${percentage * 100}%); width: 3px;\"></div>`);\n                $('#tooltip').tooltip('show');\n            });\n\n            $(document).on('mouseleave', '#video-nav #seek', function (e) {\n                if (!playerReady) {\n                    return;\n                }\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                $('#video-nav #seek #tooltip').remove();\n                $('.tooltip').remove();\n            });\n\n            $(document).on('click', '#video-nav', async function (e) {\n                if (!playerReady) {\n                    return;\n                }\n                e.preventDefault();\n                var percentage = e.offsetX / $(this).width();\n                // Replace the progress bar\n                replaceProgressBars(percentage * 100);\n                player.play();\n                player.seek((percentage * totaltime) + start);\n                player.pause();\n                $(\"#message, #end-screen\").remove();\n            });\n\n            $(document).on('contextmenu', '#video-nav', function (e) {\n                if (!playerReady) {\n                    return;\n                }\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                var percentage = e.offsetX / $(this).width();\n                replaceProgressBars(percentage * 100);\n                currentTime = Math.floor(percentage * totaltime) + start;\n                player.seek(currentTime);\n                player.pause();\n                $(\"#addcontent\").trigger('click');\n\n            });\n\n            $(document).on('contextmenu', '#video-nav .annotation', function (e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                var id = $(this).data('id');\n                // Trigger click on the edit button\n                $(`tr.annotation[data-id=\"${id}\"] .edit`).trigger('click');\n            });\n\n            $(document).on('click', '#video-nav .annotation', function (e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                var timestamp = $(this).data('timestamp');\n                player.play();\n                player.seek(timestamp);\n                player.pause();\n                $('tr.annotation[data-timestamp=\"' + timestamp + '\"]').addClass('active');\n                var id = $(this).data('id');\n                var theAnnotation = annotations.find(x => x.id == id);\n                runInteraction(theAnnotation);\n            });\n\n            // Quick edit\n            $(document).on('contextmenu', '[data-editable]', function (e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                if ($('[data-field].editing').length > 0) {\n                    return;\n                }\n                var fld = $(this).data('editable');\n                $(this).hide();\n                $(this).siblings('[data-field=\"' + fld + '\"]').removeClass('d-none').focus().addClass('editing');\n            });\n\n            $(document).on('keyup', '[data-field].editing', function (e) {\n                $(this).removeClass('is-invalid');\n                var initialValue = $(this).data('initial-value');\n                var val = $(this).val();\n                var fld = $(this).data('field');\n                if (val == '') {\n                    $(this).addClass('is-invalid');\n                }\n\n                // If escape key is pressed, revert the value\n                if (e.key == 'Escape') {\n                    $(this).val(initialValue);\n                    $(this).removeClass('editing');\n                    $(this).addClass('d-none');\n                    $(this).siblings('[data-editable]').show();\n                    return;\n                }\n                // If enter key is pressed, save the value\n                if (e.key == 'Enter') {\n                    var seconds;\n                    if (fld == 'timestamp') {\n                        var parts = initialValue.split(':');\n                        seconds = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                        if (!validateTimestampFormat(val, '[data-field].editing', initialValue)) {\n                            $(this).addClass('is-invalid');\n                            return;\n                        }\n                        var timestamp = validateTimeStartEnd(val, '[data-field].editing', initialValue, seconds,\n                            true, true, true);\n                        if (timestamp == -1) {\n                            window.console.log('wtf');\n                            $(this).addClass('is-invalid');\n                            return;\n                        }\n                        seconds = timestamp;\n                    }\n\n                    if ($(this).hasClass('is-invalid')) {\n                        return;\n                    }\n                    if (val == initialValue) {\n                        $(this).removeClass('editing');\n                        $(this).addClass('d-none');\n                        $(this).siblings('[data-editable]').show();\n                        return;\n                    }\n                    var id = $(this).data('id');\n                    $.ajax({\n                        url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                        method: \"POST\",\n                        dataType: \"text\",\n                        data: {\n                            action: 'quickeditfield',\n                            sesskey: M.cfg.sesskey,\n                            id: id,\n                            field: fld,\n                            contextid: M.cfg.contextid,\n                            value: fld == 'timestamp' ? seconds : val,\n                        },\n                        success: function (data) {\n                            var updated = JSON.parse(data);\n                            dispatchEvent('annotationupdated', {\n                                annotation: updated,\n                                action: 'edit'\n                            });\n                        }\n                    });\n                    return;\n                }\n            });\n\n            $(document).on('blur', '[data-field].editing', function () {\n                var initialValue = $(this).data('initial-value');\n                $(this).val(initialValue);\n                $(this).removeClass('editing');\n                $(this).addClass('d-none');\n                $(this).siblings('[data-editable]').show();\n            });\n            // End quick edit\n\n            $(document).on('click', '#end-screen #restart', function (e) {\n                e.preventDefault();\n                $('#end-screen').remove();\n                player.seek(start);\n                player.play();\n            });\n\n            $(document).on('mouseover', 'tr.annotation', function () {\n                var id = $(this).data('id');\n                $(`#video-nav ul li[data-id=\"${id}\"] .item`).trigger('mouseover');\n            });\n\n            $(document).on('mouseout', 'tr.annotation', function () {\n                var id = $(this).data('id');\n                $(`#video-nav ul li[data-id=\"${id}\"] .item`).trigger('mouseout');\n                $('.tooltip').remove();\n            });\n\n            $(document).on('mouseover', '#video-nav ul li .item', function () {\n                var id = $(this).closest('li').data('id');\n                $(`tr.annotation[data-id=\"${id}\"]`).addClass('active');\n            });\n\n            $(document).on('mouseout', '#video-nav ul li .item', function () {\n                var id = $(this).closest('li').data('id');\n                $(`tr.annotation[data-id=\"${id}\"]`).removeClass('active');\n            });\n\n            $(document).on('change', '.timestamp-input', function () {\n                $(this).removeClass('is-invalid');\n                var parts = $(this).val().split(':');\n                var seconds = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                if (!validateTimestampFormat($(this).val(), this)) {\n                    $(this).addClass('is-invalid');\n                    return;\n                }\n\n                var timestamp = validateTimeStartEnd($(this).val(), this, \"00:00:00\", seconds, true, false, true);\n\n                if (timestamp == -1) {\n                    $(this).addClass('is-invalid');\n                    return;\n                }\n            });\n\n            $('#contentmodal').on('show.bs.modal', function () {\n                $('#addcontentdropdown').addClass('modal-body');\n            });\n\n            $('#contentmodal').on('hide.bs.modal', function () {\n                $('#addcontentdropdown a').removeClass('active');\n                $('#addcontentdropdown').removeClass('modal-body');\n            });\n\n            $(document).on('click', '#fullscreen', function (e) {\n                e.preventDefault();\n                if ($(this).hasClass('fullscreen')) {\n                    $('#distractfreemodal').modal('hide');\n\n                } else {\n                    let modal = `<div class=\"modal fade p-0\" id=\"distractfreemodal\"\n                     role=\"dialog\" aria-hidden=\"true\" data-backdrop=\"static\"\n    data-keyboard=\"false\">\n    <div class=\"modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable\" role=\"document\">\n        <div class=\"modal-content rounded-0 p-3\">\n            <div class=\"modal-body px-1 px-sm-3\" id=\"distractionfreebody\">\n<div class=\"d-flex w-100 align-items-center justify-content-center mt-5\"><div class=\"spinner-grow text-secondary\"\n     style=\"width: 3rem; height: 3rem;\" role=\"status\">\n  <span class=\"sr-only\">Loading...</span>\n</div></div>\n            </div>\n        </div>\n    </div>\n</div>`;\n                    $('body').append(modal);\n                    $('#distractfreemodal').modal('show');\n\n                }\n\n                $(this).toggleClass('fullscreen');\n\n                $('#distractfreemodal').on('shown.bs.modal', function () {\n                    $('body').addClass('distractionfreemode');\n                    let $wrapper = $('#wrapper').clone();\n                    $('#distractfreemodal').find('#distractionfreebody').html($wrapper);\n                    // Remove original wrapper\n                    $('#wrapper').remove();\n                });\n                $('#distractfreemodal').on('hidden.bs.modal', function () {\n                    $('body').removeClass('distractionfreemode');\n                    let $wrapper = $('#distractfreemodal #wrapper').clone();\n                    $('[role=\"main\"]').append($wrapper);\n                    $('#distractfreemodal').remove();\n                });\n            });\n        }\n    };\n});"],"names":["define","$","addToast","Notification","dispatchEvent","player","totaltime","currentTime","ctRenderer","Object","playerReady","replaceProgressBars","percentage","replaceWith","renderVideoNav","async","annos","start","length","text","empty","forEach","render","x","type","renderItemOnVideoNavigation","getCurrentTime","then","time","catch","document","on","tooltip","init","url","coursemodule","interaction","course","end","coursecontextid","addNotification","msg","add","Number","isNaN","contentTypes","annotations","convertSecondsToHMS","s","hours","Math","floor","minutes","seconds","activeid","renderAnnotationItems","remove","removeClass","sort","a","b","timestamp","item","listItem","clone","renderEditItem","xp","filter","map","reduce","activeAnno","find","id","postEditCallback","html","M","util","get_string","addClass","getAnnotations","getItems","ajax","cfg","wwwroot","method","dataType","data","action","sesskey","contextid","courseContextId","getContentTypes","when","done","items","contenttypes","JSON","parse","y","name","getRenderers","Promise","resolve","count","require","amdmodule","Type","prop","stringify","validateTimestampFormat","fld","existing","test","val","validateTimeStartEnd","checkduration","checkexisting","checkskipsegment","parts","split","message","skip","annotation","title","runInteraction","pause","modal","not","onReady","getDuration","t","min","ratio","css","onEnded","append","focus","currentAnnotation","setTimeout","onSeek","onPlayingInterval","onPlaying","intervalFunction","thisTime","isPlaying","isEnded","seek","stop","clearInterval","frequency","setInterval","onPause","VideoPlayer","e","detail","updated","originalEvent","push","trigger","preventDefault","this","contenttype","addAnnotation","closest","editAnnotation","cloneAnnotation","saveCancel","deleteAnnotation","theAnnotation","play","stopImmediatePropagation","offsetX","width","formattedTime","hide","siblings","initialValue","key","show","window","console","log","hasClass","field","value","success","toggleClass","$wrapper"],"mappings":"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"}