{"version":3,"file":"editannotation.min.js","sources":["../src/editannotation.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Edit interactions module\n *\n * @module     mod_interactivevideo/editannotation\n * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery',\n    'core/toast',\n    'core/notification',\n    'core/event_dispatcher',\n    'mod_interactivevideo/libraries/jquery-ui',\n], function ($, addToast, Notification, { dispatchEvent }) {\n    var ctRenderer = new Object();\n    var player;\n    var totaltime;\n    var currentTime;\n    var playerReady = false;\n    /**\n     * Replace the progress bar on the video navigation.\n     * @param {Number} percentage - Percentage to replace the progress bar.\n     * @returns {void}\n     * */\n    const replaceProgressBars = (percentage) => {\n        percentage = percentage > 100 ? 100 : percentage;\n        $('#video-nav #progress').replaceWith(`<div id=\"progress\"  style=\"width: ${percentage}%;\"></div>`);\n    };\n    /**\n     * Render the annotations on the video navigation.\n     * @param {Array} annos - Annotations to render.\n     * @param {Number} start - Start time of the video.\n     * @param {Number} totaltime - Total time of the video.\n     * @returns {void}\n     * */\n    const renderVideoNav = async (annos, start, totaltime) => {\n        if (annos.length == 0) {\n            $(\"#taskinfo #completion-info\").text('0/0');\n            $(\"#video-nav ul\").empty();\n            return;\n        }\n\n        $(\"#video-nav ul\").empty();\n        annos.forEach(async (x) => {\n            var render = ctRenderer[x.type];\n            await render.renderItemOnVideoNavigation(x);\n        });\n\n        player.getCurrentTime().then((time) => {\n            // Replace progress bar.\n            var percentage = (time - start) / totaltime * 100;\n            replaceProgressBars(percentage);\n            return;\n        }).catch(() => {\n            // Do nothing.\n        });\n\n        dispatchEvent('annotationitemsrendered', { 'annotations': annos });\n\n    };\n\n\n\n    return {\n        init: function (url, coursemodule, interaction, course, start, end, coursecontextid, type = 'yt') {\n            const addNotification = (msg, type = \"info\") => {\n                addToast.add(msg, {\n                    type: type\n                });\n            };\n\n            start = Number(start);\n            if (isNaN(start)) {\n                start = 0;\n            }\n\n            end = Number(end);\n            if (isNaN(end)) {\n                end = null;\n            }\n\n            var annotations = [];\n            var contentTypes;\n\n            const convertSecondsToHMS = (s) => {\n                var hours = Math.floor(s / 3600);\n                var minutes = Math.floor(s % 3600 / 60);\n                var seconds = Math.floor(s % 3600 % 60);\n                return (hours < 10 ? '0' + hours : hours) + ':' +\n                    (minutes < 10 ? '0' + minutes : minutes) + ':' +\n                    (seconds < 10 ? '0' + seconds : seconds);\n            };\n\n            var activeid = null; // Current active annotation id. Mainly used when editing to relaunch the interaction afte editing.\n            const renderAnnotationItems = (annotations) => {\n                renderVideoNav(annotations, start, totaltime);\n                $('#annotationwrapper .loader').remove();\n                $('#annotation-list').empty().removeClass(\"d-flex align-items-center justify-content-center\");\n                if (annotations.length == 0) {\n                    $('#annotation-list').html(`${M.util.get_string('clickaddtoaddinteraction', 'mod_interactivevideo')}`)\n                        .addClass(\"d-flex align-items-center justify-content-center\");\n                    return;\n                }\n                annotations.sort(function (a, b) {\n                    return Number(a.timestamp) - Number(b.timestamp);\n                });\n\n                annotations.forEach(function (item) {\n                    var listItem = $('#annotation-template').clone();\n                    ctRenderer[item.type].renderEditItem(annotations, listItem, item);\n                });\n\n                var xp = annotations.filter(x => x.xp).map(x => Number(x.xp)).reduce((a, b) => a + b, 0);\n                $(\"#xp span\").text(xp);\n\n                if (activeid) {\n                    var activeAnno = annotations.find(x => x.id == activeid);\n                    if (activeAnno) {\n                        ctRenderer[activeAnno.type].postEditCallback(activeAnno);\n                    }\n                }\n            };\n\n            const getAnnotations = () => {\n                const getItems = $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'get_items',\n                        sesskey: M.cfg.sesskey,\n                        id: interaction,\n                        contextid: M.cfg.courseContextId,\n                    }\n                });\n\n                const getContentTypes = $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'getallcontenttypes',\n                        sesskey: M.cfg.sesskey,\n                    }\n                });\n\n                $.when(getItems, getContentTypes).done(function (items, contenttypes) {\n                    annotations = JSON.parse(items[0]);\n                    contentTypes = JSON.parse(contenttypes[0]);\n                    // Remove all annotations that are not in the content types.\n                    annotations = annotations.filter(x => contentTypes.find(y => y.name === x.type));\n                    const getRenderers = new Promise((resolve) => {\n                        var count = 0;\n                        contentTypes.forEach(x => {\n                            require(['' + x.amdmodule], function (Type) {\n                                ctRenderer[x.name] = new Type(player, annotations, interaction,\n                                    course, 0, 0, 0, 0, type, 0, totaltime, start, end, x, coursemodule);\n                                count++;\n                                if (count == contentTypes.length) {\n                                    resolve(ctRenderer);\n                                }\n                            });\n                        });\n                    });\n                    annotations.map(x => {\n                        x.prop = JSON.stringify(contentTypes.find(y => y.name === x.type));\n                        return x;\n                    });\n                    getRenderers.then(() => {\n                        renderAnnotationItems(annotations);\n                        return;\n                    }).catch(() => {\n                        // Do nothing.\n                    });\n                });\n            };\n\n            const validateTimestampFormat = (timestamp, fld, existing) => {\n                var regex = /^([0-9]{2}):([0-5][0-9]):([0-5][0-9])$/;\n                if (!regex.test(timestamp)) {\n                    addNotification(M.util.get_string('invalidtimestampformat', 'mod_interactivevideo'), 'danger');\n                    if (existing) {\n                        $(fld).val(existing);\n                    } else {\n                        $(fld).val(convertSecondsToHMS(start));\n                    }\n                    return false;\n                }\n                return true;\n            };\n\n            const validateTimeStartEnd = (timestamp, fld, existing, seconds, checkduration,\n                checkexisting, checkskipsegment) => {\n                // Convert the timestamp to seconds.\n                var parts = timestamp.split(':');\n                timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                // Make sure the timestamp is between start and end.\n                if (checkduration) {\n                    if (timestamp > end || timestamp < start) {\n                        var message = M.util.get_string('timemustbebetweenstartandendtime', 'mod_interactivevideo', {\n                            \"start\": convertSecondsToHMS(start),\n                            \"end\": convertSecondsToHMS(end)\n                        });\n                        addNotification(message, 'danger');\n                        if (existing) {\n                            $(fld).val(existing);\n                        } else {\n                            $(fld).val(convertSecondsToHMS(start));\n                        }\n                        return -1;\n                    }\n                }\n\n                // Make sure the timestamp is not already in the list.\n                if (checkexisting) {\n                    if (annotations.find(x => x.timestamp == timestamp) && timestamp != seconds) {\n                        addNotification(M.util.get_string('interactionalreadyexists', 'mod_interactivevideo'), 'danger');\n                        if (existing) {\n                            $(fld).val(existing);\n                        } else {\n                            $(fld).val(convertSecondsToHMS(start));\n                        }\n                        return -1;\n                    }\n                }\n\n                // Make sure timestamp is not in a skip segment.\n                if (checkskipsegment) {\n                    var skipsegments = annotations.filter((annotation) => annotation.type == 'skipsegment');\n                    var skip = skipsegments.find(x => Number(x.timestamp) < Number(timestamp)\n                        && Number(x.title) > Number(timestamp));\n                    if (skip) {\n                        addNotification(M.util.get_string('interactionisbetweentheskipsegment', 'mod_interactivevideo', {\n                            \"start\": convertSecondsToHMS(skip.timestamp),\n                            \"end\": convertSecondsToHMS(skip.title)\n                        }), 'danger');\n                        if (existing) {\n                            $(fld).val(existing);\n                        } else {\n                            $(fld).val(convertSecondsToHMS(start));\n                        }\n                        return -1;\n                    }\n                }\n\n                return timestamp;\n\n            };\n\n            const runInteraction = (annotation) => {\n                player.pause();\n                // Remove the previous message but keep the one below the video.\n                $('#annotation-modal').modal('hide');\n                $('#message').not('[data-placement=bottom]').remove();\n                $('#end-screen').remove();\n                var activityType = ctRenderer[annotation.type];\n                activityType.runInteraction(annotation);\n            };\n\n            const onReady = () => {\n                let duration = player.getDuration();\n                duration.then(t => {\n                    if (!end) {\n                        end = t;\n                    } else {\n                        end = Math.min(end, t);\n                    }\n\n                    if (start > end) {\n                        start = 0;\n                    }\n\n                    totaltime = end - start;\n                    // Recalculate the ratio of the video\n                    player.ratio().then((ratio) => {\n                        $(\"#video-wrapper\").css('padding-bottom', (1 / ratio) * 100 + '%');\n                    });\n                    playerReady = true;\n                    $(\"#timeframe\").text(\"[\" + convertSecondsToHMS(start) + ' - ' + convertSecondsToHMS(end) + \"]\");\n                    return getAnnotations();\n                }).catch(() => {\n                    // Do nothing.\n                });\n            };\n\n            const onEnded = () => {\n                player.pause();\n                // Cover the video with a message on a white background div.\n                $('#video-wrapper').append(`<div id=\"end-screen\" class=\"position-absolute w-100 h-100 bg-white d-flex\n                     justify-content-center align-items-center style=\"top: 0; left: 0;\">\n                     <button class=\"btn btn-danger rounded-circle\" style=\"font-size: 1.5rem;\" id=\"restart\">\n                    <i class=\"bi bi-arrow-repeat\" style=\"font-size: x-large;\"></i></button></div>`);\n                $('#video-nav #progress').css('width', '100%');\n                // Focus on the restart button;\n                $('#message #restart').focus();\n\n                // If the current time matches the timestamp of an annotation, highlight the annotation\n                var currentAnnotation = annotations.find((annotation) => annotation.timestamp == end);\n                if (currentAnnotation) {\n                    $('#annotation-list tr').removeClass('active');\n                    $(`tr[data-id=\"${currentAnnotation.id}\"]`).addClass('active');\n\n                    // Show tooltip for two seconds\n                    // toggle the tooltip to show the title\n                    $('#video-nav .annotation[data-id=\"' + currentAnnotation.id + '\"] .item').tooltip('show');\n                    // Hide the tooltip after 2 seconds\n                    setTimeout(function () {\n                        $('#video-nav .annotation[data-id=\"' + currentAnnotation.id + '\"] .item').tooltip('hide');\n                    }, 2000);\n                }\n            };\n\n            const onSeek = async (t) => {\n                if (t) {\n                    t = Number(t);\n                } else {\n                    t = await player.getCurrentTime();\n                }\n                var percentage = (t - start) / (totaltime) * 100;\n                return $('#video-nav #progress').css('width', percentage + '%');\n            };\n\n            var onPlayingInterval;\n            const onPlaying = () => {\n                $('#message, #end-screen').remove();\n                var intervalFunction = async function () {\n                    var thisTime = await player.getCurrentTime();\n                    var isPlaying = await player.isPlaying();\n                    var isEnded = await player.isEnded();\n                    if (!isPlaying || isEnded) {\n                        clearInterval(onPlayingInterval);\n                        return;\n                    }\n\n                    if (thisTime < start) {\n                        player.seek(start);\n                        thisTime = start;\n                    }\n\n                    if (thisTime >= end) {\n                        player.stop(end);\n                        clearInterval(onPlayingInterval);\n                        onEnded();\n                        return;\n                    }\n\n                    var percentage = (thisTime - start) / (totaltime) * 100;\n                    $('#video-nav #progress').css('width', percentage + '%');\n\n                    // If the current time matches the timestamp of an annotation, highlight the annotation\n                    var currentAnnotation = annotations.find(x => (thisTime - player.frequency) <= x.timestamp\n                        && (thisTime + player.frequency) >= x.timestamp);\n                    if (currentAnnotation) {\n                        $('#annotation-list tr').removeClass('active');\n                        $(`tr[data-id=\"${currentAnnotation.id}\"]`).addClass('active');\n\n                        // Show tooltip for two seconds\n                        // toggle the tooltip to show the title\n                        $('#video-nav .annotation[data-id=\"' + currentAnnotation.id + '\"] .item').tooltip('show');\n                        // Hide the tooltip after 2 seconds\n                        setTimeout(function () {\n                            $('#video-nav .annotation[data-id=\"' + currentAnnotation.id + '\"] .item').tooltip('hide');\n                        }, 2000);\n                    }\n\n                    // If current time is within the skipsegment, seek to the end of the segment\n                    var skipsegments = annotations.filter((annotation) => annotation.type == 'skipsegment');\n                    var skip = skipsegments.find(x => Number(x.timestamp) < Number(thisTime)\n                        && Number(x.title) > Number(thisTime));\n                    if (skip) {\n                        player.seek(Number(skip.title));\n                        // Replace the progress bar\n                        percentage = (skip.title - start) / totaltime * 100;\n                        replaceProgressBars(percentage);\n                    }\n                };\n                if (player.type == 'yt' || player.type == 'wistia') {\n                    onPlayingInterval = setInterval(intervalFunction, 100);\n                } else {\n                    intervalFunction();\n                }\n            };\n\n            const onPause = () => {\n                clearInterval(onPlayingInterval);\n            };\n\n            // Implement the player\n            require(['mod_interactivevideo/player/' + type], function (VideoPlayer) {\n                player = new VideoPlayer(\n                    url,\n                    start,\n                    end,\n                    true,\n                    true,\n                );\n            });\n\n            $(document).on('iv:playerReady', function () {\n                onReady();\n            });\n\n            $(document).on('iv:playerPaused', function () {\n                onPause();\n            });\n\n            $(document).on('iv:playerPlaying', function () {\n                onPlaying();\n            });\n\n            $(document).on('iv:playerEnded', function () {\n                onEnded();\n            });\n\n            $(document).on('iv:playerSeek', function (e) {\n                onSeek(e.detail.time);\n            });\n\n            $(document).on('annotationupdated', function (e) {\n                var updated = e.originalEvent.detail.annotation;\n                var action = e.originalEvent.detail.action;\n                if (action == 'edit') {\n                    annotations = annotations.filter(function (item) {\n                        return item.id != updated.id;\n                    });\n                }\n                updated.prop = JSON.stringify(contentTypes.find(x => x.name === updated.type));\n                annotations.push(updated);\n                if (action == 'add') {\n                    activeid = updated.id;\n                } else {\n                    activeid = null;\n                }\n\n                renderAnnotationItems(annotations);\n                if (action == 'add' || action == 'clone') {\n                    addNotification(M.util.get_string('interactionadded', 'mod_interactivevideo'), 'success');\n                    $(`tr[data-id=\"${updated.id}\"]`).addClass('active');\n                    if (action == 'clone') {\n                        setTimeout(function () {\n                            $(`tr[data-id=\"${updated.id}\"]`).find(`[data-editable=\"timestamp\"]`).trigger('contextmenu');\n                        }, 100);\n                    }\n                } else if (action == 'edit') {\n                    addNotification(M.util.get_string('interactionupdated', 'mod_interactivevideo'), 'success');\n                    $(`tr[data-id=\"${updated.id}\"]`).addClass('active');\n                    setTimeout(function () {\n                        $(`tr[data-id=\"${updated.id}\"]`).removeClass('active');\n                    }, 1500);\n                }\n            });\n\n            // Implement create annotation\n            $(document).on('click', '#addcontentdropdown a', async function (e) {\n                if (!playerReady) {\n                    return;\n                }\n                e.preventDefault();\n                $('#addcontentdropdown a').removeClass('active');\n                $(this).addClass('active');\n                var contenttype = $(this).data('type');\n                player.pause();\n                var timestamp = currentTime || await player.getCurrentTime();\n                timestamp = Math.floor(timestamp);\n                currentTime = null;\n                ctRenderer[contenttype].addAnnotation(annotations, timestamp, coursemodule);\n            });\n\n            // Implement edit annotation\n            $(document).on('click', 'tr .edit', function (e) {\n                e.preventDefault();\n                var timestamp = $(this).closest('.annotation').data('timestamp');\n                if (timestamp) {\n                    player.seek(timestamp, true);\n                }\n\n                player.pause();\n                var id = $(this).closest('.annotation').data('id');\n                var contenttype = $(this).closest('.annotation').data('type');\n                ctRenderer[contenttype].editAnnotation(annotations, id, coursemodule);\n            });\n\n            // Implement copy annotation\n            $(document).on('click', 'tr .copy', function (e) {\n                e.preventDefault();\n                var id = $(this).closest('.annotation').data('id');\n                var contenttype = $(this).closest('.annotation').data('type');\n                ctRenderer[contenttype].cloneAnnotation(id);\n            });\n\n            $(document).on('annotationdeleted', function (e) {\n                var annotation = e.originalEvent.detail.annotation;\n                activeid = null;\n                $(`tr[data-id=\"${annotation.id}\"]`).addClass('deleted');\n                setTimeout(function () {\n                    annotations = annotations.filter(function (item) {\n                        return item.id != annotation.id;\n                    });\n                    renderAnnotationItems(annotations);\n                    addNotification(M.util.get_string('interactiondeleted', 'mod_interactivevideo'), 'success');\n                }, 1000);\n            });\n\n            // Implement delete annotation.\n            $(document).on('click', '.delete', function (e) {\n                e.preventDefault();\n                player.pause();\n                var id = $(this).closest('.annotation').data('id');\n                var annotation = annotations.find(x => x.id == id);\n                Notification.saveCancel(\n                    M.util.get_string('deleteinteraction', 'mod_interactivevideo'),\n                    M.util.get_string('deleteinteractionconfirm', 'mod_interactivevideo'),\n                    M.util.get_string('delete', 'mod_interactivevideo'),\n                    function () {\n                        ctRenderer[annotation.type].deleteAnnotation(annotations, id);\n                    },\n                    null\n                );\n\n            });\n\n            // Implement view annotation\n            $(document).on('click', '.annotation .title', function (e) {\n                e.preventDefault();\n                var timestamp = $(this).closest('.annotation').data('timestamp');\n                player.seek(timestamp, true);\n                player.pause();\n\n                // Update the progress bar\n                var percentage = (timestamp - start) / totaltime * 100;\n                replaceProgressBars(percentage);\n\n                var id = $(this).closest('.annotation').data('id');\n\n                var theAnnotation = annotations.find(x => x.id == id);\n\n                runInteraction(theAnnotation);\n            });\n\n            // Implement go to timestamp\n            $(document).on('click', '.timestamp', function (e) {\n                e.preventDefault();\n                var timestamp = $(this).data('timestamp');\n                player.seek(timestamp);\n                player.play();\n            });\n\n            // Display time when user hover on the progress bar\n            $(document).on('mousemove', '#video-nav #seek', function (e) {\n                if (!playerReady) {\n                    return;\n                }\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                var percentage = e.offsetX / $(this).width();\n                var time = Math.floor(percentage * (totaltime) + start);\n                var formattedTime = convertSecondsToHMS(time);\n                $('.tooltip').remove();\n                $('#video-nav #seek #tooltip').remove();\n                // Create a dummy element on the ul and show the time as tooltip\n                $('#video-nav #seek').append(`<div id=\"tooltip\" class=\"position-absolute bg-transparent text-white\"\n                    data-toggle=\"tooltip\" data-container=\"#wrapper\" data-original-title=\"${formattedTime}\"\n                    style=\"left: calc(${percentage * 100}%); width: 3px;\"></div>`);\n                $('#tooltip').tooltip('show');\n            });\n\n            $(document).on('mouseleave', '#video-nav #seek', function (e) {\n                if (!playerReady) {\n                    return;\n                }\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                $('#video-nav #seek #tooltip').remove();\n                $('.tooltip').remove();\n            });\n\n            $(document).on('click', '#video-nav', async function (e) {\n                if (!playerReady) {\n                    return;\n                }\n                e.preventDefault();\n                var percentage = e.offsetX / $(this).width();\n                // Replace the progress bar\n                replaceProgressBars(percentage * 100);\n                player.play();\n                player.seek((percentage * totaltime) + start);\n                player.pause();\n                $(\"#message, #end-screen\").remove();\n            });\n\n            $(document).on('contextmenu', '#video-nav', function (e) {\n                if (!playerReady) {\n                    return;\n                }\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                var percentage = e.offsetX / $(this).width();\n                replaceProgressBars(percentage * 100);\n                currentTime = Math.floor(percentage * totaltime) + start;\n                player.seek(currentTime);\n                player.pause();\n                $(\"#addcontent\").trigger('click');\n\n            });\n\n            $(document).on('contextmenu', '#video-nav .annotation', function (e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                var id = $(this).data('id');\n                // Trigger click on the edit button\n                $(`tr.annotation[data-id=\"${id}\"] .edit`).trigger('click');\n            });\n\n            // Quick edit\n            $(document).on('contextmenu', '[data-editable]', function (e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                if ($('[data-field].editing').length > 0) {\n                    return;\n                }\n                var fld = $(this).data('editable');\n                $(this).hide();\n                $(this).siblings('[data-field=\"' + fld + '\"]').removeClass('d-none').focus().addClass('editing');\n            });\n\n            $(document).on('keyup', '[data-field].editing', function (e) {\n                $(this).removeClass('is-invalid');\n                var initialValue = $(this).data('initial-value');\n                var val = $(this).val();\n                var fld = $(this).data('field');\n                if (val == '') {\n                    $(this).addClass('is-invalid');\n                }\n\n                // If escape key is pressed, revert the value\n                if (e.key == 'Escape') {\n                    $(this).val(initialValue);\n                    $(this).removeClass('editing');\n                    $(this).addClass('d-none');\n                    $(this).siblings('[data-editable]').show();\n                    return;\n                }\n                // If enter key is pressed, save the value\n                if (e.key == 'Enter') {\n                    var seconds;\n                    if (fld == 'timestamp') {\n                        var parts = initialValue.split(':');\n                        seconds = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                        if (!validateTimestampFormat(val, '[data-field].editing', initialValue)) {\n                            $(this).addClass('is-invalid');\n                            return;\n                        }\n                        var timestamp = validateTimeStartEnd(val, '[data-field].editing', initialValue, seconds,\n                            true, true, true);\n                        if (timestamp == -1) {\n                            window.console.log('wtf');\n                            $(this).addClass('is-invalid');\n                            return;\n                        }\n                        seconds = timestamp;\n                    }\n\n                    if ($(this).hasClass('is-invalid')) {\n                        return;\n                    }\n                    if (val == initialValue) {\n                        $(this).removeClass('editing');\n                        $(this).addClass('d-none');\n                        $(this).siblings('[data-editable]').show();\n                        return;\n                    }\n                    var id = $(this).data('id');\n                    $.ajax({\n                        url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                        method: \"POST\",\n                        dataType: \"text\",\n                        data: {\n                            action: 'quickeditfield',\n                            sesskey: M.cfg.sesskey,\n                            id: id,\n                            field: fld,\n                            contextid: M.cfg.contextid,\n                            value: fld == 'timestamp' ? seconds : val,\n                        },\n                        success: function (data) {\n                            var updated = JSON.parse(data);\n                            dispatchEvent('annotationupdated', {\n                                annotation: updated,\n                                action: 'edit'\n                            });\n                        }\n                    });\n                    return;\n                }\n            });\n\n            $(document).on('blur', '[data-field].editing', function () {\n                var initialValue = $(this).data('initial-value');\n                $(this).val(initialValue);\n                $(this).removeClass('editing');\n                $(this).addClass('d-none');\n                $(this).siblings('[data-editable]').show();\n            });\n            // End quick edit\n\n            $(document).on('click', '#end-screen #restart', function (e) {\n                e.preventDefault();\n                $('#end-screen').remove();\n                player.seek(start);\n                player.play();\n            });\n\n            $(document).on('mouseover', 'tr.annotation', function () {\n                var id = $(this).data('id');\n                $(`#video-nav ul li[data-id=\"${id}\"] .item`).trigger('mouseover');\n            });\n\n            $(document).on('mouseout', 'tr.annotation', function () {\n                var id = $(this).data('id');\n                $(`#video-nav ul li[data-id=\"${id}\"] .item`).trigger('mouseout');\n                $('.tooltip').remove();\n            });\n\n            $(document).on('mouseover', '#video-nav ul li .item', function () {\n                var id = $(this).closest('li').data('id');\n                $(`tr.annotation[data-id=\"${id}\"]`).addClass('active');\n            });\n\n            $(document).on('mouseout', '#video-nav ul li .item', function () {\n                var id = $(this).closest('li').data('id');\n                $(`tr.annotation[data-id=\"${id}\"]`).removeClass('active');\n            });\n\n            $(document).on('change', '.timestamp-input', function () {\n                $(this).removeClass('is-invalid');\n                var parts = $(this).val().split(':');\n                var seconds = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                if (!validateTimestampFormat($(this).val(), this)) {\n                    $(this).addClass('is-invalid');\n                    return;\n                }\n\n                var timestamp = validateTimeStartEnd($(this).val(), this, \"00:00:00\", seconds, true, false, true);\n\n                if (timestamp == -1) {\n                    $(this).addClass('is-invalid');\n                    return;\n                }\n            });\n\n            $('#contentmodal').on('show.bs.modal', function () {\n                $('#addcontentdropdown').addClass('modal-body');\n            });\n\n            $('#contentmodal').on('hide.bs.modal', function () {\n                $('#addcontentdropdown a').removeClass('active');\n                $('#addcontentdropdown').removeClass('modal-body');\n            });\n\n            $(document).on('click', '#fullscreen', function (e) {\n                e.preventDefault();\n                if ($(this).hasClass('fullscreen')) {\n                    $('#distractfreemodal').modal('hide');\n\n                } else {\n                    let modal = `<div class=\"modal fade p-0\" id=\"distractfreemodal\"\n                     role=\"dialog\" aria-hidden=\"true\" data-backdrop=\"static\"\n    data-keyboard=\"false\">\n    <div class=\"modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable\" role=\"document\">\n        <div class=\"modal-content rounded-0 p-3\">\n            <div class=\"modal-body px-1 px-sm-3\" id=\"distractionfreebody\">\n<div class=\"d-flex w-100 align-items-center justify-content-center mt-5\"><div class=\"spinner-grow text-secondary\"\n     style=\"width: 3rem; height: 3rem;\" role=\"status\">\n  <span class=\"sr-only\">Loading...</span>\n</div></div>\n            </div>\n        </div>\n    </div>\n</div>`;\n                    $('body').append(modal);\n                    $('#distractfreemodal').modal('show');\n\n                }\n\n                $(this).toggleClass('fullscreen');\n\n                $('#distractfreemodal').on('shown.bs.modal', function () {\n                    $('body').addClass('distractionfreemode');\n                    let $wrapper = $('#wrapper').clone();\n                    $('#distractfreemodal').find('#distractionfreebody').html($wrapper);\n                    // Remove original wrapper\n                    $('#wrapper').remove();\n                });\n                $('#distractfreemodal').on('hidden.bs.modal', function () {\n                    $('body').removeClass('distractionfreemode');\n                    let $wrapper = $('#distractfreemodal #wrapper').clone();\n                    $('[role=\"main\"]').append($wrapper);\n                    $('#distractfreemodal').remove();\n                });\n            });\n\n            $(document).on('annotationitemsrendered', function () {\n                let secondLength = $('#video-nav').width() / totaltime;\n                $('#wrapper [data-toggle=\"tooltip\"]').tooltip();\n                let targetAnnotation = null;\n                $('#video-nav .annotation.li-draggable').draggable({\n                    'containment': '#video-nav',\n                    'axis': 'x',\n                    'grid': [secondLength, 0],\n                    'start': function () {\n                        // Remove the tooltip\n                        $('.tooltip').remove();\n                        $('#seek').addClass('no-pointer-events');\n                        $(this).addClass('dragging');\n                        $(this).append('<i class=\"bi bi-grip-vertical\"></i>');\n                    },\n                    'drag': function (event, ui) {\n                        let timestamp = ((ui.position.left + 5) / $('#video-nav').width()) * totaltime + start;\n                        player.seek(Math.round(timestamp));\n                        $('.tooltip').remove();\n                    },\n                    'stop': async function (event, ui) {\n                        $(this).removeClass('dragging');\n                        $('#seek').removeClass('no-pointer-events');\n                        $(this).find('i').remove();\n                        let timestamp = ((ui.position.left + 5) / $('#video-nav').width()) * totaltime + start;\n                        player.play();\n                        player.seek(Math.round(timestamp));\n                        player.pause();\n                        $('.tooltip').remove();\n                        const id = $(this).data('id');\n                        targetAnnotation = annotations.find(x => x.id == id);\n                        let playerTime = await player.getCurrentTime();\n                        const existingAnnotation = annotations.find(x => x.timestamp == Math.round(playerTime) && x.id != id);\n                        if (existingAnnotation) {\n                            addNotification(M.util.get_string('interactionalreadyexists', 'mod_interactivevideo'), 'danger');\n                            renderAnnotationItems(annotations);\n                            return;\n                        }\n                        if (targetAnnotation.timestamp == Math.round(playerTime)) {\n                            return;\n                        }\n                        targetAnnotation.timestamp = Math.round(playerTime);\n                        dispatchEvent('annotationupdated', {\n                            annotation: targetAnnotation,\n                            action: 'edit'\n                        });\n                        // $.ajax({\n                        //     url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                        //     method: \"POST\",\n                        //     dataType: \"text\",\n                        //     data: {\n                        //         action: 'quickeditfield',\n                        //         sesskey: M.cfg.sesskey,\n                        //         id: id,\n                        //         field: 'timestamp',\n                        //         contextid: M.cfg.contextid,\n                        //         value: Math.round(playerTime),\n                        //     },\n                        //     success: function (data) {\n                        //         var updated = JSON.parse(data);\n                        //         dispatchEvent('annotationupdated', {\n                        //             annotation: updated,\n                        //             action: 'edit'\n                        //         });\n                        //     }\n                        // });\n                    }\n                });\n\n\n                $('#video-nav .annotation.skipsegment').draggable({\n                    'containment': '#video-nav',\n                    'axis': 'x',\n                    'grid': [secondLength, 0],\n                    'start': function () {\n                        $('.tooltip').remove();\n                        $('#seek').addClass('no-pointer-events');\n                    },\n                    'drag': function (event, ui) {\n                        let timestamp = ((ui.position.left) / $('#video-nav').width()) * totaltime + start;\n                        player.seek(Math.round(timestamp));\n                        $('.tooltip').remove();\n                    },\n                    'stop': async function (event, ui) {\n                        $('#seek').removeClass('no-pointer-events');\n                        $('.tooltip').remove();\n                        let timestamp = ((ui.position.left) / $('#video-nav').width()) * totaltime + start;\n                        player.play();\n                        player.seek(Math.round(timestamp));\n                        player.pause();\n                        const id = $(this).data('id');\n                        targetAnnotation = annotations.find(x => x.id == id);\n                        let playerTime = await player.getCurrentTime();\n                        const existingAnnotation = annotations.find(x => x.timestamp == Math.round(playerTime) && x.id != id);\n                        if (existingAnnotation) {\n                            addNotification(M.util.get_string('interactionalreadyexists', 'mod_interactivevideo'), 'danger');\n                            renderAnnotationItems(annotations);\n                            return;\n                        }\n                        if (targetAnnotation.timestamp == Math.round(playerTime)) {\n                            return;\n                        }\n                        const skipduration = Number(targetAnnotation.title) - Number(targetAnnotation.timestamp);\n                        targetAnnotation.timestamp = Math.floor(playerTime);\n                        targetAnnotation.title = Math.floor(playerTime) + skipduration;\n                        dispatchEvent('annotationupdated', {\n                            annotation: targetAnnotation,\n                            action: 'edit'\n                        });\n                    }\n                });\n\n                $('#video-nav .annotation.skipsegment').resizable({\n                    'containment': '#video-nav',\n                    'grid': [secondLength, 0],\n                    'handles': 'e, w',\n                    'start': function () {\n                        $('.tooltip').remove();\n                    },\n                    'resize': function (event, ui) {\n                        $('.tooltip').remove();\n                        $(this).css({\n                            'height': '10px',\n                            'top': 'unset',\n                            'opacity': '1',\n                            'background-image': 'none',\n                        });\n                        window.console.log(ui.size.width);\n                        let timestamp;\n                        if (ui.originalPosition.left != ui.position.left) {\n                            timestamp = ((ui.position.left + 5) / $('#video-nav').width()) * totaltime + start;\n                        } else {\n                            timestamp = ((ui.position.left + 5 + ui.size.width) / $('#video-nav').width()) * totaltime + start;\n                        }\n                        player.seek(Math.floor(timestamp));\n                    },\n                    'stop': async function (event, ui) {\n                        $('.tooltip').remove();\n                        const id = $(this).data('id');\n                        targetAnnotation = annotations.find(x => x.id == id);\n                        let timestamp, direction;\n                        if (ui.originalPosition.left != ui.position.left) {\n                            timestamp = ((ui.position.left + 5) / $('#video-nav').width()) * totaltime + start;\n                            direction = \"left\";\n\n                        } else {\n                            timestamp = ((ui.position.left + 5 + ui.size.width) / $('#video-nav').width()) * totaltime + start;\n                            direction = \"right\";\n                        }\n                        player.play();\n                        player.seek(Math.round(timestamp));\n                        player.pause();\n                        let playerTime = await player.getCurrentTime();\n                        const existingAnnotation = annotations.find(x => x.timestamp == Math.floor(playerTime) && x.id != id);\n                        if (existingAnnotation) {\n                            addNotification(M.util.get_string('interactionalreadyexists', 'mod_interactivevideo'), 'danger');\n                            renderAnnotationItems(annotations);\n                            return;\n                        }\n                        if (targetAnnotation.timestamp == Math.floor(playerTime)) {\n                            return;\n                        }\n                        window.console.log(targetAnnotation.title);\n                        if (direction == \"left\") {\n                            targetAnnotation.timestamp = Math.floor(playerTime);\n                        } else {\n                            targetAnnotation.title = Math.floor(playerTime);\n                        }\n                        dispatchEvent('annotationupdated', {\n                            annotation: targetAnnotation,\n                            action: 'edit'\n                        });\n                    }\n\n                });\n            });\n\n            $(document).on('click', '#video-nav .annotation', function (e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                // Check if ctrl key or command key is pressed\n                if (!e.ctrlKey && !e.metaKey) {\n                    return;\n                }\n                var timestamp = $(this).data('timestamp');\n                player.play();\n                player.seek(timestamp);\n                player.pause();\n                $('tr.annotation[data-timestamp=\"' + timestamp + '\"]').addClass('active');\n                var id = $(this).data('id');\n                var theAnnotation = annotations.find(x => x.id == id);\n                runInteraction(theAnnotation);\n            });\n        }\n    };\n});"],"names":["define","$","addToast","Notification","dispatchEvent","player","totaltime","currentTime","ctRenderer","Object","playerReady","replaceProgressBars","percentage","replaceWith","renderVideoNav","async","annos","start","length","text","empty","forEach","render","x","type","renderItemOnVideoNavigation","getCurrentTime","then","time","catch","init","url","coursemodule","interaction","course","end","coursecontextid","addNotification","msg","add","Number","isNaN","contentTypes","annotations","convertSecondsToHMS","s","hours","Math","floor","minutes","seconds","activeid","renderAnnotationItems","remove","removeClass","sort","a","b","timestamp","item","listItem","clone","renderEditItem","xp","filter","map","reduce","activeAnno","find","id","postEditCallback","html","M","util","get_string","addClass","getAnnotations","getItems","ajax","cfg","wwwroot","method","dataType","data","action","sesskey","contextid","courseContextId","getContentTypes","when","done","items","contenttypes","JSON","parse","y","name","getRenderers","Promise","resolve","count","require","amdmodule","Type","prop","stringify","validateTimestampFormat","fld","existing","test","val","validateTimeStartEnd","checkduration","checkexisting","checkskipsegment","parts","split","message","skip","annotation","title","runInteraction","pause","modal","not","onReady","getDuration","t","min","ratio","css","onEnded","append","focus","currentAnnotation","tooltip","setTimeout","onSeek","onPlayingInterval","onPlaying","intervalFunction","thisTime","isPlaying","isEnded","seek","stop","clearInterval","frequency","setInterval","onPause","VideoPlayer","document","on","e","detail","updated","originalEvent","push","trigger","preventDefault","this","contenttype","addAnnotation","closest","editAnnotation","cloneAnnotation","saveCancel","deleteAnnotation","theAnnotation","play","stopImmediatePropagation","offsetX","width","formattedTime","hide","siblings","initialValue","key","show","window","console","log","hasClass","field","value","success","toggleClass","$wrapper","secondLength","targetAnnotation","draggable","event","ui","position","left","round","playerTime","skipduration","resizable","size","originalPosition","direction","ctrlKey","metaKey"],"mappings":";;;;;;;AAsBAA,6CAAO,CAAC,SACJ,aACA,oBACA,wBACA,6CACD,SAAUC,EAAGC,SAAUC,uBAAcC,cAAEA,wBAElCC,OACAC,UACAC,YAHAC,WAAa,IAAIC,OAIjBC,aAAc,QAMZC,oBAAuBC,aACzBA,WAAaA,WAAa,IAAM,IAAMA,WACtCX,EAAE,wBAAwBY,YAAa,qCAAoCD,yBASzEE,eAAiBC,MAAOC,MAAOC,MAAOX,gBACpB,GAAhBU,MAAME,cACNjB,EAAE,8BAA8BkB,KAAK,YACrClB,EAAE,iBAAiBmB,QAIvBnB,EAAE,iBAAiBmB,QACnBJ,MAAMK,SAAQN,MAAAA,QACNO,OAASd,WAAWe,EAAEC,YACpBF,OAAOG,4BAA4BF,MAG7ClB,OAAOqB,iBAAiBC,MAAMC,OAG1BjB,qBADkBiB,KAAOX,OAASX,UAAY,QAG/CuB,OAAM,SAITzB,cAAc,0BAA2B,aAAiBY,eAMvD,CACHc,KAAM,SAAUC,IAAKC,aAAcC,YAAaC,OAAQjB,MAAOkB,IAAKC,qBAAiBZ,4DAAO,WAClFa,gBAAkB,SAACC,SAAKd,4DAAO,OACjCtB,SAASqC,IAAID,IAAK,CACdd,KAAMA,QAIdP,MAAQuB,OAAOvB,OACXwB,MAAMxB,SACNA,MAAQ,GAGZkB,IAAMK,OAAOL,KACTM,MAAMN,OACNA,IAAM,UAINO,aADAC,YAAc,SAGZC,oBAAuBC,QACrBC,MAAQC,KAAKC,MAAMH,EAAI,MACvBI,QAAUF,KAAKC,MAAMH,EAAI,KAAO,IAChCK,QAAUH,KAAKC,MAAMH,EAAI,KAAO,WAC5BC,MAAQ,GAAK,IAAMA,MAAQA,OAAS,KACvCG,QAAU,GAAK,IAAMA,QAAUA,SAAW,KAC1CC,QAAU,GAAK,IAAMA,QAAUA,cAGpCC,SAAW,WACTC,sBAAyBT,iBAC3B7B,eAAe6B,YAAa1B,MAAOX,WACnCL,EAAE,8BAA8BoD,SAChCpD,EAAE,oBAAoBmB,QAAQkC,YAAY,oDAChB,GAAtBX,YAAYzB,QAKhByB,YAAYY,MAAK,SAAUC,EAAGC,UACnBjB,OAAOgB,EAAEE,WAAalB,OAAOiB,EAAEC,cAG1Cf,YAAYtB,SAAQ,SAAUsC,UACtBC,SAAW3D,EAAE,wBAAwB4D,QACzCrD,WAAWmD,KAAKnC,MAAMsC,eAAenB,YAAaiB,SAAUD,aAG5DI,GAAKpB,YAAYqB,QAAOzC,GAAKA,EAAEwC,KAAIE,KAAI1C,GAAKiB,OAAOjB,EAAEwC,MAAKG,QAAO,CAACV,EAAGC,IAAMD,EAAIC,GAAG,MACtFxD,EAAE,YAAYkB,KAAK4C,IAEfZ,SAAU,KACNgB,WAAaxB,YAAYyB,MAAK7C,GAAKA,EAAE8C,IAAMlB,WAC3CgB,YACA3D,WAAW2D,WAAW3C,MAAM8C,iBAAiBH,kBAnBjDlE,EAAE,oBAAoBsE,KAAM,GAAEC,EAAEC,KAAKC,WAAW,2BAA4B,2BACvEC,SAAS,qDAuBhBC,eAAiB,WACbC,SAAW5E,EAAE6E,KAAK,CACpB/C,IAAKyC,EAAEO,IAAIC,QAAU,iCACrBC,OAAQ,OACRC,SAAU,OACVC,KAAM,CACFC,OAAQ,YACRC,QAASb,EAAEO,IAAIM,QACfhB,GAAIpC,YACJqD,UAAWd,EAAEO,IAAIQ,mBAInBC,gBAAkBvF,EAAE6E,KAAK,CAC3B/C,IAAKyC,EAAEO,IAAIC,QAAU,iCACrBC,OAAQ,OACRC,SAAU,OACVC,KAAM,CACFC,OAAQ,qBACRC,QAASb,EAAEO,IAAIM,WAIvBpF,EAAEwF,KAAKZ,SAAUW,iBAAiBE,MAAK,SAAUC,MAAOC,cACpDjD,YAAckD,KAAKC,MAAMH,MAAM,IAC/BjD,aAAemD,KAAKC,MAAMF,aAAa,IAEvCjD,YAAcA,YAAYqB,QAAOzC,GAAKmB,aAAa0B,MAAK2B,GAAKA,EAAEC,OAASzE,EAAEC,eACpEyE,aAAe,IAAIC,SAASC,cAC1BC,MAAQ,EACZ1D,aAAarB,SAAQE,IACjB8E,QAAQ,CAAC,GAAK9E,EAAE+E,YAAY,SAAUC,MAClC/F,WAAWe,EAAEyE,MAAQ,IAAIO,KAAKlG,OAAQsC,YAAaV,YAC/CC,OAAQ,EAAG,EAAG,EAAG,EAAGV,KAAM,EAAGlB,UAAWW,MAAOkB,IAAKZ,EAAGS,gBAC3DoE,OACa1D,aAAaxB,QACtBiF,QAAQ3F,qBAKxBmC,YAAYsB,KAAI1C,IACZA,EAAEiF,KAAOX,KAAKY,UAAU/D,aAAa0B,MAAK2B,GAAKA,EAAEC,OAASzE,EAAEC,QACrDD,KAEX0E,aAAatE,MAAK,KACdyB,sBAAsBT,gBAEvBd,OAAM,aAMX6E,wBAA0B,CAAChD,UAAWiD,IAAKC,aACjC,yCACDC,KAAKnD,aACZrB,gBAAgBmC,EAAEC,KAAKC,WAAW,yBAA0B,wBAAyB,UACjFkC,SACA3G,EAAE0G,KAAKG,IAAIF,UAEX3G,EAAE0G,KAAKG,IAAIlE,oBAAoB3B,SAE5B,GAKT8F,qBAAuB,CAACrD,UAAWiD,IAAKC,SAAU1D,QAAS8D,cAC7DC,cAAeC,wBAEXC,MAAQzD,UAAU0D,MAAM,QAC5B1D,UAA+B,KAAnBlB,OAAO2E,MAAM,IAAgC,GAAnB3E,OAAO2E,MAAM,IAAW3E,OAAO2E,MAAM,IAEvEH,gBACItD,UAAYvB,KAAOuB,UAAYzC,OAAO,KAClCoG,QAAU7C,EAAEC,KAAKC,WAAW,mCAAoC,uBAAwB,OAC/E9B,oBAAoB3B,WACtB2B,oBAAoBT,cAE/BE,gBAAgBgF,QAAS,UACrBT,SACA3G,EAAE0G,KAAKG,IAAIF,UAEX3G,EAAE0G,KAAKG,IAAIlE,oBAAoB3B,SAE3B,KAKZgG,eACItE,YAAYyB,MAAK7C,GAAKA,EAAEmC,WAAaA,aAAcA,WAAaR,eAChEb,gBAAgBmC,EAAEC,KAAKC,WAAW,2BAA4B,wBAAyB,UACnFkC,SACA3G,EAAE0G,KAAKG,IAAIF,UAEX3G,EAAE0G,KAAKG,IAAIlE,oBAAoB3B,SAE3B,KAKZiG,iBAAkB,KAEdI,KADe3E,YAAYqB,QAAQuD,YAAkC,eAAnBA,WAAW/F,OACzC4C,MAAK7C,GAAKiB,OAAOjB,EAAEmC,WAAalB,OAAOkB,YACxDlB,OAAOjB,EAAEiG,OAAShF,OAAOkB,gBAC5B4D,YACAjF,gBAAgBmC,EAAEC,KAAKC,WAAW,qCAAsC,uBAAwB,OACnF9B,oBAAoB0E,KAAK5D,eAC3Bd,oBAAoB0E,KAAKE,SAChC,UACAZ,SACA3G,EAAE0G,KAAKG,IAAIF,UAEX3G,EAAE0G,KAAKG,IAAIlE,oBAAoB3B,SAE3B,SAITyC,WAIL+D,eAAkBF,aACpBlH,OAAOqH,QAEPzH,EAAE,qBAAqB0H,MAAM,QAC7B1H,EAAE,YAAY2H,IAAI,2BAA2BvE,SAC7CpD,EAAE,eAAeoD,SACE7C,WAAW+G,WAAW/F,MAC5BiG,eAAeF,aAG1BM,QAAU,KACGxH,OAAOyH,cACbnG,MAAKoG,IAIN5F,IAHCA,IAGKY,KAAKiF,IAAI7F,IAAK4F,GAFdA,EAKN9G,MAAQkB,MACRlB,MAAQ,GAGZX,UAAY6B,IAAMlB,MAElBZ,OAAO4H,QAAQtG,MAAMsG,QACjBhI,EAAE,kBAAkBiI,IAAI,iBAAmB,EAAID,MAAS,IAAM,QAElEvH,aAAc,EACdT,EAAE,cAAckB,KAAK,IAAMyB,oBAAoB3B,OAAS,MAAQ2B,oBAAoBT,KAAO,KACpFyC,oBACR/C,OAAM,UAKPsG,QAAU,KACZ9H,OAAOqH,QAEPzH,EAAE,kBAAkBmI,OAAQ,uXAI5BnI,EAAE,wBAAwBiI,IAAI,QAAS,QAEvCjI,EAAE,qBAAqBoI,YAGnBC,kBAAoB3F,YAAYyB,MAAMmD,YAAeA,WAAW7D,WAAavB,MAC7EmG,oBACArI,EAAE,uBAAuBqD,YAAY,UACrCrD,EAAG,eAAcqI,kBAAkBjE,QAAQM,SAAS,UAIpD1E,EAAE,mCAAqCqI,kBAAkBjE,GAAK,YAAYkE,QAAQ,QAElFC,YAAW,WACPvI,EAAE,mCAAqCqI,kBAAkBjE,GAAK,YAAYkE,QAAQ,UACnF,OAILE,OAAS1H,MAAAA,QAMPH,aAJAmH,EADAA,EACIvF,OAAOuF,SAED1H,OAAOqB,kBAECT,OAAUX,UAAa,WACtCL,EAAE,wBAAwBiI,IAAI,QAAStH,WAAa,UAG3D8H,wBACEC,UAAY,KACd1I,EAAE,yBAAyBoD,aACvBuF,iBAAmB7H,qBACf8H,eAAiBxI,OAAOqB,iBACxBoH,gBAAkBzI,OAAOyI,YACzBC,cAAgB1I,OAAO0I,aACtBD,YAAaC,YAKdF,SAAW5H,QACXZ,OAAO2I,KAAK/H,OACZ4H,SAAW5H,OAGX4H,UAAY1G,WACZ9B,OAAO4I,KAAK9G,KACZ+G,cAAcR,wBACdP,cAIAvH,YAAciI,SAAW5H,OAAUX,UAAa,IACpDL,EAAE,wBAAwBiI,IAAI,QAAStH,WAAa,SAGhD0H,kBAAoB3F,YAAYyB,MAAK7C,GAAMsH,SAAWxI,OAAO8I,WAAc5H,EAAEmC,WACzEmF,SAAWxI,OAAO8I,WAAc5H,EAAEmC,YACtC4E,oBACArI,EAAE,uBAAuBqD,YAAY,UACrCrD,EAAG,eAAcqI,kBAAkBjE,QAAQM,SAAS,UAIpD1E,EAAE,mCAAqCqI,kBAAkBjE,GAAK,YAAYkE,QAAQ,QAElFC,YAAW,WACPvI,EAAE,mCAAqCqI,kBAAkBjE,GAAK,YAAYkE,QAAQ,UACnF,UAKHjB,KADe3E,YAAYqB,QAAQuD,YAAkC,eAAnBA,WAAW/F,OACzC4C,MAAK7C,GAAKiB,OAAOjB,EAAEmC,WAAalB,OAAOqG,WACxDrG,OAAOjB,EAAEiG,OAAShF,OAAOqG,YAC5BvB,OACAjH,OAAO2I,KAAKxG,OAAO8E,KAAKE,QAExB5G,YAAc0G,KAAKE,MAAQvG,OAASX,UAAY,IAChDK,oBAAoBC,kBA3CpBsI,cAAcR,oBA8CH,MAAfrI,OAAOmB,MAA+B,UAAfnB,OAAOmB,KAC9BkH,kBAAoBU,YAAYR,iBAAkB,KAElDA,oBAIFS,QAAU,KACZH,cAAcR,oBAIlBrC,QAAQ,CAAC,+BAAiC7E,OAAO,SAAU8H,aACvDjJ,OAAS,IAAIiJ,YACTvH,IACAd,MACAkB,KACA,GACA,MAIRlC,EAAEsJ,UAAUC,GAAG,kBAAkB,WAC7B3B,aAGJ5H,EAAEsJ,UAAUC,GAAG,mBAAmB,WAC9BH,aAGJpJ,EAAEsJ,UAAUC,GAAG,oBAAoB,WAC/Bb,eAGJ1I,EAAEsJ,UAAUC,GAAG,kBAAkB,WAC7BrB,aAGJlI,EAAEsJ,UAAUC,GAAG,iBAAiB,SAAUC,GACtChB,OAAOgB,EAAEC,OAAO9H,SAGpB3B,EAAEsJ,UAAUC,GAAG,qBAAqB,SAAUC,OACtCE,QAAUF,EAAEG,cAAcF,OAAOnC,WACjCnC,OAASqE,EAAEG,cAAcF,OAAOtE,OACtB,QAAVA,SACAzC,YAAcA,YAAYqB,QAAO,SAAUL,aAChCA,KAAKU,IAAMsF,QAAQtF,OAGlCsF,QAAQnD,KAAOX,KAAKY,UAAU/D,aAAa0B,MAAK7C,GAAKA,EAAEyE,OAAS2D,QAAQnI,QACxEmB,YAAYkH,KAAKF,SAEbxG,SADU,OAAViC,OACWuE,QAAQtF,GAER,KAGfjB,sBAAsBT,aACR,OAAVyC,QAA6B,SAAVA,QACnB/C,gBAAgBmC,EAAEC,KAAKC,WAAW,mBAAoB,wBAAyB,WAC/EzE,EAAG,eAAc0J,QAAQtF,QAAQM,SAAS,UAC5B,SAAVS,QACAoD,YAAW,WACPvI,EAAG,eAAc0J,QAAQtF,QAAQD,KAAM,+BAA8B0F,QAAQ,iBAC9E,MAEU,QAAV1E,SACP/C,gBAAgBmC,EAAEC,KAAKC,WAAW,qBAAsB,wBAAyB,WACjFzE,EAAG,eAAc0J,QAAQtF,QAAQM,SAAS,UAC1C6D,YAAW,WACPvI,EAAG,eAAc0J,QAAQtF,QAAQf,YAAY,YAC9C,UAKXrD,EAAEsJ,UAAUC,GAAG,QAAS,yBAAyBzI,eAAgB0I,MACxD/I,aAGL+I,EAAEM,iBACF9J,EAAE,yBAAyBqD,YAAY,UACvCrD,EAAE+J,MAAMrF,SAAS,cACbsF,YAAchK,EAAE+J,MAAM7E,KAAK,QAC/B9E,OAAOqH,YACHhE,UAAYnD,mBAAqBF,OAAOqB,iBAC5CgC,UAAYX,KAAKC,MAAMU,WACvBnD,YAAc,KACdC,WAAWyJ,aAAaC,cAAcvH,YAAae,UAAW1B,kBAIlE/B,EAAEsJ,UAAUC,GAAG,QAAS,YAAY,SAAUC,GAC1CA,EAAEM,qBACErG,UAAYzD,EAAE+J,MAAMG,QAAQ,eAAehF,KAAK,aAChDzB,WACArD,OAAO2I,KAAKtF,WAAW,GAG3BrD,OAAOqH,YACHrD,GAAKpE,EAAE+J,MAAMG,QAAQ,eAAehF,KAAK,MACzC8E,YAAchK,EAAE+J,MAAMG,QAAQ,eAAehF,KAAK,QACtD3E,WAAWyJ,aAAaG,eAAezH,YAAa0B,GAAIrC,iBAI5D/B,EAAEsJ,UAAUC,GAAG,QAAS,YAAY,SAAUC,GAC1CA,EAAEM,qBACE1F,GAAKpE,EAAE+J,MAAMG,QAAQ,eAAehF,KAAK,MACzC8E,YAAchK,EAAE+J,MAAMG,QAAQ,eAAehF,KAAK,QACtD3E,WAAWyJ,aAAaI,gBAAgBhG,OAG5CpE,EAAEsJ,UAAUC,GAAG,qBAAqB,SAAUC,OACtClC,WAAakC,EAAEG,cAAcF,OAAOnC,WACxCpE,SAAW,KACXlD,EAAG,eAAcsH,WAAWlD,QAAQM,SAAS,WAC7C6D,YAAW,WACP7F,YAAcA,YAAYqB,QAAO,SAAUL,aAChCA,KAAKU,IAAMkD,WAAWlD,MAEjCjB,sBAAsBT,aACtBN,gBAAgBmC,EAAEC,KAAKC,WAAW,qBAAsB,wBAAyB,aAClF,QAIPzE,EAAEsJ,UAAUC,GAAG,QAAS,WAAW,SAAUC,GACzCA,EAAEM,iBACF1J,OAAOqH,YACHrD,GAAKpE,EAAE+J,MAAMG,QAAQ,eAAehF,KAAK,MACzCoC,WAAa5E,YAAYyB,MAAK7C,GAAKA,EAAE8C,IAAMA,KAC/ClE,aAAamK,WACT9F,EAAEC,KAAKC,WAAW,oBAAqB,wBACvCF,EAAEC,KAAKC,WAAW,2BAA4B,wBAC9CF,EAAEC,KAAKC,WAAW,SAAU,yBAC5B,WACIlE,WAAW+G,WAAW/F,MAAM+I,iBAAiB5H,YAAa0B,MAE9D,SAMRpE,EAAEsJ,UAAUC,GAAG,QAAS,sBAAsB,SAAUC,GACpDA,EAAEM,qBACErG,UAAYzD,EAAE+J,MAAMG,QAAQ,eAAehF,KAAK,aACpD9E,OAAO2I,KAAKtF,WAAW,GACvBrD,OAAOqH,QAIP/G,qBADkB+C,UAAYzC,OAASX,UAAY,SAG/C+D,GAAKpE,EAAE+J,MAAMG,QAAQ,eAAehF,KAAK,MAEzCqF,cAAgB7H,YAAYyB,MAAK7C,GAAKA,EAAE8C,IAAMA,KAElDoD,eAAe+C,kBAInBvK,EAAEsJ,UAAUC,GAAG,QAAS,cAAc,SAAUC,GAC5CA,EAAEM,qBACErG,UAAYzD,EAAE+J,MAAM7E,KAAK,aAC7B9E,OAAO2I,KAAKtF,WACZrD,OAAOoK,UAIXxK,EAAEsJ,UAAUC,GAAG,YAAa,oBAAoB,SAAUC,MACjD/I,aAGL+I,EAAEM,iBACFN,EAAEiB,+BACE9J,WAAa6I,EAAEkB,QAAU1K,EAAE+J,MAAMY,QACjChJ,KAAOmB,KAAKC,MAAMpC,WAAcN,UAAaW,OAC7C4J,cAAgBjI,oBAAoBhB,MACxC3B,EAAE,YAAYoD,SACdpD,EAAE,6BAA6BoD,SAE/BpD,EAAE,oBAAoBmI,OAAQ,mKAC6CyC,yDACtC,IAAbjK,qCACxBX,EAAE,YAAYsI,QAAQ,YAG1BtI,EAAEsJ,UAAUC,GAAG,aAAc,oBAAoB,SAAUC,GAClD/I,cAGL+I,EAAEM,iBACFN,EAAEiB,2BACFzK,EAAE,6BAA6BoD,SAC/BpD,EAAE,YAAYoD,aAGlBpD,EAAEsJ,UAAUC,GAAG,QAAS,cAAczI,eAAgB0I,MAC7C/I,aAGL+I,EAAEM,qBACEnJ,WAAa6I,EAAEkB,QAAU1K,EAAE+J,MAAMY,QAErCjK,oBAAiC,IAAbC,YACpBP,OAAOoK,OACPpK,OAAO2I,KAAMpI,WAAaN,UAAaW,OACvCZ,OAAOqH,QACPzH,EAAE,yBAAyBoD,aAG/BpD,EAAEsJ,UAAUC,GAAG,cAAe,cAAc,SAAUC,MAC7C/I,aAGL+I,EAAEM,iBACFN,EAAEiB,+BACE9J,WAAa6I,EAAEkB,QAAU1K,EAAE+J,MAAMY,QACrCjK,oBAAiC,IAAbC,YACpBL,YAAcwC,KAAKC,MAAMpC,WAAaN,WAAaW,MACnDZ,OAAO2I,KAAKzI,aACZF,OAAOqH,QACPzH,EAAE,eAAe6J,QAAQ,aAI7B7J,EAAEsJ,UAAUC,GAAG,cAAe,0BAA0B,SAAUC,GAC9DA,EAAEM,iBACFN,EAAEiB,+BACErG,GAAKpE,EAAE+J,MAAM7E,KAAK,MAEtBlF,EAAG,0BAAyBoE,cAAcyF,QAAQ,YAItD7J,EAAEsJ,UAAUC,GAAG,cAAe,mBAAmB,SAAUC,MACvDA,EAAEM,iBACFN,EAAEiB,6BACEzK,EAAE,wBAAwBiB,OAAS,QAGnCyF,IAAM1G,EAAE+J,MAAM7E,KAAK,YACvBlF,EAAE+J,MAAMc,OACR7K,EAAE+J,MAAMe,SAAS,gBAAkBpE,IAAM,MAAMrD,YAAY,UAAU+E,QAAQ1D,SAAS,eAG1F1E,EAAEsJ,UAAUC,GAAG,QAAS,wBAAwB,SAAUC,GACtDxJ,EAAE+J,MAAM1G,YAAY,kBAChB0H,aAAe/K,EAAE+J,MAAM7E,KAAK,iBAC5B2B,IAAM7G,EAAE+J,MAAMlD,MACdH,IAAM1G,EAAE+J,MAAM7E,KAAK,YACZ,IAAP2B,KACA7G,EAAE+J,MAAMrF,SAAS,cAIR,UAAT8E,EAAEwB,WACFhL,EAAE+J,MAAMlD,IAAIkE,cACZ/K,EAAE+J,MAAM1G,YAAY,WACpBrD,EAAE+J,MAAMrF,SAAS,eACjB1E,EAAE+J,MAAMe,SAAS,mBAAmBG,UAI3B,SAATzB,EAAEwB,cACE/H,WACO,aAAPyD,IAAoB,KAChBQ,MAAQ6D,aAAa5D,MAAM,QAC/BlE,QAA6B,KAAnBV,OAAO2E,MAAM,IAAgC,GAAnB3E,OAAO2E,MAAM,IAAW3E,OAAO2E,MAAM,KACpET,wBAAwBI,IAAK,uBAAwBkE,0BACtD/K,EAAE+J,MAAMrF,SAAS,kBAGjBjB,UAAYqD,qBAAqBD,IAAK,uBAAwBkE,aAAc9H,SAC5E,GAAM,GAAM,OACE,GAAdQ,iBACAyH,OAAOC,QAAQC,IAAI,YACnBpL,EAAE+J,MAAMrF,SAAS,cAGrBzB,QAAUQ,aAGVzD,EAAE+J,MAAMsB,SAAS,wBAGjBxE,KAAOkE,oBACP/K,EAAE+J,MAAM1G,YAAY,WACpBrD,EAAE+J,MAAMrF,SAAS,eACjB1E,EAAE+J,MAAMe,SAAS,mBAAmBG,WAGpC7G,GAAKpE,EAAE+J,MAAM7E,KAAK,MACtBlF,EAAE6E,KAAK,CACH/C,IAAKyC,EAAEO,IAAIC,QAAU,iCACrBC,OAAQ,OACRC,SAAU,OACVC,KAAM,CACFC,OAAQ,iBACRC,QAASb,EAAEO,IAAIM,QACfhB,GAAIA,GACJkH,MAAO5E,IACPrB,UAAWd,EAAEO,IAAIO,UACjBkG,MAAc,aAAP7E,IAAqBzD,QAAU4D,KAE1C2E,QAAS,SAAUtG,UACXwE,QAAU9D,KAAKC,MAAMX,MACzB/E,cAAc,oBAAqB,CAC/BmH,WAAYoC,QACZvE,OAAQ,gBAQ5BnF,EAAEsJ,UAAUC,GAAG,OAAQ,wBAAwB,eACvCwB,aAAe/K,EAAE+J,MAAM7E,KAAK,iBAChClF,EAAE+J,MAAMlD,IAAIkE,cACZ/K,EAAE+J,MAAM1G,YAAY,WACpBrD,EAAE+J,MAAMrF,SAAS,UACjB1E,EAAE+J,MAAMe,SAAS,mBAAmBG,UAIxCjL,EAAEsJ,UAAUC,GAAG,QAAS,wBAAwB,SAAUC,GACtDA,EAAEM,iBACF9J,EAAE,eAAeoD,SACjBhD,OAAO2I,KAAK/H,OACZZ,OAAOoK,UAGXxK,EAAEsJ,UAAUC,GAAG,YAAa,iBAAiB,eACrCnF,GAAKpE,EAAE+J,MAAM7E,KAAK,MACtBlF,EAAG,6BAA4BoE,cAAcyF,QAAQ,gBAGzD7J,EAAEsJ,UAAUC,GAAG,WAAY,iBAAiB,eACpCnF,GAAKpE,EAAE+J,MAAM7E,KAAK,MACtBlF,EAAG,6BAA4BoE,cAAcyF,QAAQ,YACrD7J,EAAE,YAAYoD,YAGlBpD,EAAEsJ,UAAUC,GAAG,YAAa,0BAA0B,eAC9CnF,GAAKpE,EAAE+J,MAAMG,QAAQ,MAAMhF,KAAK,MACpClF,EAAG,0BAAyBoE,QAAQM,SAAS,aAGjD1E,EAAEsJ,UAAUC,GAAG,WAAY,0BAA0B,eAC7CnF,GAAKpE,EAAE+J,MAAMG,QAAQ,MAAMhF,KAAK,MACpClF,EAAG,0BAAyBoE,QAAQf,YAAY,aAGpDrD,EAAEsJ,UAAUC,GAAG,SAAU,oBAAoB,WACzCvJ,EAAE+J,MAAM1G,YAAY,kBAChB6D,MAAQlH,EAAE+J,MAAMlD,MAAMM,MAAM,KAC5BlE,QAA6B,KAAnBV,OAAO2E,MAAM,IAAgC,GAAnB3E,OAAO2E,MAAM,IAAW3E,OAAO2E,MAAM,IACxET,wBAAwBzG,EAAE+J,MAAMlD,MAAOkD,OAO1B,GAFFjD,qBAAqB9G,EAAE+J,MAAMlD,MAAOkD,KAAM,WAAY9G,SAAS,GAAM,GAAO,IAGxFjD,EAAE+J,MAAMrF,SAAS,cAPjB1E,EAAE+J,MAAMrF,SAAS,iBAYzB1E,EAAE,iBAAiBuJ,GAAG,iBAAiB,WACnCvJ,EAAE,uBAAuB0E,SAAS,iBAGtC1E,EAAE,iBAAiBuJ,GAAG,iBAAiB,WACnCvJ,EAAE,yBAAyBqD,YAAY,UACvCrD,EAAE,uBAAuBqD,YAAY,iBAGzCrD,EAAEsJ,UAAUC,GAAG,QAAS,eAAe,SAAUC,MAC7CA,EAAEM,iBACE9J,EAAE+J,MAAMsB,SAAS,cACjBrL,EAAE,sBAAsB0H,MAAM,YAE3B,KACCA,MAAS,iqBAcb1H,EAAE,QAAQmI,OAAOT,OACjB1H,EAAE,sBAAsB0H,MAAM,QAIlC1H,EAAE+J,MAAM0B,YAAY,cAEpBzL,EAAE,sBAAsBuJ,GAAG,kBAAkB,WACzCvJ,EAAE,QAAQ0E,SAAS,2BACfgH,SAAW1L,EAAE,YAAY4D,QAC7B5D,EAAE,sBAAsBmE,KAAK,wBAAwBG,KAAKoH,UAE1D1L,EAAE,YAAYoD,YAElBpD,EAAE,sBAAsBuJ,GAAG,mBAAmB,WAC1CvJ,EAAE,QAAQqD,YAAY,2BAClBqI,SAAW1L,EAAE,+BAA+B4D,QAChD5D,EAAE,iBAAiBmI,OAAOuD,UAC1B1L,EAAE,sBAAsBoD,eAIhCpD,EAAEsJ,UAAUC,GAAG,2BAA2B,eAClCoC,aAAe3L,EAAE,cAAc2K,QAAUtK,UAC7CL,EAAE,oCAAoCsI,cAClCsD,iBAAmB,KACvB5L,EAAE,uCAAuC6L,UAAU,aAChC,kBACP,SACA,CAACF,aAAc,SACd,WAEL3L,EAAE,YAAYoD,SACdpD,EAAE,SAAS0E,SAAS,qBACpB1E,EAAE+J,MAAMrF,SAAS,YACjB1E,EAAE+J,MAAM5B,OAAO,6CAEX,SAAU2D,MAAOC,QACjBtI,WAAcsI,GAAGC,SAASC,KAAO,GAAKjM,EAAE,cAAc2K,QAAWtK,UAAYW,MACjFZ,OAAO2I,KAAKjG,KAAKoJ,MAAMzI,YACvBzD,EAAE,YAAYoD,eAEVtC,eAAgBgL,MAAOC,IAC3B/L,EAAE+J,MAAM1G,YAAY,YACpBrD,EAAE,SAASqD,YAAY,qBACvBrD,EAAE+J,MAAM5F,KAAK,KAAKf,aACdK,WAAcsI,GAAGC,SAASC,KAAO,GAAKjM,EAAE,cAAc2K,QAAWtK,UAAYW,MACjFZ,OAAOoK,OACPpK,OAAO2I,KAAKjG,KAAKoJ,MAAMzI,YACvBrD,OAAOqH,QACPzH,EAAE,YAAYoD,eACRgB,GAAKpE,EAAE+J,MAAM7E,KAAK,MACxB0G,iBAAmBlJ,YAAYyB,MAAK7C,GAAKA,EAAE8C,IAAMA,SAC7C+H,iBAAmB/L,OAAOqB,oBACHiB,YAAYyB,MAAK7C,GAAKA,EAAEmC,WAAaX,KAAKoJ,MAAMC,aAAe7K,EAAE8C,IAAMA,YAE9FhC,gBAAgBmC,EAAEC,KAAKC,WAAW,2BAA4B,wBAAyB,eACvFtB,sBAAsBT,aAGtBkJ,iBAAiBnI,WAAaX,KAAKoJ,MAAMC,cAG7CP,iBAAiBnI,UAAYX,KAAKoJ,MAAMC,YACxChM,cAAc,oBAAqB,CAC/BmH,WAAYsE,iBACZzG,OAAQ,aA0BpBnF,EAAE,sCAAsC6L,UAAU,aAC/B,kBACP,SACA,CAACF,aAAc,SACd,WACL3L,EAAE,YAAYoD,SACdpD,EAAE,SAAS0E,SAAS,2BAEhB,SAAUoH,MAAOC,QACjBtI,UAAcsI,GAAGC,SAASC,KAAQjM,EAAE,cAAc2K,QAAWtK,UAAYW,MAC7EZ,OAAO2I,KAAKjG,KAAKoJ,MAAMzI,YACvBzD,EAAE,YAAYoD,eAEVtC,eAAgBgL,MAAOC,IAC3B/L,EAAE,SAASqD,YAAY,qBACvBrD,EAAE,YAAYoD,aACVK,UAAcsI,GAAGC,SAASC,KAAQjM,EAAE,cAAc2K,QAAWtK,UAAYW,MAC7EZ,OAAOoK,OACPpK,OAAO2I,KAAKjG,KAAKoJ,MAAMzI,YACvBrD,OAAOqH,cACDrD,GAAKpE,EAAE+J,MAAM7E,KAAK,MACxB0G,iBAAmBlJ,YAAYyB,MAAK7C,GAAKA,EAAE8C,IAAMA,SAC7C+H,iBAAmB/L,OAAOqB,oBACHiB,YAAYyB,MAAK7C,GAAKA,EAAEmC,WAAaX,KAAKoJ,MAAMC,aAAe7K,EAAE8C,IAAMA,YAE9FhC,gBAAgBmC,EAAEC,KAAKC,WAAW,2BAA4B,wBAAyB,eACvFtB,sBAAsBT,gBAGtBkJ,iBAAiBnI,WAAaX,KAAKoJ,MAAMC,yBAGvCC,aAAe7J,OAAOqJ,iBAAiBrE,OAAShF,OAAOqJ,iBAAiBnI,WAC9EmI,iBAAiBnI,UAAYX,KAAKC,MAAMoJ,YACxCP,iBAAiBrE,MAAQzE,KAAKC,MAAMoJ,YAAcC,aAClDjM,cAAc,oBAAqB,CAC/BmH,WAAYsE,iBACZzG,OAAQ,YAKpBnF,EAAE,sCAAsCqM,UAAU,aAC/B,kBACP,CAACV,aAAc,WACZ,aACF,WACL3L,EAAE,YAAYoD,iBAER,SAAU0I,MAAOC,QASnBtI,UARJzD,EAAE,YAAYoD,SACdpD,EAAE+J,MAAM9B,IAAI,QACE,WACH,gBACI,uBACS,SAExBiD,OAAOC,QAAQC,IAAIW,GAAGO,KAAK3B,OAGvBlH,UADAsI,GAAGQ,iBAAiBN,MAAQF,GAAGC,SAASC,MAC1BF,GAAGC,SAASC,KAAO,GAAKjM,EAAE,cAAc2K,QAAWtK,UAAYW,OAE/D+K,GAAGC,SAASC,KAAO,EAAIF,GAAGO,KAAK3B,OAAS3K,EAAE,cAAc2K,QAAWtK,UAAYW,MAEjGZ,OAAO2I,KAAKjG,KAAKC,MAAMU,kBAEnB3C,eAAgBgL,MAAOC,IAC3B/L,EAAE,YAAYoD,eACRgB,GAAKpE,EAAE+J,MAAM7E,KAAK,UAEpBzB,UAAW+I,UADfZ,iBAAmBlJ,YAAYyB,MAAK7C,GAAKA,EAAE8C,IAAMA,KAE7C2H,GAAGQ,iBAAiBN,MAAQF,GAAGC,SAASC,MACxCxI,WAAcsI,GAAGC,SAASC,KAAO,GAAKjM,EAAE,cAAc2K,QAAWtK,UAAYW,MAC7EwL,UAAY,SAGZ/I,WAAcsI,GAAGC,SAASC,KAAO,EAAIF,GAAGO,KAAK3B,OAAS3K,EAAE,cAAc2K,QAAWtK,UAAYW,MAC7FwL,UAAY,SAEhBpM,OAAOoK,OACPpK,OAAO2I,KAAKjG,KAAKoJ,MAAMzI,YACvBrD,OAAOqH,YACH0E,iBAAmB/L,OAAOqB,oBACHiB,YAAYyB,MAAK7C,GAAKA,EAAEmC,WAAaX,KAAKC,MAAMoJ,aAAe7K,EAAE8C,IAAMA,YAE9FhC,gBAAgBmC,EAAEC,KAAKC,WAAW,2BAA4B,wBAAyB,eACvFtB,sBAAsBT,aAGtBkJ,iBAAiBnI,WAAaX,KAAKC,MAAMoJ,cAG7CjB,OAAOC,QAAQC,IAAIQ,iBAAiBrE,OACnB,QAAbiF,UACAZ,iBAAiBnI,UAAYX,KAAKC,MAAMoJ,YAExCP,iBAAiBrE,MAAQzE,KAAKC,MAAMoJ,YAExChM,cAAc,oBAAqB,CAC/BmH,WAAYsE,iBACZzG,OAAQ,gBAOxBnF,EAAEsJ,UAAUC,GAAG,QAAS,0BAA0B,SAAUC,MACxDA,EAAEM,iBACFN,EAAEiB,2BAEGjB,EAAEiD,SAAYjD,EAAEkD,aAGjBjJ,UAAYzD,EAAE+J,MAAM7E,KAAK,aAC7B9E,OAAOoK,OACPpK,OAAO2I,KAAKtF,WACZrD,OAAOqH,QACPzH,EAAE,iCAAmCyD,UAAY,MAAMiB,SAAS,cAC5DN,GAAKpE,EAAE+J,MAAM7E,KAAK,MAClBqF,cAAgB7H,YAAYyB,MAAK7C,GAAKA,EAAE8C,IAAMA,KAClDoD,eAAe+C"}