define("ivplugin_pdfviewer/main",["exports","jquery","ivplugin_iframe/main"],(function(_exports,_jquery,_main){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * TODO describe module main
   *
   * @module     ivplugin_pdfviewer/main
   * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_main=_interopRequireDefault(_main);class PdfViewer extends _main.default{renderContainer(annotation){let $message=(0,_jquery.default)(`#message[data-id='${annotation.id}']`);$message.addClass("hasiframe"),annotation.completiontracking&&"scrolltolastpage"==annotation.completiontracking&&($message.find("#completiontoggle").prop("disabled",!0),1==annotation.completed?$message.find("#completiontoggle span").text(`${M.util.get_string("completioncompleted","mod_interactivevideo")}`):$message.find("#completiontoggle span").text(`${M.util.get_string("completionincomplete","mod_interactivevideo")}`))}postContentRenderEditor(modal){modal.getRoot().addClass("modalhasiframe");var interval=setInterval((()=>{(0,_jquery.default)(".modalhasiframe iframe").length>0&&((0,_jquery.default)(".modalhasiframe .modal-body iframe").on("load",(function(){setTimeout((()=>{(0,_jquery.default)(".modalhasiframe .modal-body iframe").css("background","none")}))})),clearInterval(interval))}),1e3)}async runInteraction(annotation){this.player.pause();let self=this;await this.renderViewer(annotation),this.renderContainer(annotation),(async annotation=>{const data=await this.render(annotation,"html");(0,_jquery.default)(`#message[data-id='${annotation.id}'] .modal-body`).attr("id","content").html(data).fadeIn(300),annotation.completed?this.postContentRender(annotation):"scrolltolastpage"==annotation.completiontracking&&0==annotation.completed&&this.postContentRender(annotation,(annotation=>{var iframeinterval=setInterval((()=>{var pdf,iframe=document.querySelector(`#message[data-id='${annotation.id}'] iframe`);try{pdf=iframe.contentWindow.PDFViewerApplication.pdfViewer}catch(e){pdf=null}pdf&&(clearInterval(iframeinterval),1==pdf.pagesCount?self.toggleCompletion(annotation.id,"mark-done","automatic"):pdf.eventBus.on("pagechanging",(function(e){e.pageNumber!=pdf.pagesCount||annotation.completed||(self.toggleCompletion(annotation.id,"mark-done","automatic"),annotation.completed=!0)})))}),1e3)})(annotation))})(annotation),this.enableManualCompletion(),"popup"==annotation.displayoptions&&(0,_jquery.default)("#annotation-modal").on("shown.bs.modal",(function(){self.setModalDraggable("#annotation-modal .modal-dialog")}))}}return _exports.default=PdfViewer,_exports.default}));

//# sourceMappingURL=main.min.js.map