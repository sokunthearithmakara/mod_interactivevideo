{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module main\n *\n * @module     ivplugin_inlineannotation/main\n * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport Base from 'mod_interactivevideo/type/base';\nimport {dispatchEvent} from 'core/event_dispatcher';\nimport ModalForm from 'core_form/modalform';\nimport Templates from 'core/templates';\nimport {notifyFilterContentUpdated as notifyFilter} from 'core_filters/events';\nexport default class InlineAnnotation extends Base {\n    postEditCallback() {\n        // Do nothing\n    }\n\n    renderContainer(annotation) {\n        const videoWrapper = $('#video-wrapper');\n        videoWrapper.find('#message').remove();\n        videoWrapper.append(`<div id=\"message\" data-id=\"${annotation.id}\"\n             class=\"message text-white bg-transparent inlineannotation\"></div>`);\n\n        const updateAspectRatio = async(video, reset) => {\n            let elem = video ? $('#player') : $(`#message[data-id='${annotation.id}']`);\n            if ($(\"#wrapper\").hasClass('fullscreen')) {\n                let ratio = await this.player.ratio();\n                let videowrapperaspect = videoWrapper.width() / videoWrapper.height();\n                let gap = '- 55px';\n                if ($(\"#wrapper\").hasClass('no-videonav')) {\n                    gap = '';\n                }\n                if (videowrapperaspect > ratio) {\n                    elem.css('height', `calc(100vh ${gap})`);\n                    elem.css('width', `calc((100vh ${gap}) * ${ratio})`);\n                    elem.css('top', '0');\n                    elem.css('left', `calc((100vw - (100vh ${gap}) * ${ratio}) / 2)`);\n                } else if (videowrapperaspect < ratio) {\n                    elem.css('width', '100vw');\n                    elem.css('height', `${100 / ratio}vw`);\n                    elem.css('top', `calc((100vh ${gap} - 100vw / ${ratio}) / 2)`);\n                    elem.css('left', '0');\n                }\n            } else {\n                elem.css('width', '100%');\n                elem.css('height', '100%');\n                elem.css('top', '0');\n                elem.css('left', '0');\n            }\n            if (reset) {\n                elem.css('width', '100%');\n                elem.css('height', '100%');\n                elem.css('top', '0');\n                elem.css('left', '0');\n            }\n        };\n\n        updateAspectRatio();\n        updateAspectRatio(true);\n\n        let vwrapper = document.querySelector('#video-wrapper');\n        let resizeObserver = new ResizeObserver(() => {\n            updateAspectRatio();\n            updateAspectRatio(true);\n        });\n\n        resizeObserver.observe(vwrapper);\n\n        $(document).on('timeupdate', function() {\n            updateAspectRatio(true, true);\n        });\n    }\n\n    postContentRender(annotation, data) {\n        let self = this;\n        var $videoWrapper = $('#video-wrapper');\n        var $playerWrapper = $('#wrapper');\n        const convertSecondsToMMSS = (seconds) => {\n            let minutes = Math.floor(seconds / 60);\n            seconds = Math.round(seconds - minutes * 60);\n            return (minutes < 10 ? '0' + minutes : minutes) + ':' + (seconds < 10 ? '0' + seconds : seconds);\n        };\n\n        const updatePositionInfo = (elem) => {\n            let w = parseFloat(elem.outerWidth());\n            let hw = parseFloat(elem.outerHeight());\n            let t = parseFloat(elem.position().top) < 0 ? 0 : parseFloat(elem.position().top);\n            let l = parseFloat(elem.position().left) < 0 ? 0 : parseFloat(elem.position().left);\n            let z = elem.css('z-index');\n            $(`#player-region #inlineannotation-btns #position`)\n                .text(`x: ${Math.round(l)}, y: ${Math.round(t)}, z: ${z - 5}, w: ${Math.round(w)}, h: ${Math.round(hw)}`);\n        };\n\n        const recalculatingSize = (elem) => {\n            let message = $videoWrapper.find(`#message`);\n            $(`#player-region #inlineannotation-btns #down, #player-region #inlineannotation-btns #up`).removeAttr('disabled');\n            let w = parseFloat(elem.outerWidth()) / parseFloat(message.width()) * 100;\n            let h = parseFloat(elem.outerHeight()) / parseFloat(message.height()) * 100;\n            if (elem.position().right < 0) {\n                elem.css('right', '0');\n            }\n            if (elem.position().bottom < 0) {\n                elem.css('bottom', '0');\n            }\n            let t = parseFloat(elem.position().top) / parseFloat(message.height()) * 100 < 0 ? 0\n                : parseFloat(elem.position().top) / parseFloat(message.height()) * 100;\n            let l = parseFloat(elem.position().left) / parseFloat(message.width()) * 100 < 0 ? 0\n                : parseFloat(elem.position().left) / parseFloat(message.width()) * 100;\n            let z = elem.css('z-index');\n            let position = {\n                'width': w + '%',\n                'height': h + '%',\n                'left': l + '%',\n                'top': t + '%',\n                'z-index': z,\n            };\n            elem.css(position);\n            if (z == 6) {\n                $(`#player-region #inlineannotation-btns #down`).attr('disabled', 'disabled');\n            }\n            updatePositionInfo(elem);\n            if (elem.data('type') == 'video') {\n                // Update size of the playpause button\n                elem.find('.playpause').css({\n                    'font-size': elem.outerHeight() * 0.2 + 'px',\n                    'line-height': elem.outerHeight() * 0.2 + 'px',\n                });\n            }\n            return position;\n        };\n\n        const recalculatingTextSize = (elem, button) => {\n            let fontSize = elem.outerHeight();\n            elem.find('.annotation-content').css({\n                'font-size': (button ? fontSize * 0.7 : fontSize * 0.9) + 'px',\n                'line-height': fontSize + 'px',\n                'padding-left': (button ? 0.4 : 0.1) + 'em',\n                'padding-right': (button ? 0.4 : 0.1) + 'em',\n            });\n\n            elem.css('width', 'auto');\n        };\n\n        const renderItems = (elements, active, update) => {\n            if (!update) { // Clear the canvas if it is a new start.\n                $videoWrapper.find(`#message`).empty();\n            }\n            elements.forEach((item) => {\n                let prop = item.properties;\n                let type = item.type;\n                let id = item.id;\n                let position = item.position;\n                let wrapper = $(`<div class=\"annotation-wrapper\"\n                     data-anno=\"${annotation.id}\" data-item=\"${id}\" data-type=\"${type}\"\n                      data-property='${JSON.stringify(prop)}'></div>`);\n                if (prop.resizable == '1' || self.isEditMode()) {\n                    wrapper.addClass('resizable');\n                    wrapper.attr('tabindex', 0);\n                }\n                switch (type) {\n                    case 'image':\n                        var parts = prop.timestamp.split(':');\n                        var timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                        if (prop.gotourl != '') {\n                            wrapper.append(`<a href=\"${prop.gotourl}\" target=\"_blank\"><img src=\"${prop.url}\" id=\"${id}\"\n                             class=\"annotation-content ${prop.rounded == 1 ? 'rounded' : 'rounded-0'} w-100\n                              ${prop.shadow == '1' ? 'shadow' : ''}\" alt=\"${prop.formattedalttext}\"/></a>`);\n                        } else {\n                            wrapper.append(`<img src=\"${prop.url}\" id=\"${id}\"\n                                 ${timestamp > 0 ? 'data-timestamp=\"' + timestamp + '\"' : ''} class=\"annotation-content\n                                 ${prop.rounded == 1 ? 'rounded' : 'rounded-0'} w-100 ${prop.shadow == '1' ? 'shadow' : ''}\n                                  ${timestamp > 0 ? 'cursor-pointer' : ''}\" alt=\"${prop.formattedalttext}\"/>`);\n                        }\n                        if ((prop.gototurl != '' || timestamp > 0) && !self.isEditMode()) {\n                            wrapper.removeClass('resizable');\n                        }\n                        wrapper.css(position);\n                        wrapper.css('height', 'auto');\n                        $videoWrapper.find(`#message`).append(wrapper);\n                        break;\n\n                    case 'video':\n                        wrapper.append(`<video id=\"${id}\" class=\"annotation-content ${prop.rounded == 1 ? 'rounded' : 'rounded-0'}\n                             w-100 ${prop.shadow == '1' ? 'shadow' : ''}\" preload=\"metadata\" src=\"${prop.url}\"\n                              disablePictureInPicture/>\n                        </video><i class=\"playpause bi bi-play-fill shadow position-absolute\" style=\"font-size: unset\"></i>`);\n                        var video = wrapper.find('video')[0];\n                        video.autoplay = prop.autoplay == '1';\n                        video.playsInline = true;\n                        if (self.isEditMode()) {\n                            video.autoplay = false;\n                        }\n                        video.onplay = function() {\n                            wrapper.find('.playpause').removeClass('bi-play-fill').addClass('bi-pause-fill');\n                        };\n                        video.onpause = function() {\n                            wrapper.find('.playpause').removeClass('bi-pause-fill').addClass('bi-play-fill');\n                        };\n                        video.onended = function() {\n                            wrapper.find('.playpause').removeClass('bi-pause-fill').addClass('bi-play-fill');\n                        };\n                        wrapper.css(position);\n                        $videoWrapper.find(`#message`).append(wrapper);\n                        recalculatingSize(wrapper);\n                        break;\n                    case 'file':\n                    case 'audio':\n                        var wrapperhtml = ``;\n                        if (type == 'audio') {\n                            wrapperhtml = `<span id=\"${id}\" tabindex=\"0\"\n                             class=\"btn ${prop.style} ${prop.rounded == '1' ? 'btn-rounded' : 'rounded-0'}\n                              annotation-content text-nowrap ${prop.shadow == '1' ? 'shadow' : ''} rotatex-360\"\n                               data-src=\"${prop.url}\"><i class=\"bi bi-volume-up\" style=\"font-size:0.7em;margin-right:0.25em;\"></i>\n                               <span class=\"timeremaining\">00:00</span></span>`;\n                        } else if (type == 'file') {\n                            wrapperhtml = `<a id=\"${id}\"\n                             class=\"btn ${prop.style} ${prop.rounded == '1' ? 'btn-rounded' : 'rounded-0'}\n                             annotation-content text-nowrap ${prop.shadow == '1' ? 'shadow' : ''} rotatey-180\" href=\"${prop.url}\"\n                              target=\"_blank\"><i class=\"bi bi-paperclip\"\n                               style=\"font-size:0.7em;\"></i>${prop.formattedlabel != \"\" ?\n                                    `<span style=\"margin-left:0.25em;\">${prop.formattedlabel}` : ''}</a>`;\n                        }\n                        wrapper.append(`<div class=\"d-flex h-100\">${wrapperhtml}</div>`);\n\n                        if (type == 'audio' && !self.isEditMode()) {\n                            let playButton = wrapper.find('.annotation-content');\n                            let audioSrc = prop.url;\n                            let media = new Audio(audioSrc);\n                            playButton.on('click', function(e) {\n                                e.stopImmediatePropagation();\n                                if (media.paused || media.ended || media.currentTime === 0) {\n                                    media.play();\n                                    $(this).find('i').removeClass('bi-volume-up').addClass('bi-pause-fill');\n                                } else {\n                                    media.pause();\n                                    $(this).find('i').removeClass('bi-pause-fill').addClass('bi-volume-up');\n                                }\n                            });\n\n                            let totaltime = 0;\n                            media.onloadedmetadata = function() {\n                                totaltime = media.duration;\n                                playButton.find('span.timeremaining').text(convertSecondsToMMSS(totaltime));\n                            };\n\n                            media.onended = function() {\n                                playButton.find('i').removeClass('bi-pause-fill').addClass('bi-volume-up');\n                                playButton.find('span.timeremaining').text(convertSecondsToMMSS(totaltime));\n                            };\n\n                            media.ontimeupdate = function() {\n                                playButton.find('span.timeremaining')\n                                    .text(convertSecondsToMMSS(media.duration - media.currentTime));\n                            };\n\n                            if (prop.autoplay == '1') {\n                                setTimeout(() => {\n                                    playButton.trigger('click');\n                                }, 100);\n                            }\n\n                            $(document).on('iv:playerSeek iv:playerPlaying', function() {\n                                if (media) {\n                                    media.pause();\n                                }\n                            });\n                        }\n\n                        position.width = 0;\n\n                        wrapper.css(position);\n                        $videoWrapper.find(`#message`).append(wrapper);\n                        recalculatingTextSize(wrapper, true);\n\n                        break;\n\n                    case 'navigation':\n                        var parts = prop.timestamp.split(':');\n                        var timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n\n                        wrapper.append(`<div class=\"d-flex h-100\"><span id=\"${id}\" tabindex=\"0\"\n                             class=\"btn ${prop.style} ${prop.rounded == '1' ? 'btn-rounded' : 'rounded-0'}\n                              annotation-content text-nowrap ${prop.shadow == '1' ? 'shadow' : ''}\"\n                               data-timestamp=\"${timestamp}\">${prop.formattedlabel}</span></div>`);\n\n                        position.width = 0;\n\n                        wrapper.css(position);\n                        $videoWrapper.find(`#message`).append(wrapper);\n                        recalculatingTextSize(wrapper, true);\n                        break;\n\n                    case 'stopwatch':\n                        var duration = Number(prop.duration) * 60;\n                        wrapper.append(`<div class=\"d-flex h-100\"><span id=\"${id}\" tabindex=\"0\"\n                             class=\"btn ${prop.style} ${prop.rounded == '1' ? 'btn-rounded' : 'rounded-0'}\n                              annotation-content text-nowrap ${prop.shadow == '1' ? 'shadow' : ''} rotatey-180\"\n                               data-duration=\"${duration}\">\n                               <i class=\"bi bi bi-stopwatch\" style=\"font-size:0.7em;margin-right:0.25em;\"></i>\n                               <span>${convertSecondsToMMSS(duration)}</span></span></div>`);\n\n                        var timer, alarm;\n                        if (timer) {\n                            clearInterval(timer);\n                        }\n                        var intervalfunction = function() {\n                            timer = setInterval(() => {\n                                $(`.annotation-content#${id}`).addClass('running');\n                                let time = $(`.annotation-content#${id}`).data('duration');\n                                time--;\n                                $(`.annotation-content#${id} span`).text(convertSecondsToMMSS(time));\n                                $(`.annotation-content#${id}`).data('duration', time);\n                                if (prop.playalarmsound.playsoundatinterval == '1'\n                                    && time % (prop.playalarmsound.intervaltime * 60) == 0) {\n                                    if (prop.playalarmsound.playsoundatend == 1) {\n                                        alarm = new Audio(M.cfg.wwwroot + '/mod/interactivevideo/sounds/short-alarm.mp3');\n                                        alarm.play();\n                                    }\n                                }\n                                if (time < 0) {\n                                    clearInterval(timer);\n                                    if (prop.playalarmsound.playsoundatend == 1) {\n                                        alarm = new Audio(M.cfg.wwwroot + '/mod/interactivevideo/sounds/alarm.mp3');\n                                        alarm.play();\n                                        alarm.onplay = function() {\n                                            $(`.annotation-content#${id}`).addClass('pulse');\n                                        };\n                                        alarm.onended = function() {\n                                            $(`.annotation-content#${id}`).removeClass('pulse');\n                                        };\n                                    }\n                                    $(`.annotation-content#${id}`).removeClass('running');\n                                    $(`.annotation-content#${id} span`).text(convertSecondsToMMSS(duration));\n                                    $(`.annotation-content#${id}`).data('duration', duration);\n                                }\n                            }, 1000);\n                        };\n\n                        if (!self.isEditMode()) {\n                            intervalfunction();\n                            $videoWrapper.on('click', `.annotation-content#${id}`, function(e) {\n                                e.stopImmediatePropagation();\n                                if (prop.allowpause == 1) {\n                                    if ($(this).hasClass('running')) {\n                                        clearInterval(timer);\n                                        if (alarm) {\n                                            alarm.pause();\n                                        }\n                                        $(this).removeClass('running');\n                                    } else {\n                                        intervalfunction();\n                                    }\n                                } else if ($(this).data('duration') == duration) {\n                                    intervalfunction();\n                                }\n                            });\n                        }\n\n                        $(document).on('iv:playerSeek', function() {\n                            clearInterval(timer);\n                        });\n\n                        position.width = 0;\n\n                        wrapper.css(position);\n                        $videoWrapper.find(`#message`).append(wrapper);\n                        recalculatingTextSize(wrapper, true);\n\n                        break;\n                    case 'text':\n                        if (prop.url != undefined && prop.url != '') {\n                            wrapper.append(`<a id=\"${id}\"\n                                 class=\"annotation-content text-nowrap ${prop.shadow == '1' ? 'text-shadow' : ''} d-block\"\n                                  href=\"${prop.url}\" target=\"_blank\">${prop.formattedlabel}</a>`);\n                        } else {\n                            wrapper.append(`<div id=\"${id}\"\n                                 class=\"annotation-content text-nowrap ${prop.shadow == '1' ? 'text-shadow' : ''}\n                                 \">${prop.formattedlabel}</div>`);\n                        }\n                        wrapper.position.width = 0;\n                        wrapper.css(position);\n                        var style = {\n                            'font-weight': prop.bold == '1' ? 'bold' : 'normal',\n                            'font-style': prop.italic == '1' ? 'italic' : 'normal',\n                            'text-decoration': prop.underline == '1' ? 'underline' : 'none',\n                            'color': prop.textcolor,\n                            'background': prop.bgcolor,\n                            'border-width': prop.borderwidth,\n                            'border-color': prop.bordercolor,\n                            'border-style': 'solid',\n                            'font-family': prop.textfont != '' ? prop.textfont : 'inherit',\n                        };\n                        wrapper.find('.annotation-content').css(style);\n                        $videoWrapper.find(`#message`).append(wrapper);\n                        recalculatingTextSize(wrapper);\n                        break;\n\n                    case 'shape':\n                        var parts = prop.timestamp.split(':');\n                        var timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                        if (prop.gotourl != '') {\n                            wrapper.append(`<a href=\"${prop.gotourl}\" target=\"_blank\"><div id=\"${id}\"\n                             class=\"annotation-content ${prop.shadow == '1' ? 'shadow' : ''}\"\n                              style=\"width: 100%; height: 100%;\"></div></a>`);\n                        } else {\n                            wrapper.append(`<div id=\"${id}\" class=\"annotation-content ${prop.shadow == '1' ? 'shadow' : ''}\n                                 ${timestamp > 0 ? 'cursor-pointer' : ''}\"\n                             ${timestamp > 0 ? 'data-timestamp=\"' + timestamp + '\"' : ''}\n                             style=\"width: 100%; height: 100%;\"></div>`);\n                        }\n                        wrapper.css(position);\n                        var style = {\n                            'background': prop.bgcolor,\n                            'border-width': prop.borderwidth,\n                            'border-color': prop.bordercolor,\n                            'border-style': 'solid',\n                            'opacity': prop.opacity / 100,\n                        };\n                        if (prop.shape == 'circle') {\n                            style['border-radius'] = '50%';\n                        } else if (prop.shape == 'rectangle') {\n                            style['border-radius'] = prop.rounded == '1' ? '10px' : '0';\n                        }\n                        wrapper.find('.annotation-content').css(style);\n                        $videoWrapper.find(`#message`).append(wrapper);\n                        break;\n\n                    case 'hotspot':\n                        wrapper.append(`<div id=\"${id}\" class=\"annotation-content shadow-sm pulse\" role=\"button\"></div>`);\n                        position['aspect-ratio'] = '1';\n                        wrapper.css(position);\n                        var style = {\n                            'background-color': prop.color,\n                            'opacity': prop.opacity / 100,\n                            'border-radius': '50%',\n                            'aspect-ratio': '1',\n                        };\n                        wrapper.find('.annotation-content').css(style);\n                        $videoWrapper.find(`#message`).append(wrapper);\n\n                        if (!self.isEditMode()) {\n                            if (prop.usemodal == '1') {\n                                wrapper.attr({\n                                    'data-toggle': 'modal',\n                                    'data-content': prop.content.text,\n                                    'data-title': prop.formattedtitle,\n                                    'data-link': prop.url,\n                                });\n                            } else {\n                                wrapper.attr({\n                                    'tabindex': -1,\n                                    'data-trigger': 'manual',\n                                    'data-boundary': 'viewport',\n                                    'data-placement': 'auto',\n                                    'data-html': 'true',\n                                    'data-content': '<div class=\"loader\"></div>',\n                                    'data-title': prop.formattedtitle\n                                        + `<i class=\"bi bi-x-circle-fill ml-auto popover-dismiss cursor-pointer\"\n                                         style=\"font-size:1.5em;\"></i>`,\n                                });\n\n                                wrapper.popover({\n                                    container: '#wrapper',\n                                    html: true,\n                                    template: `<div class=\"popover inlineannotation-popover id-${id}\"\n                                     role=\"tooltip\"><div class=\"arrow\"></div>\n                                     <h3 class=\"popover-header d-flex justify-content-between\"></h3>\n                                     <div class=\"popover-body rounded\"></div>${prop.url != '' ?\n                                            `<div class=\"popup-footer bg-gray p-2 rounded-bottom\"><a href=\"${prop.url}\"\n                                          class=\"d-block w-100 text-right rotatex-360\" target=\"_blank\">\n                                          <i class=\"bi bi-arrow-right\"><i></i></i></a></div>` : ''}</div>`,\n                                });\n\n                                wrapper.on('shown.bs.popover', function() {\n                                    let $body = $(`.popover.id-${id} .popover-body`);\n                                    self.formatContent(prop.content.text, M.cfg.contextid).then((html) => {\n                                        $body.html(html);\n                                        notifyFilter($body);\n                                        wrapper.popover('update');\n                                    });\n                                });\n                                if (prop.openbydefault == '1') {\n                                    wrapper.popover('show');\n                                }\n                            }\n                        }\n                        break;\n                }\n\n                if (self.isEditMode() || prop.resizable == '1') {\n                    wrapper.draggable({\n                        containment: \"#message\",\n                        cursor: \"move\",\n                        handle: '.annotation-content',\n                        stop: function() {\n                            recalculatingSize($(this));\n                            $(this).trigger('click');\n                        },\n                        drag: function() {\n                            updatePositionInfo($(this));\n                        }\n                    });\n\n                    wrapper.resizable({\n                        containment: \"#message\",\n                        handles: \"all\",\n                        start: function(event) {\n                            // If shape and ctrl key is pressed, keep the aspect ratio 1:1\n                            if (type == 'shape' && event.ctrlKey) {\n                                $(this).resizable('option', 'aspectRatio', 1);\n                            }\n                        },\n                        stop: function() {\n                            if (type == 'text'\n                                || type == 'audio' || type == 'stopwatch' || type == 'file' || type == 'navigation') {\n                                recalculatingTextSize($(this), type != 'text');\n                            } else if (type == 'shape') {\n                                $(this).resizable('option', 'aspectRatio', false);\n                            }\n\n                            recalculatingSize($(this));\n                            $(this).trigger('click');\n                        },\n                        resize: function(event) {\n                            if (type == 'text'\n                                || type == 'audio' || type == 'stopwatch' || type == 'file' || type == 'navigation') {\n                                recalculatingTextSize($(this), type != 'text');\n                            } else if (type == 'shape' && event.ctrlKey) {\n                                $(this).resizable('option', 'aspectRatio', 1);\n                            }\n                            updatePositionInfo($(this));\n                        }\n                    });\n                }\n\n                if (type != 'shape') {\n                    wrapper.on('mouseover', function() {\n                        if (!$(this).hasClass('resizable')) {\n                            return;\n                        }\n\n                        let aspectRatio =\n                            $(this).find('.annotation-content').width() / $(this).find('.annotation-content').height();\n                        if (wrapper.width() / wrapper.height() != aspectRatio && (type == 'image' || type == 'video')) {\n                            $(this).height((wrapper.width() / aspectRatio));\n                        }\n                        $(this).resizable('option', 'aspectRatio', $(this).find('.annotation-content').outerWidth() /\n                            $(this).find('.annotation-content').outerHeight());\n                    });\n                }\n\n                if (id == active) {\n                    wrapper.trigger('click');\n                }\n\n            });\n\n            // Handle behavior for each item\n            if (!self.isEditMode()) {\n                $videoWrapper.on('click', `.annotation-wrapper`, function(e) {\n                    e.stopImmediatePropagation();\n                    let wrapper = $(this);\n                    let type = wrapper.data('type');\n                    switch (type) {\n                        case 'video':\n                            var video = wrapper.find('video')[0];\n                            if (video.paused || video.ended || video.currentTime === 0) {\n                                video.play();\n                            } else {\n                                video.pause();\n                            }\n                            break;\n                        case 'navigation':\n                        case 'image':\n                        case 'shape':\n                            var navigation = wrapper.find('.annotation-content');\n                            if (navigation.data('timestamp') && self.isBetweenStartAndEnd(navigation.data('timestamp'))) {\n                                self.player.seek(navigation.data('timestamp'));\n                                self.player.play();\n                            }\n                            break;\n                        case 'hotspot':\n                            var viewertype = wrapper.data('toggle');\n                            if (viewertype == 'modal') {\n                                let title = wrapper.data('title');\n                                let content = wrapper.data('content');\n                                let url = wrapper.data('link');\n                                let modal = `<div class=\"modal fade\" id=\"annotation-modal\" role=\"dialog\"\n                                aria-labelledby=\"annotation-modal\"\n                             aria-hidden=\"true\" data-backdrop=\"static\" data-keyboard=\"false\">\n                             <div class=\"modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable\" role=\"document\">\n                                <div class=\"modal-content rounded-lg\">\n                                    <div class=\"modal-header d-flex align-items-center shadow-sm pr-0\" id=\"title\">\n                                        <h5 class=\"modal-title text-truncate mb-0\">${title}</h5>\n                                        <button class=\"btn mx-2 p-0 close\" aria-label=\"Close\" data-dismiss=\"modal\">\n                                            <i class=\"bi bi-x-lg fa-fw\" style=\"font-size: x-large;\"></i>\n                                        </button>\n                                    </div>\n                                    <div class=\"modal-body\" id=\"content\">\n                                    <div class=\"loader\"></div>\n                                    </div>\n                                    ${url != '' ? `<div class=\"modal-footer bg-gray p-2 rounded-bottom\">\n                                        <a href=\"${url}\" class=\"d-block w-100 text-right rotatex-360\" target=\"_blank\">\n                                        <i class=\"bi bi-arrow-right\"><i></i></i></a></div>` : ''}\n                                    </div>\n                                </div>\n                                </div>`;\n                                $('#wrapper').append(modal);\n                                $('#annotation-modal').modal('show');\n                                $('#annotation-modal').on('hide.bs.modal', function() {\n                                    $('#annotation-modal').remove();\n                                });\n                                $('#annotation-modal').on('shown.bs.modal', function() {\n                                    $('#annotation-modal .modal-body').fadeIn(300);\n                                    let $body = $('#annotation-modal .modal-body');\n                                    self.formatContent(content, M.cfg.contextid).then((html) => {\n                                        $body.html(html);\n                                        notifyFilter($body);\n                                    });\n                                });\n                            } else {\n                                wrapper.popover('show');\n                            }\n                            break;\n                    }\n                });\n\n                $playerWrapper.on('click', `.popover-dismiss`, function(e) {\n                    e.stopImmediatePropagation();\n                    $(this).closest('.popover').remove();\n                });\n            }\n\n        };\n\n        // Check resize on video wrapper resize\n        let vwrapper = document.querySelector('#video-wrapper');\n\n        let resizeObserver = new ResizeObserver(() => {\n            let existingwrapper = $(`#video-wrapper`).find(`.annotation-wrapper`);\n            if (existingwrapper.length == 0) {\n                return;\n            }\n            existingwrapper.each(function() {\n                let type = $(this).data('type');\n                if (type == 'text' || type == 'audio' || type == 'stopwatch' || type == 'file' || type == 'navigation') {\n                    recalculatingTextSize($(this), type != 'text');\n                } else if (type == 'video') {\n                    recalculatingSize($(this));\n                }\n            });\n        });\n\n        resizeObserver.observe(vwrapper);\n        let items = [];\n        if (data.items != '' && data.items !== null) {\n            items = JSON.parse(data.items);\n        }\n        let draftitemid = data.draftitemid;\n\n        renderItems(items, null, false);\n\n        // Render the inline annotation toolbar\n        if (this.isEditMode()) {\n            $('#inlineannotation-btns').remove();\n            let inlineannotationitems = [\n                {\n                    'icon': 'bi bi-image',\n                    'type': 'media',\n                    'mediatype': 'image',\n                    'label': M.util.get_string('image', 'ivplugin_inlineannotation'),\n                },\n                {\n                    'icon': 'bi bi-film',\n                    'type': 'media',\n                    'mediatype': 'video',\n                    'label': M.util.get_string('video', 'ivplugin_inlineannotation'),\n                },\n                {\n                    'icon': 'bi bi-volume-up',\n                    'type': 'media',\n                    'mediatype': 'audio',\n                    'label': M.util.get_string('audio', 'ivplugin_inlineannotation'),\n                },\n                {\n                    'icon': 'bi bi-alphabet-uppercase',\n                    'type': 'text',\n                    'mediatype': 'text',\n                    'label': M.util.get_string('text', 'ivplugin_inlineannotation'),\n                },\n                {\n                    'icon': 'bi bi-circle-square',\n                    'type': 'shape',\n                    'mediatype': 'shape',\n                    'label': M.util.get_string('shape', 'ivplugin_inlineannotation'),\n                },\n                {\n                    'icon': 'bi bi-stopwatch',\n                    'type': 'stopwatch',\n                    'mediatype': 'stopwatch',\n                    'label': M.util.get_string('stopwatch', 'ivplugin_inlineannotation'),\n                },\n                {\n                    'icon': 'bi bi-file-earmark-arrow-down',\n                    'type': 'media',\n                    'mediatype': 'file',\n                    'label': M.util.get_string('inlinefile', 'ivplugin_inlineannotation'),\n                },\n                {\n                    'icon': 'bi bi-sign-turn-right',\n                    'type': 'navigation',\n                    'mediatype': 'navigation',\n                    'label': M.util.get_string('navigation', 'ivplugin_inlineannotation')\n                },\n                {\n                    'icon': 'bi bi-plus-circle',\n                    'type': 'hotspot',\n                    'mediatype': 'hotspot',\n                    'label': M.util.get_string('hotspot', 'ivplugin_inlineannotation'),\n                }\n            ];\n            const dataForTemplate = {\n                id: annotation.id,\n                items: inlineannotationitems,\n            };\n\n            Templates.render('ivplugin_inlineannotation/inlineannotation_toolbar', dataForTemplate).then((html) => {\n                $videoWrapper.before(html);\n            }).catch(() => {\n                // Do nothing.\n            });\n\n            self.enableColorPicker();\n        }\n\n        $(document).on('iv:playerSeek iv:playerPlaying', function(e) {\n            let newTime = e.detail.time;\n            if (Math.floor(newTime) != annotation.timestamp) {\n                $(`#inlineannotation-btns`).remove();\n                $('.inlineannotation-popover').remove();\n                $videoWrapper.find(`#message`).remove();\n            }\n        });\n\n        // End of view mode.\n        if (!self.isEditMode()) {\n            return;\n        }\n\n        const getItems = (updateid) => {\n            items = [];\n            $videoWrapper.find(`.annotation-wrapper`).each(function(index, element) {\n                let item = {\n                    \"id\": (updateid ? (new Date().getTime() + index) : $(element).data('item')),\n                    \"type\": $(element).data('type'),\n                    \"position\": recalculatingSize($(element)),\n                    \"properties\": JSON.parse($(element).attr('data-property')),\n                };\n                items.push(item);\n            });\n        };\n\n        $playerWrapper.on('click', `#inlineannotation-btns #save`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            getItems(true, true);\n            // Encode html tags\n            let cleanItems = JSON.stringify(items).replace(/</g, '&lt;').replace(/>/g, '&gt;');\n            let updateId = $videoWrapper.find('#message').data('id');\n            $.ajax({\n                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                method: \"POST\",\n                dataType: \"text\",\n                data: {\n                    action: 'quickeditfield',\n                    sesskey: M.cfg.sesskey,\n                    id: updateId,\n                    field: 'content',\n                    contextid: M.cfg.contextid,\n                    draftitemid: draftitemid,\n                    value: cleanItems,\n                    cmid: self.cmid,\n                    token: self.token,\n                },\n                success: function(data) {\n                    let updated = JSON.parse(data);\n                    dispatchEvent('annotationupdated', {\n                        annotation: updated,\n                        action: 'edit',\n                    });\n                }\n            });\n        });\n\n        $playerWrapper.on('click', `#inlineannotation-btns  #close`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            $(`#inlineannotation-btns`).remove();\n            $videoWrapper.find(`#message`).remove();\n        });\n\n        const handleFormData = (newItem, type, add) => {\n            switch (type) {\n                case 'audio':\n                case 'file':\n                    if (add) {\n                        newItem.position.height = '40px';\n                        newItem.position.width = '130px';\n                    }\n                    break;\n                case 'navigation':\n                case 'stopwatch':\n                    if (add) {\n                        newItem.position.height = '40px';\n                        newItem.position.width = '130px';\n                    }\n                    break;\n                case 'text':\n                    newItem.width = '0';\n                    break;\n                case 'shape':\n                    if (add) {\n                        newItem.position.height = '100px';\n                        newItem.position.width = '100px';\n                    }\n                    break;\n                case 'video':\n                case 'image':\n                    newItem.position.height = 'auto';\n                    break;\n                case 'hotspot':\n                    if (add) {\n                        newItem.position.width = '5%';\n                    }\n                    break;\n            }\n\n            items.push(newItem);\n            renderItems([newItem], newItem.id, true);\n        };\n\n        $playerWrapper.on('click', `#inlineannotation-btns  .add-ia`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            let annoid = $videoWrapper.find(`#message`).data('id');\n            let type = $(this).attr('data-mediatype');\n            if (type == 'stopwatch' && items.find(x => x.type == 'stopwatch')) {\n                alert(M.util.get_string('onlyonestopwatch', 'ivplugin_inlineannotation'));\n                return;\n            }\n            let iaform = new ModalForm({\n                formClass: \"ivplugin_inlineannotation\\\\items\\\\\" + $(this).attr('data-type'),\n                args: {\n                    contextid: M.cfg.contextid,\n                    id: 0,\n                    type: type,\n                    annotationid: annoid,\n                },\n                modalConfig: {\n                    title: M.util.get_string('addinlineannotation', 'ivplugin_inlineannotation',\n                        M.util.get_string(type, 'ivplugin_inlineannotation')),\n                }\n            });\n\n            iaform.show();\n\n\n            iaform.addEventListener(iaform.events.LOADED, () => {\n                iaform.modal.modal.draggable({\n                    handle: \".modal-header\",\n                });\n                if (type == 'navigation' || type == 'image' || type == 'shape') {\n                    $(document).on('change', '[name=\"timestamp\"]', function(e) {\n                        e.preventDefault();\n                        let parts = $(this).val().split(':');\n                        let timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                        if (!self.isBetweenStartAndEnd(timestamp)) {\n                            let message = M.util.get_string('timemustbebetweenstartandendtime', 'ivplugin_inlineannotation', {\n                                \"start\": self.convertSecondsToHMS(self.start),\n                                \"end\": self.convertSecondsToHMS(self.end),\n                            });\n                            self.addNotification(message);\n                            $(this).val($(this).attr('data-initial-value'));\n                            return;\n                        }\n\n                        // Make sure the timestamp is not in the skip segment.\n                        if (self.isInSkipSegment(timestamp)) {\n                            self.addNotification(M.util.get_string('interactionisbetweentheskipsegment',\n                                'ivplugin_inlineannotation'));\n                            $(this).val($(this).attr('data-initial-value'));\n                            return;\n                        }\n                    });\n                }\n            });\n\n            iaform.addEventListener(iaform.events.FORM_SUBMITTED, (e) => {\n                getItems(false);\n                let left = Math.random() * 100;\n                let top = Math.random() * 100;\n                let newItem = {\n                    \"id\": new Date().getTime(),\n                    \"type\": type,\n                    \"position\": {\n                        \"width\": \"30%\",\n                        \"left\": left + \"px\",\n                        \"top\": top + \"px\",\n                        \"z-index\": items.length + 6,\n                    },\n                    'properties': e.detail,\n                };\n                handleFormData(newItem, type, true);\n            });\n        });\n\n        $playerWrapper.on('click', `#inlineannotation-btns  #edit`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            let annnoid = $videoWrapper.find(`#message`).data('id');\n            let active = $('#edit-btns').attr('data-active');\n            getItems(false);\n            let item = items.find(x => x.id == active);\n            let type = item.type;\n            let formdata = {...item.properties};\n            formdata.contextid = M.cfg.contextid;\n            formdata.id = item.id;\n            formdata.annotationid = annnoid;\n            formdata.type = type;\n            let editform = new ModalForm({\n                formClass: \"ivplugin_inlineannotation\\\\items\\\\\" +\n                    (type == 'image' || type == 'video' || type == 'audio' || type == 'file' ? 'media' : type),\n                args: item.properties,\n                modalConfig: {\n                    title: M.util.get_string('editinlineannotation', 'ivplugin_inlineannotation',\n                        M.util.get_string(type, 'ivplugin_inlineannotation')),\n                }\n            });\n\n            editform.show();\n\n            editform.addEventListener(editform.events.LOADED, () => {\n                editform.modal.modal.draggable({\n                    handle: \".modal-header\",\n                });\n                if (type == 'navigation' || type == 'image' || type == 'shape') {\n                    $(document).on('change', '[name=\"timestamp\"]', function(e) {\n                        e.preventDefault();\n                        let parts = $(this).val().split(':');\n                        let timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                        if (!self.isBetweenStartAndEnd(timestamp)) {\n                            let message = M.util.get_string('timemustbebetweenstartandendtime', 'mod_interactivevideo', {\n                                \"start\": self.convertSecondsToHMS(self.start),\n                                \"end\": self.convertSecondsToHMS(self.end),\n                            });\n                            self.addNotification(message);\n                            $(this).val($(this).attr('data-initial-value'));\n                            return;\n                        }\n\n                        // Make sure the timestamp is not in the skip segment.\n                        if (self.isInSkipSegment(timestamp)) {\n                            self.addNotification(M.util.get_string('interactionisbetweentheskipsegment', 'mod_interactivevideo'));\n                            $(this).val($(this).attr('data-initial-value'));\n                            return;\n                        }\n                    });\n                }\n            });\n\n            editform.addEventListener(editform.events.FORM_SUBMITTED, (e) => {\n                getItems(false);\n                item = items.find(x => x.id == active);\n                item.properties = e.detail;\n                // Remove the item from the canvas\n                $videoWrapper.find(`.annotation-wrapper[data-item=\"${active}\"]`).remove();\n                items = items.filter(x => x.id != active);\n                handleFormData(item, type, false);\n            });\n        });\n\n        $videoWrapper.on('click', `.annotation-wrapper`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            if (!e.ctrlKey) {\n                $('#inlineannotation-btns .btn').removeClass('active rotatey-360');\n                $videoWrapper.find('.annotation-wrapper').removeClass('active');\n                $(this).addClass('active');\n                this.focus();\n                recalculatingSize($(this));\n            } else {\n                if ($(this).hasClass('active')) {\n                    $(this).removeClass('active');\n                } else {\n                    $(this).addClass('active');\n                    this.focus();\n                }\n            }\n\n            recalculatingSize($(this));\n\n            var activewrapper = $videoWrapper.find('.annotation-wrapper.active');\n            if (activewrapper.length == 0) {\n                $('#edit-btns').attr('data-active', '').addClass('d-none').removeClass('d-flex');\n                $('#inlineannotation-btns #edit').attr('disabled', 'disabled');\n                $('#inlineannotation-btns #edit').removeAttr('disabled');\n            } else {\n                let dataActive = activewrapper.map(function() {\n                    return $(this).data('item');\n                }).get();\n                $('#edit-btns').attr('data-active', dataActive).addClass('d-flex').removeClass('d-none');\n                activewrapper.each(function() {\n                    let type = $(this).data('type');\n                    $(`#inlineannotation-btns .btn[data-mediatype=\"${type}\"]`).addClass('active rotatey-360');\n                });\n                if (activewrapper.length > 1) {\n                    $('#inlineannotation-btns #edit').attr('disabled', 'disabled');\n                } else {\n                    $('#inlineannotation-btns #edit').removeAttr('disabled');\n                }\n            }\n        });\n\n        $playerWrapper.on('click', `#inlineannotation-btns  #up`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            // Increase the z-index of the active item\n            let active = $('#edit-btns').attr('data-active');\n            active = active.split(',');\n            active.forEach((item) => {\n                let activeItem = $(`.annotation-wrapper[data-item=\"${item}\"]`);\n                let zIndex = parseInt(activeItem.css('z-index'));\n                activeItem.css('z-index', zIndex + 1);\n                recalculatingSize(activeItem);\n            });\n        });\n\n        $playerWrapper.on('click', `#inlineannotation-btns  #down`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            // Decrease the z-index of the active item\n            let active = $('#edit-btns').attr('data-active');\n            active = active.split(',');\n            active.forEach((item) => {\n                let activeItem = $(`.annotation-wrapper[data-item=\"${item}\"]`);\n                let zIndex = parseInt(activeItem.css('z-index'));\n                activeItem.css('z-index', zIndex - 1);\n                recalculatingSize(activeItem);\n            });\n        });\n\n        $playerWrapper.on('click', `#inlineannotation-btns  #delete`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            // Delete the active item\n            let active = $('#edit-btns').attr('data-active');\n            active = active.split(',');\n            active.forEach((item) => {\n                let activeItem = $(`.annotation-wrapper[data-item=\"${item}\"]`);\n                activeItem.remove();\n                $('#edit-btns').attr('data-active', '').addClass('d-none').removeClass('d-flex');\n            });\n            getItems(false);\n            $('#inlineannotation-btns .btn').removeClass('active rotatey-360');\n        });\n\n        $playerWrapper.on('click', `#inlineannotation-btns  #copy`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            getItems(false);\n            // Copy the active item\n            let active = $('#edit-btns').attr('data-active');\n            active = active.split(',');\n            let newItems = [];\n            for (let i = 0; i < active.length; i++) {\n                let a = active[i];\n                let activeItem = $(`.annotation-wrapper[data-item=\"${a}\"]`);\n                activeItem.removeClass('active');\n                let item = items.find(x => x.id == a);\n                let newItem = {...item};\n                newItem.position = recalculatingSize(activeItem);\n                newItem.id = new Date().getTime();\n                newItems.push(newItem.id);\n                newItem.position.zIndex = items.length + 6;\n                newItem.position.left = (parseInt(newItem.position.left) + 5) + '%';\n                newItem.position.top = (parseInt(newItem.position.top) + 5) + '%';\n                items.push(newItem);\n                renderItems([newItem], null, true);\n                if (i == active.length - 1) {\n                    $('#edit-btns').attr('data-active', newItems.join(',')).addClass('d-flex').removeClass('d-none');\n                    newItems.forEach((ni) => {\n                        $(`.annotation-wrapper[data-item=\"${ni}\"]`).addClass('active');\n                    });\n                    // Put focus on the first element\n                    document.querySelector('.annotation-wrapper.active').focus();\n                }\n            }\n        });\n\n        // Move items with keyboard arrow keys, ctrl + up to layer up, and ctrl + down to layer down.\n        $playerWrapper.on('keydown', '.annotation-wrapper', function(e) {\n            let active = $('#edit-btns').attr('data-active');\n            active = active.split(',');\n            for (let i = 0; i < active.length; i++) {\n                let a = active[i];\n                let activeItem = $(`.annotation-wrapper[data-item=\"${a}\"]`);\n                if (activeItem != undefined) {\n                    let position = activeItem.position();\n                    position['z-index'] = parseInt(activeItem.css('z-index'));\n                    let ctrl = e.ctrlKey;\n                    let step = 1;\n                    // Prevent page scroll\n                    e.preventDefault();\n                    e.stopImmediatePropagation();\n                    switch (e.key) {\n                        case 'ArrowUp':\n                            if (ctrl) {\n                                position['z-index'] = position['z-index'] + 1;\n                            } else {\n                                if (position.top > 0) {\n                                    position.top = position.top - step;\n                                } else {\n                                    break;\n                                }\n                            }\n                            break;\n                        case 'ArrowDown':\n                            if (ctrl) {\n                                position['z-index'] = position['z-index'] - 1;\n                            } else {\n                                if (position.top + activeItem.outerHeight() < $videoWrapper.find(`#message`).height()) {\n                                    position.top = position.top + step;\n                                } else {\n                                    break;\n                                }\n                            }\n                            break;\n                        case 'ArrowLeft':\n                            if (position.left > 0) {\n                                position.left = position.left - step;\n                            } else {\n                                break;\n                            }\n                            break;\n                        case 'ArrowRight':\n                            if (position.left + activeItem.outerWidth() < $videoWrapper.find(`#message`).width()) {\n                                position.left = position.left + step;\n                            } else {\n                                break;\n                            }\n                            break;\n                        case 'Delete':\n                            $(`#inlineannotation-btns #delete`).trigger('click');\n                            return;\n                        case 'd': // Ctrl + d to duplicate\n                            if (ctrl) {\n                                $(`#inlineannotation-btns #copy`).trigger('click');\n                            }\n                            return;\n                        default:\n                            return;\n                    }\n                    activeItem.css(position);\n                    recalculatingSize(activeItem);\n                }\n            }\n        });\n\n        $playerWrapper.on('click', `#message`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            $videoWrapper.find('.annotation-wrapper').removeClass('active');\n            $('#inlineannotation-btns .btn').removeClass('active rotatey-360');\n            $('#edit-btns').attr('data-active', '').addClass('d-none').removeClass('d-flex');\n        });\n\n        $(document).on('annotationdeleted', function(e) {\n            let deleted = e.originalEvent.detail.annotation;\n            let annoid = $videoWrapper.find(`#message`).data('id');\n            if (annoid == deleted.id) {\n                $videoWrapper.find(`#message[data-id='${annoid}']`).remove();\n                $(`#inlineannotation-btns`).remove();\n            }\n        });\n    }\n    /**\n     * What happens when an item runs\n     * @param {Object} annotation The annotation object\n     * @returns {void}\n     */\n    runInteraction(annotation) {\n        this.player.pause();\n        this.renderContainer(annotation);\n        if (this.isEditMode()) {\n            annotation.editmode = true; // Use editmode to render the draft content (i.e draft.php vs plugin.php).\n        }\n        this.render(annotation, 'json').then((content) => {\n            return this.postContentRender(annotation, content);\n        }).catch(() => {\n            // Do nothing.\n        });\n    }\n}"],"names":["InlineAnnotation","Base","postEditCallback","renderContainer","annotation","videoWrapper","find","remove","append","id","updateAspectRatio","async","video","reset","elem","hasClass","ratio","this","player","videowrapperaspect","width","height","gap","css","vwrapper","document","querySelector","ResizeObserver","observe","on","postContentRender","data","self","$videoWrapper","$playerWrapper","convertSecondsToMMSS","seconds","minutes","Math","floor","round","updatePositionInfo","w","parseFloat","outerWidth","hw","outerHeight","t","position","top","l","left","z","text","recalculatingSize","message","removeAttr","h","right","bottom","attr","recalculatingTextSize","button","fontSize","renderItems","elements","active","update","empty","forEach","item","prop","properties","type","wrapper","JSON","stringify","resizable","isEditMode","addClass","parts","timestamp","split","Number","gotourl","url","rounded","shadow","formattedalttext","gototurl","removeClass","autoplay","playsInline","onplay","onpause","onended","wrapperhtml","style","formattedlabel","playButton","audioSrc","media","Audio","e","stopImmediatePropagation","paused","ended","currentTime","play","pause","totaltime","onloadedmetadata","duration","ontimeupdate","setTimeout","trigger","timer","alarm","clearInterval","intervalfunction","setInterval","time","playalarmsound","playsoundatinterval","intervaltime","playsoundatend","M","cfg","wwwroot","allowpause","undefined","bold","italic","underline","textcolor","bgcolor","borderwidth","bordercolor","textfont","opacity","shape","color","usemodal","content","formattedtitle","popover","container","html","template","$body","formatContent","contextid","then","openbydefault","draggable","containment","cursor","handle","stop","drag","handles","start","event","ctrlKey","resize","aspectRatio","navigation","isBetweenStartAndEnd","seek","title","modal","fadeIn","closest","existingwrapper","length","each","items","parse","draftitemid","inlineannotationitems","util","get_string","dataForTemplate","render","before","catch","enableColorPicker","newTime","detail","getItems","updateid","index","element","Date","getTime","push","preventDefault","cleanItems","replace","updateId","ajax","method","dataType","action","sesskey","field","value","cmid","token","success","updated","handleFormData","newItem","add","annoid","x","alert","iaform","ModalForm","formClass","args","annotationid","modalConfig","show","addEventListener","events","LOADED","val","convertSecondsToHMS","end","addNotification","isInSkipSegment","FORM_SUBMITTED","random","annnoid","formdata","editform","filter","focus","activewrapper","dataActive","map","get","activeItem","zIndex","parseInt","newItems","i","a","join","ni","ctrl","step","key","deleted","originalEvent","runInteraction","editmode"],"mappings":"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"}