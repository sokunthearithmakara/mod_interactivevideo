{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["/* eslint-disable complexity */\n\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Main class for inlineannotation content type\n *\n * @module     ivplugin_inlineannotation/main\n * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport Base from 'mod_interactivevideo/type/base';\nimport {dispatchEvent} from 'core/event_dispatcher';\nimport ModalForm from 'core_form/modalform';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport {notifyFilterContentUpdated as notifyFilter} from 'core_filters/events';\nexport default class InlineAnnotation extends Base {\n    /**\n     * Callback function to be executed after an edit operation.\n     * Currently, this function does not perform any actions.\n     */\n    postEditCallback() {\n        // Do nothing\n    }\n\n    /**\n     * Round a number to two decimal places\n     * @param {Number} num Number\n     * @returns {Number} rounded number\n     */\n    roundToTwo(num) {\n        return +(Math.round(num + 'e+2') + 'e-2');\n    }\n\n    /**\n     * Render the container for the annotation.\n     * @param {Object} annotation The annotation object.\n     * @return {void}\n     */\n    renderContainer(annotation) {\n        const videoWrapper = $('#video-wrapper');\n        videoWrapper.find('#canvas').remove();\n        videoWrapper.append(`<div id=\"canvas\" data-id=\"${annotation.id}\"\n             class=\"message text-white bg-transparent inlineannotation position-absolute\"></div>`);\n\n        const updateAspectRatio = async (video, reset) => {\n            let elem = video ? $('#player') : $(`#canvas[data-id='${annotation.id}']`);\n            if ($(\"#wrapper\").hasClass('fullscreen')) {\n                let ratio = 16 / 9;\n                if (!this.displayoptions.usefixedratio || this.displayoptions.usefixedratio == 0) {\n                    ratio = this.player.aspectratio;\n                }\n                let videowrapperaspect = videoWrapper.width() / videoWrapper.height();\n                let gap = '- 55px';\n                if ($(\"#wrapper\").hasClass('no-videonav')) {\n                    gap = '';\n                }\n                if (videowrapperaspect > ratio) {\n                    elem.css('height', `calc(100dvh ${gap})`);\n                    elem.css('width', `calc((100dvh ${gap}) * ${ratio})`);\n                    elem.css('top', '0');\n                    elem.css('left', `calc((100dvw - (100dvh ${gap}) * ${ratio}) / 2)`);\n                } else if (videowrapperaspect < ratio) {\n                    elem.css('width', '100dvw');\n                    elem.css('height', `${100 / ratio}dvw`);\n                    elem.css('top', `calc((100dvh ${gap} - 100dvw / ${ratio}) / 2)`);\n                    elem.css('left', '0');\n                }\n            } else {\n                elem.css('width', '100%');\n                elem.css('height', '100%');\n                elem.css('top', '0');\n                elem.css('left', '0');\n            }\n            if (reset) {\n                elem.css('width', '100%');\n                elem.css('height', '100%');\n                elem.css('top', '0');\n                elem.css('left', '0');\n            }\n        };\n\n        updateAspectRatio();\n        updateAspectRatio(true);\n\n        let vwrapper = document.querySelector('#video-wrapper');\n        let resizeObserver = new ResizeObserver(() => {\n            updateAspectRatio();\n            updateAspectRatio(true);\n        });\n\n        resizeObserver.observe(vwrapper);\n\n        $(document).on('timeupdate', function() {\n            updateAspectRatio(true, true);\n        });\n    }\n\n    /**\n     * Post-processes the content after rendering an annotation.\n     * @param {Object} annotation The annotation object.\n     * @param {Object} data The data object.\n     * @return {void}\n     */\n    postContentRender(annotation, data) {\n        let self = this;\n        var $videoWrapper = $('#video-wrapper');\n        var $playerWrapper = $('#wrapper');\n        let draftStatus = null;\n\n        /**\n         * Format seconds to HH:MM:SS\n         * @param {Number} seconds seconds\n         * @returns formatted time\n         */\n        const convertSecondsToMMSS = (seconds) => {\n            let minutes = Math.floor(seconds / 60);\n            seconds = Math.round(seconds - minutes * 60);\n            return (minutes < 10 ? '0' + minutes : minutes) + ':' + (seconds < 10 ? '0' + seconds : seconds);\n        };\n\n        /**\n         * Update position information of the active element on the toolbar.\n         * @param {Object} elem jQuery element\n         */\n        const updatePositionInfo = (elem) => {\n            let w = elem.outerWidth();\n            let hw = elem.outerHeight();\n            let t = elem.position().top < 0 ? 0 : elem.position().top;\n            let l = elem.position().left < 0 ? 0 : elem.position().left;\n            let z = elem.css('z-index');\n            $(`#inlineannotation-btns #position`)\n                .text(`x: ${Math.round(l)}, y: ${Math.round(t)}, z: ${z - 5}, w: ${Math.round(w)}, h: ${Math.round(hw)}`);\n        };\n\n        /**\n         * Recalculate the size of the element.\n         * @param {Object} elem jQuery element\n         * @return {Object} position of the element\n         */\n        const recalculatingSize = (elem) => {\n            let message = $videoWrapper.find(`#canvas`);\n            $(`#inlineannotation-btns #down, #inlineannotation-btns #up`).removeAttr('disabled');\n            let w = self.roundToTwo(elem.outerWidth()) / message.width() * 100;\n            let h = self.roundToTwo(elem.outerHeight()) / message.height() * 100;\n            let t = self.roundToTwo(elem.position().top) / message.height() * 100;\n            t = t < 0 ? 0 : t;\n            let l = self.roundToTwo(elem.position().left) / message.width() * 100;\n            l = l < 0 ? 0 : l;\n            let z = elem.css('z-index');\n            let g = elem.data('group');\n            let position = {\n                'width': w + '%',\n                'height': h + '%',\n                'left': l + '%',\n                'top': t + '%',\n                'z-index': z,\n            };\n            position.group = g;\n            elem.css(position);\n            updatePositionInfo(elem);\n            return position;\n        };\n\n        /**\n         * Calculate the text size for text and file type.\n         * @param {Object} elem jQuery element\n         * @param {Boolean} button if it is a button\n         * @param {Boolean} multiline if it is a multiline text\n         */\n        const recalculatingTextSize = (elem, button, multiline = false) => {\n            let fontSize = elem.outerHeight();\n            let padding = 0;\n            let rowCount = 1;\n            if (multiline) {\n                let rows = elem.find('.text-row');\n                rowCount = rows.length;\n                if (rowCount > 1) {\n                    let rowHeight = elem.outerHeight() / rowCount;\n                    padding = rowHeight * 0.3;\n                    fontSize = (elem.outerHeight() - padding * 2) / rowCount;\n                }\n            }\n            let style = {\n                'font-size': (button ? fontSize * 0.7 : fontSize * 0.9) + 'px',\n                'line-height': fontSize + 'px',\n                'padding-left': (button ? fontSize * 0.5 : fontSize * 0.3) + 'px',\n                'padding-right': (button ? fontSize * 0.5 : fontSize * 0.3) + 'px',\n            };\n            if (multiline && rowCount > 1) {\n                style.padding = padding + 'px';\n            }\n            elem.find('.annotation-content').css(style);\n            elem.css('width', 'auto');\n        };\n\n        const renderImage = (wrapper, item, prop, id, position) => {\n            var parts = prop.timestamp.split(':');\n            var timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n            if (prop.gotourl != '') {\n                wrapper.append(`<a href=\"${prop.gotourl}\" target=\"_blank\"><img src=\"${prop.url}\" id=\"${id}\"\n                             class=\"annotation-content w-100 ${prop.shadow == '1' ? 'shadow' : ''}\"\n                             ${prop.rounded == 1 ? 'style=\"border-radius:1em;\"' : ''} alt=\"${prop.formattedalttext}\"/></a>`);\n            } else {\n                wrapper.append(`<img src=\"${prop.url}\" id=\"${id}\"\n                                 ${timestamp > 0 ? ' data-timestamp=\"' + timestamp + '\"' : ''}\n                                  class=\"annotation-content w-100 ${prop.shadow == '1' ? 'shadow' : ''}\n                                  ${timestamp > 0 ? 'cursor-pointer' : ''}\"\n                                   ${prop.rounded == 1 ? 'style=\"border-radius:1em;\"' : ''} alt=\"${prop.formattedalttext}\"/>`);\n            }\n            if (!self.isEditMode()) {\n                if (prop.gotourl == '' && timestamp == 0) {\n                    wrapper.removeClass('resizable');\n                    wrapper.addClass('no-pointer');\n                } else {\n                    wrapper.addClass('clickable');\n                }\n            }\n            wrapper.css(position);\n            wrapper.css('height', 'auto');\n            $videoWrapper.find(`#canvas`).append(wrapper);\n        };\n\n        const renderVideo = (wrapper, item, prop, id, position) => {\n            wrapper.append(`<video id=\"${id}\" class=\"annotation-content w-100 ${prop.shadow == '1' ? 'shadow' : ''}\"\n                 ${prop.showcontrol == 1 && !self.isEditMode() ? 'controls' : ''}\n                 src=\"${prop.url}\" style=\"border-radius: ${prop.rounded == 1 ? '1em' : '0'}\" disablePictureInPicture/></video>\n             <i class=\"playpause bi bi-play-fill position-absolute\" style=\"font-size: 2em; line-height:: 2em;\"></i>`);\n            var video = wrapper.find('video')[0];\n            video.autoplay = prop.autoplay == '1';\n            video.playsInline = true;\n            if (self.isEditMode()) {\n                video.autoplay = false;\n            }\n            video.onplay = function() {\n                wrapper.find('.playpause').removeClass('bi-play-fill').addClass('bi-pause-fill');\n            };\n            video.onpause = function() {\n                wrapper.find('.playpause').removeClass('bi-pause-fill').addClass('bi-play-fill');\n            };\n            video.onended = function() {\n                wrapper.find('.playpause').removeClass('bi-pause-fill').addClass('bi-play-fill');\n            };\n            wrapper.css(position);\n            $videoWrapper.find(`#canvas`).append(wrapper);\n            recalculatingSize(wrapper);\n        };\n\n        const renderFile = (wrapper, item, prop, id, position) => {\n            const type = item.type;\n            var wrapperhtml = ``;\n            if (type == 'audio') {\n                wrapperhtml = `<span id=\"${id}\" tabindex=\"0\"\n                             class=\"btn ${prop.style} ${prop.rounded == '1' ? 'btn-rounded' : 'rounded-0'}\n                              annotation-content text-nowrap ${prop.shadow == '1' ? 'shadow' : ''} rotatex-360\"\n                               data-src=\"${prop.url}\"><i class=\"bi bi-volume-up fs-unset\" style=\"margin-right:0.25em;\"></i>\n                               <span class=\"timeremaining\">00:00</span></span>`;\n            } else if (type == 'file') {\n                wrapperhtml = `<a id=\"${id}\"\n                             class=\"btn ${prop.style} ${prop.rounded == '1' ? 'btn-rounded' : 'rounded-0'}\n                             annotation-content text-nowrap ${prop.shadow == '1' ? 'shadow' : ''} rotatey-180\" href=\"${prop.url}\"\n                              target=\"_blank\"><i class=\"bi bi-paperclip fs-unset\"></i>${prop.formattedlabel != \"\" ?\n                        `<span style=\"margin-left:0.25em;\">${prop.formattedlabel}` : ''}</a>`;\n            }\n            wrapper.append(`<div class=\"d-flex h-100\">${wrapperhtml}</div>`);\n\n            if (type == 'audio' && !self.isEditMode()) {\n                let playButton = wrapper.find('.annotation-content');\n                let audioSrc = prop.url;\n                let media = new Audio(audioSrc);\n                playButton.on('click', function(e) {\n                    e.stopImmediatePropagation();\n                    if (media.paused || media.ended || media.currentTime === 0) {\n                        media.play();\n                        $(this).find('i').removeClass('bi-volume-up').addClass('bi-pause-fill');\n                    } else {\n                        media.pause();\n                        $(this).find('i').removeClass('bi-pause-fill').addClass('bi-volume-up');\n                    }\n                });\n\n                let totaltime = 0;\n                media.onloadedmetadata = function() {\n                    totaltime = media.duration;\n                    playButton.find('span.timeremaining').text(convertSecondsToMMSS(totaltime));\n                };\n\n                media.onended = function() {\n                    playButton.find('i').removeClass('bi-pause-fill').addClass('bi-volume-up');\n                    playButton.find('span.timeremaining').text(convertSecondsToMMSS(totaltime));\n                };\n\n                media.ontimeupdate = function() {\n                    playButton.find('span.timeremaining')\n                        .text(convertSecondsToMMSS(media.duration - media.currentTime));\n                };\n\n                if (prop.autoplay == '1') {\n                    setTimeout(() => {\n                        playButton.trigger('click');\n                    }, 100);\n                }\n\n                $(document).one('iv:playerSeek iv:playerPlaying', function() {\n                    if (media) {\n                        media.pause();\n                    }\n                });\n            }\n\n            position.width = 0;\n\n            wrapper.css(position);\n            $videoWrapper.find(`#canvas`).append(wrapper);\n            recalculatingTextSize(wrapper, true);\n        };\n\n        const renderNavigation = (wrapper, item, prop, id, position) => {\n            var parts = prop.timestamp.split(':');\n            var timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n\n            wrapper.append(`<div class=\"d-flex h-100\"><span id=\"${id}\" tabindex=\"0\" class=\"btn ${prop.style} ${prop.rounded == '1' ?\n                'btn-rounded' : 'rounded-0'} annotation-content text-nowrap ${prop.shadow == '1' ? 'shadow' : ''}\"\n                data-timestamp=\"${timestamp}\">${prop.formattedlabel}</span></div>`);\n\n            position.width = 0;\n\n            wrapper.css(position);\n            $videoWrapper.find(`#canvas`).append(wrapper);\n            recalculatingTextSize(wrapper, true);\n        };\n\n        const renderStopwatch = (wrapper, item, prop, id, position) => {\n            var duration = Number(prop.duration) * 60;\n            wrapper.append(`<div class=\"d-flex h-100\"><span id=\"${id}\" tabindex=\"0\"\n                             class=\"btn ${prop.style} ${prop.rounded == '1' ? 'btn-rounded' : 'rounded-0'}\n                              annotation-content text-nowrap ${prop.shadow == '1' ? 'shadow' : ''} rotatey-180\"\n                               data-duration=\"${duration}\">\n                               <i class=\"bi bi bi-stopwatch fs-unset\" style=\"margin-right:0.25em;\"></i>\n                               <span>${convertSecondsToMMSS(duration)}</span></span></div>`);\n\n            var timer, alarm;\n            if (timer) {\n                clearInterval(timer);\n            }\n            var intervalfunction = function() {\n                timer = setInterval(() => {\n                    $(`.annotation-content#${id}`).addClass('running');\n                    let time = $(`.annotation-content#${id}`).data('duration');\n                    time--;\n                    $(`.annotation-content#${id} span`).text(convertSecondsToMMSS(time));\n                    $(`.annotation-content#${id}`).data('duration', time);\n                    if (prop.playalarmsound.playsoundatinterval == '1'\n                        && time % (prop.playalarmsound.intervaltime * 60) == 0) {\n                        if (prop.playalarmsound.playsoundatend == 1) {\n                            alarm = new Audio(M.cfg.wwwroot + '/mod/interactivevideo/sounds/short-alarm.mp3');\n                            alarm.play();\n                        }\n                    }\n                    if (time < 0) {\n                        clearInterval(timer);\n                        if (prop.playalarmsound.playsoundatend == 1) {\n                            alarm = new Audio(M.cfg.wwwroot + '/mod/interactivevideo/sounds/alarm.mp3');\n                            alarm.play();\n                            alarm.onplay = function() {\n                                $(`.annotation-content#${id}`).addClass('pulse');\n                            };\n                            alarm.onended = function() {\n                                $(`.annotation-content#${id}`).removeClass('pulse');\n                            };\n                        }\n                        $(`.annotation-content#${id}`).removeClass('running');\n                        $(`.annotation-content#${id} span`).text(convertSecondsToMMSS(duration));\n                        $(`.annotation-content#${id}`).data('duration', duration);\n                    }\n                }, 1000);\n            };\n\n            if (!self.isEditMode()) {\n                intervalfunction();\n                $videoWrapper.on('click', `.annotation-content#${id}`, function(e) {\n                    e.stopImmediatePropagation();\n                    if (prop.allowpause == 1) {\n                        if ($(this).hasClass('running')) {\n                            clearInterval(timer);\n                            if (alarm) {\n                                alarm.pause();\n                            }\n                            $(this).removeClass('running');\n                        } else {\n                            intervalfunction();\n                        }\n                    } else if ($(this).data('duration') == duration) {\n                        intervalfunction();\n                    }\n                });\n            }\n\n            $(document).one('iv:playerSeek', function() {\n                clearInterval(timer);\n            });\n\n            position.width = 0;\n\n            wrapper.css(position);\n            $videoWrapper.find(`#canvas`).append(wrapper);\n            recalculatingTextSize(wrapper, true);\n        };\n\n        const renderTextblock = (wrapper, item, prop, id, position) => {\n            var textparts = prop.formattedlabel.split('\\r\\n');\n            var textblock = '<div class=\"d-flex flex-column\">';\n            textparts.forEach((part) => {\n                if (part.trim() == '') {\n                    return;\n                }\n                textblock += `<span class=\"text-row text-nowrap text-${prop.alignment}\"\n                                 style=\"font-family: ${prop.textfont != '' ? prop.textfont : 'inherit'}\">${part}</span>`;\n            });\n            textblock += '</div>';\n            if (prop.url != undefined && prop.url != '') {\n                wrapper.append(`<a id=\"${id}\"\n                                     class=\"annotation-content d-block ${prop.shadow == '1' ? 'text-shadow' : ''}\"\n                                      href=\"${prop.url}\" target=\"_blank\">${textblock}</a>`);\n                wrapper.addClass('clickable');\n            } else {\n                wrapper.append(`<div id=\"${id}\"\n                                     class=\"annotation-content ${prop.shadow == '1' ? 'text-shadow' : ''}\n                                     \">${textblock}</div>`);\n            }\n            wrapper.position.width = 0;\n            wrapper.css(position);\n            var style = {\n                'font-size': item.position.fontSize,\n                'line-height': item.position.lineHeight,\n                'font-weight': prop.bold == '1' ? 'bold' : 'normal',\n                'font-style': prop.italic == '1' ? 'italic' : 'normal',\n                'text-decoration': prop.underline == '1' ? 'underline' : 'none',\n                'color': prop.textcolor,\n                'background': prop.bgcolor,\n                'border-radius': prop.rounded == '1' ? '0.3em' : '0',\n                'border-width': prop.borderwidth,\n                'border-color': prop.bordercolor,\n                'border-style': 'solid',\n            };\n            wrapper.find('.annotation-content').css(style);\n            $videoWrapper.find(`#canvas`).append(wrapper);\n            recalculatingTextSize(wrapper, false, true);\n        };\n\n        const renderShape = (wrapper, item, prop, id, position) => {\n            var parts = prop.timestamp.split(':');\n            var timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n            if (prop.gotourl != '') {\n                wrapper.append(`<a href=\"${prop.gotourl}\" target=\"_blank\"><div id=\"${id}\"\n                             class=\"annotation-content ${prop.shadow == '1' ? 'shadow' : ''}\"\n                              style=\"width: 100%; height: 100%;\"></div></a>`);\n                wrapper.addClass('clickable');\n            } else {\n                if (!self.isEditMode()) {\n                    if (timestamp == 0) {\n                        wrapper.addClass('no-pointer');\n                    } else {\n                        wrapper.addClass('clickable');\n                    }\n                }\n                wrapper.append(`<div id=\"${id}\" class=\"annotation-content ${prop.shadow == '1' ? 'shadow' : ''}\n                                 ${timestamp > 0 ? 'cursor-pointer' : ''}\"\n                             ${timestamp > 0 ? 'data-timestamp=\"' + timestamp + '\"' : ''}\n                             style=\"width: 100%; height: 100%;\"></div>`);\n            }\n            wrapper.css(position);\n            var style = {\n                'background': prop.bgcolor,\n                'border-width': prop.borderwidth,\n                'border-color': prop.bordercolor,\n                'border-style': 'solid',\n                'opacity': prop.opacity / 100,\n            };\n            if (prop.shape == 'circle') {\n                style['border-radius'] = '50%';\n            } else if (prop.shape == 'rectangle') {\n                style['border-radius'] = prop.rounded == '1' ? '1em' : '0';\n            }\n            wrapper.find('.annotation-content').css(style);\n            $videoWrapper.find(`#canvas`).append(wrapper);\n        };\n\n        const renderHotspot = (wrapper, item, prop, id, position) => {\n            wrapper.append(`<div id=\"${id}\" class=\"annotation-content shadow-sm pulse\" role=\"button\"></div>`);\n            position['aspect-ratio'] = '1';\n            wrapper.css(position);\n            var style = {\n                'background-color': prop.color,\n                'opacity': prop.opacity / 100,\n                'border-radius': '50%',\n                'aspect-ratio': '1',\n            };\n            wrapper.find('.annotation-content').css(style);\n            $videoWrapper.find(`#canvas`).append(wrapper);\n\n            if (!self.isEditMode()) {\n                if (prop.usemodal == '1') {\n                    wrapper.attr({\n                        'data-toggle': 'modal',\n                    });\n                } else {\n                    wrapper.attr({\n                        'tabindex': -1,\n                        'data-trigger': 'manual',\n                        'data-boundary': 'viewport',\n                        'data-placement': 'auto',\n                        'data-html': 'true',\n                        'data-content': '<div class=\"loader\"></div>',\n                        'data-title': prop.formattedtitle\n                            + `<i class=\"bi bi-x-circle-fill ml-auto popover-dismiss cursor-pointer\"\n                                         style=\"font-size:1.5em;\"></i>`,\n                    });\n\n                    wrapper.popover({\n                        container: '#wrapper',\n                        html: true,\n                        template: `<div class=\"popover inlineannotation-popover id-${id}\"\n                                     role=\"tooltip\"><div class=\"arrow\"></div>\n                                     <h3 class=\"popover-header d-flex justify-content-between\"></h3>\n                                     <div class=\"popover-body rounded\"></div>${prop.url != '' ?\n                                `<div class=\"popup-footer bg-light p-2 rounded-bottom\"><a href=\"${prop.url}\"\n                                          class=\"d-block w-100 text-right rotatex-360\" target=\"_blank\">\n                                          <i class=\"bi bi-arrow-right\"><i></i></i></a></div>` : ''}</div>`,\n                    });\n\n                    wrapper.on('shown.bs.popover', async function() {\n                        let $body = $(`.popover.id-${id} .popover-body`);\n                        const html = await self.formatContent(prop.content.text, M.cfg.contextid);\n                        $body.html(html);\n                        notifyFilter($body);\n                        wrapper.popover('update');\n                    });\n                    if (prop.openbydefault == '1') {\n                        wrapper.popover('show');\n                    }\n                }\n            }\n        };\n\n        const renderItems = (elements, actives, update) => {\n            if (!update) { // Clear the canvas if it is a new start.\n                $videoWrapper.find(`#canvas`).empty();\n            }\n\n            if (elements.length == 0) {\n                if (actives) {\n                    actives.forEach((active) => {\n                        $videoWrapper.find(`#canvas .annotation-wrapper[data-item=\"${active}\"]`).addClass('active');\n                    });\n                }\n            } else {\n                let count = 0;\n                elements.forEach((item) => {\n                    let prop = item.properties;\n                    let type = item.type;\n                    let id = item.id;\n                    let position = item.position;\n                    let wrapper = $(`<div class=\"annotation-wrapper\" data-group=\"${position.group}\" data-anno=\"${annotation.id}\"\n                     data-item=\"${id}\" data-type=\"${type}\" data-property='${JSON.stringify(prop)}'></div>`);\n                    if (prop.resizable == '1' || self.isEditMode()) {\n                        wrapper.addClass('resizable');\n                        wrapper.attr('tabindex', 0);\n                    }\n\n                    switch (type) {\n                        case 'image':\n                            renderImage(wrapper, item, prop, id, position);\n                            break;\n                        case 'video':\n                            renderVideo(wrapper, item, prop, id, position);\n                            break;\n                        case 'file':\n                        case 'audio':\n                            renderFile(wrapper, item, prop, id, position);\n                            break;\n                        case 'navigation':\n                            renderNavigation(wrapper, item, prop, id, position);\n                            break;\n                        case 'stopwatch':\n                            renderStopwatch(wrapper, item, prop, id, position);\n                            break;\n                        case 'textblock':\n                            renderTextblock(wrapper, item, prop, id, position);\n                            break;\n                        case 'shape':\n                            renderShape(wrapper, item, prop, id, position);\n                            break;\n                        case 'hotspot':\n                            renderHotspot(wrapper, item, prop, id, position);\n                            break;\n                    }\n\n                    count++;\n                    if (count == elements.length) {\n                        $videoWrapper.find(`#canvas .annotation-wrapper.resizable`).draggable({\n                            containment: \"#canvas\",\n                            cursor: \"move\",\n                            grid: [1, 1],\n                            handle: '.annotation-content',\n                            start: function() {\n                                // Get all the selected elements\n                                if (!$(this).hasClass('active')) {\n                                    $(this).trigger('click');\n                                }\n                                let $selected = $videoWrapper.find('#canvas .annotation-wrapper.active');\n                                $selected.each(function() {\n                                    $(this).data('startPosition', $(this).position());\n                                });\n                            },\n                            drag: function(event, ui) {\n                                var $selected = $videoWrapper.find('#canvas .annotation-wrapper.active');\n                                var left = ui.originalPosition.left - ui.position.left;\n                                var top = ui.originalPosition.top - ui.position.top;\n                                var positions = $selected.map(function() {\n                                    return {\n                                        id: $(this).data('item'),\n                                        left: $(this).position().left,\n                                        top: $(this).position().top,\n                                        bottom: $(this).position().top + $(this).height(),\n                                        right: $(this).position().left + $(this).width(),\n                                    };\n                                }).get();\n\n                                if (positions.find(x => x.left < 0)) {\n                                    // Sort the elements by left position to get the leftmost element\n                                    positions.sort((a, b) => a.left - b.left);\n                                    let onLeft = positions.find(x => x.left < 0);\n                                    let id = onLeft.id;\n                                    let target = $videoWrapper.find(`#canvas .annotation-wrapper[data-item=\"${id}\"]`);\n                                    target.css('left', 0);\n                                    let distance = target.data('startPosition').left;\n                                    ui.position.left = ui.originalPosition.left - distance;\n                                    left = ui.originalPosition.left - ui.position.left;\n                                }\n\n                                if (positions.find(x => x.top < 0)) {\n                                    positions.sort((a, b) => a.top - b.top);\n                                    let onTop = positions.find(x => x.top < 0);\n                                    let id = onTop.id;\n                                    let target = $videoWrapper.find(`#canvas .annotation-wrapper[data-item=\"${id}\"]`);\n                                    target.css('top', 0);\n                                    let distance = target.data('startPosition').top;\n                                    ui.position.top = ui.originalPosition.top - distance;\n                                    top = ui.originalPosition.top - ui.position.top;\n                                }\n\n                                if (positions.find(x => x.right > $('#canvas').width())) {\n                                    positions.sort((a, b) => a.right - b.right);\n                                    let onRight = positions.find(x => x.right > $('#canvas').width());\n                                    let id = onRight.id;\n                                    let target = $videoWrapper.find(`#canvas .annotation-wrapper[data-item=\"${id}\"]`);\n                                    target.css('left', ($('#canvas').width() - target.width() - 1) + 'px');\n                                    let distance = target.data('startPosition').left - target.position().left;\n                                    ui.position.left = ui.originalPosition.left - distance;\n                                    left = ui.originalPosition.left - ui.position.left;\n                                }\n\n                                if (positions.find(x => x.bottom > $('#canvas').height())) {\n                                    positions.sort((a, b) => a.bottom - b.bottom);\n                                    let onBottom = positions.find(x => x.bottom > $('#canvas').height());\n                                    let id = onBottom.id;\n                                    let target = $videoWrapper.find(`#canvas .annotation-wrapper[data-item=\"${id}\"]`);\n                                    target.css('top', ($('#canvas').height() - target.height() - 1) + 'px');\n                                    let distance = target.data('startPosition').top - target.position().top;\n                                    ui.position.top = ui.originalPosition.top - distance;\n                                    top = ui.originalPosition.top - ui.position.top;\n                                }\n\n                                $selected.not(this).each(function() {\n                                    var $this = $(this);\n                                    var position = $this.data('startPosition');\n                                    $this.css({\n                                        left: (position.left - left) + 'px',\n                                        top: (position.top - top) + 'px',\n                                    });\n                                });\n                                updatePositionInfo($(this));\n                            },\n                            stop: function() {\n                                if (self.isEditMode()) {\n                                    let $selected = $videoWrapper.find('#canvas .annotation-wrapper.active');\n                                    var positions = $selected.map(function() {\n                                        return {\n                                            id: $(this).data('item'),\n                                            left: $(this).position().left,\n                                            top: $(this).position().top,\n                                            bottom: $(this).position().top + $(this).height(),\n                                            right: $(this).position().left + $(this).width(),\n                                        };\n                                    }).get();\n\n                                    if (positions.find(x => x.left < 0)) {\n                                        positions.sort((a, b) => a.left - b.left);\n                                        let onLeft = positions.find(x => x.left < 0);\n                                        let id = onLeft.id;\n                                        let target = $videoWrapper.find(`#canvas .annotation-wrapper[data-item=\"${id}\"]`);\n                                        target.css('left', 0);\n                                        let distance = target.data('startPosition').left;\n                                        $selected.each(function() {\n                                            let $this = $(this);\n                                            let position = $this.data('startPosition');\n                                            let newLeft = position.left - distance;\n                                            $this.css('left', newLeft + 'px');\n                                        });\n                                    }\n\n                                    if (positions.find(x => x.top < 0)) {\n                                        positions.sort((a, b) => a.top - b.top);\n                                        let onTop = positions.find(x => x.top < 0);\n                                        let id = onTop.id;\n                                        let target = $videoWrapper.find(`#canvas .annotation-wrapper[data-item=\"${id}\"]`);\n                                        target.css('top', 0);\n                                        let distance = target.data('startPosition').top;\n                                        $selected.each(function() {\n                                            let $this = $(this);\n                                            let position = $this.data('startPosition');\n                                            let newTop = position.top - distance;\n                                            $this.css('top', newTop + 'px');\n                                        });\n                                    }\n\n                                    if (positions.find(x => x.right > $('#canvas').width())) {\n                                        positions.sort((a, b) => a.right - b.right);\n                                        let onRight = positions.find(x => x.right > $('#canvas').width());\n                                        let id = onRight.id;\n                                        let target = $videoWrapper.find(`#canvas .annotation-wrapper[data-item=\"${id}\"]`);\n                                        target.css('left', ($('#canvas').width() - target.width() - 1) + 'px');\n                                        let distance = target.data('startPosition').left - target.position().left;\n                                        $selected.each(function() {\n                                            let $this = $(this);\n                                            let position = $this.data('startPosition');\n                                            let newLeft = position.left - distance;\n                                            $this.css('left', newLeft + 'px');\n                                        });\n                                    }\n\n                                    if (positions.find(x => x.bottom > $('#canvas').height())) {\n                                        positions.sort((a, b) => a.bottom - b.bottom);\n                                        let onBottom = positions.find(x => x.bottom > $('#canvas').height());\n                                        let id = onBottom.id;\n                                        let target = $videoWrapper.find(`#canvas .annotation-wrapper[data-item=\"${id}\"]`);\n                                        target.css('top', ($('#canvas').height() - target.height() - 1) + 'px');\n                                        let distance = target.data('startPosition').top - target.position().top;\n                                        $selected.each(function() {\n                                            let $this = $(this);\n                                            let position = $this.data('startPosition');\n                                            let newTop = position.top - distance;\n                                            $this.css('top', newTop + 'px');\n                                        });\n                                    }\n\n                                    getItems(false);\n                                    updatePositionInfo($(this));\n                                    $selected = $selected.map(function() {\n                                        return $(this).data('item');\n                                    }).get();\n\n                                    saveTracking($selected);\n                                }\n                            }\n                        });\n\n                        $videoWrapper.find('#canvas .annotation-wrapper.resizable').resizable({\n                            containment: \"#canvas\",\n                            handles: \"all\",\n                            grid: [1, 1],\n                            minHeight: 1,\n                            resize: function(event) {\n                                if (self.isEditMode()) {\n                                    let type = $(this).data('type');\n                                    if (type == 'file'\n                                        || type == 'audio' || type == 'stopwatch' || type == 'navigation' || type == 'textblock') {\n                                        recalculatingTextSize($(this), type != 'textblock', type == 'textblock');\n                                    } else if (type == 'shape' && event.ctrlKey) {\n                                        $(this).resizable('option', 'aspectRatio', 1);\n                                    }\n                                    updatePositionInfo($(this));\n                                }\n                            },\n                            stop: function() {\n                                if (self.isEditMode()) {\n                                    let type = $(this).data('type');\n                                    if (type == 'file' || type == 'navigation' || type == 'textblock') {\n                                        recalculatingTextSize($(this), type != 'textblock', type == 'textblock');\n                                    } else if (type == 'shape') {\n                                        $(this).resizable('option', 'aspectRatio', false);\n                                    }\n                                    recalculatingSize($(this));\n                                    getItems(false);\n                                    saveTracking([$(this).data('item')]);\n                                    $(this).trigger('click');\n                                }\n                            }\n                        });\n                    }\n\n                    if (type != 'shape') {\n                        wrapper.on('mouseover', function() {\n                            if (!$(this).hasClass('resizable')) {\n                                return;\n                            }\n\n                            let aspectRatio =\n                                $(this).find('.annotation-content').width() / $(this).find('.annotation-content').height();\n                            if (wrapper.width() / wrapper.height() != aspectRatio && (type == 'image' || type == 'video')) {\n                                $(this).height((wrapper.width() / aspectRatio));\n                            }\n                            $(this).resizable('option', 'aspectRatio', $(this).find('.annotation-content').outerWidth() /\n                                $(this).find('.annotation-content').outerHeight());\n                        });\n                    }\n\n                    if (actives && actives.includes(id)) {\n                        wrapper.addClass('active');\n                        if (actives.length == 1) {\n                            setTimeout(function() {\n                                wrapper.trigger('mouseover');\n                                wrapper.trigger('click');\n                            }, 500);\n                        }\n                    }\n\n                });\n\n                // Handle behavior for each item\n                if (!self.isEditMode()) {\n                    $videoWrapper.on('click', `#canvas .annotation-wrapper`, function(e) {\n                        e.stopImmediatePropagation();\n                        let wrapper = $(this);\n                        let type = wrapper.data('type');\n                        switch (type) {\n                            case 'video':\n                                var video = wrapper.find('video')[0];\n                                if (video.paused || video.ended || video.currentTime === 0) {\n                                    video.play();\n                                } else {\n                                    video.pause();\n                                }\n                                break;\n                            case 'navigation':\n                            case 'image':\n                            case 'shape':\n                                var navigation = wrapper.find('.annotation-content');\n                                if (self.isBetweenStartAndEnd(navigation.data('timestamp'))) {\n                                    self.player.seek(navigation.data('timestamp'));\n                                    self.player.play();\n                                }\n                                break;\n                            case 'hotspot':\n                                var viewertype = wrapper.data('toggle');\n                                var hotspotid = wrapper.data('item');\n                                var hotspot = items.find(x => x.id == hotspotid);\n                                if (viewertype == 'modal') {\n                                    let title = hotspot.properties.formattedtitle;\n                                    let content = hotspot.properties.content.text;\n                                    let url = hotspot.properties.url;\n                                    let modal = `<div class=\"modal fade\" id=\"annotation-modal\" role=\"dialog\"\n                                aria-labelledby=\"annotation-modal\"\n                             aria-hidden=\"true\" data-backdrop=\"static\" data-keyboard=\"false\">\n                             <div class=\"modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable\" role=\"document\">\n                                <div class=\"modal-content rounded-lg\">\n                                    <div class=\"modal-header d-flex align-items-center shadow-sm pr-0\" id=\"title\">\n                                        <h5 class=\"modal-title text-truncate mb-0\">${title}</h5>\n                                        <button class=\"btn mx-2 p-0 close\" aria-label=\"Close\" data-dismiss=\"modal\">\n                                            <i class=\"bi bi-x-lg fa-fw\" style=\"font-size: x-large;\"></i>\n                                        </button>\n                                    </div>\n                                    <div class=\"modal-body\" id=\"content\">\n                                    <div class=\"loader\"></div>\n                                    </div>\n                                    ${url != '' ? `<div class=\"modal-footer bg-light p-2 rounded-bottom\">\n                                        <a href=\"${url}\" class=\"d-block w-100 text-right rotatex-360\" target=\"_blank\">\n                                        <i class=\"bi bi-arrow-right\"><i></i></i></a></div>` : ''}\n                                    </div>\n                                </div>\n                                </div>`;\n                                    $('#wrapper').append(modal);\n                                    $('#annotation-modal').modal('show');\n                                    $('#annotation-modal').on('hide.bs.modal', function() {\n                                        $('#annotation-modal').remove();\n                                    });\n                                    $('#annotation-modal').on('shown.bs.modal', async function() {\n                                        $('#annotation-modal .modal-body').fadeIn(300);\n                                        let $body = $('#annotation-modal .modal-body');\n                                        const html = await self.formatContent(content, M.cfg.contextid);\n                                        $body.html(html);\n                                        notifyFilter($body);\n                                    });\n                                } else {\n                                    wrapper.popover('show');\n                                }\n                                break;\n                        }\n                    });\n\n                    $playerWrapper.on('click', `.popover-dismiss`, function(e) {\n                        e.stopImmediatePropagation();\n                        $(this).closest('.popover').remove();\n                    });\n                }\n            }\n        };\n\n        // Check resize on video wrapper resize\n        let vwrapper = document.querySelector('#video-wrapper');\n\n        let resizeObserver = new ResizeObserver(() => {\n            let existingwrapper = $(`#video-wrapper`).find(`#canvas .annotation-wrapper`);\n            if (existingwrapper.length == 0) {\n                return;\n            }\n            existingwrapper.each(function() {\n                let type = $(this).data('type');\n                setTimeout(() => {\n                    if (type == 'textblock'\n                        || type == 'audio' || type == 'stopwatch' || type == 'file' || type == 'navigation') {\n                        recalculatingTextSize($(this), type != 'textblock', type == 'textblock');\n                    } else if (type == 'video') {\n                        recalculatingSize($(this));\n                    }\n                }, 100);\n                $('#canvas').css('font-size', $('#canvas').width() / 75 + 'px');\n            });\n        });\n        resizeObserver.observe(vwrapper);\n\n        // Ready to render items.\n        let items = [];\n        let tracking = [];\n        let trackingIndex = 0;\n        if (data.items != '' && data.items !== null) {\n            items = JSON.parse(data.items);\n            tracking.push({\n                items: JSON.stringify(items),\n                actives: null,\n                at: new Date().getTime(),\n            });\n        }\n        let draftitemid = data.draftitemid;\n\n        renderItems(items, null, false);\n\n        // Render the inline annotation toolbar\n        if (this.isEditMode()) {\n            $('#inlineannotation-btns').remove();\n            let inlineannotationitems = [\n                {\n                    'icon': 'bi bi-image',\n                    'type': 'media',\n                    'mediatype': 'image',\n                    'label': M.util.get_string('image', 'ivplugin_inlineannotation'),\n                },\n                {\n                    'icon': 'bi bi-film',\n                    'type': 'media',\n                    'mediatype': 'video',\n                    'label': M.util.get_string('video', 'ivplugin_inlineannotation'),\n                },\n                {\n                    'icon': 'bi bi-volume-up',\n                    'type': 'media',\n                    'mediatype': 'audio',\n                    'label': M.util.get_string('audio', 'ivplugin_inlineannotation'),\n                },\n                {\n                    'icon': 'bi bi-alphabet-uppercase',\n                    'type': 'textblock',\n                    'mediatype': 'textblock',\n                    'label': M.util.get_string('text', 'ivplugin_inlineannotation'),\n                },\n                {\n                    'icon': 'bi bi-circle-square',\n                    'type': 'shape',\n                    'mediatype': 'shape',\n                    'label': M.util.get_string('shape', 'ivplugin_inlineannotation'),\n                },\n                {\n                    'icon': 'bi bi-stopwatch',\n                    'type': 'stopwatch',\n                    'mediatype': 'stopwatch',\n                    'label': M.util.get_string('stopwatch', 'ivplugin_inlineannotation'),\n                },\n                {\n                    'icon': 'bi bi-file-earmark-arrow-down',\n                    'type': 'media',\n                    'mediatype': 'file',\n                    'label': M.util.get_string('inlinefile', 'ivplugin_inlineannotation'),\n                },\n                {\n                    'icon': 'bi bi-sign-turn-right',\n                    'type': 'navigation',\n                    'mediatype': 'navigation',\n                    'label': M.util.get_string('navigation', 'ivplugin_inlineannotation')\n                },\n                {\n                    'icon': 'bi bi-plus-circle',\n                    'type': 'hotspot',\n                    'mediatype': 'hotspot',\n                    'label': M.util.get_string('hotspot', 'ivplugin_inlineannotation'),\n                }\n            ];\n            const dataForTemplate = {\n                id: annotation.id,\n                items: inlineannotationitems,\n            };\n\n            Templates.render('ivplugin_inlineannotation/toolbar', dataForTemplate).then((html) => {\n                return $videoWrapper.before(html);\n            }).catch(() => {\n                // Do nothing.\n            });\n\n            self.enableColorPicker();\n        }\n\n        $(document).one('iv:playerSeek iv:playerPlaying', function(e) {\n            let newTime = e.detail.time;\n            if (Math.floor(newTime) != annotation.timestamp) {\n                $(`#inlineannotation-btns`).remove();\n                $('.inlineannotation-popover').remove();\n                $videoWrapper.find(`#canvas`).remove();\n            }\n        });\n\n        $playerWrapper.on('click', `#canvas`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            if (!self.isEditMode()) {\n                self.player.play();\n            } else {\n                $videoWrapper.find('#canvas .annotation-wrapper').removeClass('active');\n                $('#inlineannotation-btns .btn').removeClass('active rotatey-360');\n                $('#edit-btns').attr('data-active', '').addClass('d-none').removeClass('d-flex');\n            }\n        });\n\n        // End of view mode.\n        if (!self.isEditMode()) {\n            return;\n        }\n\n        /**\n         * Update tracking data for redo and undo\n         * @param {Array} actives array of active items\n         */\n        const saveTracking = (actives) => {\n            if (trackingIndex < tracking.length - 1) {\n                // Remove all the tracking data after the current index.\n                tracking = tracking.slice(0, trackingIndex + 1);\n            }\n            tracking.push({\n                items: JSON.stringify(items),\n                actives: actives,\n                at: new Date().getTime(),\n            });\n            tracking.sort((a, b) => a.at - b.at);\n            trackingIndex = tracking.length - 1;\n            $('#inlineannotation-btns #undo').removeAttr('disabled');\n            $('#inlineannotation-btns #redo').attr('disabled', 'disabled');\n            if (tracking.length == 1) {\n                $('#inlineannotation-btns #undo').attr('disabled', 'disabled');\n            }\n        };\n\n        /**\n         * Order items by layer.\n         * @param {Array} ids array of item ids\n         * @param {String} order asc or desc\n         * @returns {Array} sorted array of item ids\n         */\n        const sortItemsByLayer = (ids, order) => {\n            ids = ids.map(x => x.toString()); // Convert ids to string for consistency.\n            let targetItems = items.filter(item => {\n                const id = item.id.toString();\n                return ids.includes(id);\n            });\n            if (order == 'desc') {\n                targetItems.sort((a, b) => b.position['z-index'] - a.position['z-index']);\n            } else {\n                targetItems.sort((a, b) => a.position['z-index'] - b.position['z-index']);\n            }\n\n            return targetItems.map(item => item.id);\n        };\n\n        /**\n         * Get highest z-index.\n         * @param {Array} itms array of items\n         * @returns {Number} top z-index\n         */\n        const getTopLayer = (itms) => {\n            if (itms.length == 0) {\n                return 5;\n            }\n            let ids = itms.map(item => item.id);\n            let sorted = sortItemsByLayer(ids, 'desc');\n            let zindex = itms.find(item => item.id == sorted[0]).position['z-index'];\n            return Number(zindex);\n        };\n\n        /**\n         * Get lowest z-index.\n         * @param {Array} itms array of items\n         * @returns {Number} bottom z-index\n         */\n        const getBottomLayer = (itms) => {\n            if (itms.length == 0) {\n                return 5;\n            }\n            let ids = itms.map(item => item.id);\n            let sorted = sortItemsByLayer(ids, 'asc');\n            let zindex = itms.find(item => item.id == sorted[0]).position['z-index'];\n            return Number(zindex);\n        };\n\n        /**\n         * Get all items from the annotation-canvas.\n         * @param {Boolean} updateid whether or not to update the id of the item.\n         */\n        const getItems = (updateid) => {\n            let newItems = [];\n            $videoWrapper.find(`#canvas .annotation-wrapper`).each(function(index, element) {\n                const id = $(element).data('item');\n                let item = {\n                    \"type\": $(element).data('type'),\n                    \"position\": recalculatingSize($(element)),\n                };\n                item.id = id;\n                item.properties = items.find(x => x.id == id).properties;\n                if (updateid) {\n                    item.id = new Date().getTime() + index;\n                    $(element).attr('data-item', item.id);\n                }\n                newItems.push(item);\n            });\n            items = newItems;\n            draftStatus = 'draft';\n        };\n\n        $playerWrapper.on('click', `#inlineannotation-btns #save`, function(e) {\n            e.stopImmediatePropagation();\n            getItems(false);\n            // Encode html tags\n            let cleanItems = JSON.stringify(items).replace(/</g, '&lt;').replace(/>/g, '&gt;');\n            let updateId = $videoWrapper.find('#canvas').data('id');\n            $.ajax({\n                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                method: \"POST\",\n                dataType: \"text\",\n                data: {\n                    action: 'quickeditfield',\n                    sesskey: M.cfg.sesskey,\n                    id: updateId,\n                    field: 'content',\n                    contextid: M.cfg.contextid,\n                    draftitemid: draftitemid,\n                    value: cleanItems,\n                    cmid: self.cmid,\n                    token: self.token,\n                },\n                success: function(data) {\n                    let updated = JSON.parse(data);\n                    draftStatus = null;\n                    tracking = [];\n                    $('#inlineannotation-btns #redo, #inlineannotation-btns #undo').attr('disabled', 'disabled');\n                    dispatchEvent('annotationupdated', {\n                        annotation: updated,\n                        action: 'edit',\n                    });\n                }\n            });\n        });\n\n        $(document).off('click', `#inlineannotation-btns #closetoolbar`)\n            .on('click', `#inlineannotation-btns #closetoolbar`, function(e) {\n                e.stopImmediatePropagation();\n                if (draftStatus == 'draft') {\n                    Notification.saveCancel(\n                        M.util.get_string('unsavedchange', 'ivplugin_inlineannotation'),\n                        M.util.get_string('unsavedchangeconfirm', 'ivplugin_inlineannotation'),\n                        M.util.get_string('save', 'ivplugin_inlineannotation'),\n                        function() {\n                            // If the user clicks save, save the changes.\n                            $('#inlineannotation-btns #save').trigger('click');\n                            draftStatus = null;\n                            tracking = [];\n                            $(`#inlineannotation-btns #closetoolbar`).trigger('click');\n                        },\n                        function() {\n                            $(`#inlineannotation-btns`).remove();\n                            $('#canvas[data-id=\"' + annotation.id + '\"]').remove();\n                        }\n                    );\n                } else {\n                    $(`#inlineannotation-btns`).remove();\n                    $('#canvas[data-id=\"' + annotation.id + '\"]').remove();\n                }\n            });\n\n        $(document).on('click', `#inlineannotation-btns #hideshow`, function(e) {\n            e.stopImmediatePropagation();\n            $('#canvas[data-id=\"' + annotation.id + '\"]').toggle();\n            $(this).find('i').toggleClass('bi-eye bi-eye-slash');\n        });\n        /**\n         * Handle form data when adding or editing an item.\n         * @param {Object} newItem data from form submission\n         * @param {String} type type of the item\n         * @param {Boolean} add adding or editing\n         */\n        const handleFormData = (newItem, type, add) => {\n            switch (type) {\n                case 'audio':\n                case 'file':\n                    if (add) {\n                        newItem.position.height = '40px';\n                        newItem.position.width = '130px';\n                    }\n                    break;\n                case 'textblock':\n                    if (add) {\n                        newItem.position.fontSize = '16px';\n                        newItem.position.lineHeight = '20px';\n                    }\n                    break;\n                case 'navigation':\n                case 'stopwatch':\n                    if (add) {\n                        newItem.position.height = '40px';\n                        newItem.position.width = '130px';\n                    }\n                    break;\n                case 'shape':\n                    if (add) {\n                        newItem.position.height = '100px';\n                        newItem.position.width = '100px';\n                    }\n                    break;\n                case 'video':\n                case 'image':\n                    newItem.position.height = 'auto';\n                    break;\n                case 'hotspot':\n                    if (add) {\n                        newItem.position.width = '5%';\n                    }\n                    break;\n            }\n\n            items.push(newItem);\n            saveTracking([newItem.id]);\n            renderItems([newItem], [newItem.id], true);\n        };\n\n        $playerWrapper.on('click', `#inlineannotation-btns .add-ia`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            let annoid = $videoWrapper.find(`#canvas`).data('id');\n            let type = $(this).attr('data-mediatype');\n            if (type == 'stopwatch' && items.find(x => x.type == 'stopwatch')) {\n                self.addNotification(M.util.get_string('onlyonestopwatch', 'ivplugin_inlineannotation'), 'danger');\n                return;\n            }\n            let iaform = new ModalForm({\n                formClass: \"ivplugin_inlineannotation\\\\items\\\\\" + $(this).attr('data-type'),\n                args: {\n                    contextid: M.cfg.contextid,\n                    id: 0,\n                    type: type,\n                    annotationid: annoid,\n                },\n                modalConfig: {\n                    title: M.util.get_string('addinlineannotation', 'ivplugin_inlineannotation',\n                        M.util.get_string(type, 'ivplugin_inlineannotation')),\n                }\n            });\n\n            iaform.show();\n\n            iaform.addEventListener(iaform.events.LOADED, () => {\n                iaform.modal.modal.draggable({\n                    handle: \".modal-header\",\n                });\n                if (type == 'navigation' || type == 'image' || type == 'shape') {\n                    $(document).on('change', '[name=\"timestamp\"]', function(e) {\n                        e.preventDefault();\n                        let parts = $(this).val().split(':');\n                        let timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                        if (!self.isBetweenStartAndEnd(timestamp)) {\n                            let message = M.util.get_string('timemustbebetweenstartandendtime', 'ivplugin_inlineannotation', {\n                                \"start\": self.convertSecondsToHMS(self.start),\n                                \"end\": self.convertSecondsToHMS(self.end),\n                            });\n                            self.addNotification(message);\n                            $(this).val($(this).attr('data-initial-value'));\n                            return;\n                        }\n\n                        // Make sure the timestamp is not in the skip segment.\n                        if (self.isInSkipSegment(timestamp)) {\n                            self.addNotification(M.util.get_string('interactionisbetweentheskipsegment',\n                                'ivplugin_inlineannotation'));\n                            $(this).val($(this).attr('data-initial-value'));\n                            return;\n                        }\n                    });\n                }\n            });\n\n            iaform.addEventListener(iaform.events.FORM_SUBMITTED, (e) => {\n                e.stopImmediatePropagation();\n                getItems(false);\n                const highestOrder = getTopLayer(items);\n                let left = Math.random() * 100;\n                let top = Math.random() * 100;\n                let newItem = {\n                    \"id\": new Date().getTime(),\n                    \"type\": type,\n                    \"position\": {\n                        \"width\": \"30%\",\n                        \"left\": left + \"px\",\n                        \"top\": top + \"px\",\n                        \"z-index\": highestOrder + 1,\n                    },\n                    'properties': e.detail,\n                };\n                handleFormData(newItem, type, true);\n            });\n        });\n\n        $playerWrapper.on('click', `#inlineannotation-btns #edit`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            let annnoid = $videoWrapper.find(`#canvas`).data('id');\n            let active = $('#edit-btns').attr('data-active');\n            getItems(false);\n            let item = items.find(x => x.id == active);\n            let type = item.type;\n            let formdata = {...item.properties};\n            formdata.contextid = M.cfg.contextid;\n            formdata.id = item.id;\n            formdata.annotationid = annnoid;\n            formdata.type = type;\n            let editform = new ModalForm({\n                formClass: \"ivplugin_inlineannotation\\\\items\\\\\" +\n                    (type == 'image' || type == 'video' || type == 'audio' || type == 'file' ? 'media' : type),\n                args: formdata,\n                modalConfig: {\n                    title: M.util.get_string('editinlineannotation', 'ivplugin_inlineannotation',\n                        M.util.get_string(type, 'ivplugin_inlineannotation')),\n                }\n            });\n\n            editform.show();\n\n            editform.addEventListener(editform.events.LOADED, () => {\n                editform.modal.modal.draggable({\n                    handle: \".modal-header\",\n                });\n                if (type == 'navigation' || type == 'image' || type == 'shape') {\n                    $(document).on('change', '[name=\"timestamp\"]', function(e) {\n                        e.preventDefault();\n                        let parts = $(this).val().split(':');\n                        let timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                        if (!self.isBetweenStartAndEnd(timestamp)) {\n                            let message = M.util.get_string('timemustbebetweenstartandendtime', 'mod_interactivevideo', {\n                                \"start\": self.convertSecondsToHMS(self.start),\n                                \"end\": self.convertSecondsToHMS(self.end),\n                            });\n                            self.addNotification(message);\n                            $(this).val($(this).attr('data-initial-value'));\n                            return;\n                        }\n\n                        // Make sure the timestamp is not in the skip segment.\n                        if (self.isInSkipSegment(timestamp)) {\n                            self.addNotification(M.util.get_string('interactionisbetweentheskipsegment', 'mod_interactivevideo'));\n                            $(this).val($(this).attr('data-initial-value'));\n                            return;\n                        }\n                    });\n                }\n            });\n\n            editform.addEventListener(editform.events.FORM_SUBMITTED, (e) => {\n                e.stopImmediatePropagation();\n                getItems(false);\n                item = items.find(x => x.id == active);\n                item.properties = e.detail;\n                // Remove the item from the annotation-canvas\n                $videoWrapper.find(`.annotation-wrapper[data-item=\"${active}\"]`).remove();\n                items = items.filter(x => x.id != active);\n                handleFormData(item, type, false);\n            });\n        });\n\n        $videoWrapper.on('click', `#canvas .annotation-wrapper`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            if (!e.ctrlKey && !e.metaKey) {\n                $videoWrapper.find('#canvas .annotation-wrapper').removeClass('active');\n                $(this).addClass('active');\n                this.focus();\n                recalculatingSize($(this));\n            } else {\n                if ($(this).hasClass('active')) {\n                    $(this).removeClass('active');\n                } else {\n                    $(this).addClass('active');\n                    this.focus();\n                }\n            }\n\n            if (!isNaN(Number($(this).data('group')))) {\n                let group = $(this).data('group');\n                $videoWrapper.find(`#canvas .annotation-wrapper[data-group=\"${group}\"]`).addClass('active');\n            }\n\n            recalculatingSize($(this));\n\n            var activewrapper = $videoWrapper.find('#canvas .annotation-wrapper.active');\n            if (activewrapper.length == 0) {\n                $('#edit-btns').attr('data-active', '').addClass('d-none').removeClass('d-flex');\n                $('#inlineannotation-btns #edit').attr('disabled', 'disabled');\n                $('#inlineannotation-btns #edit').removeAttr('disabled');\n            } else {\n                let dataActive = activewrapper.map(function() {\n                    return $(this).data('item');\n                }).get();\n                $('#edit-btns').attr('data-active', dataActive).addClass('d-flex').removeClass('d-none');\n                if (activewrapper.length > 1) {\n                    $('#inlineannotation-btns #edit').attr('disabled', 'disabled');\n                    $('#edit-btns #position').addClass('d-none');\n                } else {\n                    $('#inlineannotation-btns #edit').removeAttr('disabled');\n                    $('#edit-btns #position').removeClass('d-none');\n                }\n            }\n\n            // Enable ungroup button if the active items are grouped.\n            let grouping = activewrapper.map(function() {\n                return $(this).data('group');\n            }).get();\n\n            grouping = [...new Set(grouping)];\n\n            if (activewrapper.length < 2) {\n                $('#inlineannotation-btns #ungroup, #inlineannotation-btns #group').attr('disabled', 'disabled').addClass('d-none');\n            } else {\n                if (grouping.length == 1) {\n                    if (grouping[0] == 'undefined') {\n                        $('#inlineannotation-btns #ungroup').attr('disabled', 'disabled').addClass('d-none');\n                        $('#inlineannotation-btns #group').removeAttr('disabled').removeClass('d-none');\n                    } else {\n                        $('#inlineannotation-btns #ungroup').removeAttr('disabled').removeClass('d-none');\n                        $('#inlineannotation-btns #group').attr('disabled', 'disabled').addClass('d-none');\n                    }\n                } else if (grouping.length > 1) {\n                    $('#inlineannotation-btns #ungroup, #inlineannotation-btns #group').removeAttr('disabled')\n                        .removeClass('d-none');\n                }\n            }\n        });\n\n        $videoWrapper.on('dblclick', '#canvas .annotation-wrapper', function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            $(this).trigger('click');\n            $('#inlineannotation-btns #edit').trigger('click');\n        });\n\n        $(document).on('click', `#inlineannotation-btns #undo`, async function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            if (trackingIndex == 0) {\n                return;\n            }\n            trackingIndex--;\n            const instance = tracking[trackingIndex];\n            items = JSON.parse(instance.items);\n            renderItems(items, instance.actives, false);\n            if (trackingIndex == 0) {\n                $('#inlineannotation-btns #undo').attr('disabled', 'disabled');\n                $('#inlineannotation-btns #redo').removeAttr('disabled');\n            } else {\n                $('#inlineannotation-btns #undo').removeAttr('disabled');\n                if (trackingIndex == tracking.length - 1) {\n                    $('#inlineannotation-btns #redo').attr('disabled', 'disabled');\n                } else {\n                    $('#inlineannotation-btns #redo').removeAttr('disabled');\n                }\n            }\n        });\n\n        $(document).on('click', `#inlineannotation-btns #redo`, async function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            if (trackingIndex == tracking.length - 1) {\n                return;\n            }\n            trackingIndex++;\n            const instance = tracking[trackingIndex];\n            items = JSON.parse(instance.items);\n            renderItems(items, instance.actives, false);\n            if (trackingIndex == tracking.length - 1) {\n                $('#inlineannotation-btns #redo').attr('disabled', 'disabled');\n                $('#inlineannotation-btns #undo').removeAttr('disabled');\n            } else {\n                $('#inlineannotation-btns #redo').removeAttr('disabled');\n                if (trackingIndex == 0) {\n                    $('#inlineannotation-btns #undo').attr('disabled', 'disabled');\n                } else {\n                    $('#inlineannotation-btns #undo').removeAttr('disabled');\n                }\n            }\n        });\n\n        const updateOrder = (active, direction) => {\n            // First sort items by z-index descending\n            getItems(false);\n            items.sort((a, b) => b.position['z-index'] - a.position['z-index']);\n            let activeIndex = items.findIndex(x => x.id == active);\n            let activeItem = items[activeIndex];\n            let currentzIndex = activeItem.position['z-index'];\n            let affectedItem = null;\n            let affectedItemIndex = null;\n            if (direction == 'up') {\n                if (activeIndex == 0) {\n                    return;\n                }\n                affectedItemIndex = activeIndex - 1;\n                affectedItem = items[affectedItemIndex];\n                activeItem.position['z-index'] = affectedItem.position['z-index'];\n                affectedItem.position['z-index'] = currentzIndex;\n            } else {\n                if (activeIndex == items.length - 1) {\n                    return;\n                }\n                affectedItemIndex = activeIndex + 1;\n                affectedItem = items[affectedItemIndex];\n                activeItem.position['z-index'] = affectedItem.position['z-index'];\n                affectedItem.position['z-index'] = currentzIndex;\n            }\n            items[activeIndex] = activeItem;\n            items[affectedItemIndex] = affectedItem;\n            $(`.annotation-wrapper[data-item=\"${active}\"]`).css(activeItem.position);\n            $(`.annotation-wrapper[data-item=\"${affectedItem.id}\"]`).css(affectedItem.position);\n            saveTracking([active]);\n        };\n\n        // Group the active items\n        $(document).on('click', `#inlineannotation-btns #group`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            $(this).attr('disabled', 'disabled').addClass('d-none');\n            $('#inlineannotation-btns #ungroup').removeAttr('disabled').removeClass('d-none');\n            getItems(false);\n            let active = $('#canvas .annotation-wrapper.active').map(function() {\n                return $(this).data('item');\n            }).get();\n            const group = new Date().getTime();\n            active.forEach((item, i) => {\n                let activeItem = $(`#canvas .annotation-wrapper[data-item=\"${item}\"]`);\n                let targetIndex = items.findIndex(x => x.id == item);\n                let target = JSON.parse(JSON.stringify(items[targetIndex]));\n                target.position.group = group;\n                items[targetIndex] = target;\n                activeItem.remove();\n                renderItems([target], null, true);\n                if (i == active.length - 1) {\n                    renderItems([], active, true);\n                }\n            });\n            saveTracking(active);\n        });\n\n        $(document).on('click', `#inlineannotation-btns #ungroup`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            $(this).attr('disabled', 'disabled').addClass('d-none');\n            $(`#inlineannotation-btns #group`).removeAttr('disabled').removeClass('d-none');\n            getItems(false);\n            let active = $('#canvas .annotation-wrapper.active').map(function() {\n                return $(this).data('item');\n            }).get();\n            active.forEach((item, i) => {\n                let activeItem = $(`#canvas .annotation-wrapper[data-item=\"${item}\"]`);\n                let targetIndex = items.findIndex(x => x.id == item);\n                let target = JSON.parse(JSON.stringify(items[targetIndex]));\n                delete target.position.group;\n                items[targetIndex] = target;\n                activeItem.remove();\n                renderItems([target], null, true);\n                if (i == active.length - 1) {\n                    renderItems([], active, true);\n                }\n            });\n            saveTracking(active);\n        });\n\n        $playerWrapper.on('click', `#inlineannotation-btns #up`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            let active = $('#edit-btns').attr('data-active');\n            active = active.split(',');\n            const topLayer = getTopLayer(items);\n            // Check if the active elements are already in the correct order based on their index positions in the items array\n            if (active.length > 1) {\n                active = sortItemsByLayer(active, 'desc');\n                let indexes = [];\n                items.sort((a, b) => b.position['z-index'] - a.position['z-index']);\n                active.forEach((item) => {\n                    indexes.push(items.findIndex(x => x.id == item));\n                });\n                indexes.sort((a, b) => a - b);\n                if (Math.abs(indexes[0] - indexes[indexes.length - 1]) == active.length - 1) {\n                    if (Number(items[indexes[0]].position['z-index']) == topLayer) {\n                        return;\n                    }\n                }\n            }\n            active.forEach((item) => {\n                updateOrder(item, 'up');\n            });\n            getItems(false);\n            updatePositionInfo($(`.annotation-wrapper[data-item=\"${active[0]}\"]`));\n        });\n\n        $playerWrapper.on('click', `#inlineannotation-btns #down`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            let active = $('#edit-btns').attr('data-active');\n            active = active.split(',');\n            const bottomLayer = getBottomLayer(items);\n            // Check if the active elements are already in the correct order based on their index positions in the items array\n            if (active.length > 1) {\n                active = sortItemsByLayer(active, 'asc');\n                let indexes = [];\n                items.sort((a, b) => a.position['z-index'] - b.position['z-index']);\n                active.forEach((item) => {\n                    indexes.push(items.findIndex(x => x.id == item));\n                });\n                indexes.sort((a, b) => a - b);\n                if (Math.abs(indexes[0] - indexes[indexes.length - 1]) == active.length - 1) {\n                    if (Number(items[indexes[0]].position['z-index']) == bottomLayer) {\n                        return;\n                    }\n                }\n            }\n            active.forEach((item) => {\n                updateOrder(item, 'down');\n            });\n            getItems(false);\n            updatePositionInfo($(`.annotation-wrapper[data-item=\"${active[0]}\"]`));\n        });\n\n        $playerWrapper.on('click', `#inlineannotation-btns #delete`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            let active = $('#edit-btns').attr('data-active');\n            active = active.split(',');\n            active.forEach((item) => {\n                let activeItem = $(`#canvas .annotation-wrapper[data-item=\"${item}\"]`);\n                activeItem.remove();\n                $('#edit-btns').attr('data-active', '').addClass('d-none').removeClass('d-flex');\n            });\n            getItems(false);\n            saveTracking(null);\n        });\n\n        $playerWrapper.on('click', `#inlineannotation-btns #copy`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            getItems(false);\n            // Copy the active item\n            const highestOrder = getTopLayer(items);\n            let active = $('#edit-btns').attr('data-active');\n            active = active.split(',');\n            active = sortItemsByLayer(active, 'asc');\n            let newItems = [];\n            for (let i = 0; i < active.length; i++) {\n                let a = active[i];\n                let activeItem = $(`#canvas .annotation-wrapper[data-item=\"${a}\"]`);\n                activeItem.removeClass('active');\n                const item = items.find(x => x.id == a);\n                let newItem = JSON.parse(JSON.stringify(item));\n                newItem.position = recalculatingSize(activeItem);\n                if (item.position.group) {\n                    newItem.position.group = Number(item.position.group) + 1;\n                }\n                newItem.id = new Date().getTime();\n                newItems.push(newItem);\n                newItem.position.zIndex = Number(highestOrder) + i + 1;\n                items.push(newItem);\n                if (i == active.length - 1) {\n                    const newItemIds = newItems.map(x => x.id);\n                    $('#edit-btns').attr('data-active', newItemIds.join(',')).addClass('d-flex').removeClass('d-none');\n                    renderItems(newItems, newItemIds, true);\n                    // Put focus on the first element\n                    getItems(false);\n                    document.querySelector('.annotation-wrapper.active').focus();\n                    updatePositionInfo($(`.annotation-wrapper[data-item=\"${newItem.id}\"]`));\n                    saveTracking(newItemIds);\n                }\n            }\n        });\n\n        // Move items with keyboard arrow keys, ctrl + up to layer up, and ctrl + down to layer down.\n        $playerWrapper.on('keydown', '#canvas .annotation-wrapper', function(e) {\n            let active = $('#edit-btns').attr('data-active');\n            active = active.split(',');\n            for (let i = 0; i < active.length; i++) {\n                let a = active[i];\n                let activeItem = $(`#canvas .annotation-wrapper[data-item=\"${a}\"]`);\n                if (activeItem != undefined) {\n                    let position = activeItem.position();\n                    position['z-index'] = parseInt(activeItem.css('z-index'));\n                    let ctrl = e.ctrlKey || e.metaKey;\n                    let step = 1;\n                    // Prevent page scroll\n                    e.preventDefault();\n                    e.stopImmediatePropagation();\n                    switch (e.key) {\n                        case 'ArrowUp':\n                            if (position.top > 0) {\n                                position.top = position.top - step;\n                                saveTracking(active);\n                            }\n                            break;\n                        case 'ArrowDown':\n                            if (position.top + activeItem.outerHeight() < $videoWrapper.find(`#canvas`).height()) {\n                                position.top = position.top + step;\n                                saveTracking(active);\n                            }\n                            break;\n                        case 'ArrowLeft':\n                            if (position.left > 0) {\n                                position.left = position.left - step;\n                                saveTracking(active);\n                            }\n                            break;\n                        case 'ArrowRight':\n                            if (position.left + activeItem.outerWidth() < $videoWrapper.find(`#canvas`).width()) {\n                                position.left = position.left + step;\n                                saveTracking(active);\n                            }\n                            break;\n                        case 'Delete':\n                            $(`#inlineannotation-btns #delete`).trigger('click');\n                            return;\n                        case 'd': // Ctrl + d to duplicate\n                            if (ctrl) {\n                                $(`#inlineannotation-btns #copy`).trigger('click');\n                            }\n                            return;\n                        default:\n                            return;\n                    }\n                    activeItem.css(position);\n                    recalculatingSize(activeItem);\n                }\n            }\n        });\n\n        $(document).on('annotationdeleted', function(e) {\n            let deleted = e.originalEvent.detail.annotation;\n            let annoid = $videoWrapper.find(`#canvas`).data('id');\n            if (annoid == deleted.id) {\n                $videoWrapper.find(`#canvas[data-id='${annoid}']`).remove();\n                $(`#inlineannotation-btns`).remove();\n            }\n        });\n\n        // Confirm draft saved.\n        window.addEventListener('beforeunload', (e) => {\n            if (draftStatus !== null) {\n                const confirmationMessage = M.util.get_string('unsavedchanges', 'mod_interactivevideo');\n                e.returnValue = confirmationMessage;\n                return confirmationMessage;\n            }\n            return true;\n        });\n    }\n    /**\n     * What happens when an item runs\n     * @param {Object} annotation The annotation object\n     * @returns {void}\n     */\n    async runInteraction(annotation) {\n        this.player.pause();\n        this.renderContainer(annotation);\n        if (this.isEditMode()) {\n            annotation.editmode = true; // Use editmode to render the draft content (i.e draft.php vs plugin.php).\n        }\n        const content = await this.render(annotation, 'json');\n        this.postContentRender(annotation, content);\n    }\n}"],"names":["InlineAnnotation","Base","postEditCallback","roundToTwo","num","Math","round","renderContainer","annotation","videoWrapper","find","remove","append","id","updateAspectRatio","async","video","reset","elem","hasClass","ratio","this","displayoptions","usefixedratio","player","aspectratio","videowrapperaspect","width","height","gap","css","vwrapper","document","querySelector","ResizeObserver","observe","on","postContentRender","data","self","$videoWrapper","$playerWrapper","draftStatus","convertSecondsToMMSS","seconds","minutes","floor","updatePositionInfo","w","outerWidth","hw","outerHeight","t","position","top","l","left","z","text","recalculatingSize","message","removeAttr","h","g","group","recalculatingTextSize","button","multiline","fontSize","padding","rowCount","length","style","renderFile","wrapper","item","prop","type","wrapperhtml","rounded","shadow","url","formattedlabel","isEditMode","playButton","audioSrc","media","Audio","e","stopImmediatePropagation","paused","ended","currentTime","play","removeClass","addClass","pause","totaltime","onloadedmetadata","duration","onended","ontimeupdate","autoplay","setTimeout","trigger","one","renderStopwatch","timer","alarm","Number","clearInterval","intervalfunction","setInterval","time","playalarmsound","playsoundatinterval","intervaltime","playsoundatend","M","cfg","wwwroot","onplay","allowpause","renderItems","elements","actives","update","empty","forEach","active","count","properties","JSON","stringify","resizable","attr","parts","timestamp","split","gotourl","formattedalttext","renderImage","showcontrol","playsInline","onpause","renderVideo","renderNavigation","textparts","textblock","part","trim","alignment","textfont","undefined","lineHeight","bold","italic","underline","textcolor","bgcolor","borderwidth","bordercolor","renderTextblock","opacity","shape","renderShape","color","usemodal","formattedtitle","popover","container","html","template","$body","formatContent","content","contextid","openbydefault","renderHotspot","draggable","containment","cursor","grid","handle","start","each","drag","event","ui","$selected","originalPosition","positions","map","bottom","right","get","x","sort","a","b","target","distance","not","$this","stop","newLeft","newTop","getItems","saveTracking","handles","minHeight","resize","ctrlKey","aspectRatio","includes","navigation","isBetweenStartAndEnd","seek","viewertype","hotspotid","hotspot","items","title","modal","fadeIn","closest","existingwrapper","tracking","trackingIndex","parse","push","at","Date","getTime","draftitemid","inlineannotationitems","util","get_string","dataForTemplate","render","then","before","catch","enableColorPicker","newTime","detail","preventDefault","slice","sortItemsByLayer","ids","order","toString","targetItems","filter","getTopLayer","itms","sorted","zindex","updateid","newItems","index","element","cleanItems","replace","updateId","ajax","method","dataType","action","sesskey","field","value","cmid","token","success","updated","off","saveCancel","toggle","toggleClass","handleFormData","newItem","add","annoid","addNotification","iaform","ModalForm","formClass","args","annotationid","modalConfig","show","addEventListener","events","LOADED","val","convertSecondsToHMS","end","isInSkipSegment","FORM_SUBMITTED","highestOrder","random","annnoid","formdata","editform","metaKey","focus","isNaN","activewrapper","dataActive","grouping","Set","instance","updateOrder","direction","activeIndex","findIndex","activeItem","currentzIndex","affectedItem","affectedItemIndex","i","targetIndex","topLayer","indexes","abs","bottomLayer","getBottomLayer","zIndex","newItemIds","join","parseInt","ctrl","step","key","deleted","originalEvent","window","confirmationMessage","returnValue","editmode"],"mappings":"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"}