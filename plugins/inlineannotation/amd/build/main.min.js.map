{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["/* eslint-disable complexity */\n\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Main class for inlineannotation content type\n *\n * @module     ivplugin_inlineannotation/main\n * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport Base from 'mod_interactivevideo/type/base';\nimport {dispatchEvent} from 'core/event_dispatcher';\nimport ModalForm from 'core_form/modalform';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport {notifyFilterContentUpdated as notifyFilter} from 'core_filters/events';\nexport default class InlineAnnotation extends Base {\n    postEditCallback() {\n        // Do nothing\n    }\n\n    /**\n     * Round a number to two decimal places\n     * @param {Number} num Number\n     * @returns {Number} rounded number\n     */\n    roundToTwo(num) {\n        return +(Math.round(num + 'e+2') + 'e-2');\n    }\n\n    renderContainer(annotation) {\n        const videoWrapper = $('#video-wrapper');\n        videoWrapper.find('#canvas').remove();\n        videoWrapper.append(`<div id=\"canvas\" data-id=\"${annotation.id}\"\n             class=\"message text-white bg-transparent inlineannotation position-absolute\"></div>`);\n\n        const updateAspectRatio = async (video, reset) => {\n            let elem = video ? $('#player') : $(`#canvas[data-id='${annotation.id}']`);\n            if ($(\"#wrapper\").hasClass('fullscreen')) {\n                let ratio = await this.player.ratio();\n                let videowrapperaspect = videoWrapper.width() / videoWrapper.height();\n                let gap = '- 55px';\n                if ($(\"#wrapper\").hasClass('no-videonav')) {\n                    gap = '';\n                }\n                if (videowrapperaspect > ratio) {\n                    elem.css('height', `calc(100vh ${gap})`);\n                    elem.css('width', `calc((100vh ${gap}) * ${ratio})`);\n                    elem.css('top', '0');\n                    elem.css('left', `calc((100vw - (100vh ${gap}) * ${ratio}) / 2)`);\n                } else if (videowrapperaspect < ratio) {\n                    elem.css('width', '100vw');\n                    elem.css('height', `${100 / ratio}vw`);\n                    elem.css('top', `calc((100vh ${gap} - 100vw / ${ratio}) / 2)`);\n                    elem.css('left', '0');\n                }\n            } else {\n                elem.css('width', '100%');\n                elem.css('height', '100%');\n                elem.css('top', '0');\n                elem.css('left', '0');\n            }\n            if (reset) {\n                elem.css('width', '100%');\n                elem.css('height', '100%');\n                elem.css('top', '0');\n                elem.css('left', '0');\n            }\n        };\n\n        updateAspectRatio();\n        updateAspectRatio(true);\n\n        let vwrapper = document.querySelector('#video-wrapper');\n        let resizeObserver = new ResizeObserver(() => {\n            updateAspectRatio();\n            updateAspectRatio(true);\n        });\n\n        resizeObserver.observe(vwrapper);\n\n        $(document).on('timeupdate', function() {\n            updateAspectRatio(true, true);\n        });\n    }\n\n    postContentRender(annotation, data) {\n        let self = this;\n        var $videoWrapper = $('#video-wrapper');\n        var $playerWrapper = $('#wrapper');\n        let draftStatus = null;\n\n        /**\n         * Format seconds to HH:MM:SS\n         * @param {Number} seconds seconds\n         * @returns formatted time\n         */\n        const convertSecondsToMMSS = (seconds) => {\n            let minutes = Math.floor(seconds / 60);\n            seconds = Math.round(seconds - minutes * 60);\n            return (minutes < 10 ? '0' + minutes : minutes) + ':' + (seconds < 10 ? '0' + seconds : seconds);\n        };\n\n        /**\n         * Update position information of the active element on the toolbar.\n         * @param {Object} elem jQuery element\n         */\n        const updatePositionInfo = (elem) => {\n            let w = elem.outerWidth();\n            let hw = elem.outerHeight();\n            let t = elem.position().top < 0 ? 0 : elem.position().top;\n            let l = elem.position().left < 0 ? 0 : elem.position().left;\n            let z = elem.css('z-index');\n            $(`#inlineannotation-btns #position`)\n                .text(`x: ${Math.round(l)}, y: ${Math.round(t)}, z: ${z - 5}, w: ${Math.round(w)}, h: ${Math.round(hw)}`);\n        };\n\n        /**\n         * Recalculate the size of the element.\n         * @param {Object} elem jQuery element\n         * @return {Object} position of the element\n         */\n        const recalculatingSize = (elem) => {\n            let message = $videoWrapper.find(`#canvas`);\n            $(`#inlineannotation-btns #down, #inlineannotation-btns #up`).removeAttr('disabled');\n            let w = self.roundToTwo(elem.outerWidth()) / message.width() * 100;\n            let h = self.roundToTwo(elem.outerHeight()) / message.height() * 100;\n            let t = self.roundToTwo(elem.position().top) / message.height() * 100;\n            t = t < 0 ? 0 : t;\n            let l = self.roundToTwo(elem.position().left) / message.width() * 100;\n            l = l < 0 ? 0 : l;\n            let z = elem.css('z-index');\n            let g = elem.data('group');\n            let position = {\n                'width': w + '%',\n                'height': h + '%',\n                'left': l + '%',\n                'top': t + '%',\n                'z-index': z,\n            };\n            position.group = g;\n            elem.css(position);\n            updatePositionInfo(elem);\n            if (elem.data('type') == 'video') {\n                // Update size of the playpause button\n                elem.find('.playpause').css({\n                    'font-size': elem.outerHeight() * 0.2 + 'px',\n                    'line-height': elem.outerHeight() * 0.2 + 'px',\n                });\n            }\n            return position;\n        };\n\n        /**\n         * Calculate the text size for text and file type.\n         * @param {Object} elem jQuery element\n         * @param {Boolean} button if it is a button\n         * @param {Boolean} multiline if it is a multiline text\n         */\n        const recalculatingTextSize = (elem, button, multiline = false) => {\n            let fontSize = elem.outerHeight();\n            let padding = 0;\n            let rowCount = 1;\n            if (multiline) {\n                let rows = elem.find('.text-row');\n                rowCount = rows.length;\n                if (rowCount > 1) {\n                    let rowHeight = elem.outerHeight() / rowCount;\n                    padding = rowHeight * 0.3;\n                    fontSize = (elem.outerHeight() - padding * 2) / rowCount;\n                }\n            }\n            let style = {\n                'font-size': (button ? fontSize * 0.7 : fontSize * 0.9) + 'px',\n                'line-height': fontSize + 'px',\n                'padding-left': (button ? fontSize * 0.5 : fontSize * 0.3) + 'px',\n                'padding-right': (button ? fontSize * 0.5 : fontSize * 0.3) + 'px',\n            };\n            if (multiline && rowCount > 1) {\n                style.padding = padding + 'px';\n            }\n            elem.find('.annotation-content').css(style);\n            elem.css('width', 'auto');\n        };\n\n        const renderItems = (elements, actives, update) => {\n            if (!update) { // Clear the canvas if it is a new start.\n                $videoWrapper.find(`#canvas`).empty();\n            }\n\n            if (elements.length == 0) {\n                if (actives) {\n                    actives.forEach((active) => {\n                        $videoWrapper.find(`#canvas .annotation-wrapper[data-item=\"${active}\"]`).addClass('active');\n                    });\n                }\n            } else {\n                let count = 0;\n                elements.forEach((item) => {\n                    let prop = item.properties;\n                    let type = item.type;\n                    let id = item.id;\n                    let position = item.position;\n                    let wrapper = $(`<div class=\"annotation-wrapper\" data-group=\"${position.group}\" data-anno=\"${annotation.id}\"\n                     data-item=\"${id}\" data-type=\"${type}\" data-property='${JSON.stringify(prop)}'></div>`);\n                    if (prop.resizable == '1' || self.isEditMode()) {\n                        wrapper.addClass('resizable');\n                        wrapper.attr('tabindex', 0);\n                    }\n\n                    switch (type) {\n                        case 'image':\n                            var parts = prop.timestamp.split(':');\n                            var timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                            if (prop.gotourl != '') {\n                                wrapper.append(`<a href=\"${prop.gotourl}\" target=\"_blank\"><img src=\"${prop.url}\" id=\"${id}\"\n                             class=\"annotation-content w-100 ${prop.shadow == '1' ? 'shadow' : ''}\"\n                             ${prop.rounded == 1 ? 'style=\"border-radius:1em;\"' : ''} alt=\"${prop.formattedalttext}\"/></a>`);\n                            } else {\n                                wrapper.append(`<img src=\"${prop.url}\" id=\"${id}\"\n                                 ${timestamp > 0 ? ' data-timestamp=\"' + timestamp + '\"' : ''}\n                                  class=\"annotation-content w-100 ${prop.shadow == '1' ? 'shadow' : ''}\n                                  ${timestamp > 0 ? 'cursor-pointer' : ''}\"\n                                   ${prop.rounded == 1 ? 'style=\"border-radius:1em;\"' : ''} alt=\"${prop.formattedalttext}\"/>`);\n                            }\n                            if (!self.isEditMode()) {\n                                if (prop.gotourl == '' && timestamp == 0) {\n                                    wrapper.removeClass('resizable');\n                                    wrapper.addClass('no-pointer');\n                                } else {\n                                    wrapper.addClass('clickable');\n                                }\n                            }\n                            wrapper.css(position);\n                            wrapper.css('height', 'auto');\n                            $videoWrapper.find(`#canvas`).append(wrapper);\n                            break;\n                        case 'video':\n                            wrapper.append(`<video id=\"${id}\" class=\"annotation-content w-100 ${prop.shadow == '1' ? 'shadow' : ''}\"\n                                 preload=\"metadata\" src=\"${prop.url}\" style=\"border-radius: ${prop.rounded == 1 ? '1em' : '0'}\"\n                              disablePictureInPicture/></video>\n                              <i class=\"playpause bi bi-play-fill shadow position-absolute fs-unset\"></i>`);\n                            var video = wrapper.find('video')[0];\n                            video.autoplay = prop.autoplay == '1';\n                            video.playsInline = true;\n                            if (self.isEditMode()) {\n                                video.autoplay = false;\n                            }\n                            video.onplay = function() {\n                                wrapper.find('.playpause').removeClass('bi-play-fill').addClass('bi-pause-fill');\n                            };\n                            video.onpause = function() {\n                                wrapper.find('.playpause').removeClass('bi-pause-fill').addClass('bi-play-fill');\n                            };\n                            video.onended = function() {\n                                wrapper.find('.playpause').removeClass('bi-pause-fill').addClass('bi-play-fill');\n                            };\n                            wrapper.css(position);\n                            $videoWrapper.find(`#canvas`).append(wrapper);\n                            recalculatingSize(wrapper);\n                            break;\n                        case 'file':\n                        case 'audio':\n                            var wrapperhtml = ``;\n                            if (type == 'audio') {\n                                wrapperhtml = `<span id=\"${id}\" tabindex=\"0\"\n                             class=\"btn ${prop.style} ${prop.rounded == '1' ? 'btn-rounded' : 'rounded-0'}\n                              annotation-content text-nowrap ${prop.shadow == '1' ? 'shadow' : ''} rotatex-360\"\n                               data-src=\"${prop.url}\"><i class=\"bi bi-volume-up fs-unset\" style=\"margin-right:0.25em;\"></i>\n                               <span class=\"timeremaining\">00:00</span></span>`;\n                            } else if (type == 'file') {\n                                wrapperhtml = `<a id=\"${id}\"\n                             class=\"btn ${prop.style} ${prop.rounded == '1' ? 'btn-rounded' : 'rounded-0'}\n                             annotation-content text-nowrap ${prop.shadow == '1' ? 'shadow' : ''} rotatey-180\" href=\"${prop.url}\"\n                              target=\"_blank\"><i class=\"bi bi-paperclip fs-unset\"></i>${prop.formattedlabel != \"\" ?\n                                        `<span style=\"margin-left:0.25em;\">${prop.formattedlabel}` : ''}</a>`;\n                            }\n                            wrapper.append(`<div class=\"d-flex h-100\">${wrapperhtml}</div>`);\n\n                            if (type == 'audio' && !self.isEditMode()) {\n                                let playButton = wrapper.find('.annotation-content');\n                                let audioSrc = prop.url;\n                                let media = new Audio(audioSrc);\n                                playButton.on('click', function(e) {\n                                    e.stopImmediatePropagation();\n                                    if (media.paused || media.ended || media.currentTime === 0) {\n                                        media.play();\n                                        $(this).find('i').removeClass('bi-volume-up').addClass('bi-pause-fill');\n                                    } else {\n                                        media.pause();\n                                        $(this).find('i').removeClass('bi-pause-fill').addClass('bi-volume-up');\n                                    }\n                                });\n\n                                let totaltime = 0;\n                                media.onloadedmetadata = function() {\n                                    totaltime = media.duration;\n                                    playButton.find('span.timeremaining').text(convertSecondsToMMSS(totaltime));\n                                };\n\n                                media.onended = function() {\n                                    playButton.find('i').removeClass('bi-pause-fill').addClass('bi-volume-up');\n                                    playButton.find('span.timeremaining').text(convertSecondsToMMSS(totaltime));\n                                };\n\n                                media.ontimeupdate = function() {\n                                    playButton.find('span.timeremaining')\n                                        .text(convertSecondsToMMSS(media.duration - media.currentTime));\n                                };\n\n                                if (prop.autoplay == '1') {\n                                    setTimeout(() => {\n                                        playButton.trigger('click');\n                                    }, 100);\n                                }\n\n                                $(document).one('iv:playerSeek iv:playerPlaying', function() {\n                                    if (media) {\n                                        media.pause();\n                                    }\n                                });\n                            }\n\n                            position.width = 0;\n\n                            wrapper.css(position);\n                            $videoWrapper.find(`#canvas`).append(wrapper);\n                            recalculatingTextSize(wrapper, true);\n\n                            break;\n                        case 'navigation':\n                            var parts = prop.timestamp.split(':');\n                            var timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n\n                            wrapper.append(`<div class=\"d-flex h-100\"><span id=\"${id}\" tabindex=\"0\"\n                             class=\"btn ${prop.style} ${prop.rounded == '1' ? 'btn-rounded' : 'rounded-0'}\n                              annotation-content text-nowrap ${prop.shadow == '1' ? 'shadow' : ''}\"\n                               data-timestamp=\"${timestamp}\">${prop.formattedlabel}</span></div>`);\n\n                            position.width = 0;\n\n                            wrapper.css(position);\n                            $videoWrapper.find(`#canvas`).append(wrapper);\n                            recalculatingTextSize(wrapper, true);\n                            break;\n                        case 'stopwatch':\n                            var duration = Number(prop.duration) * 60;\n                            wrapper.append(`<div class=\"d-flex h-100\"><span id=\"${id}\" tabindex=\"0\"\n                             class=\"btn ${prop.style} ${prop.rounded == '1' ? 'btn-rounded' : 'rounded-0'}\n                              annotation-content text-nowrap ${prop.shadow == '1' ? 'shadow' : ''} rotatey-180\"\n                               data-duration=\"${duration}\">\n                               <i class=\"bi bi bi-stopwatch fs-unset\" style=\"margin-right:0.25em;\"></i>\n                               <span>${convertSecondsToMMSS(duration)}</span></span></div>`);\n\n                            var timer, alarm;\n                            if (timer) {\n                                clearInterval(timer);\n                            }\n                            var intervalfunction = function() {\n                                timer = setInterval(() => {\n                                    $(`.annotation-content#${id}`).addClass('running');\n                                    let time = $(`.annotation-content#${id}`).data('duration');\n                                    time--;\n                                    $(`.annotation-content#${id} span`).text(convertSecondsToMMSS(time));\n                                    $(`.annotation-content#${id}`).data('duration', time);\n                                    if (prop.playalarmsound.playsoundatinterval == '1'\n                                        && time % (prop.playalarmsound.intervaltime * 60) == 0) {\n                                        if (prop.playalarmsound.playsoundatend == 1) {\n                                            alarm = new Audio(M.cfg.wwwroot + '/mod/interactivevideo/sounds/short-alarm.mp3');\n                                            alarm.play();\n                                        }\n                                    }\n                                    if (time < 0) {\n                                        clearInterval(timer);\n                                        if (prop.playalarmsound.playsoundatend == 1) {\n                                            alarm = new Audio(M.cfg.wwwroot + '/mod/interactivevideo/sounds/alarm.mp3');\n                                            alarm.play();\n                                            alarm.onplay = function() {\n                                                $(`.annotation-content#${id}`).addClass('pulse');\n                                            };\n                                            alarm.onended = function() {\n                                                $(`.annotation-content#${id}`).removeClass('pulse');\n                                            };\n                                        }\n                                        $(`.annotation-content#${id}`).removeClass('running');\n                                        $(`.annotation-content#${id} span`).text(convertSecondsToMMSS(duration));\n                                        $(`.annotation-content#${id}`).data('duration', duration);\n                                    }\n                                }, 1000);\n                            };\n\n                            if (!self.isEditMode()) {\n                                intervalfunction();\n                                $videoWrapper.on('click', `.annotation-content#${id}`, function(e) {\n                                    e.stopImmediatePropagation();\n                                    if (prop.allowpause == 1) {\n                                        if ($(this).hasClass('running')) {\n                                            clearInterval(timer);\n                                            if (alarm) {\n                                                alarm.pause();\n                                            }\n                                            $(this).removeClass('running');\n                                        } else {\n                                            intervalfunction();\n                                        }\n                                    } else if ($(this).data('duration') == duration) {\n                                        intervalfunction();\n                                    }\n                                });\n                            }\n\n                            $(document).one('iv:playerSeek', function() {\n                                clearInterval(timer);\n                            });\n\n                            position.width = 0;\n\n                            wrapper.css(position);\n                            $videoWrapper.find(`#canvas`).append(wrapper);\n                            recalculatingTextSize(wrapper, true);\n\n                            break;\n                        case 'textblock':\n                            var textparts = prop.formattedlabel.split('\\r\\n');\n                            var textblock = '<div class=\"d-flex flex-column\">';\n                            textparts.forEach((part) => {\n                                if (part.trim() == '') {\n                                    return;\n                                }\n                                textblock += `<span class=\"text-row text-nowrap text-${prop.alignment}\"\n                                 style=\"font-family: ${prop.textfont != '' ? prop.textfont : 'inherit'}\">${part}</span>`;\n                            });\n                            textblock += '</div>';\n                            if (prop.url != undefined && prop.url != '') {\n                                wrapper.append(`<a id=\"${id}\"\n                                     class=\"annotation-content d-block ${prop.shadow == '1' ? 'text-shadow' : ''}\"\n                                      href=\"${prop.url}\" target=\"_blank\">${textblock}</a>`);\n                                wrapper.addClass('clickable');\n                            } else {\n                                wrapper.append(`<div id=\"${id}\"\n                                     class=\"annotation-content ${prop.shadow == '1' ? 'text-shadow' : ''}\n                                     \">${textblock}</div>`);\n                            }\n                            wrapper.position.width = 0;\n                            wrapper.css(position);\n                            var style = {\n                                'font-size': item.position.fontSize,\n                                'line-height': item.position.lineHeight,\n                                'font-weight': prop.bold == '1' ? 'bold' : 'normal',\n                                'font-style': prop.italic == '1' ? 'italic' : 'normal',\n                                'text-decoration': prop.underline == '1' ? 'underline' : 'none',\n                                'color': prop.textcolor,\n                                'background': prop.bgcolor,\n                                'border-radius': prop.rounded == '1' ? '0.3em' : '0',\n                                'border-width': prop.borderwidth,\n                                'border-color': prop.bordercolor,\n                                'border-style': 'solid',\n                            };\n                            wrapper.find('.annotation-content').css(style);\n                            $videoWrapper.find(`#canvas`).append(wrapper);\n                            recalculatingTextSize(wrapper, false, true);\n                            break;\n                        case 'shape':\n                            var parts = prop.timestamp.split(':');\n                            var timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                            if (prop.gotourl != '') {\n                                wrapper.append(`<a href=\"${prop.gotourl}\" target=\"_blank\"><div id=\"${id}\"\n                             class=\"annotation-content ${prop.shadow == '1' ? 'shadow' : ''}\"\n                              style=\"width: 100%; height: 100%;\"></div></a>`);\n                                wrapper.addClass('clickable');\n                            } else {\n                                if (!self.isEditMode()) {\n                                    if (timestamp == 0) {\n                                        wrapper.addClass('no-pointer');\n                                    } else {\n                                        wrapper.addClass('clickable');\n                                    }\n                                }\n                                wrapper.append(`<div id=\"${id}\" class=\"annotation-content ${prop.shadow == '1' ? 'shadow' : ''}\n                                 ${timestamp > 0 ? 'cursor-pointer' : ''}\"\n                             ${timestamp > 0 ? 'data-timestamp=\"' + timestamp + '\"' : ''}\n                             style=\"width: 100%; height: 100%;\"></div>`);\n                            }\n                            wrapper.css(position);\n                            var style = {\n                                'background': prop.bgcolor,\n                                'border-width': prop.borderwidth,\n                                'border-color': prop.bordercolor,\n                                'border-style': 'solid',\n                                'opacity': prop.opacity / 100,\n                            };\n                            if (prop.shape == 'circle') {\n                                style['border-radius'] = '50%';\n                            } else if (prop.shape == 'rectangle') {\n                                style['border-radius'] = prop.rounded == '1' ? '1em' : '0';\n                            }\n                            wrapper.find('.annotation-content').css(style);\n                            $videoWrapper.find(`#canvas`).append(wrapper);\n                            break;\n                        case 'hotspot':\n                            wrapper.append(`<div id=\"${id}\" class=\"annotation-content shadow-sm pulse\" role=\"button\"></div>`);\n                            position['aspect-ratio'] = '1';\n                            wrapper.css(position);\n                            var style = {\n                                'background-color': prop.color,\n                                'opacity': prop.opacity / 100,\n                                'border-radius': '50%',\n                                'aspect-ratio': '1',\n                            };\n                            wrapper.find('.annotation-content').css(style);\n                            $videoWrapper.find(`#canvas`).append(wrapper);\n\n                            if (!self.isEditMode()) {\n                                if (prop.usemodal == '1') {\n                                    wrapper.attr({\n                                        'data-toggle': 'modal',\n                                    });\n                                } else {\n                                    wrapper.attr({\n                                        'tabindex': -1,\n                                        'data-trigger': 'manual',\n                                        'data-boundary': 'viewport',\n                                        'data-placement': 'auto',\n                                        'data-html': 'true',\n                                        'data-content': '<div class=\"loader\"></div>',\n                                        'data-title': prop.formattedtitle\n                                            + `<i class=\"bi bi-x-circle-fill ml-auto popover-dismiss cursor-pointer\"\n                                         style=\"font-size:1.5em;\"></i>`,\n                                    });\n\n                                    wrapper.popover({\n                                        container: '#wrapper',\n                                        html: true,\n                                        template: `<div class=\"popover inlineannotation-popover id-${id}\"\n                                     role=\"tooltip\"><div class=\"arrow\"></div>\n                                     <h3 class=\"popover-header d-flex justify-content-between\"></h3>\n                                     <div class=\"popover-body rounded\"></div>${prop.url != '' ?\n                                                `<div class=\"popup-footer bg-light p-2 rounded-bottom\"><a href=\"${prop.url}\"\n                                          class=\"d-block w-100 text-right rotatex-360\" target=\"_blank\">\n                                          <i class=\"bi bi-arrow-right\"><i></i></i></a></div>` : ''}</div>`,\n                                    });\n\n                                    wrapper.on('shown.bs.popover', async function() {\n                                        let $body = $(`.popover.id-${id} .popover-body`);\n                                        const html = await self.formatContent(prop.content.text, M.cfg.contextid);\n                                        $body.html(html);\n                                        notifyFilter($body);\n                                        wrapper.popover('update');\n                                    });\n                                    if (prop.openbydefault == '1') {\n                                        wrapper.popover('show');\n                                    }\n                                }\n                            }\n                            break;\n                    }\n\n                    count++;\n                    if (count == elements.length) {\n                        $videoWrapper.find(`#canvas .annotation-wrapper.resizable`).draggable({\n                            containment: \"#canvas\",\n                            cursor: \"move\",\n                            grid: [1, 1],\n                            handle: '.annotation-content',\n                            start: function() {\n                                // Get all the selected elements\n                                if (!$(this).hasClass('active')) {\n                                    $(this).trigger('click');\n                                }\n                                let $selected = $videoWrapper.find('#canvas .annotation-wrapper.active');\n                                $selected.each(function() {\n                                    $(this).data('startPosition', $(this).position());\n                                });\n                            },\n                            drag: function(event, ui) {\n                                var $selected = $videoWrapper.find('#canvas .annotation-wrapper.active');\n                                var left = ui.originalPosition.left - ui.position.left;\n                                var top = ui.originalPosition.top - ui.position.top;\n                                var positions = $selected.map(function() {\n                                    return {\n                                        id: $(this).data('item'),\n                                        left: $(this).position().left,\n                                        top: $(this).position().top,\n                                        bottom: $(this).position().top + $(this).height(),\n                                        right: $(this).position().left + $(this).width(),\n                                    };\n                                }).get();\n\n                                if (positions.find(x => x.left < 0)) {\n                                    // Sort the elements by left position to get the leftmost element\n                                    positions.sort((a, b) => a.left - b.left);\n                                    let onLeft = positions.find(x => x.left < 0);\n                                    let id = onLeft.id;\n                                    let target = $videoWrapper.find(`#canvas .annotation-wrapper[data-item=\"${id}\"]`);\n                                    target.css('left', 0);\n                                    let distance = target.data('startPosition').left;\n                                    ui.position.left = ui.originalPosition.left - distance;\n                                    left = ui.originalPosition.left - ui.position.left;\n                                }\n\n                                if (positions.find(x => x.top < 0)) {\n                                    positions.sort((a, b) => a.top - b.top);\n                                    let onTop = positions.find(x => x.top < 0);\n                                    let id = onTop.id;\n                                    let target = $videoWrapper.find(`#canvas .annotation-wrapper[data-item=\"${id}\"]`);\n                                    target.css('top', 0);\n                                    let distance = target.data('startPosition').top;\n                                    ui.position.top = ui.originalPosition.top - distance;\n                                    top = ui.originalPosition.top - ui.position.top;\n                                }\n\n                                if (positions.find(x => x.right > $('#canvas').width())) {\n                                    positions.sort((a, b) => a.right - b.right);\n                                    let onRight = positions.find(x => x.right > $('#canvas').width());\n                                    let id = onRight.id;\n                                    let target = $videoWrapper.find(`#canvas .annotation-wrapper[data-item=\"${id}\"]`);\n                                    target.css('left', ($('#canvas').width() - target.width() - 1) + 'px');\n                                    let distance = target.data('startPosition').left - target.position().left;\n                                    ui.position.left = ui.originalPosition.left - distance;\n                                    left = ui.originalPosition.left - ui.position.left;\n                                }\n\n                                if (positions.find(x => x.bottom > $('#canvas').height())) {\n                                    positions.sort((a, b) => a.bottom - b.bottom);\n                                    let onBottom = positions.find(x => x.bottom > $('#canvas').height());\n                                    let id = onBottom.id;\n                                    let target = $videoWrapper.find(`#canvas .annotation-wrapper[data-item=\"${id}\"]`);\n                                    target.css('top', ($('#canvas').height() - target.height() - 1) + 'px');\n                                    let distance = target.data('startPosition').top - target.position().top;\n                                    ui.position.top = ui.originalPosition.top - distance;\n                                    top = ui.originalPosition.top - ui.position.top;\n                                }\n\n                                $selected.not(this).each(function() {\n                                    var $this = $(this);\n                                    var position = $this.data('startPosition');\n                                    $this.css({\n                                        left: (position.left - left) + 'px',\n                                        top: (position.top - top) + 'px',\n                                    });\n                                });\n                                updatePositionInfo($(this));\n                            },\n                            stop: function() {\n                                let $selected = $videoWrapper.find('#canvas .annotation-wrapper.active');\n                                var positions = $selected.map(function() {\n                                    return {\n                                        id: $(this).data('item'),\n                                        left: $(this).position().left,\n                                        top: $(this).position().top,\n                                        bottom: $(this).position().top + $(this).height(),\n                                        right: $(this).position().left + $(this).width(),\n                                    };\n                                }).get();\n\n                                if (positions.find(x => x.left < 0)) {\n                                    positions.sort((a, b) => a.left - b.left);\n                                    let onLeft = positions.find(x => x.left < 0);\n                                    let id = onLeft.id;\n                                    let target = $videoWrapper.find(`#canvas .annotation-wrapper[data-item=\"${id}\"]`);\n                                    target.css('left', 0);\n                                    let distance = target.data('startPosition').left;\n                                    $selected.each(function() {\n                                        let $this = $(this);\n                                        let position = $this.data('startPosition');\n                                        let newLeft = position.left - distance;\n                                        $this.css('left', newLeft + 'px');\n                                    });\n                                }\n\n                                if (positions.find(x => x.top < 0)) {\n                                    positions.sort((a, b) => a.top - b.top);\n                                    let onTop = positions.find(x => x.top < 0);\n                                    let id = onTop.id;\n                                    let target = $videoWrapper.find(`#canvas .annotation-wrapper[data-item=\"${id}\"]`);\n                                    target.css('top', 0);\n                                    let distance = target.data('startPosition').top;\n                                    $selected.each(function() {\n                                        let $this = $(this);\n                                        let position = $this.data('startPosition');\n                                        let newTop = position.top - distance;\n                                        $this.css('top', newTop + 'px');\n                                    });\n                                }\n\n                                if (positions.find(x => x.right > $('#canvas').width())) {\n                                    positions.sort((a, b) => a.right - b.right);\n                                    let onRight = positions.find(x => x.right > $('#canvas').width());\n                                    let id = onRight.id;\n                                    let target = $videoWrapper.find(`#canvas .annotation-wrapper[data-item=\"${id}\"]`);\n                                    target.css('left', ($('#canvas').width() - target.width() - 1) + 'px');\n                                    let distance = target.data('startPosition').left - target.position().left;\n                                    $selected.each(function() {\n                                        let $this = $(this);\n                                        let position = $this.data('startPosition');\n                                        let newLeft = position.left - distance;\n                                        $this.css('left', newLeft + 'px');\n                                    });\n                                }\n\n                                if (positions.find(x => x.bottom > $('#canvas').height())) {\n                                    positions.sort((a, b) => a.bottom - b.bottom);\n                                    let onBottom = positions.find(x => x.bottom > $('#canvas').height());\n                                    let id = onBottom.id;\n                                    let target = $videoWrapper.find(`#canvas .annotation-wrapper[data-item=\"${id}\"]`);\n                                    target.css('top', ($('#canvas').height() - target.height() - 1) + 'px');\n                                    let distance = target.data('startPosition').top - target.position().top;\n                                    $selected.each(function() {\n                                        let $this = $(this);\n                                        let position = $this.data('startPosition');\n                                        let newTop = position.top - distance;\n                                        $this.css('top', newTop + 'px');\n                                    });\n                                }\n\n                                getItems(false);\n                                updatePositionInfo($(this));\n                                $selected = $selected.map(function() {\n                                    return $(this).data('item');\n                                }).get();\n\n                                saveTracking($selected);\n                            }\n                        });\n\n                        $videoWrapper.find('#canvas .annotation-wrapper.resizable').resizable({\n                            containment: \"#canvas\",\n                            handles: \"all\",\n                            grid: [1, 1],\n                            minHeight: 1,\n                            resize: function(event) {\n                                let type = $(this).data('type');\n                                if (type == 'file'\n                                    || type == 'audio' || type == 'stopwatch' || type == 'navigation' || type == 'textblock') {\n                                    recalculatingTextSize($(this), type != 'textblock', type == 'textblock');\n                                } else if (type == 'shape' && event.ctrlKey) {\n                                    $(this).resizable('option', 'aspectRatio', 1);\n                                }\n                                updatePositionInfo($(this));\n                            },\n                            stop: function() {\n                                let type = $(this).data('type');\n                                if (type == 'file' || type == 'navigation' || type == 'textblock') {\n                                    recalculatingTextSize($(this), type != 'textblock', type == 'textblock');\n                                } else if (type == 'shape') {\n                                    $(this).resizable('option', 'aspectRatio', false);\n                                }\n                                recalculatingSize($(this));\n                                getItems(false);\n                                saveTracking([$(this).data('item')]);\n                                $(this).trigger('click');\n                            }\n                        });\n                    }\n\n                    if (type != 'shape') {\n                        wrapper.on('mouseover', function() {\n                            if (!$(this).hasClass('resizable')) {\n                                return;\n                            }\n\n                            let aspectRatio =\n                                $(this).find('.annotation-content').width() / $(this).find('.annotation-content').height();\n                            if (wrapper.width() / wrapper.height() != aspectRatio && (type == 'image' || type == 'video')) {\n                                $(this).height((wrapper.width() / aspectRatio));\n                            }\n                            $(this).resizable('option', 'aspectRatio', $(this).find('.annotation-content').outerWidth() /\n                                $(this).find('.annotation-content').outerHeight());\n                        });\n                    }\n\n                    if (actives && actives.includes(id)) {\n                        wrapper.addClass('active');\n                        if (actives.length == 1) {\n                            setTimeout(function() {\n                                wrapper.trigger('mouseover');\n                                wrapper.trigger('click');\n                            }, 500);\n                        }\n                    }\n\n                });\n\n                // Handle behavior for each item\n                if (!self.isEditMode()) {\n                    $videoWrapper.on('click', `#canvas .annotation-wrapper`, function(e) {\n                        e.stopImmediatePropagation();\n                        let wrapper = $(this);\n                        let type = wrapper.data('type');\n                        switch (type) {\n                            case 'video':\n                                var video = wrapper.find('video')[0];\n                                if (video.paused || video.ended || video.currentTime === 0) {\n                                    video.play();\n                                } else {\n                                    video.pause();\n                                }\n                                break;\n                            case 'navigation':\n                            case 'image':\n                            case 'shape':\n                                var navigation = wrapper.find('.annotation-content');\n                                if (self.isBetweenStartAndEnd(navigation.data('timestamp'))) {\n                                    self.player.seek(navigation.data('timestamp'));\n                                    self.player.play();\n                                }\n                                break;\n                            case 'hotspot':\n                                var viewertype = wrapper.data('toggle');\n                                var hotspotid = wrapper.data('item');\n                                var hotspot = items.find(x => x.id == hotspotid);\n                                if (viewertype == 'modal') {\n                                    let title = hotspot.properties.formattedtitle;\n                                    let content = hotspot.properties.content.text;\n                                    let url = hotspot.properties.url;\n                                    let modal = `<div class=\"modal fade\" id=\"annotation-modal\" role=\"dialog\"\n                                aria-labelledby=\"annotation-modal\"\n                             aria-hidden=\"true\" data-backdrop=\"static\" data-keyboard=\"false\">\n                             <div class=\"modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable\" role=\"document\">\n                                <div class=\"modal-content rounded-lg\">\n                                    <div class=\"modal-header d-flex align-items-center shadow-sm pr-0\" id=\"title\">\n                                        <h5 class=\"modal-title text-truncate mb-0\">${title}</h5>\n                                        <button class=\"btn mx-2 p-0 close\" aria-label=\"Close\" data-dismiss=\"modal\">\n                                            <i class=\"bi bi-x-lg fa-fw\" style=\"font-size: x-large;\"></i>\n                                        </button>\n                                    </div>\n                                    <div class=\"modal-body\" id=\"content\">\n                                    <div class=\"loader\"></div>\n                                    </div>\n                                    ${url != '' ? `<div class=\"modal-footer bg-light p-2 rounded-bottom\">\n                                        <a href=\"${url}\" class=\"d-block w-100 text-right rotatex-360\" target=\"_blank\">\n                                        <i class=\"bi bi-arrow-right\"><i></i></i></a></div>` : ''}\n                                    </div>\n                                </div>\n                                </div>`;\n                                    $('#wrapper').append(modal);\n                                    $('#annotation-modal').modal('show');\n                                    $('#annotation-modal').on('hide.bs.modal', function() {\n                                        $('#annotation-modal').remove();\n                                    });\n                                    $('#annotation-modal').on('shown.bs.modal', async function() {\n                                        $('#annotation-modal .modal-body').fadeIn(300);\n                                        let $body = $('#annotation-modal .modal-body');\n                                        const html = await self.formatContent(content, M.cfg.contextid);\n                                        $body.html(html);\n                                        notifyFilter($body);\n                                    });\n                                } else {\n                                    wrapper.popover('show');\n                                }\n                                break;\n                        }\n                    });\n\n                    $playerWrapper.on('click', `.popover-dismiss`, function(e) {\n                        e.stopImmediatePropagation();\n                        $(this).closest('.popover').remove();\n                    });\n                }\n            }\n        };\n\n        // Check resize on video wrapper resize\n        let vwrapper = document.querySelector('#video-wrapper');\n\n        let resizeObserver = new ResizeObserver(() => {\n            let existingwrapper = $(`#video-wrapper`).find(`#canvas .annotation-wrapper`);\n            if (existingwrapper.length == 0) {\n                return;\n            }\n            existingwrapper.each(function() {\n                let type = $(this).data('type');\n                setTimeout(() => {\n                    if (type == 'textblock'\n                        || type == 'audio' || type == 'stopwatch' || type == 'file' || type == 'navigation') {\n                        recalculatingTextSize($(this), type != 'textblock', type == 'textblock');\n                    } else if (type == 'video') {\n                        recalculatingSize($(this));\n                    }\n                }, 1);\n                $('#canvas').css('font-size', $('#canvas').width() / 75 + 'px');\n            });\n        });\n        resizeObserver.observe(vwrapper);\n\n        // Ready to render items.\n        let items = [];\n        let tracking = [];\n        let trackingIndex = 0;\n        if (data.items != '' && data.items !== null) {\n            items = JSON.parse(data.items);\n            tracking.push({\n                items: JSON.stringify(items),\n                actives: null,\n                at: new Date().getTime(),\n            });\n        }\n        let draftitemid = data.draftitemid;\n\n        renderItems(items, null, false);\n\n        // Render the inline annotation toolbar\n        if (this.isEditMode()) {\n            $('#inlineannotation-btns').remove();\n            let inlineannotationitems = [\n                {\n                    'icon': 'bi bi-image',\n                    'type': 'media',\n                    'mediatype': 'image',\n                    'label': M.util.get_string('image', 'ivplugin_inlineannotation'),\n                },\n                {\n                    'icon': 'bi bi-film',\n                    'type': 'media',\n                    'mediatype': 'video',\n                    'label': M.util.get_string('video', 'ivplugin_inlineannotation'),\n                },\n                {\n                    'icon': 'bi bi-volume-up',\n                    'type': 'media',\n                    'mediatype': 'audio',\n                    'label': M.util.get_string('audio', 'ivplugin_inlineannotation'),\n                },\n                {\n                    'icon': 'bi bi-alphabet-uppercase',\n                    'type': 'textblock',\n                    'mediatype': 'textblock',\n                    'label': M.util.get_string('text', 'ivplugin_inlineannotation'),\n                },\n                {\n                    'icon': 'bi bi-circle-square',\n                    'type': 'shape',\n                    'mediatype': 'shape',\n                    'label': M.util.get_string('shape', 'ivplugin_inlineannotation'),\n                },\n                {\n                    'icon': 'bi bi-stopwatch',\n                    'type': 'stopwatch',\n                    'mediatype': 'stopwatch',\n                    'label': M.util.get_string('stopwatch', 'ivplugin_inlineannotation'),\n                },\n                {\n                    'icon': 'bi bi-file-earmark-arrow-down',\n                    'type': 'media',\n                    'mediatype': 'file',\n                    'label': M.util.get_string('inlinefile', 'ivplugin_inlineannotation'),\n                },\n                {\n                    'icon': 'bi bi-sign-turn-right',\n                    'type': 'navigation',\n                    'mediatype': 'navigation',\n                    'label': M.util.get_string('navigation', 'ivplugin_inlineannotation')\n                },\n                {\n                    'icon': 'bi bi-plus-circle',\n                    'type': 'hotspot',\n                    'mediatype': 'hotspot',\n                    'label': M.util.get_string('hotspot', 'ivplugin_inlineannotation'),\n                }\n            ];\n            const dataForTemplate = {\n                id: annotation.id,\n                items: inlineannotationitems,\n            };\n\n            Templates.render('ivplugin_inlineannotation/toolbar', dataForTemplate).then((html) => {\n                return $videoWrapper.before(html);\n            }).catch(() => {\n                // Do nothing.\n            });\n\n            self.enableColorPicker();\n        }\n\n        $(document).one('iv:playerSeek iv:playerPlaying', function(e) {\n            let newTime = e.detail.time;\n            if (Math.floor(newTime) != annotation.timestamp) {\n                $(`#inlineannotation-btns`).remove();\n                $('.inlineannotation-popover').remove();\n                $videoWrapper.find(`#canvas`).remove();\n            }\n        });\n\n        // End of view mode.\n        if (!self.isEditMode()) {\n            return;\n        }\n\n        /**\n         * Update tracking data for redo and undo\n         * @param {Array} actives array of active items\n         */\n        const saveTracking = (actives) => {\n            if (trackingIndex < tracking.length - 1) {\n                // Remove all the tracking data after the current index.\n                tracking = tracking.slice(0, trackingIndex + 1);\n            }\n            tracking.push({\n                items: JSON.stringify(items),\n                actives: actives,\n                at: new Date().getTime(),\n            });\n            tracking.sort((a, b) => a.at - b.at);\n            trackingIndex = tracking.length - 1;\n            $('#inlineannotation-btns #undo').removeAttr('disabled');\n            $('#inlineannotation-btns #redo').attr('disabled', 'disabled');\n            if (tracking.length == 1) {\n                $('#inlineannotation-btns #undo').attr('disabled', 'disabled');\n            }\n        };\n\n        /**\n         * Order items by layer.\n         * @param {Array} ids array of item ids\n         * @param {String} order asc or desc\n         * @returns {Array} sorted array of item ids\n         */\n        const sortItemsByLayer = (ids, order) => {\n            ids = ids.map(x => x.toString()); // Convert ids to string for consistency.\n            let targetItems = items.filter(item => {\n                const id = item.id.toString();\n                return ids.includes(id);\n            });\n            if (order == 'desc') {\n                targetItems.sort((a, b) => b.position['z-index'] - a.position['z-index']);\n            } else {\n                targetItems.sort((a, b) => a.position['z-index'] - b.position['z-index']);\n            }\n\n            return targetItems.map(item => item.id);\n        };\n\n        /**\n         * Get highest z-index.\n         * @param {Array} itms array of items\n         * @returns {Number} top z-index\n         */\n        const getTopLayer = (itms) => {\n            if (itms.length == 0) {\n                return 5;\n            }\n            let ids = itms.map(item => item.id);\n            let sorted = sortItemsByLayer(ids, 'desc');\n            let zindex = itms.find(item => item.id == sorted[0]).position['z-index'];\n            return Number(zindex);\n        };\n\n        /**\n         * Get lowest z-index.\n         * @param {Array} itms array of items\n         * @returns {Number} bottom z-index\n         */\n        const getBottomLayer = (itms) => {\n            if (itms.length == 0) {\n                return 5;\n            }\n            let ids = itms.map(item => item.id);\n            let sorted = sortItemsByLayer(ids, 'asc');\n            let zindex = itms.find(item => item.id == sorted[0]).position['z-index'];\n            return Number(zindex);\n        };\n\n        /**\n         * Get all items from the annotation-canvas.\n         * @param {Boolean} updateid whether or not to update the id of the item.\n         */\n        const getItems = (updateid) => {\n            let newItems = [];\n            $videoWrapper.find(`#canvas .annotation-wrapper`).each(function(index, element) {\n                const id = $(element).data('item');\n                let item = {\n                    \"type\": $(element).data('type'),\n                    \"position\": recalculatingSize($(element)),\n                };\n                item.id = id;\n                item.properties = items.find(x => x.id == id).properties;\n                if (updateid) {\n                    item.id = new Date().getTime() + index;\n                    $(element).attr('data-item', item.id);\n                }\n                newItems.push(item);\n            });\n            items = newItems;\n            draftStatus = 'draft';\n        };\n\n        $playerWrapper.on('click', `#inlineannotation-btns #save`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            getItems(false);\n            // Encode html tags\n            let cleanItems = JSON.stringify(items).replace(/</g, '&lt;').replace(/>/g, '&gt;');\n            let updateId = $videoWrapper.find('#canvas').data('id');\n            $.ajax({\n                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                method: \"POST\",\n                dataType: \"text\",\n                data: {\n                    action: 'quickeditfield',\n                    sesskey: M.cfg.sesskey,\n                    id: updateId,\n                    field: 'content',\n                    contextid: M.cfg.contextid,\n                    draftitemid: draftitemid,\n                    value: cleanItems,\n                    cmid: self.cmid,\n                    token: self.token,\n                },\n                success: function(data) {\n                    let updated = JSON.parse(data);\n                    draftStatus = null;\n                    tracking = [];\n                    $('#inlineannotation-btns #redo, #inlineannotation-btns #undo').attr('disabled', 'disabled');\n                    dispatchEvent('annotationupdated', {\n                        annotation: updated,\n                        action: 'edit',\n                    });\n                }\n            });\n        });\n\n        $(document).one('click', `#inlineannotation-btns #closetoolbar`, function(e) {\n            e.preventDefault();\n            if (draftStatus == 'draft') {\n                Notification.saveCancel(\n                    M.util.get_string('unsavedchange', 'ivplugin_inlineannotation'),\n                    M.util.get_string('unsavedchangeconfirm', 'ivplugin_inlineannotation'),\n                    M.util.get_string('save'),\n                    function() {\n                        // If the user clicks save, save the changes.\n                        $('#inlineannotation-btns #save').trigger('click');\n                        $(`#inlineannotation-btns #closetoolbar`).trigger('click');\n                    },\n                    function() {\n                        $(`#inlineannotation-btns`).remove();\n                        $('#canvas[data-id=\"' + annotation.id + '\"]').remove();\n                    }\n                );\n            } else {\n                $(`#inlineannotation-btns`).remove();\n                $('#canvas[data-id=\"' + annotation.id + '\"]').remove();\n            }\n        });\n\n        $(document).on('click', `#inlineannotation-btns #hideshow`, function(e) {\n            e.preventDefault();\n            $('#canvas[data-id=\"' + annotation.id + '\"]').toggle();\n            $(this).find('i').toggleClass('bi-eye bi-eye-slash');\n        });\n        /**\n         * Handle form data when adding or editing an item.\n         * @param {Object} newItem data from form submission\n         * @param {String} type type of the item\n         * @param {Boolean} add adding or editing\n         */\n        const handleFormData = (newItem, type, add) => {\n            switch (type) {\n                case 'audio':\n                case 'file':\n                    if (add) {\n                        newItem.position.height = '40px';\n                        newItem.position.width = '130px';\n                    }\n                    break;\n                case 'textblock':\n                    if (add) {\n                        newItem.position.fontSize = '16px';\n                        newItem.position.lineHeight = '20px';\n                    }\n                    break;\n                case 'navigation':\n                case 'stopwatch':\n                    if (add) {\n                        newItem.position.height = '40px';\n                        newItem.position.width = '130px';\n                    }\n                    break;\n                case 'shape':\n                    if (add) {\n                        newItem.position.height = '100px';\n                        newItem.position.width = '100px';\n                    }\n                    break;\n                case 'video':\n                case 'image':\n                    newItem.position.height = 'auto';\n                    break;\n                case 'hotspot':\n                    if (add) {\n                        newItem.position.width = '5%';\n                    }\n                    break;\n            }\n\n            items.push(newItem);\n            saveTracking([newItem.id]);\n            renderItems([newItem], [newItem.id], true);\n        };\n\n        $playerWrapper.on('click', `#inlineannotation-btns .add-ia`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            let annoid = $videoWrapper.find(`#canvas`).data('id');\n            let type = $(this).attr('data-mediatype');\n            if (type == 'stopwatch' && items.find(x => x.type == 'stopwatch')) {\n                self.addNotification(M.util.get_string('onlyonestopwatch', 'ivplugin_inlineannotation'), 'danger');\n                return;\n            }\n            let iaform = new ModalForm({\n                formClass: \"ivplugin_inlineannotation\\\\items\\\\\" + $(this).attr('data-type'),\n                args: {\n                    contextid: M.cfg.contextid,\n                    id: 0,\n                    type: type,\n                    annotationid: annoid,\n                },\n                modalConfig: {\n                    title: M.util.get_string('addinlineannotation', 'ivplugin_inlineannotation',\n                        M.util.get_string(type, 'ivplugin_inlineannotation')),\n                }\n            });\n\n            iaform.show();\n\n            iaform.addEventListener(iaform.events.LOADED, () => {\n                iaform.modal.modal.draggable({\n                    handle: \".modal-header\",\n                });\n                if (type == 'navigation' || type == 'image' || type == 'shape') {\n                    $(document).on('change', '[name=\"timestamp\"]', function(e) {\n                        e.preventDefault();\n                        let parts = $(this).val().split(':');\n                        let timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                        if (!self.isBetweenStartAndEnd(timestamp)) {\n                            let message = M.util.get_string('timemustbebetweenstartandendtime', 'ivplugin_inlineannotation', {\n                                \"start\": self.convertSecondsToHMS(self.start),\n                                \"end\": self.convertSecondsToHMS(self.end),\n                            });\n                            self.addNotification(message);\n                            $(this).val($(this).attr('data-initial-value'));\n                            return;\n                        }\n\n                        // Make sure the timestamp is not in the skip segment.\n                        if (self.isInSkipSegment(timestamp)) {\n                            self.addNotification(M.util.get_string('interactionisbetweentheskipsegment',\n                                'ivplugin_inlineannotation'));\n                            $(this).val($(this).attr('data-initial-value'));\n                            return;\n                        }\n                    });\n                }\n            });\n\n            iaform.addEventListener(iaform.events.FORM_SUBMITTED, (e) => {\n                e.stopImmediatePropagation();\n                getItems(false);\n                const highestOrder = getTopLayer(items);\n                let left = Math.random() * 100;\n                let top = Math.random() * 100;\n                let newItem = {\n                    \"id\": new Date().getTime(),\n                    \"type\": type,\n                    \"position\": {\n                        \"width\": \"30%\",\n                        \"left\": left + \"px\",\n                        \"top\": top + \"px\",\n                        \"z-index\": highestOrder + 1,\n                    },\n                    'properties': e.detail,\n                };\n                handleFormData(newItem, type, true);\n            });\n        });\n\n        $playerWrapper.on('click', `#inlineannotation-btns #edit`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            let annnoid = $videoWrapper.find(`#canvas`).data('id');\n            let active = $('#edit-btns').attr('data-active');\n            getItems(false);\n            let item = items.find(x => x.id == active);\n            let type = item.type;\n            let formdata = {...item.properties};\n            formdata.contextid = M.cfg.contextid;\n            formdata.id = item.id;\n            formdata.annotationid = annnoid;\n            formdata.type = type;\n            let editform = new ModalForm({\n                formClass: \"ivplugin_inlineannotation\\\\items\\\\\" +\n                    (type == 'image' || type == 'video' || type == 'audio' || type == 'file' ? 'media' : type),\n                args: formdata,\n                modalConfig: {\n                    title: M.util.get_string('editinlineannotation', 'ivplugin_inlineannotation',\n                        M.util.get_string(type, 'ivplugin_inlineannotation')),\n                }\n            });\n\n            editform.show();\n\n            editform.addEventListener(editform.events.LOADED, () => {\n                editform.modal.modal.draggable({\n                    handle: \".modal-header\",\n                });\n                if (type == 'navigation' || type == 'image' || type == 'shape') {\n                    $(document).on('change', '[name=\"timestamp\"]', function(e) {\n                        e.preventDefault();\n                        let parts = $(this).val().split(':');\n                        let timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                        if (!self.isBetweenStartAndEnd(timestamp)) {\n                            let message = M.util.get_string('timemustbebetweenstartandendtime', 'mod_interactivevideo', {\n                                \"start\": self.convertSecondsToHMS(self.start),\n                                \"end\": self.convertSecondsToHMS(self.end),\n                            });\n                            self.addNotification(message);\n                            $(this).val($(this).attr('data-initial-value'));\n                            return;\n                        }\n\n                        // Make sure the timestamp is not in the skip segment.\n                        if (self.isInSkipSegment(timestamp)) {\n                            self.addNotification(M.util.get_string('interactionisbetweentheskipsegment', 'mod_interactivevideo'));\n                            $(this).val($(this).attr('data-initial-value'));\n                            return;\n                        }\n                    });\n                }\n            });\n\n            editform.addEventListener(editform.events.FORM_SUBMITTED, (e) => {\n                e.stopImmediatePropagation();\n                getItems(false);\n                item = items.find(x => x.id == active);\n                item.properties = e.detail;\n                // Remove the item from the annotation-canvas\n                $videoWrapper.find(`.annotation-wrapper[data-item=\"${active}\"]`).remove();\n                items = items.filter(x => x.id != active);\n                handleFormData(item, type, false);\n            });\n        });\n\n        $videoWrapper.on('click', `#canvas .annotation-wrapper`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            if (!e.ctrlKey && !e.metaKey) {\n                $videoWrapper.find('#canvas .annotation-wrapper').removeClass('active');\n                $(this).addClass('active');\n                this.focus();\n                recalculatingSize($(this));\n            } else {\n                if ($(this).hasClass('active')) {\n                    $(this).removeClass('active');\n                } else {\n                    $(this).addClass('active');\n                    this.focus();\n                }\n            }\n\n            if (!isNaN(Number($(this).data('group')))) {\n                let group = $(this).data('group');\n                $videoWrapper.find(`#canvas .annotation-wrapper[data-group=\"${group}\"]`).addClass('active');\n            }\n\n            recalculatingSize($(this));\n\n            var activewrapper = $videoWrapper.find('#canvas .annotation-wrapper.active');\n            if (activewrapper.length == 0) {\n                $('#edit-btns').attr('data-active', '').addClass('d-none').removeClass('d-flex');\n                $('#inlineannotation-btns #edit').attr('disabled', 'disabled');\n                $('#inlineannotation-btns #edit').removeAttr('disabled');\n            } else {\n                let dataActive = activewrapper.map(function() {\n                    return $(this).data('item');\n                }).get();\n                $('#edit-btns').attr('data-active', dataActive).addClass('d-flex').removeClass('d-none');\n                if (activewrapper.length > 1) {\n                    $('#inlineannotation-btns #edit').attr('disabled', 'disabled');\n                    $('#edit-btns #position').addClass('d-none');\n                } else {\n                    $('#inlineannotation-btns #edit').removeAttr('disabled');\n                    $('#edit-btns #position').removeClass('d-none');\n                }\n            }\n\n            // Enable ungroup button if the active items are grouped.\n            let grouping = activewrapper.map(function() {\n                return $(this).data('group');\n            }).get();\n\n            grouping = [...new Set(grouping)];\n\n            if (activewrapper.length < 2) {\n                $('#inlineannotation-btns #ungroup, #inlineannotation-btns #group').attr('disabled', 'disabled').addClass('d-none');\n            } else {\n                if (grouping.length == 1) {\n                    if (grouping[0] == 'undefined') {\n                        $('#inlineannotation-btns #ungroup').attr('disabled', 'disabled').addClass('d-none');\n                        $('#inlineannotation-btns #group').removeAttr('disabled').removeClass('d-none');\n                    } else {\n                        $('#inlineannotation-btns #ungroup').removeAttr('disabled').removeClass('d-none');\n                        $('#inlineannotation-btns #group').attr('disabled', 'disabled').addClass('d-none');\n                    }\n                } else if (grouping.length > 1) {\n                    $('#inlineannotation-btns #ungroup, #inlineannotation-btns #group').removeAttr('disabled')\n                        .removeClass('d-none');\n                }\n            }\n        });\n\n        $videoWrapper.on('dblclick', '#canvas .annotation-wrapper', function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            $(this).trigger('click');\n            $('#inlineannotation-btns #edit').trigger('click');\n        });\n\n        $(document).on('click', `#inlineannotation-btns #undo`, async function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            if (trackingIndex == 0) {\n                return;\n            }\n            trackingIndex--;\n            const instance = tracking[trackingIndex];\n            items = JSON.parse(instance.items);\n            renderItems(items, instance.actives, false);\n            if (trackingIndex == 0) {\n                $('#inlineannotation-btns #undo').attr('disabled', 'disabled');\n                $('#inlineannotation-btns #redo').removeAttr('disabled');\n            } else {\n                $('#inlineannotation-btns #undo').removeAttr('disabled');\n                if (trackingIndex == tracking.length - 1) {\n                    $('#inlineannotation-btns #redo').attr('disabled', 'disabled');\n                } else {\n                    $('#inlineannotation-btns #redo').removeAttr('disabled');\n                }\n            }\n        });\n\n        $(document).on('click', `#inlineannotation-btns #redo`, async function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            if (trackingIndex == tracking.length - 1) {\n                return;\n            }\n            trackingIndex++;\n            const instance = tracking[trackingIndex];\n            items = JSON.parse(instance.items);\n            renderItems(items, instance.actives, false);\n            if (trackingIndex == tracking.length - 1) {\n                $('#inlineannotation-btns #redo').attr('disabled', 'disabled');\n                $('#inlineannotation-btns #undo').removeAttr('disabled');\n            } else {\n                $('#inlineannotation-btns #redo').removeAttr('disabled');\n                if (trackingIndex == 0) {\n                    $('#inlineannotation-btns #undo').attr('disabled', 'disabled');\n                } else {\n                    $('#inlineannotation-btns #undo').removeAttr('disabled');\n                }\n            }\n        });\n\n        const updateOrder = (active, direction) => {\n            // First sort items by z-index descending\n            getItems(false);\n            items.sort((a, b) => b.position['z-index'] - a.position['z-index']);\n            let activeIndex = items.findIndex(x => x.id == active);\n            let activeItem = items[activeIndex];\n            let currentzIndex = activeItem.position['z-index'];\n            let affectedItem = null;\n            let affectedItemIndex = null;\n            if (direction == 'up') {\n                if (activeIndex == 0) {\n                    return;\n                }\n                affectedItemIndex = activeIndex - 1;\n                affectedItem = items[affectedItemIndex];\n                activeItem.position['z-index'] = affectedItem.position['z-index'];\n                affectedItem.position['z-index'] = currentzIndex;\n            } else {\n                if (activeIndex == items.length - 1) {\n                    return;\n                }\n                affectedItemIndex = activeIndex + 1;\n                affectedItem = items[affectedItemIndex];\n                activeItem.position['z-index'] = affectedItem.position['z-index'];\n                affectedItem.position['z-index'] = currentzIndex;\n            }\n            items[activeIndex] = activeItem;\n            items[affectedItemIndex] = affectedItem;\n            $(`.annotation-wrapper[data-item=\"${active}\"]`).css(activeItem.position);\n            $(`.annotation-wrapper[data-item=\"${affectedItem.id}\"]`).css(affectedItem.position);\n            saveTracking([active]);\n        };\n\n        // Group the active items\n        $(document).on('click', `#inlineannotation-btns #group`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            $(this).attr('disabled', 'disabled').addClass('d-none');\n            $('#inlineannotation-btns #ungroup').removeAttr('disabled').removeClass('d-none');\n            getItems(false);\n            let active = $('#canvas .annotation-wrapper.active').map(function() {\n                return $(this).data('item');\n            }).get();\n            const group = new Date().getTime();\n            active.forEach((item, i) => {\n                let activeItem = $(`#canvas .annotation-wrapper[data-item=\"${item}\"]`);\n                let targetIndex = items.findIndex(x => x.id == item);\n                let target = JSON.parse(JSON.stringify(items[targetIndex]));\n                target.position.group = group;\n                items[targetIndex] = target;\n                activeItem.remove();\n                renderItems([target], null, true);\n                if (i == active.length - 1) {\n                    renderItems([], active, true);\n                }\n            });\n            saveTracking(active);\n        });\n\n        $(document).on('click', `#inlineannotation-btns #ungroup`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            $(this).attr('disabled', 'disabled').addClass('d-none');\n            $(`#inlineannotation-btns #group`).removeAttr('disabled').removeClass('d-none');\n            getItems(false);\n            let active = $('#canvas .annotation-wrapper.active').map(function() {\n                return $(this).data('item');\n            }).get();\n            active.forEach((item, i) => {\n                let activeItem = $(`#canvas .annotation-wrapper[data-item=\"${item}\"]`);\n                let targetIndex = items.findIndex(x => x.id == item);\n                let target = JSON.parse(JSON.stringify(items[targetIndex]));\n                delete target.position.group;\n                items[targetIndex] = target;\n                activeItem.remove();\n                renderItems([target], null, true);\n                if (i == active.length - 1) {\n                    renderItems([], active, true);\n                }\n            });\n            saveTracking(active);\n        });\n\n        $playerWrapper.on('click', `#inlineannotation-btns #up`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            let active = $('#edit-btns').attr('data-active');\n            active = active.split(',');\n            const topLayer = getTopLayer(items);\n            // Check if the active elements are already in the correct order based on their index positions in the items array\n            if (active.length > 1) {\n                active = sortItemsByLayer(active, 'desc');\n                let indexes = [];\n                items.sort((a, b) => b.position['z-index'] - a.position['z-index']);\n                active.forEach((item) => {\n                    indexes.push(items.findIndex(x => x.id == item));\n                });\n                indexes.sort((a, b) => a - b);\n                if (Math.abs(indexes[0] - indexes[indexes.length - 1]) == active.length - 1) {\n                    if (Number(items[indexes[0]].position['z-index']) == topLayer) {\n                        return;\n                    }\n                }\n            }\n            active.forEach((item) => {\n                updateOrder(item, 'up');\n            });\n            getItems(false);\n            updatePositionInfo($(`.annotation-wrapper[data-item=\"${active[0]}\"]`));\n        });\n\n        $playerWrapper.on('click', `#inlineannotation-btns #down`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            let active = $('#edit-btns').attr('data-active');\n            active = active.split(',');\n            const bottomLayer = getBottomLayer(items);\n            // Check if the active elements are already in the correct order based on their index positions in the items array\n            if (active.length > 1) {\n                active = sortItemsByLayer(active, 'asc');\n                let indexes = [];\n                items.sort((a, b) => a.position['z-index'] - b.position['z-index']);\n                active.forEach((item) => {\n                    indexes.push(items.findIndex(x => x.id == item));\n                });\n                indexes.sort((a, b) => a - b);\n                if (Math.abs(indexes[0] - indexes[indexes.length - 1]) == active.length - 1) {\n                    if (Number(items[indexes[0]].position['z-index']) == bottomLayer) {\n                        return;\n                    }\n                }\n            }\n            active.forEach((item) => {\n                updateOrder(item, 'down');\n            });\n            getItems(false);\n            updatePositionInfo($(`.annotation-wrapper[data-item=\"${active[0]}\"]`));\n        });\n\n        $playerWrapper.on('click', `#inlineannotation-btns #delete`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            let active = $('#edit-btns').attr('data-active');\n            active = active.split(',');\n            active.forEach((item) => {\n                let activeItem = $(`#canvas .annotation-wrapper[data-item=\"${item}\"]`);\n                activeItem.remove();\n                $('#edit-btns').attr('data-active', '').addClass('d-none').removeClass('d-flex');\n            });\n            getItems(false);\n            saveTracking(null);\n        });\n\n        $playerWrapper.on('click', `#inlineannotation-btns #copy`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            getItems(false);\n            // Copy the active item\n            const highestOrder = getTopLayer(items);\n            let active = $('#edit-btns').attr('data-active');\n            active = active.split(',');\n            active = sortItemsByLayer(active, 'asc');\n            let newItems = [];\n            for (let i = 0; i < active.length; i++) {\n                let a = active[i];\n                let activeItem = $(`#canvas .annotation-wrapper[data-item=\"${a}\"]`);\n                activeItem.removeClass('active');\n                const item = items.find(x => x.id == a);\n                let newItem = JSON.parse(JSON.stringify(item));\n                newItem.position = recalculatingSize(activeItem);\n                if (item.position.group) {\n                    newItem.position.group = Number(item.position.group) + 1;\n                }\n                newItem.id = new Date().getTime();\n                newItems.push(newItem);\n                newItem.position.zIndex = Number(highestOrder) + i + 1;\n                items.push(newItem);\n                if (i == active.length - 1) {\n                    const newItemIds = newItems.map(x => x.id);\n                    $('#edit-btns').attr('data-active', newItemIds.join(',')).addClass('d-flex').removeClass('d-none');\n                    renderItems(newItems, newItemIds, true);\n                    // Put focus on the first element\n                    getItems(false);\n                    document.querySelector('.annotation-wrapper.active').focus();\n                    updatePositionInfo($(`.annotation-wrapper[data-item=\"${newItem.id}\"]`));\n                    saveTracking(newItemIds);\n                }\n            }\n        });\n\n        // Move items with keyboard arrow keys, ctrl + up to layer up, and ctrl + down to layer down.\n        $playerWrapper.on('keydown', '#canvas .annotation-wrapper', function(e) {\n            let active = $('#edit-btns').attr('data-active');\n            active = active.split(',');\n            for (let i = 0; i < active.length; i++) {\n                let a = active[i];\n                let activeItem = $(`#canvas .annotation-wrapper[data-item=\"${a}\"]`);\n                if (activeItem != undefined) {\n                    let position = activeItem.position();\n                    position['z-index'] = parseInt(activeItem.css('z-index'));\n                    let ctrl = e.ctrlKey || e.metaKey;\n                    let step = 1;\n                    // Prevent page scroll\n                    e.preventDefault();\n                    e.stopImmediatePropagation();\n                    switch (e.key) {\n                        case 'ArrowUp':\n                            if (position.top > 0) {\n                                position.top = position.top - step;\n                                saveTracking(active);\n                            }\n                            break;\n                        case 'ArrowDown':\n                            if (position.top + activeItem.outerHeight() < $videoWrapper.find(`#canvas`).height()) {\n                                position.top = position.top + step;\n                                saveTracking(active);\n                            }\n                            break;\n                        case 'ArrowLeft':\n                            if (position.left > 0) {\n                                position.left = position.left - step;\n                                saveTracking(active);\n                            }\n                            break;\n                        case 'ArrowRight':\n                            if (position.left + activeItem.outerWidth() < $videoWrapper.find(`#canvas`).width()) {\n                                position.left = position.left + step;\n                                saveTracking(active);\n                            }\n                            break;\n                        case 'Delete':\n                            $(`#inlineannotation-btns #delete`).trigger('click');\n                            return;\n                        case 'd': // Ctrl + d to duplicate\n                            if (ctrl) {\n                                $(`#inlineannotation-btns #copy`).trigger('click');\n                            }\n                            return;\n                        default:\n                            return;\n                    }\n                    activeItem.css(position);\n                    recalculatingSize(activeItem);\n                }\n            }\n        });\n\n        $playerWrapper.on('click', `#canvas`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            $videoWrapper.find('#canvas .annotation-wrapper').removeClass('active');\n            $('#inlineannotation-btns .btn').removeClass('active rotatey-360');\n            $('#edit-btns').attr('data-active', '').addClass('d-none').removeClass('d-flex');\n        });\n\n        $(document).on('annotationdeleted', function(e) {\n            let deleted = e.originalEvent.detail.annotation;\n            let annoid = $videoWrapper.find(`#canvas`).data('id');\n            if (annoid == deleted.id) {\n                $videoWrapper.find(`#canvas[data-id='${annoid}']`).remove();\n                $(`#inlineannotation-btns`).remove();\n            }\n        });\n\n        // Confirm draft saved.\n        window.addEventListener('beforeunload', (e) => {\n            if (draftStatus !== null) {\n                const confirmationMessage = M.util.get_string('unsavedchanges', 'mod_interactivevideo');\n                e.returnValue = confirmationMessage;\n                return confirmationMessage;\n            }\n            return true;\n        });\n    }\n    /**\n     * What happens when an item runs\n     * @param {Object} annotation The annotation object\n     * @returns {void}\n     */\n    async runInteraction(annotation) {\n        this.player.pause();\n        this.renderContainer(annotation);\n        if (this.isEditMode()) {\n            annotation.editmode = true; // Use editmode to render the draft content (i.e draft.php vs plugin.php).\n        }\n        const content = await this.render(annotation, 'json');\n        this.postContentRender(annotation, content);\n    }\n}"],"names":["InlineAnnotation","Base","postEditCallback","roundToTwo","num","Math","round","renderContainer","annotation","videoWrapper","find","remove","append","id","updateAspectRatio","async","video","reset","elem","hasClass","ratio","this","player","videowrapperaspect","width","height","gap","css","vwrapper","document","querySelector","ResizeObserver","observe","on","postContentRender","data","self","$videoWrapper","$playerWrapper","draftStatus","convertSecondsToMMSS","seconds","minutes","floor","updatePositionInfo","w","outerWidth","hw","outerHeight","t","position","top","l","left","z","text","recalculatingSize","message","removeAttr","h","g","group","recalculatingTextSize","button","multiline","fontSize","padding","rowCount","length","style","renderItems","elements","actives","update","empty","forEach","active","addClass","count","item","prop","properties","type","wrapper","JSON","stringify","resizable","isEditMode","attr","parts","timestamp","split","Number","gotourl","url","shadow","rounded","formattedalttext","removeClass","autoplay","playsInline","onplay","onpause","onended","wrapperhtml","formattedlabel","playButton","audioSrc","media","Audio","e","stopImmediatePropagation","paused","ended","currentTime","play","pause","totaltime","onloadedmetadata","duration","ontimeupdate","setTimeout","trigger","one","timer","alarm","clearInterval","intervalfunction","setInterval","time","playalarmsound","playsoundatinterval","intervaltime","playsoundatend","M","cfg","wwwroot","allowpause","textparts","textblock","part","trim","alignment","textfont","undefined","lineHeight","bold","italic","underline","textcolor","bgcolor","borderwidth","bordercolor","opacity","shape","color","usemodal","formattedtitle","popover","container","html","template","$body","formatContent","content","contextid","openbydefault","draggable","containment","cursor","grid","handle","start","each","drag","event","ui","$selected","originalPosition","positions","map","bottom","right","get","x","sort","a","b","target","distance","not","$this","stop","newLeft","newTop","getItems","saveTracking","handles","minHeight","resize","ctrlKey","aspectRatio","includes","navigation","isBetweenStartAndEnd","seek","viewertype","hotspotid","hotspot","items","title","modal","fadeIn","closest","existingwrapper","tracking","trackingIndex","parse","push","at","Date","getTime","draftitemid","inlineannotationitems","util","get_string","dataForTemplate","render","then","before","catch","enableColorPicker","newTime","detail","slice","sortItemsByLayer","ids","order","toString","targetItems","filter","getTopLayer","itms","sorted","zindex","updateid","newItems","index","element","preventDefault","cleanItems","replace","updateId","ajax","method","dataType","action","sesskey","field","value","cmid","token","success","updated","saveCancel","toggle","toggleClass","handleFormData","newItem","add","annoid","addNotification","iaform","ModalForm","formClass","args","annotationid","modalConfig","show","addEventListener","events","LOADED","val","convertSecondsToHMS","end","isInSkipSegment","FORM_SUBMITTED","highestOrder","random","annnoid","formdata","editform","metaKey","focus","isNaN","activewrapper","dataActive","grouping","Set","instance","updateOrder","direction","activeIndex","findIndex","activeItem","currentzIndex","affectedItem","affectedItemIndex","i","targetIndex","topLayer","indexes","abs","bottomLayer","getBottomLayer","zIndex","newItemIds","join","parseInt","ctrl","step","key","deleted","originalEvent","window","confirmationMessage","returnValue","editmode"],"mappings":"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"}