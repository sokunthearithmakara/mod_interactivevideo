{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module main\n *\n * @module     ivplugin_annotation/main\n * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport Base from 'mod_interactivevideo/type/base';\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport {dispatchEvent} from 'core/event_dispatcher';\nimport ModalForm from 'core_form/modalform';\nimport {notifyFilterContentUpdated as notifyFilter} from 'core_filters/events';\n\nexport default class Annotation extends Base {\n    async init() {\n        const videoWrapper = $('#video-wrapper');\n        let item = this.annotations.find((annotation) => annotation.type == 'annotation');\n        if (!this.isEditMode()) {\n            if (!item || item.content == '') {\n                return;\n            }\n            const updateAspectRatio = async (video, reset) => {\n                let elem = video ? $('#player') : $(`#annotation-canvas[data-id='${item.id}']`);\n                if ($(\"#wrapper\").hasClass('fullscreen')) {\n                    let ratio = await this.player.ratio();\n                    let videowrapperaspect = videoWrapper.width() / videoWrapper.height();\n                    let gap = '- 55px';\n                    if ($(\"#wrapper\").hasClass('no-videonav')) {\n                        gap = '';\n                    }\n                    if (videowrapperaspect > ratio) {\n                        elem.css('height', `calc(100vh ${gap})`);\n                        elem.css('width', `calc((100vh ${gap}) * ${ratio})`);\n                        elem.css('top', '0');\n                        elem.css('left', `calc((100vw - (100vh ${gap}) * ${ratio}) / 2)`);\n                    } else if (videowrapperaspect < ratio) {\n                        elem.css('width', '100vw');\n                        elem.css('height', `${100 / ratio}vw`);\n                        elem.css('top', `calc((100vh ${gap} - 100vw / ${ratio}) / 2)`);\n                        elem.css('left', '0');\n                    }\n                } else {\n                    elem.css('width', '100%');\n                    elem.css('height', '100%');\n                    elem.css('top', '0');\n                    elem.css('left', '0');\n                }\n                if (reset) {\n                    elem.css('width', '100%');\n                    elem.css('height', '100%');\n                    elem.css('top', '0');\n                    elem.css('left', '0');\n                }\n            };\n\n            updateAspectRatio();\n            updateAspectRatio(true);\n\n            let vwrapper = document.querySelector('#video-wrapper');\n            let resizeObserver = new ResizeObserver(() => {\n                updateAspectRatio();\n                updateAspectRatio(true);\n            });\n\n            resizeObserver.observe(vwrapper);\n\n            $(document).on('timeupdate', function(e) {\n                updateAspectRatio(true, true);\n                const t = e.originalEvent.detail.time;\n                let annos = $('#annotation-canvas .annotation-wrapper');\n                annos.each(function() {\n                    let start = $(this).data('start');\n                    let end = $(this).data('end');\n                    if (t >= start && t <= end) {\n                        $(this).css('visibility', 'visible');\n                    } else {\n                        $(this).css('visibility', 'hidden');\n                    }\n                });\n            });\n\n            $('#annotation-canvas').attr('data-id', item.id);\n            let content = await this.render(item, 'json');\n            this.postContentRender(item, content);\n        } else {\n            $(document).on('timeupdate', function(e) {\n                const t = e.originalEvent.detail.time;\n                let annos = $('#annotation-canvas .annotation-wrapper');\n                annos.each(function() {\n                    let start = $(this).data('start');\n                    let end = $(this).data('end');\n                    if (t >= start && t <= end) {\n                        $(this).css('visibility', 'visible');\n                    } else {\n                        $(this).css('visibility', 'hidden');\n                    }\n                });\n            });\n            if (item) {\n                $('#annotation-canvas').attr('data-id', item.id);\n                item.editmode = true;\n                window.console.log(item);\n                let content = await this.render(item, 'json');\n                window.console.log(content);\n                this.postContentRender(item, content);\n            }\n        }\n    }\n    async renderAnnotationToolbar(annotation) {\n        $('#annotation-btns').remove();\n        let annotationitems = [\n            {\n                'icon': 'bi bi-image',\n                'type': 'media',\n                'mediatype': 'image',\n                'label': M.util.get_string('image', 'ivplugin_inlineannotation'),\n            },\n            {\n                'icon': 'bi bi-alphabet-uppercase',\n                'type': 'text',\n                'mediatype': 'text',\n                'label': M.util.get_string('text', 'ivplugin_inlineannotation'),\n            },\n            {\n                'icon': 'bi bi-circle-square',\n                'type': 'shape',\n                'mediatype': 'shape',\n                'label': M.util.get_string('shape', 'ivplugin_inlineannotation'),\n            },\n            {\n                'icon': 'bi bi-file-earmark-arrow-down',\n                'type': 'media',\n                'mediatype': 'file',\n                'label': M.util.get_string('inlinefile', 'ivplugin_inlineannotation'),\n            },\n            {\n                'icon': 'bi bi-sign-turn-right',\n                'type': 'navigation',\n                'mediatype': 'navigation',\n                'label': M.util.get_string('navigation', 'ivplugin_inlineannotation')\n            },\n            {\n                'icon': 'bi bi-plus-circle',\n                'type': 'hotspot',\n                'mediatype': 'hotspot',\n                'label': M.util.get_string('hotspot', 'ivplugin_inlineannotation'),\n            }\n        ];\n        const dataForTemplate = {\n            id: annotation.id,\n            items: annotationitems,\n        };\n\n        let html = await Templates.render('ivplugin_annotation/toolbar', dataForTemplate);\n        $(\"#wrapper\").append(html);\n\n        this.enableColorPicker();\n    }\n\n    postContentRender(annotation, data) {\n        let self = this;\n        var $videoWrapper = $('#annotation-canvas');\n        var $playerWrapper = $('#wrapper');\n        const convertSecondsToMMSS = (seconds) => {\n            let hours = Math.floor(seconds / 3600);\n            let minutes = Math.floor((seconds - hours * 3600) / 60);\n            let sec = seconds - hours * 3600 - minutes * 60;\n            let formattedTime = '';\n            if (hours > 0) {\n                formattedTime += hours + ':';\n            }\n            if (minutes < 10) {\n                formattedTime += '0';\n            }\n            formattedTime += minutes + ':';\n            if (sec < 10) {\n                formattedTime += '0';\n            }\n            formattedTime += sec;\n            return formattedTime;\n        };\n\n        const appendTimestamp = (seconds) => {\n            var formattedTime = convertSecondsToMMSS(seconds, true);\n            $('#scrollbar').append(`<div id=\"position\" class=\"position-absolute bg-black text-white small rounded-sm p-1\"\n                 style=\"top: -30px;\">${formattedTime}</div>`);\n        };\n\n        const updatePositionInfo = (elem) => {\n            let w = parseFloat(elem.outerWidth());\n            let hw = parseFloat(elem.outerHeight());\n            let t = parseFloat(elem.position().top) < 0 ? 0 : parseFloat(elem.position().top);\n            let l = parseFloat(elem.position().left) < 0 ? 0 : parseFloat(elem.position().left);\n            let z = elem.css('z-index');\n            let s = elem.data('start');\n            let e = elem.data('end');\n            $(`#annotation-btns #position`)\n                .html(`<i class=\"bi-bounding-box-circles bi mr-1\"></i>\n                    x: <span id=\"x-position\" class=\"mr-2\">${Math.round(l)}</span>\n                    y: <span id=\"y-position\" class=\"mr-2\">${Math.round(t)}</span>\n                    z: <span id=\"z-position\" class=\"mr-2\">${z - 5}</span>\n                    w: <span id=\"w-position\" class=\"mr-2\">${Math.round(w)}</span>\n                    h: <span id=\"h-position\" class=\"mr-2\">${Math.round(hw)}</span>\n                <i class=\"bi-stopwatch bi ml-2 mr-1\"></i>\n                <span id=\"s-position\" class=\"mr-1\">${convertSecondsToMMSS(s)}</span>\n                -<span id=\"e-position\" class=\"mx-1\">${convertSecondsToMMSS(e)}</span>`);\n        };\n\n        const recalculatingSize = (elem) => {\n            let message = $('#annotation-canvas');\n            $(`#annotation-btns #down, #annotation-btns #up`).removeAttr('disabled');\n            let w = parseFloat(elem.outerWidth()) / parseFloat(message.width()) * 100;\n            let h = parseFloat(elem.outerHeight()) / parseFloat(message.height()) * 100;\n            if (elem.position().right < 0) {\n                elem.css('right', '0');\n            }\n            if (elem.position().bottom < 0) {\n                elem.css('bottom', '0');\n            }\n            let t = parseFloat(elem.position().top) / parseFloat(message.height()) * 100 < 0 ? 0\n                : parseFloat(elem.position().top) / parseFloat(message.height()) * 100;\n            let l = parseFloat(elem.position().left) / parseFloat(message.width()) * 100 < 0 ? 0\n                : parseFloat(elem.position().left) / parseFloat(message.width()) * 100;\n            let z = elem.css('z-index');\n            let position = {\n                'width': w + '%',\n                'height': h + '%',\n                'left': l + '%',\n                'top': t + '%',\n                'z-index': z,\n            };\n            elem.css(position);\n            if (z == 6) {\n                $(`#annotation-btns #down`).attr('disabled', 'disabled');\n            }\n            updatePositionInfo(elem);\n            if (elem.data('type') == 'video') {\n                // Update size of the playpause button\n                elem.find('.playpause').css({\n                    'font-size': elem.outerHeight() * 0.2 + 'px',\n                    'line-height': elem.outerHeight() * 0.2 + 'px',\n                });\n            }\n            return position;\n        };\n\n        const recalculatingTextSize = (elem, button) => {\n            let fontSize = elem.outerHeight();\n            elem.find('.annotation-content').css({\n                'font-size': (button ? fontSize * 0.7 : fontSize * 0.9) + 'px',\n                'line-height': fontSize + 'px',\n                'padding-left': (button ? 0.4 : 0.1) + 'em',\n                'padding-right': (button ? 0.4 : 0.1) + 'em',\n            });\n            elem.css('width', 'auto');\n        };\n\n        const renderTimelineItems = async (elements, activeid) => {\n            let timeline = $('#timeline #annotation-timeline');\n            timeline.empty();\n            elements.sort((a, b) => b.position['z-index'] - a.position['z-index']);\n            elements.forEach((item, i) => {\n                let prop = item.properties;\n                let type = item.type;\n                let id = item.id;\n                let left = (prop.start - self.start) / (self.end - self.start) * 100;\n                let width = (prop.end - prop.start) / (self.end - self.start) * 100;\n                timeline.append(`<div class=\"annotation-timeline-item position-absolute ${activeid == id ? 'active' : ''}\"\n                     data-item=\"${id}\" data-type=\"${type}\" data-end=\"${prop.end}\" data-start=\"${prop.start}\"\n                         style=\"left: ${left}%; top: ${(i + 1) * 7}px; width: ${width}%\"></div>`);\n            });\n            dispatchEvent('timeupdate', {time: await self.player.getCurrentTime()});\n        };\n\n        const renderItems = async (elements, active, update) => {\n            if (!update) { // Clear the annotation-canvas if it is a new start.\n                $videoWrapper.find(`.annotation-wrapper`).remove();\n                $('#timeline #annotation-timeline').empty();\n            }\n            // Sort element by z-index\n            elements.sort((a, b) => b.position['z-index'] - a.position['z-index']);\n            let count = 0;\n            elements.forEach((item) => {\n                let prop = item.properties;\n                let type = item.type;\n                let id = item.id;\n                let position = item.position;\n                let wrapper = $(`<div class=\"annotation-wrapper\" data-start=\"${prop.start}\" data-end=\"${prop.end}\"\n                     data-anno=\"${annotation.id}\" data-item=\"${id}\" data-type=\"${type}\"\n                      data-property='${JSON.stringify(prop)}'></div>`);\n                if (prop.resizable == '1' || self.isEditMode()) {\n                    wrapper.addClass('resizable');\n                    wrapper.attr('tabindex', 0);\n                }\n                switch (type) {\n                    case 'image':\n                        var parts = prop.timestamp.split(':');\n                        var timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                        if (prop.gotourl != '') {\n                            wrapper.append(`<a href=\"${prop.gotourl}\" target=\"_blank\"><img src=\"${prop.url}\" id=\"${id}\"\n                             class=\"annotation-content ${prop.rounded == 1 ? 'rounded' : 'rounded-0'} w-100\n                              ${prop.shadow == '1' ? 'shadow' : ''}\" alt=\"${prop.formattedalttext}\"/></a>`);\n                        } else {\n                            wrapper.append(`<img src=\"${prop.url}\" id=\"${id}\"\n                                 ${timestamp > 0 ? 'data-timestamp=\"' + timestamp + '\"' : ''} class=\"annotation-content\n                                 ${prop.rounded == 1 ? 'rounded' : 'rounded-0'} w-100 ${prop.shadow == '1' ? 'shadow' : ''}\n                                  ${timestamp > 0 ? 'cursor-pointer' : ''}\" alt=\"${prop.formattedalttext}\"/>`);\n                        }\n                        if ((prop.gototurl != '' || timestamp > 0) && !self.isEditMode()) {\n                            wrapper.removeClass('resizable');\n                        }\n                        wrapper.css(position);\n                        wrapper.css('height', 'auto');\n                        $videoWrapper.append(wrapper);\n                        break;\n                    case 'file':\n                        var wrapperhtml = ``;\n                        wrapperhtml = `<a id=\"${id}\"\n                        class=\"btn ${prop.style} ${prop.rounded == '1' ? 'btn-rounded' : 'rounded-0'}\n                        annotation-content text-nowrap ${prop.shadow == '1' ? 'shadow' : ''} rotatey-180\" href=\"${prop.url}\"\n                         target=\"_blank\"><i class=\"bi bi-paperclip\"\n                          style=\"font-size:0.7em;\"></i>${prop.formattedlabel != \"\" ?\n                                `<span style=\"margin-left:0.25em;\">${prop.formattedlabel}` : ''}</a>`;\n                        wrapper.append(`<div class=\"d-flex h-100\">${wrapperhtml}</div>`);\n\n                        position.width = 0;\n\n                        wrapper.css(position);\n                        $videoWrapper.append(wrapper);\n                        recalculatingTextSize(wrapper, true);\n\n                        break;\n\n                    case 'navigation':\n                        var parts = prop.timestamp.split(':');\n                        var timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n\n                        wrapper.append(`<div class=\"d-flex h-100\"><span id=\"${id}\" tabindex=\"0\"\n                             class=\"btn ${prop.style} ${prop.rounded == '1' ? 'btn-rounded' : 'rounded-0'}\n                              annotation-content text-nowrap ${prop.shadow == '1' ? 'shadow' : ''}\"\n                               data-timestamp=\"${timestamp}\">${prop.formattedlabel}</span></div>`);\n\n                        position.width = 0;\n\n                        wrapper.css(position);\n                        $videoWrapper.append(wrapper);\n                        recalculatingTextSize(wrapper, true);\n                        break;\n\n                    case 'text':\n                        if (prop.url != undefined && prop.url != '') {\n                            wrapper.append(`<a id=\"${id}\"\n                                 class=\"annotation-content text-nowrap ${prop.shadow == '1' ? 'text-shadow' : ''} d-block\"\n                                  href=\"${prop.url}\" target=\"_blank\">${prop.formattedlabel}</a>`);\n                        } else {\n                            wrapper.append(`<div id=\"${id}\"\n                                 class=\"annotation-content text-nowrap ${prop.shadow == '1' ? 'text-shadow' : ''}\n                                 \">${prop.formattedlabel}</div>`);\n                        }\n                        wrapper.position.width = 0;\n                        wrapper.css(position);\n                        var style = {\n                            'font-weight': prop.bold == '1' ? 'bold' : 'normal',\n                            'font-style': prop.italic == '1' ? 'italic' : 'normal',\n                            'text-decoration': prop.underline == '1' ? 'underline' : 'none',\n                            'color': prop.textcolor,\n                            'background': prop.bgcolor,\n                            'border-width': prop.borderwidth,\n                            'border-color': prop.bordercolor,\n                            'border-style': 'solid',\n                            'font-family': prop.textfont != '' ? prop.textfont : 'inherit',\n                        };\n                        wrapper.find('.annotation-content').css(style);\n                        $videoWrapper.append(wrapper);\n                        recalculatingTextSize(wrapper);\n                        break;\n\n                    case 'shape':\n                        var parts = prop.timestamp.split(':');\n                        var timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                        if (prop.gotourl != '') {\n                            wrapper.append(`<a href=\"${prop.gotourl}\" target=\"_blank\"><div id=\"${id}\"\n                             class=\"annotation-content ${prop.shadow == '1' ? 'shadow' : ''}\"\n                              style=\"width: 100%; height: 100%;\"></div></a>`);\n                        } else {\n                            wrapper.append(`<div id=\"${id}\" class=\"annotation-content ${prop.shadow == '1' ? 'shadow' : ''}\n                                 ${timestamp > 0 ? 'cursor-pointer' : ''}\"\n                             ${timestamp > 0 ? 'data-timestamp=\"' + timestamp + '\"' : ''}\n                             style=\"width: 100%; height: 100%;\"></div>`);\n                        }\n                        wrapper.css(position);\n                        var style = {\n                            'background': prop.bgcolor,\n                            'border-width': prop.borderwidth,\n                            'border-color': prop.bordercolor,\n                            'border-style': 'solid',\n                            'opacity': prop.opacity / 100,\n                        };\n                        if (prop.shape == 'circle') {\n                            style['border-radius'] = '50%';\n                        } else if (prop.shape == 'rectangle') {\n                            style['border-radius'] = prop.rounded == '1' ? '10px' : '0';\n                        }\n                        wrapper.find('.annotation-content').css(style);\n                        $videoWrapper.append(wrapper);\n                        break;\n\n                    case 'hotspot':\n                        wrapper.append(`<div id=\"${id}\" class=\"annotation-content shadow-sm pulse\" role=\"button\"></div>`);\n                        position['aspect-ratio'] = '1';\n                        wrapper.css(position);\n                        var style = {\n                            'background-color': prop.color,\n                            'opacity': prop.opacity / 100,\n                            'border-radius': '50%',\n                            'aspect-ratio': '1',\n                        };\n                        wrapper.find('.annotation-content').css(style);\n                        $videoWrapper.append(wrapper);\n\n                        if (!self.isEditMode()) {\n                            if (prop.usemodal == '1') {\n                                wrapper.attr({\n                                    'data-toggle': 'modal',\n                                    'data-content': prop.content.text,\n                                    'data-title': prop.formattedtitle,\n                                    'data-link': prop.url,\n                                });\n                            } else {\n                                wrapper.attr({\n                                    'tabindex': -1,\n                                    'data-trigger': 'manual',\n                                    'data-boundary': 'viewport',\n                                    'data-placement': 'auto',\n                                    'data-html': 'true',\n                                    'data-content': '<div class=\"loader\"></div>',\n                                    'data-title': prop.formattedtitle\n                                        + `<i class=\"bi bi-x-circle-fill ml-auto popover-dismiss cursor-pointer\"\n                                         style=\"font-size:1.5em;\"></i>`,\n                                });\n\n                                wrapper.popover({\n                                    container: '#wrapper',\n                                    html: true,\n                                    template: `<div class=\"popover inlineannotation-popover id-${id}\"\n                                     role=\"tooltip\"><div class=\"arrow\"></div>\n                                     <h3 class=\"popover-header d-flex justify-content-between\"></h3>\n                                     <div class=\"popover-body rounded\"></div>${prop.url != '' ?\n                                            `<div class=\"popup-footer bg-gray p-2 rounded-bottom\"><a href=\"${prop.url}\"\n                                          class=\"d-block w-100 text-right rotatex-360\" target=\"_blank\">\n                                          <i class=\"bi bi-arrow-right\"><i></i></i></a></div>` : ''}</div>`,\n                                });\n\n                                wrapper.on('shown.bs.popover', function() {\n                                    let $body = $(`.popover.id-${id} .popover-body`);\n                                    self.formatContent(prop.content.text, M.cfg.contextid).then((html) => {\n                                        $body.html(html);\n                                        notifyFilter($body);\n                                        wrapper.popover('update');\n                                    });\n                                });\n                                if (prop.openbydefault == '1') {\n                                    wrapper.popover('show');\n                                }\n                            }\n                        }\n                        break;\n                }\n\n                if (type != 'shape') {\n                    wrapper.on('mouseover', function() {\n                        if (!$(this).hasClass('resizable')) {\n                            return;\n                        }\n\n                        let aspectRatio =\n                            $(this).find('.annotation-content').width() / $(this).find('.annotation-content').height();\n                        if (wrapper.width() / wrapper.height() != aspectRatio && (type == 'image' || type == 'video')) {\n                            $(this).height((wrapper.width() / aspectRatio));\n                        }\n                        $(this).resizable('option', 'aspectRatio', $(this).find('.annotation-content').outerWidth() /\n                            $(this).find('.annotation-content').outerHeight());\n                    });\n                }\n\n                if (id == active) {\n                    wrapper.trigger('click');\n                }\n\n                count++;\n\n                if (count == elements.length) {\n                    const currentTime = self.player.getCurrentTime();\n                    dispatchEvent('timeupdate', {time: currentTime});\n\n                    if (self.isEditMode()) {\n                        renderTimelineItems(elements, active);\n                        if ($('#annotation-btns').is(\":visible\") == false) {\n                            $videoWrapper.find('.annotation-wrapper').addClass('no-pointer-events');\n                        }\n                        // Initialize the draggable and resizable for each item.\n                        $videoWrapper.find('.annotation-wrapper').draggable({\n                            containment: \"#annotation-canvas\",\n                            cursor: \"move\",\n                            handle: '.annotation-content',\n                            stop: function() {\n                                recalculatingSize($(this));\n                                $(this).trigger('click');\n                            },\n                            drag: function() {\n                                updatePositionInfo($(this));\n                            }\n                        });\n\n                        $videoWrapper.find('.annotation-wrapper').resizable({\n                            containment: \"#annotation-canvas\",\n                            handles: \"all\",\n                            start: function(event) {\n                                let type = $(this).data('type');\n                                // If shape and ctrl key is pressed, keep the aspect ratio 1:1.\n                                if (type == 'shape' && event.ctrlKey) {\n                                    $(this).resizable('option', 'aspectRatio', 1);\n                                }\n                            },\n                            stop: function() {\n                                let type = $(this).data('type');\n                                if (type == 'text' || type == 'file' || type == 'navigation') {\n                                    recalculatingTextSize($(this), type != 'text');\n                                } else if (type == 'shape') {\n                                    $(this).resizable('option', 'aspectRatio', false);\n                                }\n                                recalculatingSize($(this));\n                                $(this).trigger('click');\n                            },\n                            resize: function(event) {\n                                let type = $(this).data('type');\n                                if (type == 'text' || type == 'file' || type == 'navigation') {\n                                    recalculatingTextSize($(this), type != 'text');\n                                } else if (type == 'shape' && event.ctrlKey) {\n                                    $(this).resizable('option', 'aspectRatio', 1);\n                                }\n                                updatePositionInfo($(this));\n                            }\n                        });\n\n                        // Initialize the draggable and resizable for each item on the timeline.\n                        $('#timeline #annotation-timeline .annotation-timeline-item').draggable({\n                            'axis': 'x',\n                            'containment': 'parent',\n                            'cursor': 'move',\n                            'start': function() {\n                                let elementid = $(this).data('item');\n                                let elem = $videoWrapper.find(`.annotation-wrapper[data-item=\"${elementid}\"]`);\n                                elem.trigger('click');\n                                appendTimestamp($(this).data('timestamp'));\n                                $('#timeline-items').addClass('no-pointer-events');\n                                $(this).addClass('no-pointer-events');\n                            },\n                            'drag': async function(e, ui) {\n                                let timestamp = (ui.position.left) / $('#annotation-timeline').width() * self.totaltime\n                                    + self.start;\n                                await self.player.seek(Math.round(timestamp));\n                                self.player.pause();\n                                $('#scrollbar').css('left', (timestamp - self.start) / self.totaltime * 100 + '%');\n                                $('#scrollbar #position').text(convertSecondsToMMSS(Math.round(timestamp), true));\n                                let length = $(this).data('end') - $(this).data('start');\n                                window.console.log($(this).data('end'), $(this).data('start'));\n                                $('#s-position').text(convertSecondsToMMSS(Math.round(timestamp), true));\n                                $('#e-position').text(convertSecondsToMMSS(Math.round(timestamp) + length, true));\n                            },\n                            'stop': function(e, ui) {\n                                $('#scrollbar #position').remove();\n                                $('#timeline-items').removeClass('no-pointer-events');\n                                $(this).removeClass('no-pointer-events');\n                                let elementid = $(this).data('item');\n                                let elem = $videoWrapper.find(`.annotation-wrapper[data-item=\"${elementid}\"]`);\n                                let prop = elem.data('property');\n                                let timestamp = (ui.position.left) / $('#annotation-timeline').width() * self.totaltime\n                                    + self.start;\n                                let duration = prop.end - prop.start;\n                                prop.start = Math.round(((ui.position.left) / $('#annotation-timeline').width() * self.totaltime)\n                                    + self.start);\n                                prop.end = Math.round(prop.start + duration);\n                                elem.attr('data-property', JSON.stringify(prop));\n                                elem.attr('data-start', prop.start);\n                                elem.attr('data-end', prop.end);\n                                $('#scrollbar').css('left', (Math.round(timestamp) - self.start) / self.totaltime * 100 + '%');\n                                $(this).attr('data-start', prop.start);\n                                getItems(false);\n                                renderItems(items, elementid, false);\n                                dispatchEvent('timeupdate', {time: Math.round(timestamp)});\n                                $('#s-position').text(convertSecondsToMMSS(Math.round(timestamp), true));\n                                $('#e-position').text(convertSecondsToMMSS(Math.round(timestamp) + duration, true));\n                            },\n                        });\n\n                        $('#timeline #annotation-timeline .annotation-timeline-item').resizable({\n                            'handles': 'e, w',\n                            'containment': 'parent',\n                            'start': function() {\n                                let elementid = $(this).data('item');\n                                let elem = $videoWrapper.find(`.annotation-wrapper[data-item=\"${elementid}\"]`);\n                                elem.trigger('click');\n                                appendTimestamp($(this).data('timestamp'));\n                                $('#timeline-items').addClass('no-pointer-events');\n                            },\n                            'resize': async function(e, ui) {\n                                let timestamp;\n                                if (ui.originalPosition.left != ui.position.left || ui.originalSize.width == ui.size.width) {\n                                    if (ui.position.left < 0) {\n                                        ui.position.left = 0;\n                                    }\n                                    timestamp = ((ui.position.left)\n                                        / $('#annotation-timeline').width()) * self.totaltime + self.start;\n                                } else {\n                                    timestamp = ((ui.position.left + ui.size.width)\n                                        / $('#annotation-timeline').width()) * self.totaltime + self.start;\n                                }\n                                $('#scrollbar').css('left', (timestamp - self.start) / self.totaltime * 100 + '%');\n                                await self.player.seek(Math.round(timestamp));\n                                self.player.pause();\n                                $('#scrollbar #position').text(convertSecondsToMMSS(Math.round(timestamp), true));\n                                let start = ((ui.position.left) / $('#annotation-timeline').width()) * self.totaltime + self.start;\n                                let end = ((ui.position.left + ui.size.width) / $('#annotation-timeline').width()) * self.totaltime\n                                    + self.start;\n                                $('#s-position').text(convertSecondsToMMSS(Math.round(start), true));\n                                $('#e-position').text(convertSecondsToMMSS(Math.round(end), true));\n                            },\n                            'stop': async function(e, ui) {\n                                $('#scrollbar #position').remove();\n                                setTimeout(function() {\n                                    $('#timeline-items').removeClass('no-pointer-events');\n                                }, 200);\n                                let elementid = $(this).data('item');\n                                let elem = $videoWrapper.find(`.annotation-wrapper[data-item=\"${elementid}\"]`);\n                                let prop = elem.data('property');\n                                let timestamp, direction;\n                                if (ui.originalPosition.left != ui.position.left) {\n                                    if (ui.position.left < 0) {\n                                        ui.position.left = 0;\n                                    }\n                                    timestamp = ((ui.position.left)\n                                        / $('#annotation-timeline').width()) * self.totaltime + self.start;\n                                    direction = \"left\";\n                                } else {\n                                    timestamp = ((ui.position.left + ui.size.width)\n                                        / $('#annotation-timeline').width()) * self.totaltime + self.start;\n                                    direction = \"right\";\n                                }\n                                if (direction == \"left\") {\n                                    prop.start = Math.round(timestamp);\n                                } else {\n                                    prop.end = Math.round(timestamp);\n                                }\n                                elem.attr('data-property', JSON.stringify(prop));\n                                elem.attr('data-start', prop.start);\n                                elem.attr('data-end', prop.end);\n                                await self.player.seek(Math.round(timestamp));\n                                self.player.pause();\n                                $('#scrollbar').css('left', (timestamp - self.start) / self.totaltime * 100 + '%');\n                                $(this).attr('data-start', prop.start);\n                                getItems(false);\n                                renderItems(items, elementid, false);\n                                dispatchEvent('timeupdate', {time: Math.round(timestamp)});\n                                $('#s-position').text(convertSecondsToMMSS(Math.round(prop.start), true));\n                                $('#e-position').text(convertSecondsToMMSS(Math.round(prop.end), true));\n                            }\n                        });\n                    }\n                }\n            });\n\n            // Handle behavior for each item\n            if (!self.isEditMode()) {\n                $videoWrapper.on('click', `.annotation-wrapper`, function(e) {\n                    e.stopImmediatePropagation();\n                    let wrapper = $(this);\n                    let type = wrapper.data('type');\n                    switch (type) {\n                        case 'navigation':\n                        case 'image':\n                        case 'shape':\n                            var navigation = wrapper.find('.annotation-content');\n                            if (navigation.data('timestamp') && self.isBetweenStartAndEnd(navigation.data('timestamp'))) {\n                                self.player.seek(navigation.data('timestamp'));\n                                self.player.play();\n                            }\n                            break;\n                        case 'hotspot':\n                            var viewertype = wrapper.data('toggle');\n                            if (viewertype == 'modal') {\n                                let title = wrapper.data('title');\n                                let content = wrapper.data('content');\n                                let url = wrapper.data('link');\n                                let modal = `<div class=\"modal fade\" id=\"annotation-modal\" role=\"dialog\"\n                                aria-labelledby=\"annotation-modal\"\n                             aria-hidden=\"true\" data-backdrop=\"static\" data-keyboard=\"false\">\n                             <div class=\"modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable\" role=\"document\">\n                                <div class=\"modal-content rounded-lg\">\n                                    <div class=\"modal-header d-flex align-items-center shadow-sm pr-0\" id=\"title\">\n                                        <h5 class=\"modal-title text-truncate mb-0\">${title}</h5>\n                                        <button class=\"btn mx-2 p-0 close\" aria-label=\"Close\" data-dismiss=\"modal\">\n                                            <i class=\"bi bi-x-lg fa-fw\" style=\"font-size: x-large;\"></i>\n                                        </button>\n                                    </div>\n                                    <div class=\"modal-body\" id=\"content\">\n                                    <div class=\"loader\"></div>\n                                    </div>\n                                    ${url != '' ? `<div class=\"modal-footer bg-gray p-2 rounded-bottom\">\n                                        <a href=\"${url}\" class=\"d-block w-100 text-right rotatex-360\" target=\"_blank\">\n                                        <i class=\"bi bi-arrow-right\"><i></i></i></a></div>` : ''}\n                                    </div>\n                                </div>\n                                </div>`;\n                                $('#wrapper').append(modal);\n                                $('#annotation-modal').modal('show');\n                                $('#annotation-modal').on('hide.bs.modal', function() {\n                                    $('#annotation-modal').remove();\n                                });\n                                $('#annotation-modal').on('shown.bs.modal', async function() {\n                                    $('#annotation-modal .modal-body').fadeIn(300);\n                                    let $body = $('#annotation-modal .modal-body');\n                                    const html = await self.formatContent(content, M.cfg.contextid);\n                                    $body.html(html);\n                                    notifyFilter($body);\n                                });\n                            } else {\n                                wrapper.popover('show');\n                            }\n                            break;\n                    }\n                });\n\n                $playerWrapper.on('click', `.popover-dismiss`, function(e) {\n                    e.stopImmediatePropagation();\n                    $(this).closest('.popover').remove();\n                });\n            }\n        };\n\n        // Check resize on video wrapper resize\n        let vwrapper = document.querySelector('#video-wrapper');\n\n        let resizeObserver = new ResizeObserver(() => {\n            let existingwrapper = $(`#annotation-canvas`).find(`.annotation-wrapper`);\n            if (existingwrapper.length == 0) {\n                return;\n            }\n            existingwrapper.each(function() {\n                let type = $(this).data('type');\n                if (type == 'text' || type == 'file' || type == 'navigation') {\n                    recalculatingTextSize($(this), type != 'text');\n                } else if (type == 'video') {\n                    recalculatingSize($(this));\n                }\n            });\n        });\n\n        resizeObserver.observe(vwrapper);\n        let items = [];\n        if (data.items != '' && data.items !== null) {\n            items = JSON.parse(data.items);\n        }\n        let draftitemid = data.draftitemid;\n\n        renderItems(items, null, false);\n\n        // End of view mode.\n        if (!self.isEditMode()) {\n            return;\n        }\n\n        const getItems = (updateid) => {\n            items = [];\n            $videoWrapper.find(`.annotation-wrapper`).each(function(index, element) {\n                let item = {\n                    \"id\": (updateid ? (new Date().getTime() + index) : $(element).data('item')),\n                    \"type\": $(element).data('type'),\n                    \"position\": recalculatingSize($(element)),\n                    \"properties\": JSON.parse($(element).attr('data-property')),\n                };\n                items.push(item);\n            });\n        };\n\n        $(document).on('click', '.annotation-timeline-item', function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            let elementid = $(this).data('item');\n            let elem = $videoWrapper.find(`.annotation-wrapper[data-item=\"${elementid}\"]`);\n            $('.annotation-timeline-item').removeClass('active');\n            $(this).addClass('active');\n            elem.trigger('click');\n            self.player.seek($(this).data('start'));\n        });\n\n        $playerWrapper.on('click', `#annotation-btns #save`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            getItems(true);\n            // Encode html tags\n            let cleanItems = JSON.stringify(items).replace(/</g, '&lt;').replace(/>/g, '&gt;');\n            let updateId = $videoWrapper.data('id');\n            $.ajax({\n                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                method: \"POST\",\n                dataType: \"text\",\n                data: {\n                    action: 'quickeditfield',\n                    sesskey: M.cfg.sesskey,\n                    id: updateId,\n                    field: 'content',\n                    contextid: M.cfg.contextid,\n                    draftitemid: draftitemid,\n                    value: cleanItems,\n                    cmid: self.cmid,\n                    token: self.token,\n                },\n                success: function(data) {\n                    let updated = JSON.parse(data);\n                    dispatchEvent('annotationupdated', {\n                        annotation: updated,\n                        action: 'edit',\n                    });\n                }\n            });\n        });\n\n        $(document).on('click', `#annotation-btns #closetoolbar`, function(e) {\n            e.preventDefault();\n            $(`#annotation-btns`).remove();\n            $('#interaction-timeline, #video-timeline-wrapper, #timeline-btns').show();\n            $('#content-region').removeClass('no-pointer-events');\n            $('#annotation-timeline').hide();\n            $('#annotation-canvas .annotation-wrapper').addClass('no-pointer-events').removeClass('active');\n        });\n\n        const handleFormData = (newItem, type, add) => {\n            switch (type) {\n                case 'file':\n                    if (add) {\n                        newItem.position.height = '40px';\n                        newItem.position.width = '130px';\n                    }\n                    break;\n                case 'navigation':\n                case 'text':\n                    newItem.width = '0';\n                    break;\n                case 'shape':\n                    if (add) {\n                        newItem.position.height = '100px';\n                        newItem.position.width = '100px';\n                    }\n                    break;\n                case 'image':\n                    newItem.position.height = 'auto';\n                    break;\n                case 'hotspot':\n                    if (add) {\n                        newItem.position.width = '5%';\n                    }\n                    break;\n            }\n\n            items.push(newItem);\n            renderItems(items, newItem.id, false);\n        };\n\n        $playerWrapper.on('click', `#annotation-btns .add-ia`, async function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            let annoid = $videoWrapper.data('id');\n            let type = $(this).attr('data-mediatype');\n            let currenttime = await self.player.getCurrentTime();\n            let iaform = new ModalForm({\n                formClass: \"ivplugin_annotation\\\\items\\\\\" + $(this).attr('data-type'),\n                args: {\n                    contextid: M.cfg.contextid,\n                    id: 0,\n                    type: type,\n                    annotationid: annoid,\n                    start: currenttime,\n                    end: currenttime + 5,\n                },\n                modalConfig: {\n                    title: M.util.get_string('addinlineannotation', 'ivplugin_inlineannotation',\n                        M.util.get_string(type, 'ivplugin_inlineannotation')),\n                }\n            });\n\n            iaform.show();\n\n            iaform.addEventListener(iaform.events.LOADED, () => {\n                iaform.modal.modal.draggable({\n                    handle: \".modal-header\",\n                });\n                if (type == 'navigation' || type == 'image' || type == 'shape') {\n                    $(document).on('change', '[name=\"timestamp\"]', function(e) {\n                        e.preventDefault();\n                        let parts = $(this).val().split(':');\n                        let timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                        if (!self.isBetweenStartAndEnd(timestamp)) {\n                            let message = M.util.get_string('timemustbebetweenstartandendtime', 'ivplugin_inlineannotation', {\n                                \"start\": self.convertSecondsToHMS(self.start),\n                                \"end\": self.convertSecondsToHMS(self.end),\n                            });\n                            self.addNotification(message);\n                            $(this).val($(this).attr('data-initial-value'));\n                            return;\n                        }\n\n                        // Make sure the timestamp is not in the skip segment.\n                        if (self.isInSkipSegment(timestamp)) {\n                            self.addNotification(M.util.get_string('interactionisbetweentheskipsegment',\n                                'ivplugin_inlineannotation'));\n                            $(this).val($(this).attr('data-initial-value'));\n                            return;\n                        }\n                    });\n                }\n            });\n\n            iaform.addEventListener(iaform.events.FORM_SUBMITTED, (e) => {\n                getItems(false);\n                let left = Math.random() * 100;\n                let top = Math.random() * 100;\n                let newItem = {\n                    \"id\": new Date().getTime(),\n                    \"type\": type,\n                    \"position\": {\n                        \"width\": \"30%\",\n                        \"left\": left + \"px\",\n                        \"top\": top + \"px\",\n                        \"z-index\": items.length + 6,\n                    },\n                    'properties': e.detail,\n                };\n                handleFormData(newItem, type, true);\n            });\n        });\n\n        $playerWrapper.on('click', `#annotation-btns #edit`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            let annnoid = $videoWrapper.data('id');\n            let active = $('#edit-btns').attr('data-active');\n            getItems(false);\n            let item = items.find(x => x.id == active);\n            let type = item.type;\n            let formdata = {...item.properties};\n            formdata.contextid = M.cfg.contextid;\n            formdata.id = item.id;\n            formdata.annotationid = annnoid;\n            formdata.type = type;\n            let editform = new ModalForm({\n                formClass: \"ivplugin_annotation\\\\items\\\\\" +\n                    (type == 'image' || type == 'file' ? 'media' : type),\n                args: item.properties,\n                modalConfig: {\n                    title: M.util.get_string('editinlineannotation', 'ivplugin_inlineannotation',\n                        M.util.get_string(type, 'ivplugin_inlineannotation')),\n                }\n            });\n\n            editform.show();\n\n            editform.addEventListener(editform.events.LOADED, () => {\n                editform.modal.modal.draggable({\n                    handle: \".modal-header\",\n                });\n                if (type == 'navigation' || type == 'image' || type == 'shape') {\n                    $(document).on('change', '[name=\"timestamp\"]', function(e) {\n                        e.preventDefault();\n                        let parts = $(this).val().split(':');\n                        let timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                        if (!self.isBetweenStartAndEnd(timestamp)) {\n                            let message = M.util.get_string('timemustbebetweenstartandendtime', 'mod_interactivevideo', {\n                                \"start\": self.convertSecondsToHMS(self.start),\n                                \"end\": self.convertSecondsToHMS(self.end),\n                            });\n                            self.addNotification(message);\n                            $(this).val($(this).attr('data-initial-value'));\n                            return;\n                        }\n\n                        // Make sure the timestamp is not in the skip segment.\n                        if (self.isInSkipSegment(timestamp)) {\n                            self.addNotification(M.util.get_string('interactionisbetweentheskipsegment', 'mod_interactivevideo'));\n                            $(this).val($(this).attr('data-initial-value'));\n                            return;\n                        }\n                    });\n                }\n            });\n\n            editform.addEventListener(editform.events.FORM_SUBMITTED, (e) => {\n                getItems(false);\n                item = items.find(x => x.id == active);\n                item.properties = e.detail;\n                // Remove the item from the annotation-canvas\n                $videoWrapper.find(`.annotation-wrapper[data-item=\"${active}\"]`).remove();\n                items = items.filter(x => x.id != active);\n                handleFormData(item, type, false);\n            });\n        });\n\n        $videoWrapper.on('click', `.annotation-wrapper`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            if (!e.ctrlKey) {\n                $('#annotation-btns .btn').removeClass('active rotatey-360');\n                $videoWrapper.find('.annotation-wrapper').removeClass('active');\n                $(this).addClass('active');\n                this.focus();\n                recalculatingSize($(this));\n            } else {\n                if ($(this).hasClass('active')) {\n                    $(this).removeClass('active');\n                } else {\n                    $(this).addClass('active');\n                    this.focus();\n                }\n            }\n\n            recalculatingSize($(this));\n\n            const id = $(this).data('item');\n            $(`#timeline #annotation-timeline .annotation-timeline-item`).removeClass('active');\n            $(`#timeline #annotation-timeline .annotation-timeline-item[data-item=\"${id}\"]`).addClass('active');\n\n            var activewrapper = $videoWrapper.find('.annotation-wrapper.active');\n            if (activewrapper.length == 0) {\n                $('#edit-btns').attr('data-active', '').addClass('d-none').removeClass('d-flex');\n                $('#annotation-btns #edit').attr('disabled', 'disabled');\n                $('#annotation-btns #edit').removeAttr('disabled');\n            } else {\n                let dataActive = activewrapper.map(function() {\n                    return $(this).data('item');\n                }).get();\n                $('#edit-btns').attr('data-active', dataActive).addClass('d-flex').removeClass('d-none');\n                activewrapper.each(function() {\n                    let type = $(this).data('type');\n                    $(`#annotation-btns .btn[data-mediatype=\"${type}\"]`).addClass('active rotatey-360');\n                });\n                if (activewrapper.length > 1) {\n                    $('#annotation-btns #edit').attr('disabled', 'disabled');\n                } else {\n                    $('#annotation-btns #edit').removeAttr('disabled');\n                }\n            }\n        });\n\n        $playerWrapper.on('click', `#annotation-btns #up`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            // Increase the z-index of the active item\n            let active = $('#edit-btns').attr('data-active');\n            active = active.split(',');\n            active.forEach((item) => {\n                let activeItem = $(`.annotation-wrapper[data-item=\"${item}\"]`);\n                let zIndex = parseInt(activeItem.css('z-index'));\n                activeItem.css('z-index', zIndex + 1);\n                recalculatingSize(activeItem);\n            });\n            if (active.length == 1) {\n                active = active[0];\n            }\n            getItems(false);\n            renderTimelineItems(items, active);\n        });\n\n        $playerWrapper.on('click', `#annotation-btns #down`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            // Decrease the z-index of the active item\n            let active = $('#edit-btns').attr('data-active');\n            active = active.split(',');\n            active.forEach((item) => {\n                let activeItem = $(`.annotation-wrapper[data-item=\"${item}\"]`);\n                let zIndex = parseInt(activeItem.css('z-index'));\n                activeItem.css('z-index', zIndex - 1);\n                recalculatingSize(activeItem);\n            });\n            if (active.length == 1) {\n                active = active[0];\n            }\n            getItems(false);\n            renderTimelineItems(items, active);\n        });\n\n        $playerWrapper.on('click', `#annotation-btns #delete`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            // Delete the active item\n            let active = $('#edit-btns').attr('data-active');\n            active = active.split(',');\n            active.forEach((item) => {\n                let activeItem = $(`.annotation-wrapper[data-item=\"${item}\"]`);\n                activeItem.remove();\n                $('#edit-btns').attr('data-active', '').addClass('d-none').removeClass('d-flex');\n            });\n            getItems(false);\n            renderTimelineItems(items, null);\n            $('#annotation-btns .btn').removeClass('active rotatey-360');\n        });\n\n        $playerWrapper.on('click', `#annotation-btns #copy`, function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            getItems(false);\n            // Copy the active item\n            let active = $('#edit-btns').attr('data-active');\n            active = active.split(',');\n            let newItems = [];\n            for (let i = 0; i < active.length; i++) {\n                let a = active[i];\n                let activeItem = $(`.annotation-wrapper[data-item=\"${a}\"]`);\n                activeItem.removeClass('active');\n                let item = items.find(x => x.id == a);\n                let newItem = {...item};\n                newItem.position = recalculatingSize(activeItem);\n                newItem.id = new Date().getTime();\n                newItems.push(newItem.id);\n                newItem.position.zIndex = items.length + 6;\n                newItem.position.left = (parseInt(newItem.position.left) + 5) + '%';\n                newItem.position.top = (parseInt(newItem.position.top) + 5) + '%';\n                items.push(newItem);\n                renderItems(items, null, false);\n                if (i == active.length - 1) {\n                    $('#edit-btns').attr('data-active', newItems.join(',')).addClass('d-flex').removeClass('d-none');\n                    newItems.forEach((ni) => {\n                        $(`.annotation-wrapper[data-item=\"${ni}\"]`).addClass('active');\n                    });\n                    // Put focus on the first element\n                    document.querySelector('.annotation-wrapper.active').focus();\n                }\n            }\n        });\n\n        // Move items with keyboard arrow keys, ctrl + up to layer up, and ctrl + down to layer down.\n        $playerWrapper.on('keydown', '.annotation-wrapper', function(e) {\n            let active = $('#edit-btns').attr('data-active');\n            active = active.split(',');\n            for (let i = 0; i < active.length; i++) {\n                let a = active[i];\n                let activeItem = $(`.annotation-wrapper[data-item=\"${a}\"]`);\n                if (activeItem != undefined) {\n                    let position = activeItem.position();\n                    position['z-index'] = parseInt(activeItem.css('z-index'));\n                    let ctrl = e.ctrlKey || e.metaKey;\n                    let step = 1;\n                    // Prevent page scroll\n                    e.preventDefault();\n                    e.stopImmediatePropagation();\n                    switch (e.key) {\n                        case 'ArrowUp':\n                            if (ctrl) {\n                                position['z-index'] = position['z-index'] + 1;\n                                break;\n                            }\n                            if (position.top > 0) {\n                                position.top = position.top - step;\n                            }\n                            break;\n                        case 'ArrowDown':\n                            if (ctrl) {\n                                position['z-index'] = position['z-index'] - 1;\n                                break;\n                            }\n                            if (position.top + activeItem.outerHeight() < $videoWrapper.height()) {\n                                position.top = position.top + step;\n                            }\n                            break;\n                        case 'ArrowLeft':\n                            if (position.left > 0) {\n                                position.left = position.left - step;\n                            }\n                            break;\n                        case 'ArrowRight':\n                            if (position.left + activeItem.outerWidth() < $videoWrapper.width()) {\n                                position.left = position.left + step;\n                            }\n                            break;\n                        case 'Delete':\n                            $(`#annotation-btns #delete`).trigger('click');\n                            return;\n                        case 'd': // Ctrl + d to duplicate\n                            if (ctrl) {\n                                $(`#annotation-btns #copy`).trigger('click');\n                            }\n                            return;\n                        default:\n                            return;\n                    }\n                    activeItem.css(position);\n                    recalculatingSize(activeItem);\n                }\n            }\n        });\n\n        $(document).on('annotationdeleted', function(e) {\n            let deleted = e.originalEvent.detail.annotation;\n            let annoid = $videoWrapper.data('id');\n            if (annoid == deleted.id) {\n                $videoWrapper.find('.annotation-wrapper').remove();\n                $(`#annotation-btns`).remove();\n                $(`#timeline #annotation-timeline .annotation-timeline-item`).remove();\n            }\n        });\n    }\n\n    async renderEditItem(annotations, listItem, item) {\n        this.annotations = annotations;\n        listItem.removeAttr('id').removeClass('d-none');\n        listItem.attr('data-type', item.type);\n        listItem.addClass(item.type);\n        listItem.attr('data-id', item.id);\n        listItem.removeAttr('data-timestamp');\n        listItem.find('.timestamp').remove();\n        listItem.find('.title').text(item.formattedtitle).addClass('no-pointer-events');\n        listItem.find('.btn.xp').remove();\n        listItem.find('.type-icon i').addClass(this.prop.icon);\n        listItem.find('.type-icon').attr('title', this.prop.title);\n        listItem.find('.btn.copy').remove();\n        listItem.appendTo('#annotation-list');\n        return listItem;\n    }\n    async editAnnotation(annotations, id) {\n        this.annotations = annotations;\n        let item = this.annotations.find((annotation) => annotation.id == id);\n        $('#annotation-canvas').attr('data-id', item.id);\n        $('#interaction-timeline, #video-timeline-wrapper, #timeline-btns').hide();\n        $('#content-region').addClass('no-pointer-events');\n        $('#annotation-timeline').show();\n        $('#annotation-canvas .annotation-wrapper').removeClass('no-pointer-events');\n        this.renderAnnotationToolbar(item);\n    }\n    async addAnnotation(annotations, timestamp, coursemodule) {\n        let self = this;\n        // Check if the annotation of this type already exists.\n        let annotation = annotations.find((annotation) => annotation.type == self.prop.name);\n        if (annotation) {\n            self.addNotification('Annotation already exists', 'danger');\n            return;\n        }\n        let data = {\n            title: 'Annotation',\n            timestamp: -1,\n            contextid: M.cfg.contextid,\n            type: self.prop.name,\n            courseid: self.course,\n            cmid: coursemodule,\n            annotationid: self.interaction,\n            hascompletion: 0,\n            advanced: JSON.stringify({\n                \"visiblebeforecompleted\": \"1\",\n                \"visibleaftercompleted\": null,\n                \"clickablebeforecompleted\": \"1\",\n                \"clickableaftercompleted\": null,\n                \"replaybehavior\": \"1\",\n            }),\n        };\n        let ajax = await Ajax.call([{\n            methodname: 'ivplugin_annotation_add',\n            args: {\n                annotationdata: JSON.stringify(data),\n            },\n            contextid: M.cfg.contextid,\n        }])[0];\n\n        let newAnnotation = JSON.parse(ajax.data);\n        dispatchEvent('annotationupdated', {\n            annotation: newAnnotation,\n            action: 'add'\n        });\n\n        self.annotations = annotations;\n        $('#contentmodal').modal('hide');\n        self.editAnnotation(annotations, newAnnotation.id);\n    }\n    runInteraction(annotation) {\n        return annotation;\n    }\n}"],"names":["Annotation","Base","videoWrapper","item","this","annotations","find","annotation","type","isEditMode","document","on","e","t","originalEvent","detail","time","each","start","data","end","css","attr","id","editmode","window","console","log","content","render","postContentRender","updateAspectRatio","async","video","reset","elem","hasClass","ratio","player","videowrapperaspect","width","height","gap","vwrapper","querySelector","ResizeObserver","observe","remove","annotationitems","M","util","get_string","dataForTemplate","items","html","Templates","append","enableColorPicker","self","$videoWrapper","$playerWrapper","convertSecondsToMMSS","seconds","hours","Math","floor","minutes","sec","formattedTime","appendTimestamp","updatePositionInfo","w","parseFloat","outerWidth","hw","outerHeight","position","top","l","left","z","s","round","recalculatingSize","message","removeAttr","h","right","bottom","recalculatingTextSize","button","fontSize","renderTimelineItems","elements","activeid","timeline","empty","sort","a","b","forEach","i","prop","properties","getCurrentTime","renderItems","active","update","count","wrapper","JSON","stringify","resizable","addClass","parts","timestamp","split","Number","gotourl","url","rounded","shadow","formattedalttext","gototurl","removeClass","wrapperhtml","style","formattedlabel","undefined","bold","italic","underline","textcolor","bgcolor","borderwidth","bordercolor","textfont","opacity","shape","color","usemodal","text","formattedtitle","popover","container","template","$body","formatContent","cfg","contextid","then","openbydefault","aspectRatio","trigger","length","currentTime","is","draggable","containment","cursor","handle","stop","drag","handles","event","ctrlKey","resize","elementid","ui","totaltime","seek","pause","duration","getItems","originalPosition","originalSize","size","setTimeout","direction","stopImmediatePropagation","navigation","isBetweenStartAndEnd","play","title","modal","fadeIn","closest","existingwrapper","parse","draftitemid","updateid","index","element","Date","getTime","push","preventDefault","cleanItems","replace","updateId","ajax","wwwroot","method","dataType","action","sesskey","field","value","cmid","token","success","updated","show","hide","handleFormData","newItem","add","annoid","currenttime","iaform","ModalForm","formClass","args","annotationid","modalConfig","addEventListener","events","LOADED","val","convertSecondsToHMS","addNotification","isInSkipSegment","FORM_SUBMITTED","random","annnoid","x","formdata","editform","filter","focus","activewrapper","dataActive","map","get","activeItem","zIndex","parseInt","newItems","join","ni","ctrl","metaKey","step","key","deleted","listItem","icon","appendTo","renderAnnotationToolbar","coursemodule","name","courseid","course","interaction","hascompletion","advanced","Ajax","call","methodname","annotationdata","newAnnotation","editAnnotation","runInteraction"],"mappings":"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"}