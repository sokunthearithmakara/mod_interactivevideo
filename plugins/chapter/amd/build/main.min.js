define("ivplugin_chapter/main",["exports","jquery","mod_interactivevideo/type/base"],(function(_exports,_jquery,_base){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Interactive video chapter type script
   *
   * @module     ivplugin_chapter/main
   * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_base=_interopRequireDefault(_base);class Chapter extends _base.default{init(){let self=this,chapters=this.annotations.filter((annotation=>"chapter"==annotation.type));(0,_jquery.default)("#chaptertoggle").removeClass("d-none"),chapters.sort(((a,b)=>a.timestamp-b.timestamp)),chapters[0].timestamp>this.start&&chapters.unshift({id:0,title:M.util.get_string("startchapter","ivplugin_chapter"),formattedtitle:M.util.get_string("startchapter","ivplugin_chapter"),timestamp:this.start}),chapters.forEach(((chapter,index)=>{chapter.start=chapter.timestamp,index<chapters.length-1?chapter.end=chapters[index+1].timestamp:chapter.end=this.end}));const $chapterlists=(0,_jquery.default)("[data-region=chapterlists]");$chapterlists.empty(),chapters.forEach((chapter=>{var seconds,h,m,s;$chapterlists.append(`<li class="p-0 flex-column border-left-0 border-right-0 chapter\n            list-group-item d-flex justify-content-between align-items-center cursor-pointer"\n            data-id="${chapter.id}" data-start="${chapter.start}" data-end="${chapter.end}">\n            <div class="w-100 d-flex align-items-center justify-content-between p-2">\n            <span class="flex-grow-1 text-truncate font-weight-bold"><i class="bi bi-chevron-down mr-2 toggle"></i>\n            <span class="chapter-title">${chapter.formattedtitle}</span></span><span class="badge badge-primary badge-pill">\n            ${seconds=chapter.start-this.start,h=Math.floor(seconds/3600),m=Math.floor(seconds%3600/60),s=Math.floor(seconds%3600%60),(h>0?h+":":"")+(m<10?"0":"")+m+":"+(s<10?"0":"")+s}</span></div>\n            <ul class="annolistinchapter w-100 p-0"></ul></li>`)}));var interval=setInterval((async()=>{var currenttime=await this.player.getCurrentTime();if(currenttime>=this.end)clearInterval(interval);else{var currentchapter=chapters.find((chapter=>currenttime>=chapter.start&&currenttime<chapter.end));currentchapter&&($chapterlists.find(".chapter").removeClass("active-chapter"),$chapterlists.find(`.chapter[data-id=${currentchapter.id}]`).addClass("active-chapter"))}}),1e3);$chapterlists.on("click",".chapter .chapter-title",(function(e){e.preventDefault(),(0,_jquery.default)("#start-screen").fadeOut(300),(0,_jquery.default)("#end-screen").fadeOut(300);let starttime=(0,_jquery.default)(this).closest("li").data("start");self.player.seek(starttime),self.player.play();const percentage=(starttime-self.start)/self.totaltime*100;(0,_jquery.default)("#video-nav #progress").replaceWith(`<div id="progress"\n             style="width: ${percentage>100?100:percentage}%;"></div>`),(0,_jquery.default)(this).closest("#chapter-container-left").length>0&&(0,_jquery.default)("#chaptertoggle .btn").trigger("click")})),(0,_jquery.default)(document).on("click","#chaptertoggle .btn",(function(e){e.preventDefault(),(0,_jquery.default)("#interactivevideo-container").toggleClass("chapter-open"),(0,_jquery.default)(this).find("i").toggleClass("bi-collection bi-collection-fill")})),(0,_jquery.default)(document).on("click","#closechapter",(function(e){e.preventDefault(),(0,_jquery.default)("#chaptertoggle .btn").trigger("click")})),(0,_jquery.default)(document).on("click",".chapter i.toggle.bi",(function(e){e.preventDefault(),(0,_jquery.default)(this).closest(".chapter").find(".annolistinchapter").slideToggle(300),(0,_jquery.default)(this).toggleClass("bi-chevron-down bi-chevron-right")}))}renderEditItem(annotations,listItem,item){return(listItem=super.renderEditItem(annotations,listItem,item)).find(".type-name").addClass("justify-content-center"),listItem.find(".type-icon i").remove(),(Number(item.timestamp)>this.end||Number(item.timestamp)<this.start||this.isSkipped(item.timestamp))&&listItem.find(".title").addClass("text-muted"),listItem}renderItemOnVideoNavigation(annotation){if(annotation.hide)return;if(annotation.timestamp<this.start||annotation.timestamp>this.end)return;const percentage=(Number(annotation.timestamp)-this.start)/this.totaltime*100;this.isVisible(annotation)&&(0,_jquery.default)("#video-nav ul").append(`<li class="annotation ${annotation.type}\n             ${this.isClickable(annotation)?"":"no-pointer-events"} li-draggable\n              ${this.isSkipped(annotation.timestamp)?"skipped":""}" data-timestamp="${annotation.timestamp}"\n              data-id="${annotation.id}" style="left: calc(${percentage}% - 5px)">\n        <div class="item" data-toggle="tooltip" data-container="#wrapper" data-trigger="hover" data-html="true"\n        data-original-title='<i class="${this.prop.icon} mr-1"></i>${annotation.formattedtitle}'></div></li>`)}runInteraction(annotation){this.player.pause(),(0,_jquery.default)("#controler").addClass("no-pointer-events"),(0,_jquery.default)("#video-wrapper").append(`<h2 id="message" class="chapter position-absolute w-100 py-4\n        px-3 m-0 justify-content-start"><span class="text-truncate">${annotation.formattedtitle}</span></h2>`),(0,_jquery.default)("#video-wrapper #message").append('<div id="chapterprogress"\n        class="progress position-absolute w-100">\n        <div class="progress-bar"></div></div>'),(0,_jquery.default)("#message span").animate({top:"30px"},300,"swing"),(0,_jquery.default)("#chapterprogress .progress-bar").animate({width:"100%"},3e3,"linear",(()=>{this.isEditMode()?(0,_jquery.default)("h2#message").remove():((0,_jquery.default)("#message span").css("top","0"),this.player.play(),(0,_jquery.default)("#controler").removeClass("no-pointer-events"))}))}}return _exports.default=Chapter,_exports.default}));

//# sourceMappingURL=main.min.js.map