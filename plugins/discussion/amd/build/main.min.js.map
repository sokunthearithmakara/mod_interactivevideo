{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Main class for the discussion plugin.\n *\n * @module     ivplugin_discussion/main\n * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport Base from 'mod_interactivevideo/type/base';\nimport $ from 'jquery';\nimport { notifyFilterContentUpdated as notifyFilter } from 'core_filters/events';\nexport default class Discussion extends Base {\n    renderContainer(annotation) {\n        if (annotation.completiontracking\n            && annotation.completiontracking == 'complete') {\n            // Disable the mark-done and mark-undone buttons\n            $(`#message[data-id='${annotation.id}'] #completiontoggle`).prop('disabled', true);\n            if (annotation.completed == true) {\n                $(`#message[data-id='${annotation.id}'] #completiontoggle span`)\n                    .text(`${M.util.get_string('completioncompleted', 'mod_interactivevideo')}`);\n            } else {\n                $(`#message[data-id='${annotation.id}'] #completiontoggle span`)\n                    .text(`${M.util.get_string('completionincomplete', 'mod_interactivevideo')}`);\n            }\n        }\n\n        if (!this.isEditMode()) {\n            // Create three tabs for the discussion topic, responses, my reponses\n            let $message = $(`#message[data-id='${annotation.id}']`);\n            $message.find('.modal-body').addClass('p-0').css('height', '100vh').html(`\n                <ul class=\"nav justify-content-center bg-light p-2 sticky-top\" id=\"discussion-main\">\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link active rounded-sm py-1\" data-toggle=\"tab\" href=\"#discussion-topic-${annotation.id}\">\n                            ${M.util.get_string('discussiontopic', 'ivplugin_discussion')}\n                        </a>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link rounded-sm py-1\" data-toggle=\"tab\" href=\"#responses-${annotation.id}\">\n                            ${M.util.get_string('responses', 'ivplugin_discussion')}\n                        </a>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link rounded-sm py-1\" data-toggle=\"tab\" href=\"#myresponses-${annotation.id}\">\n                            ${M.util.get_string('myresponses', 'ivplugin_discussion')}\n                        </a>\n                    </li>\n                </ul>\n                <div class=\"tab-content\">\n                    <div id=\"discussion-topic-${annotation.id}\" class=\"tab-pane active\">\n                        <div class=\"discussion\">\n                        </div>\n                    </div>\n                    <div id=\"responses-${annotation.id}\" class=\"tab-pane\">\n                        <div class=\"responses p-3\">\n                        <div class=\"table-responsive\">\n                        <table class=\"table table-sm table-striped table-bordered table-hover\">\n                        <thead>\n                        <tr>\n                        <th>${M.util.get_string('id', 'mod_interactivevideo')}</th>\n                        <th>${M.util.get_string('participant', 'mod_interactivevideo')}</th>\n                        <th>${M.util.get_string('timesubmitted', 'mod_interactivevideo')}</th>\n                        <th>${M.util.get_string('timemodified', 'mod_interactivevideo')}</th>\n                        <th>${M.util.get_string('replycount', 'ivplugin_discussion')}</th>\n                        </tr>\n                        </thead>\n                        <tbody>\n                        </tbody>\n                        </table>\n                        </div>\n                        </div>\n                    </div>\n                    <div id=\"myresponses-${annotation.id}\" class=\"tab-pane\">\n                        <div class=\"myresponses\">\n                        </div>\n                    </div>\n                </div>\n\n                `);\n        }\n    }\n\n    postContentRender(annotation) {\n        // if (annotation.displayoptions == 'popup' && !this.isEditMode()) {\n        //     $(`#annotation-modal`).addClass('modal-fullscreen');\n        // }\n        $(`#message[data-id='${annotation.id}'] .modal-body`).addClass('p-0');\n        $(document).on('click', `#message[data-id='${annotation.id}'] #collapsetoggle`, function () {\n            $(this).closest('.discussion-topic').toggleClass('collapsed expanded');\n            $(this).find('i').toggleClass('bi-chevron-down bi-chevron-up');\n        });\n    }\n\n    runInteraction(annotation) {\n        this.player.pause();\n        // Apply content.\n        const applyContent = (annotation) => {\n            this.render(annotation, 'json').then((data) => {\n                let $message = $(`#message[data-id='${annotation.id}']`);\n                $message.find(`.modal-body`).attr('id', 'content');\n                $message.find(`.modal-body #discussion-topic-${annotation.id}`).html(data.content);\n                let $body = $message.find(`.modal-body`);\n                notifyFilter($body);\n                this.postContentRender(annotation);\n                this.interactionRunEvent(annotation, data);\n            }).catch(() => {\n                // Do nothing.\n            });\n        };\n\n        this.renderViewer(annotation).then(() => {\n            this.renderContainer(annotation);\n            applyContent(annotation);\n        });\n\n        this.enableManualCompletion(annotation);\n\n        if (annotation.displayoptions == 'popup') {\n            let self = this;\n            $('#annotation-modal').on('shown.bs.modal', function () {\n                self.setModalDraggable('#annotation-modal .modal-dialog');\n            });\n        }\n    }\n\n}"],"names":["Discussion","Base","renderContainer","annotation","completiontracking","id","prop","completed","text","M","util","get_string","this","isEditMode","find","addClass","css","html","postContentRender","document","on","closest","toggleClass","runInteraction","player","pause","applyContent","render","then","data","$message","attr","content","$body","interactionRunEvent","catch","renderViewer","enableManualCompletion","displayoptions","self","setModalDraggable"],"mappings":";;;;;;;uKAyBqBA,mBAAmBC,cACpCC,gBAAgBC,eACRA,WAAWC,oBACyB,YAAjCD,WAAWC,qEAESD,WAAWE,4BAA0BC,KAAK,YAAY,GACjD,GAAxBH,WAAWI,0DACYJ,WAAWE,iCAC7BG,eAAQC,EAAEC,KAAKC,WAAW,sBAAuB,0EAE/BR,WAAWE,iCAC7BG,eAAQC,EAAEC,KAAKC,WAAW,uBAAwB,4BAI1DC,KAAKC,aAAc,EAEL,+CAAuBV,WAAWE,UACxCS,KAAK,eAAeC,SAAS,OAAOC,IAAI,SAAU,SAASC,+QAG+Bd,WAAWE,8CAC5FI,EAAEC,KAAKC,WAAW,kBAAmB,uOAI8BR,WAAWE,8CAC9EI,EAAEC,KAAKC,WAAW,YAAa,yOAIsCR,WAAWE,8CAChFI,EAAEC,KAAKC,WAAW,cAAe,6MAKfR,WAAWE,+LAIlBF,WAAWE,4UAMtBI,EAAEC,KAAKC,WAAW,KAAM,sEACxBF,EAAEC,KAAKC,WAAW,cAAe,sEACjCF,EAAEC,KAAKC,WAAW,gBAAiB,sEACnCF,EAAEC,KAAKC,WAAW,eAAgB,sEAClCF,EAAEC,KAAKC,WAAW,aAAc,oVASnBR,WAAWE,uLAUlDa,kBAAkBf,4DAISA,WAAWE,sBAAoBU,SAAS,2BAC7DI,UAAUC,GAAG,oCAA8BjB,WAAWE,0BAAwB,+BAC1EO,MAAMS,QAAQ,qBAAqBC,YAAY,0CAC/CV,MAAME,KAAK,KAAKQ,YAAY,oCAItCC,eAAepB,iBACNqB,OAAOC,cAENC,aAAgBvB,kBACbwB,OAAOxB,WAAY,QAAQyB,MAAMC,WAC9BC,UAAW,+CAAuB3B,WAAWE,UACjDyB,SAAShB,oBAAoBiB,KAAK,KAAM,WACxCD,SAAShB,6CAAsCX,WAAWE,KAAMY,KAAKY,KAAKG,aACtEC,MAAQH,SAAShB,2DACRmB,YACRf,kBAAkBf,iBAClB+B,oBAAoB/B,WAAY0B,SACtCM,OAAM,kBAKRC,aAAajC,YAAYyB,MAAK,UAC1B1B,gBAAgBC,YACrBuB,aAAavB,oBAGZkC,uBAAuBlC,YAEK,SAA7BA,WAAWmC,eAA2B,KAClCC,KAAO3B,yBACT,qBAAqBQ,GAAG,kBAAkB,WACxCmB,KAAKC,kBAAkB"}