define("ivplugin_contentbank/util",["exports","jquery","core/ajax"],(function(_exports,_jquery,_ajax){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Content bank utility functions
   *
   * @module     ivplugin_contentbank/util
   * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax);const getcontent=(id,contextid,target)=>{_ajax.default.call([{args:{id:id,contextid:contextid},contextid:contextid,methodname:"ivplugin_contentbank_getitem"}])[0].then((response=>target?(0,_jquery.default)(target).html(response.item):response)).catch((()=>{}))};var _default={init:contextid=>{(0,_jquery.default)(document).off("click",".contentbank-container .contentbank-item .contentbank-item-details").on("click",".contentbank-container .contentbank-item .contentbank-item-details",(function(e){e.preventDefault(),(0,_jquery.default)(".contentbank-container .contentbank-item").removeClass("selected"),(0,_jquery.default)(this).closest(".contentbank-item").addClass("selected"),(0,_jquery.default)("#contentbank-preview").empty();const id=(0,_jquery.default)(this).closest(".contentbank-item").data("contentid");(0,_jquery.default)("[name=contentid]").val(id)})),(0,_jquery.default)(document).off("click",".contentbank-container .contentbank-item .contentbankview").on("click",".contentbank-container .contentbank-item .contentbankview",(function(e){e.preventDefault(),(0,_jquery.default)(".contentbank-container .contentbank-item").removeClass("selected");let targetContentbank=(0,_jquery.default)(this).closest(".contentbank-item");targetContentbank.addClass("selected");const id=targetContentbank.data("contentid");(0,_jquery.default)("#contentbank-preview").empty(),(0,_jquery.default)("#contentbank-preview").attr("data-contentid",id),(0,_jquery.default)("[name=contentid]").val(id),getcontent(id,contextid,"#contentbank-preview");const xapicheck=M.util.get_string("xapicheck","ivplugin_contentbank");let H5P;const checkH5P=()=>{try{H5P=document.querySelector("#contentbank-preview iframe.h5p-player").contentWindow.H5P}catch(e){H5P=null}if(null!=H5P){if(void 0===H5P.externalDispatcher)return void requestAnimationFrame(checkH5P);(0,_jquery.default)("#contentbank-preview .xapi").remove(),(0,_jquery.default)("#contentbank-preview[data-contentid=".concat(id,"]")).prepend('<div class="xapi float-right alert-secondary d-inline px-2 text-center rounded-pill mb-2">\n                '.concat(xapicheck,"</div>")),H5P.externalDispatcher.on("xAPI",(function(event){if(("http://adlnet.gov/expapi/verbs/completed"==event.data.statement.verb.id||"http://adlnet.gov/expapi/verbs/answered"==event.data.statement.verb.id)&&event.data.statement.object.id.indexOf("subContentId")<0){(0,_jquery.default)("#contentbank-preview .xapi").remove(),(0,_jquery.default)("#contentbank-preview").prepend('<div class="xapi float-right alert-success d-inline px-2 text-center rounded-pill mb-2">\n                        <i class="fa fa-check mr-2"></i>'.concat(M.util.get_string("xapieventdetected","ivplugin_contentbank"),"</div>"));new Audio(M.cfg.wwwroot+"/mod/interactivevideo/sounds/pop.mp3").play()}}))}else requestAnimationFrame(checkH5P)};requestAnimationFrame(checkH5P)}))},getcontent:getcontent,refreshContentBank:async function(id,coursecontextid){let edit=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],callback=arguments.length>3?arguments[3]:void 0;(0,_jquery.default)("#contentbank-preview").empty();let contentbankitems=await _ajax.default.call([{args:{contextid:coursecontextid},contextid:coursecontextid,methodname:"ivplugin_contentbank_getitems"}])[0],contents=JSON.parse(contentbankitems.contents),contentbank=(0,_jquery.default)(".modal-body form .contentbank-container");contentbank.empty(),contents.forEach((function(content){const editurl=M.cfg.wwwroot+"/contentbank/edit.php?contextid="+coursecontextid+"&id="+content.id+"&plugin="+content.type;let html='<div class="contentbank-item d-flex align-items-center p-1 '+(content.id==id?"selected":"")+' " data-contentid="'+content.id+'"><div class="contentbank-item-details d-flex align-items-center">';content.icon?html+='<img class="contentbank-item-icon mr-2" src="'+content.icon+'"/>':html+='<div class="contentbank-item-icon mr-2"></div>',html+='<div class="contentbank-item-name w-100">'+content.name+"</div></div>",html+='<div class="btn btn-sm ml-auto contentbankview" data-toggle="tooltip" data-container="#wrapper"\n                 data-trigger="hover" data-title="'.concat(M.util.get_string("preview","ivplugin_contentbank"),'">\n                 <i class="bi bi-eye-fill"></i></div>'),edit&&(html+='<a class="btn btn-sm ml-2" target="_blank" href="'.concat(editurl,'"\n                     data-toggle="tooltip" data-container="#wrapper" data-trigger="hover"\n                      data-title="').concat(M.util.get_string("edit","ivplugin_contentbank"),'">\n                     <i class="bi bi-pencil-square"></i></a>')),html+="</div>",contentbank.append(html)})),callback&&callback()}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=util.min.js.map