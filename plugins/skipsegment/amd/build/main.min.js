define("ivplugin_skipsegment/main",["exports","jquery","mod_interactivevideo/type/base","core/event_dispatcher","core/ajax"],(function(_exports,_jquery,_base,_event_dispatcher,_ajax){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Main class for skip segment
   *
   * @module     ivplugin_skipsegment/main
   * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_base=_interopRequireDefault(_base),_ajax=_interopRequireDefault(_ajax);class SkipSegment extends _base.default{init(){if(!this.isEditMode()){var self=this,skipsegment=this.annotations.filter((annotation=>"skipsegment"==annotation.type));(0,_jquery.default)(document).on("timeupdate",(function(e){var t=e.originalEvent.detail.time;skipsegment.forEach((annotation=>{annotation.timestamp<t&&annotation.title>t&&self.runInteraction(annotation)}))}))}}renderEditItem(annotations,listItem,item){return(listItem=super.renderEditItem(annotations,listItem,item)).find("[data-editable]").removeAttr("data-editable"),listItem.find(".btn.copy").remove(),listItem.find(".title").replaceWith('<span class="skipend timestamp\n            bg-light px-2 py-1 rounded-sm text-truncate"\n            data-timestamp="'.concat(item.title,'">').concat(this.convertSecondsToHMS(item.title,this.totaltime<3600,!0),"</span>")),this.isSkipped(item.timestamp)&&listItem.find(".skipend").after('<span class="badge badge-warning ml-2">\n                            '.concat(M.util.get_string("skipped","ivplugin_skipsegment"),"</span>")),listItem}async addAnnotation(annotations,timestamp,coursemodule){let data={title:timestamp+5>this.end?this.end:timestamp+5,timestamp:timestamp,contextid:M.cfg.contextid,type:this.prop.name,courseid:this.course,cmid:coursemodule,annotationid:this.interaction,hascompletion:this.prop.hascompletion?1:0,advanced:JSON.stringify({visiblebeforecompleted:"1",visibleaftercompleted:null,clickablebeforecompleted:"1",clickableaftercompleted:null,replaybehavior:"1"})},ajax=await _ajax.default.call([{methodname:"ivplugin_skipsegment_add_skip",args:{skipdata:JSON.stringify(data)},contextid:M.cfg.contextid}])[0],newAnnotation=JSON.parse(ajax.data);(0,_event_dispatcher.dispatchEvent)("annotationupdated",{annotation:newAnnotation,action:"add"}),(0,_jquery.default)("#contentmodal").modal("hide")}onEditFormLoaded(form,event){var self=this;return super.onEditFormLoaded(form,event).on("change","[name=titleassist]",(function(e){e.preventDefault();const originalValue=(0,_jquery.default)(this).data("initial-value");if(!self.validateTimestampFormat((0,_jquery.default)(this).val()))return self.addNotification(M.util.get_string("invalidtimestampformat","ivplugin_skipsegment")),void(0,_jquery.default)(this).val(originalValue);var parts=(0,_jquery.default)(this).val().split(":"),timestamp=3600*Number(parts[0])+60*Number(parts[1])+Number(parts[2]);if(!self.isBetweenStartAndEnd(timestamp)){var message=M.util.get_string("interactioncanonlybeaddedbetweenstartandendtime","mod_interactivevideo",{start:self.convertSecondsToHMS(self.start),end:self.convertSecondsToHMS(self.end)});return self.addNotification(message),void(0,_jquery.default)(this).val(originalValue)}if(timestamp<=Number((0,_jquery.default)("[name=timestamp]").val()))return self.addNotification(M.util.get_string("segmentendmustbegreaterthantimestamp","mod_interactivevideo")),void(0,_jquery.default)(this).val(originalValue);(0,_jquery.default)("[name=title]").val(timestamp)})),{form:form,event:event}}renderItemOnVideoNavigation(annotation){if(!(annotation.timestamp<this.start||annotation.timestamp>this.end)){var percentage=(Number(annotation.timestamp)-this.start)/this.totaltime*100,length=(Number(annotation.title)-Number(annotation.timestamp))/this.totaltime*100;this.isVisible(annotation)&&!this.isEditMode()&&(0,_jquery.default)("#video-nav ul").append('<li class="annotation '.concat(annotation.type,"\n             ").concat(this.isClickable(annotation)?"":"no-pointer-events",' position-absolute bg-dark progress-bar-striped progress-bar"\n              data-timestamp="').concat(annotation.timestamp,'" data-id="').concat(annotation.id,'"\n               style="left: ').concat(percentage,"%; width: ").concat(length,'%;" data-toggle="tooltip"\n               data-container="#wrapper" data-trigger="hover"\n         data-html="true" data-original-title=\'<i class="').concat(this.prop.icon,"\"></i>'></li>")),this.isEditMode()&&(0,_jquery.default)("#video-timeline-wrapper").append('<div class="position-absolute skipsegment cursor-pointer"\n                 data-timestamp="'.concat(annotation.timestamp,'" data-id="').concat(annotation.id,'"\n                 style="height: 100%; left: ').concat(percentage,"%; width: ").concat(length,'%;background: rgba(0,0,0,0.75);">\n                 <div class="position-absolute w-100 text-center px-1 delete-skipsegment">\n                 <i class="bi bi-trash3 text-muted fs-unset"></i></div></div>'))}}async runInteraction(annotation){(0,_jquery.default)(".video-block").append('<div id="skipsegment" class="text-white position-absolute p-3 hide"\n         style="bottom: 0;right: 0;text-shadow: 1px 2px 3px gray;line-height: 1rem;">\n         <i class="'.concat(this.prop.icon,'" style="font-size: xxx-large;"></i></div>')),(0,_jquery.default)("#skipsegment").fadeIn(300),await this.player.seek(Number(annotation.title));var percentage=(Number(annotation.title)-this.start)/this.totaltime*100;(0,_jquery.default)("#video-nav #progress").replaceWith('<div id="progress"\n         style="width: '.concat(percentage>100?100:percentage,'%;"></div>')),this.player.play(),setTimeout((()=>{(0,_jquery.default)("#skipsegment").fadeOut(300),setTimeout((()=>{(0,_jquery.default)("#skipsegment").remove()}),300)}),1e3)}}return _exports.default=SkipSegment,_exports.default}));

//# sourceMappingURL=main.min.js.map