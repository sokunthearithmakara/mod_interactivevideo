{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module main\n *\n * @module     ivplugin_skipsegment/main\n * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport Base from 'mod_interactivevideo/type/base';\n\nexport default class SkipSegment extends Base {\n    init() {\n        this.typeItems = this.annotations.filter((annotation) => annotation.type == this.type);\n        var self = this;\n        var skipsegment = this.annotations.filter((annotation) => annotation.type == 'skipsegment');\n        $(document).on('timeupdate', function (e) {\n            var t = e.originalEvent.detail.time;\n            skipsegment.forEach((annotation) => {\n                if (annotation.timestamp <= t && annotation.title >= t) {\n                    self.runInteraction(annotation);\n                }\n            });\n        });\n    }\n    renderEditItem(annotations, listItem, item) {\n        listItem = super.renderEditItem(annotations, listItem, item);\n        listItem.find('[data-editable]').removeAttr('data-editable');\n        listItem.find('.title').replaceWith(`<span class=\"skipend timestamp\n                            bg-gray px-2 py-1 rounded-sm text-truncate\"\n                            data-timestamp=\"${item.title}\">${this.convertSecondsToHMS(item.title)}</span>`);\n        if (this.isSkipped(item.timestamp)) {\n            listItem.find('.skipend').after(`<span class=\"badge badge-warning ml-2\">\n                            ${M.util.get_string('skipped', 'mod_interactivevideo')}</span>`);\n        }\n        return listItem;\n    }\n\n    onEditFormLoaded(form, event) {\n        var self = this;\n        var body = super.onEditFormLoaded(form, event);\n        body.on('change', '[name=titleassist]', function (e) {\n            e.preventDefault();\n            // Make sure the timestamp format is hh:mm:ss\n            if (!self.validateTimestampFormat($(this).val())) {\n                self.addNotification(M.util.get_string('invalidtimestampformat', 'mod_interactivevideo'));\n                $(this).val($('[name=timestampassist]').val());\n                return;\n            }\n\n            // Convert the timestamp to seconds\n            var parts = $(this).val().split(':');\n            var timestamp = parseInt(parts[0]) * 3600 + parseInt(parts[1]) * 60 + parseInt(parts[2]);\n            if (!self.isBetweenStartAndEnd(timestamp)) {\n                var message = M.util.get_string('interactioncanonlybeaddedbetweenstartandendtime', 'mod_interactivevideo', {\n                    \"start\": self.convertSecondsToHMS(self.start),\n                    \"end\": self.convertSecondsToHMS(self.end),\n                });\n                self.addNotification(message);\n                $(this).val($('[name=timestampassist]').val());\n                return;\n            }\n\n            // Make sure the title assist is not the same as the timestamp assist or less than the timestamp assist\n            if (timestamp <= parseInt($('[name=timestamp]').val())) {\n                self.addNotification(M.util.get_string('segmentendmustbegreaterthantimestamp', 'mod_interactivevideo'));\n                $(this).val($('[name=timestampassist]').val());\n                return;\n            }\n\n            $('[name=title]').val(timestamp);\n        });\n        return { form, event };\n    }\n\n    renderItemOnVideoNavigation(annotation) {\n        if (annotation.timestamp < this.start || annotation.timestamp > this.end) {\n            return;\n        }\n        var percentage = ((Number(annotation.timestamp) - this.start) / this.totaltime) * 100;\n        if (this.isVisible(annotation)) {\n            var length = (Number(annotation.title) - Number(annotation.timestamp)) / this.totaltime * 100;\n            $(\"#video-nav ul\").append(`<li class=\"annotation ${annotation.type}\n             ${this.isClickable(annotation) ? '' : 'no-pointer-events'} position-absolute bg-dark progress-bar-striped progress-bar\"\n              data-timestamp=\"${annotation.timestamp}\" data-id=\"${annotation.id}\"\n               style=\"left: calc(${percentage}%); width: ${length}%;\" data-toggle=\"tooltip\"\n               data-container=\"#wrapper\" data-trigger=\"hover\"\n         data-html=\"true\" data-original-title='<i class=\"${this.prop.icon}\"></i>'></li>`);\n        }\n    }\n    runInteraction(annotation) {\n        $('.video-block').append(`<div id=\"skipsegment\" class=\"text-white position-absolute p-3 hide\"\n         style=\"bottom: 0;right: 0;text-shadow: 1px 2px 3px gray;line-height: 1rem;\">\n         <i class=\"${this.prop.icon}\" style=\"font-size: xxx-large;\"></i></div>`);\n        $('#skipsegment').fadeIn(300);\n        this.player.seek(Number(annotation.title));\n        var percentage = (Number(annotation.title) - this.start) / this.totaltime * 100;\n        $('#video-nav #progress').replaceWith(`<div id=\"progress\"\n         style=\"width: ${percentage > 100 ? 100 : percentage}%;\"></div>`);\n        this.player.play();\n        setTimeout(() => {\n            $('#skipsegment').fadeOut(300);\n            setTimeout(() => {\n                $('#skipsegment').remove();\n            }, 300);\n        }, 1000);\n    }\n}"],"names":["SkipSegment","Base","init","typeItems","this","annotations","filter","annotation","type","self","skipsegment","document","on","e","t","originalEvent","detail","time","forEach","timestamp","title","runInteraction","renderEditItem","listItem","item","super","find","removeAttr","replaceWith","convertSecondsToHMS","isSkipped","after","M","util","get_string","onEditFormLoaded","form","event","preventDefault","validateTimestampFormat","val","addNotification","parts","split","parseInt","isBetweenStartAndEnd","message","start","end","renderItemOnVideoNavigation","percentage","Number","totaltime","isVisible","length","append","isClickable","id","prop","icon","fadeIn","player","seek","play","setTimeout","fadeOut","remove"],"mappings":";;;;;;;uKAyBqBA,oBAAoBC,cACrCC,YACSC,UAAYC,KAAKC,YAAYC,QAAQC,YAAeA,WAAWC,MAAQJ,KAAKI,WAC7EC,KAAOL,KACPM,YAAcN,KAAKC,YAAYC,QAAQC,YAAkC,eAAnBA,WAAWC,2BACnEG,UAAUC,GAAG,cAAc,SAAUC,OAC/BC,EAAID,EAAEE,cAAcC,OAAOC,KAC/BP,YAAYQ,SAASX,aACbA,WAAWY,WAAaL,GAAKP,WAAWa,OAASN,GACjDL,KAAKY,eAAed,kBAKpCe,eAAejB,YAAakB,SAAUC,aAClCD,SAAWE,MAAMH,eAAejB,YAAakB,SAAUC,OAC9CE,KAAK,mBAAmBC,WAAW,iBAC5CJ,SAASG,KAAK,UAAUE,YAAa,wJAECJ,KAAKJ,UAAUhB,KAAKyB,oBAAoBL,KAAKJ,iBAC/EhB,KAAK0B,UAAUN,KAAKL,YACpBI,SAASG,KAAK,YAAYK,MAAO,wEACfC,EAAEC,KAAKC,WAAW,UAAW,kCAE5CX,SAGXY,iBAAiBC,KAAMC,WACf5B,KAAOL,YACAqB,MAAMU,iBAAiBC,KAAMC,OACnCzB,GAAG,SAAU,sBAAsB,SAAUC,MAC9CA,EAAEyB,kBAEG7B,KAAK8B,yBAAwB,mBAAEnC,MAAMoC,cACtC/B,KAAKgC,gBAAgBT,EAAEC,KAAKC,WAAW,yBAA0B,iDAC/D9B,MAAMoC,KAAI,mBAAE,0BAA0BA,WAKxCE,OAAQ,mBAAEtC,MAAMoC,MAAMG,MAAM,KAC5BxB,UAAiC,KAArByB,SAASF,MAAM,IAAkC,GAArBE,SAASF,MAAM,IAAWE,SAASF,MAAM,QAChFjC,KAAKoC,qBAAqB1B,WAAY,KACnC2B,QAAUd,EAAEC,KAAKC,WAAW,kDAAmD,uBAAwB,OAC9FzB,KAAKoB,oBAAoBpB,KAAKsC,WAChCtC,KAAKoB,oBAAoBpB,KAAKuC,cAEzCvC,KAAKgC,gBAAgBK,iCACnB1C,MAAMoC,KAAI,mBAAE,0BAA0BA,UAKxCrB,WAAayB,UAAS,mBAAE,oBAAoBJ,cAC5C/B,KAAKgC,gBAAgBT,EAAEC,KAAKC,WAAW,uCAAwC,iDAC7E9B,MAAMoC,KAAI,mBAAE,0BAA0BA,2BAI1C,gBAAgBA,IAAIrB,cAEnB,CAAEiB,KAAAA,KAAMC,MAAAA,OAGnBY,4BAA4B1C,iBACpBA,WAAWY,UAAYf,KAAK2C,OAASxC,WAAWY,UAAYf,KAAK4C,UAGjEE,YAAeC,OAAO5C,WAAWY,WAAaf,KAAK2C,OAAS3C,KAAKgD,UAAa,OAC9EhD,KAAKiD,UAAU9C,YAAa,KACxB+C,QAAUH,OAAO5C,WAAWa,OAAS+B,OAAO5C,WAAWY,YAAcf,KAAKgD,UAAY,wBACxF,iBAAiBG,OAAQ,yBAAwBhD,WAAWC,sBAC3DJ,KAAKoD,YAAYjD,YAAc,GAAK,mHACnBA,WAAWY,uBAAuBZ,WAAWkD,yCAC1CP,wBAAwBI,4JAEAlD,KAAKsD,KAAKC,uBAGjEtC,eAAed,gCACT,gBAAgBgD,OAAQ,kLAEbnD,KAAKsD,KAAKC,sEACrB,gBAAgBC,OAAO,UACpBC,OAAOC,KAAKX,OAAO5C,WAAWa,YAC/B8B,YAAcC,OAAO5C,WAAWa,OAAShB,KAAK2C,OAAS3C,KAAKgD,UAAY,wBAC1E,wBAAwBxB,YAAa,8CACtBsB,WAAa,IAAM,IAAMA,6BACrCW,OAAOE,OACZC,YAAW,yBACL,gBAAgBC,QAAQ,KAC1BD,YAAW,yBACL,gBAAgBE,WACnB,OACJ"}