define("ivplugin_decision/main",["exports","jquery","mod_interactivevideo/type/base"],(function(_exports,_jquery,_base){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Main module for the decision plugin.
   *
   * @module     ivplugin_decision/main
   * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_base=_interopRequireDefault(_base);class Decision extends _base.default{init(){(0,_jquery.default)(document).on("timeupdate",(e=>{const cantSkip=this.annotations.filter((d=>"decision"==d.type)).filter((d=>1!=d.char1&&!d.viewed));if(cantSkip.sort(((a,b)=>a.timestamp-b.timestamp)),0==cantSkip.length)return;const t=Number(e.originalEvent.detail.time),firstCantSkip=cantSkip[0];t>=Number(firstCantSkip.timestamp)&&this.player.seek(Number(firstCantSkip.timestamp))}))}renderItemOnVideoNavigation(annotation){if(!(annotation.timestamp<this.start||annotation.timestamp>this.end)){var percentage=(Number(annotation.timestamp)-this.start)/this.totaltime*100;this.isVisible(annotation)&&(0,_jquery.default)("#video-nav ul").append(`<li class="annotation ${annotation.completed?"completed":""}\n        ${annotation.type} ${this.isClickable(annotation)?"":"no-pointer-events"} li-draggable"\n         data-timestamp="${annotation.timestamp}"\n        data-id="${annotation.id}" style="left: calc(${percentage}% - 5px)">\n        <i data-toggle="tooltip" data-trigger="hover" data-html="true" data-original-title='<i class="${this.prop.icon} mr-1"></i>\n        ${annotation.formattedtitle}' class="${this.prop.icon}"></i></li>`)}}onEditFormLoaded(form,event){let self=this,body=super.onEditFormLoaded(form,event);var int=setInterval((()=>{if((0,_jquery.default)("[name=content").length>0){clearInterval(int);var dest=(0,_jquery.default)("[name=content").val();""==dest?(0,_jquery.default)("#destination-list").append(`<div class="input-group mb-1">\n    <input type="text" class="form-control">\n    <input type="text" value="${this.convertSecondsToHMS(this.start)}"\n     placeholder="00:00:00" style="max-width: 120px;" class="form-control timestamp-input">\n    <div class="input-group-append">\n    <button class="btn add-dest btn-secondary" type="button"><i class="bi bi-plus-lg"></i></button>\n    <button class="btn btn-danger disabled" disabled type="button"><i class="bi bi-trash3-fill"></i></button>\n        </div></div>`):((dest=JSON.parse(dest)).forEach(((d,i)=>{(0,_jquery.default)("#destination-list").append(`<div class="input-group mb-1">\n    <input type="text" class="form-control" value="${d.title}">\n    <input type="text" value="${this.convertSecondsToHMS(d.timestamp)}"\n     placeholder="00:00:00" style="max-width: 120px;" class="form-control timestamp-input">\n    <div class="input-group-append">\n    <button class="btn add-dest btn-secondary" type="button"><i class="bi bi-plus-lg"></i></button>\n    <button class="btn btn-danger ${0==i?"disabled":"delete-dest"}" ${0==i?"disabled":""}\n     type="button"><i class="bi bi-trash3-fill"></i></button></div></div>`)})),(0,_jquery.default)('.input-group [type="text"]').trigger("input"))}}),100);return body.on("click",".input-group .add-dest",(function(e){e.preventDefault(),e.stopImmediatePropagation(),(0,_jquery.default)(this).closest(".input-group").after(`<div class="input-group mb-1">\n                            <input type="text" class="form-control">\n                            <input value="${self.convertSecondsToHMS(self.start)}"\n                             placeholder="00:00:00" type="text" style="max-width: 120px;"\n                             class="form-control timestamp-input">\n                            <div class="input-group-append">\n                            <button class="btn add-dest btn-secondary" type="button"><i class="bi bi-plus-lg"></i></button>\n                            <button class="btn btn-danger delete-dest" type="button">\n                            <i class="bi bi-trash3-fill"></i></button>\n                            </div>\n                        </div>`),(0,_jquery.default)('[type="text"]').trigger("input")})),body.on("click",".input-group .delete-dest",(function(e){e.preventDefault(),e.stopImmediatePropagation(),(0,_jquery.default)(this).closest(".input-group").remove(),(0,_jquery.default)('[type="text"]').trigger("input")})),body.on("input",'.input-group [type="text"]',(function(){var dest=[];(0,_jquery.default)("#destination-list .input-group").each((function(){var title=(0,_jquery.default)(this).find('input[type="text"]'),timestamp=(0,_jquery.default)(this).find(".timestamp-input");if(""!=title.val()&&""!=timestamp.val()&&!title.hasClass("is-invalid")&&!timestamp.hasClass("is-invalid")){var parts=timestamp.val().split(":"),seconds=3600*Number(parts[0])+60*Number(parts[1])+Number(parts[2]);dest.push({title:title.val(),timestamp:seconds})}})),(0,_jquery.default)("[name=content").val(JSON.stringify(dest))})),{form:form,event:event}}runInteraction(annotation){let self=this;(0,_jquery.default)("body").hasClass("page-interactions")||(annotation.viewed=!0,this.annotations=this.annotations.filter((d=>d.id!=annotation.id)),this.annotations.push(annotation)),this.render(annotation,"html").then((data=>{let $message=(0,_jquery.default)(`<div id="message" style="z-index:5;display:none;" data-id="${annotation.id}">\n                <div class="modal-body p-0" id="content">${data}</div></div>`);(0,_jquery.default)("#video-wrapper").append($message);var int=setInterval((()=>{$message.find(".decision-option").length>0&&(clearInterval(int),JSON.parse(annotation.content).forEach((d=>{var dtime=Number(d.timestamp);this.isBetweenStartAndEnd(dtime)&&!this.isInSkipSegment(dtime)||$message.find(`.decision-option[data-timestamp='${dtime}']`).remove()})),$message.fadeIn(300,"swing",(function(){1==annotation.char1&&$message.append(`<button class="btn btn-secondary btn-rounded position-absolute"\n                             id="close-decision" style="right: 1rem; top: 1rem;">\n                             ${M.util.get_string("skip","ivplugin_decision")}\n                             <i class="ml-2 bi bi-chevron-right"></i></button>`),(0,_jquery.default)(document).on("click","#close-decision",(function(e){e.preventDefault(),e.stopImmediatePropagation(),self.player.play(),(0,_jquery.default)("#video-nav").fadeIn(300),(0,_jquery.default)('[data-region="chapterlists"], #controler').removeClass("no-pointer-events")})),(0,_jquery.default)("body").hasClass("page-interactions")||((0,_jquery.default)("#video-nav").fadeOut(300),(0,_jquery.default)('[data-region="chapterlists"], #controler').addClass("no-pointer-events"))})))}),100);return $message})).catch((()=>{})),(0,_jquery.default)(document).on("click",`#message[data-id='${annotation.id}'] .decision-option`,(function(e){e.preventDefault();var time=Number((0,_jquery.default)(this).data("timestamp"));time<this.start?time=this.start:time>this.end&&(time=this.end),self.player.seek(time),(0,_jquery.default)(`#message[data-id='${annotation.id}']`).fadeOut(300),self.player.play(),(0,_jquery.default)("#video-nav").fadeIn(300),(0,_jquery.default)('[data-region="chapterlists"], #controler').removeClass("no-pointer-events")}))}}return _exports.default=Decision,_exports.default}));

//# sourceMappingURL=main.min.js.map