define("ivplugin_decision/main",["exports","jquery","mod_interactivevideo/type/base"],(function(_exports,_jquery,_base){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Main module for the decision plugin.
   *
   * @module     ivplugin_decision/main
   * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_base=_interopRequireDefault(_base);class Decision extends _base.default{init(){this.isEditMode()||(0,_jquery.default)(document).on("timeupdate",(e=>{const cantSkip=this.annotations.filter((d=>"decision"==d.type)).filter((d=>1!=d.char1&&!d.viewed));if(cantSkip.sort(((a,b)=>a.timestamp-b.timestamp)),0==cantSkip.length)return;const t=Number(e.originalEvent.detail.time),firstCantSkip=cantSkip[0];t>=Number(firstCantSkip.timestamp)&&this.player.seek(Number(firstCantSkip.timestamp))}))}onEditFormLoaded(form,event){let self=this,body=super.onEditFormLoaded(form,event);var int=setInterval((()=>{if((0,_jquery.default)("[name=content").length>0){clearInterval(int);var dest=(0,_jquery.default)("[name=content").val();""==dest?(0,_jquery.default)("#destination-list").append('<div class="input-group mb-1">\n                        <div class="input-group-prepend">\n                            <label class="input-group-text">\n                            <i class="bi bi-grip-vertical fs-unset cursor-move"></i></label>\n                        </div>\n                        <input type="text" class="form-control">\n                        <input type="text" value="'.concat(this.convertSecondsToHMS(this.start),'"\n                        placeholder="00:00:00" style="max-width: 120px;" class="form-control timestamp-input">\n                        <div class="input-group-append">\n                        <button class="btn add-dest btn-secondary" type="button"><i class="bi bi-plus-lg fs-unset"></i></button>\n                        <button class="btn btn-danger disabled" disabled type="button">\n                            <i class="bi bi-trash3-fill fs-unset"></i></button></div></div>')):((dest=JSON.parse(dest)).forEach(((d,i)=>{(0,_jquery.default)("#destination-list").append('<div class="input-group mb-1">\n                            <div class="input-group-prepend">\n                            <label class="input-group-text">\n                            <i class="bi bi-grip-vertical cursor-move fs-unset"></i></label>\n                        </div>\n                            <input type="text" class="form-control" value="'.concat(d.title,'">\n                            <input type="text" value="').concat(this.convertSecondsToHMS(d.timestamp),'"\n                            placeholder="00:00:00" style="max-width: 120px;" class="form-control timestamp-input">\n                            <div class="input-group-append">\n                            <button class="btn add-dest btn-secondary" type="button"><i class="bi bi-plus-lg fs-unset"></i></button>\n                            <button class="btn btn-danger delete-dest ').concat(0==i?"disabled":"",'" ').concat(0==i?"disabled":"",'\n                            type="button"><i class="bi bi-trash3-fill fs-unset"></i></button></div></div>'))})),(0,_jquery.default)('.input-group [type="text"]').trigger("input")),(0,_jquery.default)("#destination-list").sortable({items:".input-group",cursor:"move",update:function(){(0,_jquery.default)('.input-group [type="text"]').trigger("input")},stop:function(){(0,_jquery.default)(".input-group .delete-dest").removeAttr("disabled"),(0,_jquery.default)(".input-group .delete-dest").removeClass("disabled"),(0,_jquery.default)(".input-group .delete-dest").first().attr("disabled",!0),(0,_jquery.default)(".input-group .delete-dest").first().addClass("disabled")}})}}),100);return body.on("click",".input-group .add-dest",(function(e){e.preventDefault(),e.stopImmediatePropagation(),(0,_jquery.default)(this).closest(".input-group").after('<div class="input-group mb-1">\n                            <input type="text" class="form-control">\n                            <input value="'.concat(self.convertSecondsToHMS(self.start),'"\n                             placeholder="00:00:00" type="text" style="max-width: 120px;"\n                             class="form-control timestamp-input">\n                            <div class="input-group-append">\n                            <button class="btn add-dest btn-secondary" type="button"><i class="bi bi-plus-lg"></i></button>\n                            <button class="btn btn-danger delete-dest" type="button">\n                            <i class="bi bi-trash3-fill"></i></button>\n                            </div>\n                        </div>')),(0,_jquery.default)('[type="text"]').trigger("input")})),body.on("click",".input-group .delete-dest",(function(e){e.preventDefault(),e.stopImmediatePropagation(),(0,_jquery.default)(this).closest(".input-group").remove(),(0,_jquery.default)('[type="text"]').trigger("input")})),body.on("input",'.input-group [type="text"]',(function(){var dest=[];(0,_jquery.default)("#destination-list .input-group").each((function(){var title=(0,_jquery.default)(this).find('input[type="text"]'),timestamp=(0,_jquery.default)(this).find(".timestamp-input");if(""!=title.val()&&""!=timestamp.val()&&!title.hasClass("is-invalid")&&!timestamp.hasClass("is-invalid")){var parts=timestamp.val().split(":"),seconds=3600*Number(parts[0])+60*Number(parts[1])+Number(parts[2]);dest.push({title:title.val(),timestamp:seconds})}})),(0,_jquery.default)("[name=content").val(JSON.stringify(dest))})),{form:form,event:event}}async runInteraction(annotation){(0,_jquery.default)(".tooltip").remove(),this.player.pause();let self=this;var dest=JSON.parse(annotation.content);if(0==(dest=dest.filter((d=>!self.isSkipped(d.timestamp)))).length)return void this.player.play();self.isEditMode()||(annotation.viewed=!0,this.annotations=this.annotations.filter((d=>d.id!=annotation.id)),this.annotations.push(annotation));let newannotation=JSON.parse(JSON.stringify(annotation));newannotation.content=JSON.stringify(dest);const data=await this.render(newannotation,"json");let $html='<div class="position-absolute decision text-center mx-auto w-100">\n            <h5 class="pt-5 pb-3 bg-white" id="decision-q">\n            <i class="mb-2 bi bi-signpost-split-fill" style="font-size: 2em"></i><br>'.concat(newannotation.formattedtitle,"</h5>");data.forEach(((dest,order)=>{$html+='<a href="javascript:void(0)" data-timestamp="'.concat(dest.timestamp,'"\n                 data-order="').concat(order,'" class="decision-option btn btn-outline-secondary btn-rounded mb-2 d-flex\n                  justify-content-between align-items-center mx-auto"><span class="text-truncate">').concat(dest.title,'</span>\n                  <i class="bi bi-chevron-right"></i></a>')})),$html+="</div>";let $message=(0,_jquery.default)('<div id="message" style="z-index:1005;display:none;" data-id="'.concat(annotation.id,'">\n            <div class="modal-body p-0" id="content">').concat($html,"</div></div>"));(0,_jquery.default)("#video-wrapper").append($message),$message.fadeIn(300,"swing",(function(){1==annotation.char1&&$message.append('<button class="btn btn-secondary btn-rounded position-absolute"\n                     id="close-decision" style="right: 1rem; top: 1rem;">\n                     '.concat(M.util.get_string("skip","ivplugin_decision"),'\n                     <i class="ml-2 bi bi-chevron-right"></i></button>')),(0,_jquery.default)(document).on("click","#close-decision",(function(e){e.preventDefault(),e.stopImmediatePropagation(),self.player.play(),(0,_jquery.default)("#taskinfo").fadeIn(300),(0,_jquery.default)('[data-region="chapterlists"], #controller').removeClass("no-pointer-events")})),self.isEditMode()||((0,_jquery.default)("#taskinfo").fadeOut(300),(0,_jquery.default)('[data-region="chapterlists"], #controller').addClass("no-pointer-events"))})),(0,_jquery.default)(document).on("click","#message[data-id='".concat(annotation.id,"'] .decision-option"),(function(e){e.preventDefault(),e.stopImmediatePropagation();var time=Number((0,_jquery.default)(this).data("timestamp"));time<this.start?time=this.start:time>this.end&&(time=this.end),self.player.seek(time),(0,_jquery.default)("#message[data-id='".concat(annotation.id,"']")).fadeOut(300),self.player.play(),(0,_jquery.default)("#taskinfo").fadeIn(300),(0,_jquery.default)('[data-region="chapterlists"], #controller').removeClass("no-pointer-events")}))}}return _exports.default=Decision,_exports.default}));

//# sourceMappingURL=main.min.js.map