define("ivplugin_h5pupload/main",["exports","jquery","mod_interactivevideo/type/base"],(function(_exports,_jquery,_base){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Main class for the H5P Upload plugin.
   *
   * @module     ivplugin_h5pupload/main
   * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_base=_interopRequireDefault(_base);class H5pUpload extends _base.default{renderContainer(annotation){let $message=(0,_jquery.default)("#message[data-id='".concat(annotation.id,"']"));super.renderContainer(annotation);let $completiontoggle=$message.find("#completiontoggle");switch(annotation.completiontracking){case"complete":$completiontoggle.before('<i class="bi bi-info-circle-fill mr-2" data-toggle="tooltip" data-container="#wrapper"\n                    data-trigger="hover"\n                     data-title="'.concat(M.util.get_string("completiononcomplete","mod_interactivevideo"),'"></i>'));break;case"completepass":$completiontoggle.before('<i class="bi bi-info-circle-fill mr-2" data-toggle="tooltip" data-container="#wrapper"\n    data-trigger="hover"\n     data-title="'.concat(M.util.get_string("completiononcompletepass","mod_interactivevideo"),'"></i>'));break;case"completefull":$completiontoggle.before('<i class="bi bi-info-circle-fill mr-2" data-toggle="tooltip" data-container="#wrapper"\n            data-trigger="hover" data-title="'.concat(M.util.get_string("completiononcompletefull","mod_interactivevideo"),'"></i>'))}return $message.find('[data-toggle="tooltip"]').tooltip(),$message}postContentRender(annotation,callback){(0,_jquery.default)("#message[data-id='".concat(annotation.id,"']")).addClass("hasiframe");let interval=setInterval((()=>{if((0,_jquery.default)("#message[data-id='".concat(annotation.id,"'] iframe")).length){clearInterval(interval);const iframe=document.querySelector("#message[data-id='".concat(annotation.id,"'] iframe"));iframe.style.background="none",iframe.contentDocument.querySelector("html").style.height="unset"}}),1e3);return!(1==annotation.hascompletion&&"manual"==annotation.completiontracking&&!annotation.completed&&"view"!=annotation.completiontracking)||callback}async runInteraction(annotation){this.player.pause();var annoid=annotation.id,self=this;await this.renderViewer(annotation),this.renderContainer(annotation),(async annotation=>{const data=await this.render(annotation,"html");(0,_jquery.default)("#message[data-id='".concat(annotation.id,"'] .modal-body")).attr("id","content").html(data).fadeIn(300),0!=annotation.hascompletion&&(annotation.completed||"view"!=annotation.completiontracking?annotation.completed?this.postContentRender(annotation):this.postContentRender(annotation,(annotation=>{var H5P,iframeinterval=setInterval((function(){try{H5P=document.querySelector("#message[data-id='".concat(annoid,"'] iframe")).contentWindow.H5P}catch(e){H5P=null}null!=H5P&&(clearInterval(iframeinterval),self.isEditMode()&&((0,_jquery.default)("#message[data-id='".concat(annotation.id,"'] #title .xapi")).remove(),(0,_jquery.default)("#message[data-id='".concat(annotation.id,"'] #title .btns")).prepend('<div class="xapi alert-secondary d-inline px-2 rounded-pill">\n                            '.concat(M.util.get_string("xapicheck","ivplugin_h5pupload"),"</div>"))),H5P.externalDispatcher.on("xAPI",(function(event){if(("http://adlnet.gov/expapi/verbs/completed"==event.data.statement.verb.id||"http://adlnet.gov/expapi/verbs/answered"==event.data.statement.verb.id)&&event.data.statement.object.id.indexOf("subContentId")<0){if(self.isEditMode())return(0,_jquery.default)("#message[data-id='".concat(annotation.id,"'] #title .btns .xapi")).remove(),(0,_jquery.default)("#message[data-id='".concat(annotation.id,"'] #title .btns")).prepend('<div class="xapi alert-success d-inline px-2 rounded-pill">\n                                    <i class="fa fa-check mr-2"></i>\n                                    '.concat(M.util.get_string("xapieventdetected","ivplugin_h5pupload"),"\n                                    </div>")),void new Audio(M.cfg.wwwroot+"/mod/interactivevideo/sounds/pop.mp3").play();var complete=!1;("completepass"==annotation.completiontracking&&event.data.statement.result&&event.data.statement.result.score.scaled>=.5||"completefull"==annotation.completiontracking&&event.data.statement.result&&1==event.data.statement.result.score.scaled||"complete"==annotation.completiontracking)&&(complete=!0),complete&&!annotation.completed&&self.toggleCompletion(annoid,"mark-done","automatic")}})))}),1e3)})(annotation)):this.toggleCompletion(annotation.id,"mark-done","automatic"))})(annotation),this.enableManualCompletion(annotation),"popup"==annotation.displayoptions&&(0,_jquery.default)("#annotation-modal").on("shown.bs.modal",(function(){self.setModalDraggable("#annotation-modal .modal-dialog")}))}}return _exports.default=H5pUpload,_exports.default}));

//# sourceMappingURL=main.min.js.map